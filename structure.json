{
  "src": {
    "app": {
      "add-user-modal": {
        "add-user-modal.component.html": "<p>\r\n  add-user-modal works!\r\n</p>\r\n",
        "add-user-modal.component.scss": "",
        "add-user-modal.component.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { IonicModule, ModalController } from '@ionic/angular';\r\nimport { AddUserModalComponent } from './add-user-modal.component';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { User } from '../models/user.model';\r\n\r\ndescribe('AddUserModalComponent', () => {\r\n  let component: AddUserModalComponent;\r\n  let fixture: ComponentFixture<AddUserModalComponent>;\r\n  let modalController: jasmine.SpyObj<ModalController>;\r\n\r\n  beforeEach(async () => {\r\n    modalController = jasmine.createSpyObj('ModalController', ['dismiss']);\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [AddUserModalComponent],\r\n      imports: [\r\n        IonicModule.forRoot(),\r\n        FormsModule\r\n      ],\r\n      providers: [\r\n        { provide: ModalController, useValue: modalController }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(AddUserModalComponent);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  describe('Inicialización de componentes', () => {\r\n    it('crea el componente', () => {\r\n      expect(component).toBeTruthy();\r\n    });\r\n\r\n    it('2. inyecta ModalController', () => {\r\n      expect(modalController).toBeTruthy();\r\n    });\r\n\r\n    it('3. inicializa los valores de usuario predeterminados', () => {\r\n      expect(component.newUser).toBeDefined();\r\n      expect(component.newUser.Name).toBe('');\r\n      expect(component.newUser.Email).toBe('');\r\n      expect(component.newUser.Password).toBe('');\r\n      expect(component.newUser.Role).toBe('employee');\r\n      expect(component.newUser.ApprovalStatus).toBe('pending');\r\n    });\r\n  });\r\n\r\n  describe('UI Elementos', () => {\r\n    it('4. elementos de formulario requeridos.', () => {\r\n      const compiled = fixture.nativeElement;\r\n      expect(compiled.querySelector('ion-title')).toBeTruthy();\r\n      expect(compiled.querySelector('form')).toBeTruthy();\r\n      expect(compiled.querySelector('ion-input[name=\"name\"]')).toBeTruthy();\r\n      expect(compiled.querySelector('ion-input[name=\"email\"]')).toBeTruthy();\r\n      expect(compiled.querySelector('ion-input[name=\"password\"]')).toBeTruthy();\r\n      expect(compiled.querySelector('ion-select[name=\"role\"]')).toBeTruthy();\r\n      expect(compiled.querySelector('ion-select[name=\"approvalStatus\"]')).toBeTruthy();\r\n    });\r\n\r\n    it('5. botones requeridos', () => {\r\n      const compiled = fixture.nativeElement;\r\n      expect(compiled.querySelector('ion-button[type=\"submit\"]')).toBeTruthy();\r\n      expect(compiled.querySelector('ion-button')).toBeTruthy();\r\n    });\r\n  });\r\n\r\n  describe('Modal de interacciones', () => {\r\n    it('1. debe descartar el modal al cancelar', () => {\r\n      component.dismissModal();\r\n      expect(modalController.dismiss).toHaveBeenCalledWith(null, 'cancel');\r\n    });\r\n\r\n    it('2. Deberá enviar el formulario con los datos del usuario.', () => {\r\n      const testUser: User = {\r\n        Name: 'Test User',\r\n        Email: 'test@test.com',\r\n        Password: 'password123',\r\n        Role: 'employee',\r\n        Username: '',\r\n        ApprovalStatus: 'pending',\r\n        ProfilePicture: undefined\r\n      };\r\n\r\n      component.newUser = { ...testUser };\r\n      component.submitForm();\r\n\r\n      expect(modalController.dismiss).toHaveBeenCalledWith(testUser, 'confirm');\r\n    });\r\n  });\r\n\r\n  describe('Actualizaciones de formularios', () => {\r\n    it('3. actualizar el nombre del usuario', () => {\r\n      fixture.detectChanges();\r\n      component.newUser.Name = 'Test User';\r\n      fixture.detectChanges();\r\n\r\n      expect(component.newUser.Name).toBe('Test User');\r\n    });\r\n\r\n    it('4. deberá actualizar el rol del usuario', () => {\r\n      fixture.detectChanges();\r\n      component.newUser.Role = 'admin';\r\n      fixture.detectChanges();\r\n\r\n      expect(component.newUser.Role).toBe('admin');\r\n    });\r\n\r\n    it('5. deberá actualizar el estado de aprobación del usuario', () => {\r\n      fixture.detectChanges();\r\n      component.newUser.ApprovalStatus = 'approved';\r\n      fixture.detectChanges();\r\n\r\n      expect(component.newUser.ApprovalStatus).toBe('approved');\r\n    });\r\n  });\r\n\r\n  describe('Validaciones', () => {\r\n    it('Solo debe aceptar roles válidos', () => {\r\n      const validRoles: Array<'employee' | 'admin' | 'manager'> = ['employee', 'admin', 'manager'];\r\n      \r\n      validRoles.forEach(role => {\r\n        component.newUser.Role = role;\r\n        expect(component.newUser.Role).toBe(role);\r\n      });\r\n    });\r\n  });\r\n});",
        "add-user-modal.component.ts": "import { Component } from '@angular/core';\r\nimport { ModalController } from '@ionic/angular';\r\nimport { User } from '../models/user.model';\r\n\r\n@Component({\r\n  selector: 'app-add-user-modal',\r\n  template: `\r\n    <ion-header>\r\n      <ion-toolbar>\r\n        <ion-title>Agregar Empleado</ion-title>\r\n        <ion-buttons slot=\"end\">\r\n          <ion-button (click)=\"dismissModal()\">Cancelar</ion-button>\r\n        </ion-buttons>\r\n      </ion-toolbar>\r\n    </ion-header>\r\n    <ion-content class=\"ion-padding\">\r\n      <form (ngSubmit)=\"submitForm()\">\r\n        <ion-item>\r\n          <ion-label position=\"floating\">Nombre</ion-label>\r\n          <ion-input [(ngModel)]=\"newUser.Name\" name=\"name\" required></ion-input>\r\n        </ion-item>\r\n        \r\n        <ion-item>\r\n          <ion-label position=\"floating\">Correo electrónico</ion-label>\r\n          <ion-input [(ngModel)]=\"newUser.Email\" name=\"email\" type=\"email\" required></ion-input>\r\n        </ion-item>\r\n        \r\n        <ion-item>\r\n          <ion-label position=\"floating\">Contraseña</ion-label>\r\n          <ion-input [(ngModel)]=\"newUser.Password\" name=\"password\" type=\"password\" required></ion-input>\r\n        </ion-item>\r\n        \r\n        <ion-item>\r\n          <ion-label>Rol</ion-label>\r\n          <ion-select [(ngModel)]=\"newUser.Role\" name=\"role\" required>\r\n            <ion-select-option value=\"employee\">Empleado</ion-select-option>\r\n            <ion-select-option value=\"admin\">Administrador</ion-select-option>\r\n          </ion-select>\r\n        </ion-item>\r\n        \r\n        <ion-item>\r\n          <ion-label>Estado de aprobación</ion-label>\r\n          <ion-select [(ngModel)]=\"newUser.ApprovalStatus\" name=\"approvalStatus\" required>\r\n            <ion-select-option value=\"approved\">Aprobado</ion-select-option>\r\n            <ion-select-option value=\"pending\">Pendiente</ion-select-option>\r\n          </ion-select>\r\n        </ion-item>\r\n        \r\n        <ion-button expand=\"block\" type=\"submit\" class=\"ion-margin-top\">\r\n          Agregar Usuario\r\n        </ion-button>\r\n      </form>\r\n    </ion-content>\r\n  `\r\n})\r\nexport class AddUserModalComponent {\r\n  newUser: User = {\r\n    Name: '',\r\n    Email: '',\r\n    Password: '',\r\n    Role: 'employee',\r\n    Username: '',\r\n    ApprovalStatus: 'pending',\r\n    ProfilePicture: undefined\r\n  };\r\n\r\n  constructor(private modalController: ModalController) {}\r\n\r\n  dismissModal() {\r\n    this.modalController.dismiss(null, 'cancel');\r\n  }\r\n\r\n  submitForm() {\r\n    this.modalController.dismiss(this.newUser, 'confirm');\r\n  }\r\n}"
      },
      "admin-dashboard": {
        "admin-dashboard-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AdminDashboardPage } from './admin-dashboard.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: AdminDashboardPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class AdminDashboardPageRoutingModule {}\r\n",
        "admin-dashboard.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { RouterModule } from '@angular/router';\r\n\r\nimport { AdminDashboardPageRoutingModule } from './admin-dashboard-routing.module';\r\nimport { AdminDashboardPage } from './admin-dashboard.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    AdminDashboardPageRoutingModule,\r\n    RouterModule\r\n  ],\r\n  declarations: [AdminDashboardPage]\r\n})\r\nexport class AdminDashboardPageModule {}",
        "admin-dashboard.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar color=\"primary\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Dashboard de Administrador</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <div class=\"welcome-section\">\r\n    <ion-avatar>\r\n      <img [src]=\"profilePicture || 'assets/default-avatar.png'\" \r\n     (error)=\"handleImageError($event)\" \r\n     alt=\"Foto de perfil\" \r\n     class=\"profile-picture\">\r\n    </ion-avatar>\r\n    <h2>Bienvenido, {{ adminName }}</h2>\r\n  </div>\r\n  \r\n  <ion-grid>\r\n    <ion-row>\r\n      <ion-col size=\"12\" size-md=\"6\">\r\n        <ion-card class=\"dashboard-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"today-outline\" color=\"primary\"></ion-icon>\r\n            <ion-card-title>Órdenes de Hoy</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <h3>{{ orderCount }}</h3>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n      <ion-col size=\"12\" size-md=\"6\">\r\n        <ion-card class=\"dashboard-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"people-outline\" color=\"secondary\"></ion-icon>\r\n            <ion-card-title>Empleados Activos</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <h3>{{ activeEmployees }}</h3>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n    </ion-row>\r\n  </ion-grid>\r\n\r\n  <div class=\"action-buttons\">\r\n    <ion-button expand=\"block\" routerLink=\"/crud\" class=\"custom-button\">\r\n      <ion-icon name=\"restaurant-outline\" slot=\"start\"></ion-icon>\r\n      Gestionar Menú\r\n    </ion-button>\r\n    <ion-button expand=\"block\" routerLink=\"/comandas\" color=\"secondary\" class=\"custom-button\">\r\n      <ion-icon name=\"list-outline\" slot=\"start\"></ion-icon>\r\n      Ver Órdenes\r\n    </ion-button>\r\n    <ion-button expand=\"block\" routerLink=\"/employee-management\" color=\"tertiary\" class=\"custom-button\">\r\n      <ion-icon name=\"people-outline\" slot=\"start\"></ion-icon>\r\n      Gestionar Empleados\r\n    </ion-button>\r\n    <ion-button expand=\"block\" routerLink=\"/admin\" color=\"success\" class=\"custom-button\">\r\n      <ion-icon name=\"bar-chart-outline\" slot=\"start\"></ion-icon>\r\n      Reportes\r\n    </ion-button>\r\n    <ion-button expand=\"block\" routerLink=\"/schedule-meeting\" color=\"secondary\" class=\"custom-button\">\r\n      <ion-icon name=\"calendar-outline\" slot=\"start\"></ion-icon>\r\n      Programar una reunión\r\n    </ion-button>\r\n    <ion-button expand=\"block\" (click)=\"logout()\" color=\"danger\" class=\"custom-button\">\r\n      <ion-icon name=\"log-out-outline\" slot=\"start\"></ion-icon>\r\n      Cerrar Sesión\r\n    </ion-button>\r\n  </div>\r\n</ion-content>",
        "admin-dashboard.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #f4f5f8;\r\n}\r\n\r\nion-content {\r\n  --background: #D4E7EE;\r\n}\r\n\r\n.welcome-section {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 30px;\r\n  background-color: #ffffff;\r\n  border-radius: 12px;\r\n  padding: 20px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n\r\n  ion-avatar {\r\n    width: 70px;\r\n    height: 70px;\r\n    margin-right: 20px;\r\n    border: 3px solid var(--ion-color-primary);\r\n  }\r\n\r\n  h2 {\r\n    color: #405770;\r\n    font-size: 24px;\r\n    font-weight: 600;\r\n    margin: 0;\r\n  }\r\n}\r\n\r\n.dashboard-card, .pending-users-card {\r\n  border-radius: 12px;\r\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\r\n  margin-bottom: 25px;\r\n  background-color: #ffffff;\r\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\r\n\r\n  &:hover {\r\n    transform: translateY(-5px);\r\n    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);\r\n  }\r\n\r\n  ion-card-header {\r\n    display: flex;\r\n    align-items: center;\r\n    background-color: rgba(132, 176, 162, 0.1);\r\n    border-bottom: 1px solid #e0e0e0;\r\n    padding: 16px;\r\n    \r\n    ion-icon {\r\n      font-size: 28px;\r\n      margin-right: 12px;\r\n    }\r\n\r\n    ion-card-title {\r\n      font-size: 18px;\r\n      font-weight: 600;\r\n      color: #405770;\r\n    }\r\n  }\r\n\r\n  ion-card-content {\r\n    padding: 20px;\r\n  }\r\n}\r\n\r\n.dashboard-card {\r\n  ion-card-content {\r\n    text-align: center;\r\n\r\n    h3 {\r\n      font-size: 42px;\r\n      font-weight: bold;\r\n      color: var(--ion-color-primary);\r\n      margin: 10px 0 0;\r\n    }\r\n  }\r\n}\r\n\r\n.pending-users-card {\r\n  ion-list {\r\n    background: transparent;\r\n  }\r\n\r\n  ion-item {\r\n    --background: transparent;\r\n    --border-color: #e0e0e0;\r\n    --padding-start: 0;\r\n    --inner-padding-end: 0;\r\n    margin-bottom: 10px;\r\n\r\n    &:last-child {\r\n      --border-color: transparent;\r\n      margin-bottom: 0;\r\n    }\r\n\r\n    ion-label {\r\n      h2 {\r\n        font-weight: 600;\r\n        color: #405770;\r\n        margin-bottom: 5px;\r\n      }\r\n      p {\r\n        color: var(--ion-color-medium);\r\n      }\r\n    }\r\n\r\n    ion-button {\r\n      margin-left: 8px;\r\n    }\r\n  }\r\n\r\n  .no-pending-users {\r\n    text-align: center;\r\n    color: var(--ion-color-medium);\r\n    font-style: italic;\r\n    padding: 20px 0;\r\n  }\r\n}\r\n\r\n.action-buttons {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\r\n  gap: 15px;\r\n\r\n  .custom-button {\r\n    --border-radius: 10px;\r\n    font-weight: 500;\r\n    height: 50px;\r\n    font-size: 16px;\r\n    text-transform: none;\r\n\r\n    ion-icon {\r\n      margin-right: 8px;\r\n      font-size: 20px;\r\n    }\r\n  }\r\n}\r\n\r\n// Animations\r\n@keyframes fadeIn {\r\n  from { opacity: 0; transform: translateY(20px); }\r\n  to { opacity: 1; transform: translateY(0); }\r\n}\r\n\r\n.welcome-section, .dashboard-card, .pending-users-card, .action-buttons .custom-button {\r\n  animation: fadeIn 0.5s ease-out forwards;\r\n}\r\n\r\n.dashboard-card:nth-child(1) { animation-delay: 0.1s; }\r\n.dashboard-card:nth-child(2) { animation-delay: 0.2s; }\r\n.pending-users-card { animation-delay: 0.3s; }\r\n.action-buttons .custom-button:nth-child(1) { animation-delay: 0.4s; }\r\n.action-buttons .custom-button:nth-child(2) { animation-delay: 0.5s; }\r\n.action-buttons .custom-button:nth-child(3) { animation-delay: 0.6s; }\r\n.action-buttons .custom-button:nth-child(4) { animation-delay: 0.7s; }\r\n.action-buttons .custom-button:nth-child(5) { animation-delay: 0.8s; }\r\n\r\n@media (max-width: 576px) {\r\n  .welcome-section {\r\n    flex-direction: column;\r\n    text-align: center;\r\n    padding: 15px;\r\n\r\n    ion-avatar {\r\n      margin-right: 0;\r\n      margin-bottom: 15px;\r\n    }\r\n\r\n    h2 {\r\n      font-size: 22px;\r\n    }\r\n  }\r\n\r\n  .dashboard-card {\r\n    ion-card-content {\r\n      h3 {\r\n        font-size: 36px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .pending-users-card {\r\n    ion-item {\r\n      flex-direction: column;\r\n      align-items: flex-start;\r\n\r\n      ion-label {\r\n        margin-bottom: 10px;\r\n      }\r\n\r\n      ion-button {\r\n        margin-left: 0;\r\n        margin-top: 5px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .action-buttons {\r\n    grid-template-columns: 1fr;\r\n\r\n    .custom-button {\r\n      height: 45px;\r\n      font-size: 14px;\r\n    }\r\n  }\r\n}",
        "admin-dashboard.page.spec.ts": "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { IonicModule, LoadingController, ToastController, NavController } from '@ionic/angular';\r\nimport { AdminDashboardPage } from './admin-dashboard.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { Router } from '@angular/router';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { of } from 'rxjs';\r\nimport { User } from '../models/user.model';\r\n\r\ndescribe('AdminDashboardPage', () => {\r\n  let component: AdminDashboardPage;\r\n  let fixture: ComponentFixture<AdminDashboardPage>;\r\n  let databaseService: jasmine.SpyObj<DatabaseService>;\r\n  let router: jasmine.SpyObj<Router>;\r\n  let loadingController: jasmine.SpyObj<LoadingController>;\r\n  let toastController: jasmine.SpyObj<ToastController>;\r\n  let navController: jasmine.SpyObj<NavController>;\r\n\r\n  const mockUser = {\r\n    UserID: 1,\r\n    Username: 'admin',\r\n    Password: 'test123',\r\n    Role: 'admin',\r\n    Name: 'Test Admin',\r\n    Email: 'admin@test.com',\r\n    ApprovalStatus: 'approved',\r\n    profilePicture: 'test.jpg'  \r\n  };\r\n  \r\n  const mockPendingUsers: User[] = [\r\n    {\r\n      UserID: 2,\r\n      Username: 'pending1',\r\n      Password: 'test123',\r\n      Role: 'employee' as 'admin' | 'employee' | 'manager',\r\n      Name: 'Pending User 1',\r\n      Email: 'pending1@test.com',\r\n      ApprovalStatus: 'pending',\r\n      ProfilePicture: null\r\n    },\r\n    {\r\n      UserID: 3,\r\n      Username: 'pending2',\r\n      Password: 'test123',\r\n      Role: 'employee' as 'admin' | 'employee' | 'manager',\r\n      Name: 'Pending User 2',\r\n      Email: 'pending2@test.com',\r\n      ApprovalStatus: 'pending',\r\n      ProfilePicture: null\r\n    }\r\n  ];\r\n\r\n  const mockLoading = {\r\n    present: () => Promise.resolve(),\r\n    dismiss: () => Promise.resolve()\r\n  };\r\n\r\n  const mockToast = {\r\n    present: () => Promise.resolve()\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', {\r\n      'getUserProfilePicture': of('test-profile.jpg'),\r\n      'getOrderCountForToday': Promise.resolve(5),\r\n      'getActiveEmployeesCount': Promise.resolve(3),\r\n      'getPendingUsers': of([]),  // Inicialmente vacío\r\n      'updateUserApprovalStatus': of(true)\r\n    });\r\n\r\n    const routerSpy = jasmine.createSpyObj('Router', ['navigate']);\r\n    const navSpy = jasmine.createSpyObj('NavController', ['navigateForward', 'navigateRoot']);\r\n    const loadingSpy = jasmine.createSpyObj('LoadingController', {\r\n      create: Promise.resolve(mockLoading)\r\n    });\r\n    const toastSpy = jasmine.createSpyObj('ToastController', {\r\n      create: Promise.resolve(mockToast)\r\n    });\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [AdminDashboardPage],\r\n      imports: [IonicModule.forRoot()],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { provide: Router, useValue: routerSpy },\r\n        { provide: LoadingController, useValue: loadingSpy },\r\n        { provide: ToastController, useValue: toastSpy },\r\n        { provide: NavController, useValue: navSpy }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(AdminDashboardPage);\r\n    component = fixture.componentInstance;\r\n    databaseService = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    router = TestBed.inject(Router) as jasmine.SpyObj<Router>;\r\n    loadingController = TestBed.inject(LoadingController) as jasmine.SpyObj<LoadingController>;\r\n    toastController = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    navController = TestBed.inject(NavController) as jasmine.SpyObj<NavController>;\r\n\r\n    spyOn(localStorage, 'getItem').and.returnValue(JSON.stringify(mockUser));\r\n    spyOn(localStorage, 'setItem');\r\n    spyOn(localStorage, 'removeItem');\r\n\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  describe('Component Initialization', () => {\r\n    it('1. debe crear el componente', () => {\r\n      expect(component).toBeTruthy();\r\n    });\r\n\r\n    it('2. debe inicializar con valores predeterminados', async () => {\r\n      component.pendingUsers = [];\r\n      component.orderCount = 0;\r\n      component.activeEmployees = 0;\r\n      \r\n      expect(component.adminName).toBe('Admin');\r\n      expect(component.orderCount).toBe(0);\r\n      expect(component.activeEmployees).toBe(0);\r\n      expect(component.pendingUsers).toEqual([]);\r\n    });\r\n\r\n    it('3. debe tener las dependencias inyectadas', () => {\r\n      expect(databaseService).toBeTruthy();\r\n      expect(router).toBeTruthy();\r\n      expect(loadingController).toBeTruthy();\r\n      expect(toastController).toBeTruthy();\r\n      expect(navController).toBeTruthy();\r\n    });\r\n\r\n    it('4. debe tener ion-header y ion-content', () => {\r\n      const compiled = fixture.nativeElement;\r\n      expect(compiled.querySelector('ion-header')).toBeTruthy();\r\n      expect(compiled.querySelector('ion-content')).toBeTruthy();\r\n    });\r\n\r\n    it('5. debe obtener la imagen de perfil del usuario', fakeAsync(() => {\r\n      component.ngOnInit();\r\n      tick();\r\n      \r\n      const storedUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n      expect(component.profilePicture).toBe(storedUser.profilePicture);\r\n    }));\r\n  });\r\n\r\n  describe('Funcionalidades de la Dashboard', () => {\r\n    it('1. debe cargar estadísticas correctamente', fakeAsync(async () => {\r\n      await component.loadDashboardData();\r\n      tick();\r\n  \r\n      expect(databaseService.getOrderCountForToday).toHaveBeenCalled();\r\n      expect(databaseService.getActiveEmployeesCount).toHaveBeenCalled();\r\n      expect(component.orderCount).toBe(5);\r\n      expect(component.activeEmployees).toBe(3);\r\n    }));\r\n  \r\n    it('2. debe cargar usuarios pendientes', fakeAsync(async () => {\r\n      databaseService.getPendingUsers.and.returnValue(of(mockPendingUsers));\r\n      \r\n      await component.loadPendingUsers();\r\n      tick();\r\n  \r\n      expect(databaseService.getPendingUsers).toHaveBeenCalled();\r\n      expect(component.pendingUsers).toEqual(mockPendingUsers);\r\n    }));\r\n  });\r\n\r\n  describe('gestión de usuarios', () => {\r\n    beforeEach(() => {\r\n      component.pendingUsers = [...mockPendingUsers];\r\n    });\r\n\r\n    it('3. debe aprobar un usuario correctamente', fakeAsync(async () => {\r\n      await component.approveUser(2);\r\n      tick();\r\n  \r\n      expect(databaseService.updateUserApprovalStatus).toHaveBeenCalledWith(2, 'approved');\r\n      expect(toastController.create).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          message: 'Usuario aprobado con éxito.'\r\n        })\r\n      );\r\n    }));\r\n  \r\n    it('4. debe rechazar un usuario correctamente', fakeAsync(async () => {\r\n      await component.rejectUser(2);\r\n      tick();\r\n  \r\n      expect(databaseService.updateUserApprovalStatus).toHaveBeenCalledWith(2, 'rejected');\r\n      expect(toastController.create).toHaveBeenCalledWith(\r\n        jasmine.objectContaining({\r\n          message: 'Usuario rechazado.'\r\n        })\r\n      );\r\n    }));\r\n  });\r\n\r\n  describe('gestión de sesión', () => {\r\n    it('5. debe cerrar sesión', () => {\r\n      component.logout();\r\n      \r\n      expect(localStorage.removeItem).toHaveBeenCalledWith('currentUser');\r\n      expect(router.navigate).toHaveBeenCalledWith(['/login']);\r\n    });\r\n  });\r\n\r\n  describe('manejo de errores', () => {\r\n    it('Debería manejar el error de imagen configurando el avatar predeterminado', () => {\r\n      const event = { target: { src: '' } };\r\n      component.handleImageError(event);\r\n      expect(event.target.src).toBe('assets/default-avatar.png');\r\n    });\r\n  });\r\n});",
        "admin-dashboard.page.ts": "import { Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { LoadingController, ToastController } from '@ionic/angular';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { User } from '../models/user.model';\r\n\r\n@Component({\r\n  selector: 'app-admin-dashboard',\r\n  templateUrl: './admin-dashboard.page.html',\r\n  styleUrls: ['./admin-dashboard.page.scss'],\r\n})\r\nexport class AdminDashboardPage implements OnInit {\r\n  adminName: string = 'Admin';\r\n  adminProfilePicture: string | null = null;\r\n  orderCount: number = 0;\r\n  activeEmployees: number = 0;\r\n  pendingUsers: User[] = [];\r\n  profilePicture: string | null = null;\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private loadingController: LoadingController,\r\n    private toastController: ToastController,\r\n    private databaseService: DatabaseService\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.loadDashboardData();\r\n    this.loadPendingUsers();\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    this.profilePicture = currentUser.profilePicture || null;\r\n  }\r\n\r\n  handleImageError(event: any) {\r\n    event.target.src = 'assets/default-avatar.png';\r\n  }\r\n  async loadDashboardData() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando datos...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n      this.adminName = currentUser.name || 'Admin';\r\n      this.adminProfilePicture = currentUser.profilePicture || null;\r\n  \r\n      // Si no hay foto en localStorage, intenta cargarla de la base de datos\r\n      if (!this.adminProfilePicture && currentUser.id) {\r\n        try {\r\n          const profilePicture = await this.databaseService.getUserProfilePicture(currentUser.id).toPromise();\r\n          this.adminProfilePicture = profilePicture !== undefined ? profilePicture : null;\r\n          // Actualizar el localStorage con la imagen cargada\r\n          if (this.adminProfilePicture) {\r\n            currentUser.profilePicture = this.adminProfilePicture;\r\n            localStorage.setItem('currentUser', JSON.stringify(currentUser));\r\n          }\r\n        } catch (error) {\r\n          console.error('Error al cargar la foto de perfil:', error);\r\n        }\r\n      }\r\n  \r\n      // Obtener el número real de órdenes del día\r\n      this.orderCount = await this.databaseService.getOrderCountForToday();\r\n      console.log('Número de órdenes del día:', this.orderCount);\r\n  \r\n      // Obtener el número real de empleados activos\r\n      this.activeEmployees = await this.databaseService.getActiveEmployeesCount();\r\n      console.log('Número de empleados activos:', this.activeEmployees);\r\n  \r\n    } catch (error) {\r\n      console.error('Error al cargar datos del dashboard:', error);\r\n      await this.presentToast('Error al cargar datos. Por favor, intente de nuevo.');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  async loadPendingUsers() {\r\n    try {\r\n      console.log('Cargando usuarios pendientes');\r\n      const users = await this.databaseService.getPendingUsers().toPromise();\r\n      console.log('Usuarios pendientes obtenidos:', users);\r\n      this.pendingUsers = users || []; \r\n    } catch (error) {\r\n      console.error('Error al cargar usuarios pendientes:', error);\r\n      this.presentToast('Error al cargar usuarios pendientes.');\r\n      this.pendingUsers = []; \r\n    }\r\n  }\r\n\r\n  async approveUser(userId: number) {\r\n    try {\r\n      console.log('Intentando aprobar usuario con ID:', userId);\r\n      const success = await this.databaseService.updateUserApprovalStatus(userId, 'approved').toPromise();\r\n      console.log('Resultado de la aprobación:', success);\r\n      if (success) {\r\n        this.presentToast('Usuario aprobado con éxito.');\r\n        await this.loadPendingUsers(); \r\n        console.log('Lista de usuarios pendientes actualizada');\r\n      } else {\r\n        throw new Error('No se pudo aprobar el usuario');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al aprobar usuario:', error);\r\n      this.presentToast('Error al aprobar usuario.');\r\n    }\r\n  }\r\n  async rejectUser(userId: number) {\r\n    try {\r\n      console.log('Intentando rechazar usuario con ID:', userId);\r\n      const success = await this.databaseService.updateUserApprovalStatus(userId, 'rejected').toPromise();\r\n      console.log('Resultado del rechazo:', success);\r\n      if (success) {\r\n        this.presentToast('Usuario rechazado.');\r\n        await this.loadPendingUsers();\r\n        console.log('Lista de usuarios pendientes actualizada');\r\n      } else {\r\n        throw new Error('No se pudo rechazar el usuario');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al rechazar usuario:', error);\r\n      this.presentToast('Error al rechazar usuario.');\r\n    }\r\n  }\r\n\r\n  logout() {\r\n    localStorage.removeItem('currentUser');\r\n    this.router.navigate(['/login']);\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'bottom'\r\n    });\r\n    toast.present();\r\n  }\r\n}"
      },
      "admin": {
        "admin-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AdminPage } from './admin.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: AdminPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class AdminPageRoutingModule {}\r\n",
        "admin.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { AdminPageRoutingModule } from './admin-routing.module';\r\nimport { AdminPage } from './admin.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    AdminPageRoutingModule\r\n  ],\r\n  declarations: [AdminPage]\r\n})\r\nexport class AdminPageModule {}",
        "admin.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Reportes de ventas</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n<ion-content class=\"ion-padding\">\r\n  <h1 class=\"main-title\">Panel de Administración</h1>\r\n\r\n  <ion-grid>\r\n    <ion-row>\r\n      <ion-col size=\"12\" size-md=\"6\">\r\n        <ion-card class=\"dashboard-card sales-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"cash-outline\" color=\"primary\"></ion-icon>\r\n            <ion-card-title>Ventas Totales</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <h2 class=\"big-number\">{{ totalSales | currency:'CLP':'symbol-narrow':'1.0-0' }}</h2>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n      <ion-col size=\"12\" size-md=\"6\">\r\n        <ion-card class=\"dashboard-card canceled-orders-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"close-circle-outline\" color=\"danger\"></ion-icon>\r\n            <ion-card-title>Órdenes Canceladas</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <h2 class=\"big-number danger\">{{ ordenesCancel.cantidad }}</h2>\r\n            <p>Total: {{ ordenesCancel.total | currency:'CLP':'symbol-narrow':'1.0-0' }}</p>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n    </ion-row>\r\n\r\n    <ion-row>\r\n      <ion-col size=\"12\">\r\n        <ion-card class=\"dashboard-card weekly-sales-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"calendar-outline\" color=\"tertiary\"></ion-icon>\r\n            <ion-card-title>Ventas de la Semana</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <div class=\"week-container\">\r\n              <div class=\"day-card\" *ngFor=\"let day of dailySales\" (click)=\"showDayDetails(day)\">\r\n                <h3>{{ day.day }}</h3>\r\n              </div>\r\n            </div>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n    </ion-row>\r\n\r\n    <ion-row *ngIf=\"selectedDay\">\r\n      <ion-col size=\"12\">\r\n        <ion-card class=\"dashboard-card day-details-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"analytics-outline\" color=\"success\"></ion-icon>\r\n            <ion-card-title>Detalle del {{ selectedDay.day }}</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <p>Ventas: {{ selectedDay.amount | currency:'CLP':'symbol-narrow':'1.0-0' }}</p>\r\n            <p>Órdenes Canceladas: {{ selectedDay.canceledOrders }}</p>\r\n            <p>Total Cancelado: {{ selectedDay.canceledAmount | currency:'CLP':'symbol-narrow':'1.0-0' }}</p>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n    </ion-row>\r\n\r\n    <ion-row>\r\n      <ion-col size=\"12\">\r\n        <ion-card class=\"dashboard-card top-products-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"trophy-outline\" color=\"warning\"></ion-icon>\r\n            <ion-card-title>Productos Más Vendidos</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <ion-list lines=\"none\">\r\n              <ion-item *ngFor=\"let product of topProducts; let i = index\">\r\n                <ion-label>\r\n                  <h2>{{ i + 1 }}. {{ product.name }}</h2>\r\n                  <p>Ventas: {{ product.sales }}</p>\r\n                </ion-label>\r\n                <ion-badge slot=\"end\" color=\"primary\">{{ product.sales }}</ion-badge>\r\n              </ion-item>\r\n            </ion-list>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n    </ion-row>\r\n  </ion-grid>\r\n\r\n  <ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\">\r\n    <ion-fab-button (click)=\"generateReport()\" color=\"tertiary\">\r\n      <ion-icon name=\"document-text-outline\"></ion-icon>\r\n    </ion-fab-button>\r\n  </ion-fab>\r\n</ion-content>",
        "admin.page.scss": ":host {\r\n  --color-background: #D4E7EE;\r\n  --color-text: #405770;\r\n  --color-light: #F7F9F9;\r\n  --color-border: #E0D8D3;\r\n  --color-button: #405770;\r\n  --color-primary: #84B0A2;\r\n  --color-secondary: #D4A082;\r\n  --color-tertiary: #ECC9A3;\r\n  --color-success: #2ecc71;\r\n  --color-warning: #f39c12;\r\n  --color-danger: #e74c3c;\r\n}\r\n\r\nion-content {\r\n  --background: var(--color-background);\r\n}\r\n\r\n.main-title {\r\n  font-size: 28px;\r\n  font-weight: bold;\r\n  color: var(--color-text);\r\n  margin-bottom: 24px;\r\n  text-align: center;\r\n}\r\n\r\nion-card {\r\n  background-color: var(--color-light);\r\n  border-radius: 16px;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\r\n  overflow: hidden;\r\n  margin-bottom: 24px;\r\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\r\n\r\n  &:hover {\r\n    transform: translateY(-5px);\r\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);\r\n  }\r\n}\r\n\r\n.dashboard-card {\r\n  ion-card-header {\r\n    background-color: rgba(var(--ion-color-primary-rgb), 0.1);\r\n    padding: 16px;\r\n    display: flex;\r\n    align-items: center;\r\n\r\n    ion-icon {\r\n      font-size: 24px;\r\n      margin-right: 12px;\r\n    }\r\n\r\n    ion-card-title {\r\n      font-size: 18px;\r\n      font-weight: 600;\r\n      color: var(--color-text);\r\n      margin: 0;\r\n    }\r\n  }\r\n\r\n  ion-card-content {\r\n    padding: 20px;\r\n  }\r\n\r\n  .big-number {\r\n    font-size: 36px;\r\n    font-weight: bold;\r\n    color: var(--color-primary);\r\n    margin: 16px 0;\r\n    text-align: center;\r\n\r\n    &.danger {\r\n      color: var(--color-danger);\r\n    }\r\n  }\r\n}\r\n\r\n.top-products-card {\r\n  ion-list {\r\n    background: transparent;\r\n  }\r\n\r\n  ion-item {\r\n    --background: transparent;\r\n    --padding-start: 0;\r\n    --inner-padding-end: 0;\r\n    --min-height: 60px;\r\n\r\n    &:not(:last-child) {\r\n      --border-color: rgba(var(--ion-color-medium-rgb), 0.2);\r\n      --border-style: dashed;\r\n      --border-width: 0 0 1px 0;\r\n    }\r\n\r\n    h2 {\r\n      font-weight: 600;\r\n      color: var(--color-text);\r\n      margin-bottom: 4px;\r\n    }\r\n\r\n    p {\r\n      color: var(--ion-color-medium);\r\n      font-size: 14px;\r\n    }\r\n\r\n    ion-badge {\r\n      font-size: 14px;\r\n      padding: 4px 8px;\r\n      border-radius: 12px;\r\n    }\r\n  }\r\n}\r\n\r\n.daily-sales-card {\r\n  .chart-container {\r\n    position: relative;\r\n    height: 300px;\r\n    width: 100%;\r\n    margin-top: 16px;\r\n  }\r\n}\r\n\r\nion-fab-button {\r\n  --box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .main-title {\r\n    font-size: 24px;\r\n  }\r\n\r\n  .dashboard-card {\r\n    .big-number {\r\n      font-size: 28px;\r\n    }\r\n  }\r\n\r\n  .chart-container {\r\n    height: 250px;\r\n  }\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  .main-title {\r\n    font-size: 22px;\r\n  }\r\n\r\n  .dashboard-card {\r\n    ion-card-header {\r\n      ion-card-title {\r\n        font-size: 16px;\r\n      }\r\n    }\r\n\r\n    .big-number {\r\n      font-size: 24px;\r\n    }\r\n  }\r\n\r\n  .top-products-card {\r\n    ion-item {\r\n      h2 {\r\n        font-size: 14px;\r\n      }\r\n\r\n      p {\r\n        font-size: 12px;\r\n      }\r\n\r\n      ion-badge {\r\n        font-size: 12px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .weekly-sales-card {\r\n    .week-container {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      flex-wrap: wrap;\r\n      gap: 10px;\r\n  \r\n      .day-card {\r\n        flex: 1;\r\n        min-width: calc(14% - 10px);\r\n        background-color: rgba(var(--ion-color-primary-rgb), 0.1);\r\n        border-radius: 10px;\r\n        padding: 10px;\r\n        text-align: center;\r\n        cursor: pointer;\r\n        transition: background-color 0.3s ease, transform 0.3s ease;\r\n  \r\n        &:hover {\r\n          background-color: rgba(var(--ion-color-primary-rgb), 0.2);\r\n          transform: translateY(-3px);\r\n        }\r\n  \r\n        h3 {\r\n          margin: 0;\r\n          font-size: 16px;\r\n          font-weight: 600;\r\n          color: var(--color-text);\r\n        }\r\n  \r\n        p {\r\n          margin: 5px 0 0;\r\n          font-size: 14px;\r\n          color: var(--color-primary);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .day-details-card {\r\n    animation: fadeIn 0.3s ease-out;\r\n  }\r\n  .chart-container {\r\n    height: 200px;\r\n  }\r\n  \r\n  @keyframes fadeIn {\r\n    from { opacity: 0; transform: translateY(20px); }\r\n    to { opacity: 1; transform: translateY(0); }\r\n  }\r\n\r\n}",
        "admin.page.spec.ts": "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { IonicModule, LoadingController, ToastController, Platform, AlertController } from '@ionic/angular';\r\nimport { AdminPage } from './admin.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { of } from 'rxjs';\r\n\r\ndescribe('AdminPage', () => {\r\n  let component: AdminPage;\r\n  let fixture: ComponentFixture<AdminPage>;\r\n  let databaseService: jasmine.SpyObj<DatabaseService>;\r\n  let loadingController: jasmine.SpyObj<LoadingController>;\r\n  let toastController: jasmine.SpyObj<ToastController>;\r\n  let alertController: jasmine.SpyObj<AlertController>;\r\n\r\n  const mockTopProducts = [\r\n    { productId: 1, name: 'Producto 1', totalSold: 10 },\r\n    { productId: 2, name: 'Producto 2', totalSold: 8 }\r\n  ];\r\n\r\n  const mockDailySales = [\r\n    { \r\n      day: 'Lunes',\r\n      date: new Date(),\r\n      amount: 1000,\r\n      canceledAmount: 200,\r\n      canceledOrders: 2\r\n    }\r\n  ];\r\n\r\n  const mockLoading = {\r\n    present: jasmine.createSpy('present').and.returnValue(Promise.resolve()),\r\n    dismiss: jasmine.createSpy('dismiss').and.returnValue(Promise.resolve())\r\n  };\r\n\r\n  const mockToast = {\r\n    present: jasmine.createSpy('present').and.returnValue(Promise.resolve())\r\n  };\r\n\r\n  const mockAlert = {\r\n    present: jasmine.createSpy('present').and.returnValue(Promise.resolve())\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    databaseService = jasmine.createSpyObj('DatabaseService', {\r\n      'calculateTotalSales': Promise.resolve(5000),\r\n      'getTopSellingProducts': Promise.resolve(mockTopProducts),\r\n      'getOrdersCount': Promise.resolve(3)\r\n    });\r\n\r\n    loadingController = jasmine.createSpyObj('LoadingController', {\r\n      create: Promise.resolve(mockLoading)\r\n    });\r\n\r\n    toastController = jasmine.createSpyObj('ToastController', {\r\n      create: Promise.resolve(mockToast)\r\n    });\r\n\r\n    alertController = jasmine.createSpyObj('AlertController', {\r\n      create: Promise.resolve(mockAlert)\r\n    });\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [AdminPage],\r\n      imports: [IonicModule.forRoot()],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: databaseService },\r\n        { provide: LoadingController, useValue: loadingController },\r\n        { provide: ToastController, useValue: toastController },\r\n        { provide: AlertController, useValue: alertController }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(AdminPage);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('1. debe ser creado el componente', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('2. debe tener las dependencias inyectadas', () => {\r\n    expect(databaseService).toBeTruthy();\r\n    expect(loadingController).toBeTruthy();\r\n    expect(toastController).toBeTruthy();\r\n    expect(alertController).toBeTruthy();\r\n  });\r\n\r\n  it('3. debe inicializar con valores predeterminados', () => {\r\n    expect(component.totalSales).toBe(0);\r\n    expect(component.ventasRealizadas).toBe(0);\r\n    expect(component.ventasCanceladas).toBe(0);\r\n    expect(component.topProducts).toEqual([]);\r\n    expect(component.selectedDay).toBeNull();\r\n  });\r\n\r\n  it('4. debe tener ion-header y ion-content', () => {\r\n    const compiled = fixture.nativeElement;\r\n    expect(compiled.querySelector('ion-header')).toBeTruthy();\r\n    expect(compiled.querySelector('ion-content')).toBeTruthy();\r\n  });\r\n\r\n  it('5. debe suscribirse y desuscribirse de observables', () => {\r\n    const subscriptionSpy = spyOn(component['subscriptions'], 'unsubscribe');\r\n    component.ngOnDestroy();\r\n    expect(subscriptionSpy).toHaveBeenCalled();\r\n  });\r\n\r\n\r\n  it('1. debe cargar estadísticas correctamente', fakeAsync(async () => {\r\n    await component.loadStatistics();\r\n    tick();\r\n\r\n    expect(loadingController.create).toHaveBeenCalled();\r\n    expect(databaseService.calculateTotalSales).toHaveBeenCalled();\r\n    expect(databaseService.getTopSellingProducts).toHaveBeenCalled();\r\n    expect(component.topProducts.length).toBeGreaterThan(0);\r\n    expect(mockLoading.dismiss).toHaveBeenCalled();\r\n  }));\r\n\r\n  it('2. debe mostrar detalles del día', () => {\r\n    const mockDay = {\r\n      day: 'Lunes',\r\n      date: new Date(),\r\n      amount: 1000,\r\n      canceledAmount: 200,\r\n      canceledOrders: 2\r\n    };\r\n\r\n    component.showDayDetails(mockDay);\r\n    expect(component.selectedDay).toEqual(mockDay);\r\n  });\r\n\r\n  it('3. debe seleccionar órdenes canceladas', () => {\r\n    const mockDay = {\r\n      day: 'Lunes',\r\n      date: new Date(),\r\n      amount: 1000,\r\n      canceledAmount: 200,\r\n      canceledOrders: 2\r\n    };\r\n    \r\n    component.selectedDay = mockDay;\r\n    const result = component.selectCancelOrders();\r\n    expect(result).toBe(200);\r\n  });\r\n\r\n  it('4. debe presentar un toast', async () => {\r\n    const message = 'Test message';\r\n    await component['presentToast'](message);\r\n    expect(toastController.create).toHaveBeenCalledWith({\r\n      message,\r\n      duration: 2000,\r\n      position: 'bottom'\r\n    });\r\n  });\r\n\r\n  it('5. debe manejar errores al cargar las estadísticas', fakeAsync(async () => {\r\n    databaseService.calculateTotalSales.and.rejectWith('Error');\r\n    \r\n    await component.loadStatistics();\r\n    tick();\r\n\r\n    expect(toastController.create).toHaveBeenCalledWith({\r\n      message: 'Error al cargar estadísticas. Por favor, intente de nuevo.',\r\n      duration: 2000,\r\n      position: 'bottom'\r\n    });\r\n    expect(mockLoading.dismiss).toHaveBeenCalled();\r\n  }));\r\n\r\n  // Prueba adicional para verificar la limpieza del gráfico\r\n  it('6. debe limpiar el gráfico', () => {\r\n    const mockChart = { destroy: jasmine.createSpy('destroy') };\r\n    component['chart'] = mockChart as any;\r\n    \r\n    component.ngOnDestroy();\r\n    \r\n    expect(mockChart.destroy).toHaveBeenCalled();\r\n  });\r\n});",
        "admin.page.ts": "import { Component, OnInit, ViewChild, ElementRef, AfterViewInit, OnDestroy } from '@angular/core';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { ToastController, LoadingController, Platform, AlertController } from '@ionic/angular';\r\nimport * as pdfMake from 'pdfmake/build/pdfmake';\r\nimport * as pdfFonts from 'pdfmake/build/vfs_fonts';\r\nimport { TDocumentDefinitions } from 'pdfmake/interfaces';\r\nimport { Chart, ChartConfiguration } from 'chart.js/auto';\r\nimport { Subscription } from 'rxjs';\r\nimport { Capacitor, Plugins } from '@capacitor/core';\r\nimport { Filesystem, Directory, Encoding } from '@capacitor/filesystem';\r\nimport { App } from '@capacitor/app';\r\nimport { DailySale } from '../models/daily-sale.model';\r\nimport { TopProduct } from '../models/top-product.model';\r\n\r\nconst { Permissions } = Plugins;\r\nconst { Share } = Plugins;\r\n\r\n// Configuración de pdfMake\r\n(pdfMake as any).vfs = pdfFonts.pdfMake.vfs;\r\n\r\n@Component({\r\n  selector: 'app-admin',\r\n  templateUrl: './admin.page.html',\r\n  styleUrls: ['./admin.page.scss'],\r\n})\r\nexport class AdminPage implements OnInit, AfterViewInit, OnDestroy {\r\n  @ViewChild('dailySalesChart') private chartRef!: ElementRef;\r\n  private chart: Chart | undefined;\r\n  totalSales: number = 0;\r\n  topProducts: TopProduct[] = [];\r\n  selectedDay: DailySale | null = null;\r\n  dailySales: DailySale[] = [];\r\n  private subscriptions: Subscription = new Subscription();\r\n\r\n  ventasRealizadas: number = 0;\r\n  ventasCanceladas: number = 0;\r\n\r\n  ordenesCancel = {\r\n    cantidad: 0,\r\n    total: 0\r\n  };\r\n\r\n  constructor(\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController,\r\n    private loadingController: LoadingController,\r\n    private platform: Platform,\r\n    private alertController: AlertController  \r\n  ) {\r\n    (pdfMake as any).vfs = pdfFonts.pdfMake.vfs;\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.loadStatistics();\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    if (this.dailySales.length > 0) {\r\n      this.createChart();\r\n    }\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscriptions.unsubscribe();\r\n    if (this.chart) {\r\n      this.chart.destroy();\r\n    }\r\n  }\r\n\r\n  showDayDetails(day: DailySale) {\r\n    this.selectedDay = day;\r\n  }\r\n\r\n  async loadStatistics() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando estadísticas...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const endDate = new Date();\r\n      const startDate = new Date(endDate);\r\n      startDate.setDate(startDate.getDate() - 6); // Últimos 7 días\r\n  \r\n      this.totalSales = await this.databaseService.calculateTotalSales(\r\n        startDate.toISOString().split('T')[0],\r\n        endDate.toISOString().split('T')[0],\r\n        ['Solicitado', 'En proceso', 'Listo', 'Entregado']\r\n      );\r\n  \r\n      this.ordenesCancel = {\r\n        cantidad: await this.databaseService.getOrdersCount(['Cancelado']),\r\n        total: await this.databaseService.calculateTotalSales(\r\n          startDate.toISOString().split('T')[0],\r\n          endDate.toISOString().split('T')[0],\r\n          ['Cancelado']\r\n        )\r\n      };\r\n  \r\n      const topProductsData = await this.databaseService.getTopSellingProducts(5);\r\n      this.topProducts = topProductsData.map(product => ({\r\n        productId: product.productId,\r\n        name: product.name,\r\n        totalSold: product.totalSold,\r\n        sales: product.totalSold \r\n      }));\r\n  \r\n      this.dailySales = await this.getDailySales(startDate, endDate);\r\n  \r\n      const today = new Date().getDay();\r\n      this.selectedDay = this.dailySales[today];\r\n  \r\n      console.log('Estadísticas cargadas:', {\r\n        totalSales: this.totalSales,\r\n        ordenesCancel: this.ordenesCancel,\r\n        topProducts: this.topProducts,\r\n        dailySales: this.dailySales\r\n      });\r\n  \r\n    } catch (error) {\r\n      console.error('Error al cargar estadísticas:', error);\r\n      this.presentToast('Error al cargar estadísticas. Por favor, intente de nuevo.');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n  \r\n  private createChart() {\r\n    if (this.chart) {\r\n      this.chart.destroy();\r\n    }\r\n    if (!this.chartRef) {\r\n      console.error('Chart reference not found');\r\n      return;\r\n    }\r\n  \r\n    const ctx = this.chartRef.nativeElement.getContext('2d');\r\n    if (!ctx) {\r\n      console.error('Unable to get 2D context for canvas');\r\n      return;\r\n    }\r\n  \r\n    const config: ChartConfiguration = {\r\n      type: 'line', \r\n      data: {\r\n        labels: this.dailySales.map(sale => sale.day),\r\n        datasets: [\r\n          {\r\n            label: 'Ventas Realizadas',\r\n            data: this.dailySales.map(sale => sale.amount),\r\n            borderColor: 'rgba(75, 192, 192, 1)',\r\n            backgroundColor: 'rgba(75, 192, 192, 0.2)',\r\n            fill: true\r\n          },\r\n          {\r\n            label: 'Ventas Canceladas',\r\n            data: this.dailySales.map(sale => sale.canceledAmount),\r\n            borderColor: 'rgba(255, 99, 132, 1)',\r\n            backgroundColor: 'rgba(255, 99, 132, 0.2)',\r\n            fill: true\r\n          }\r\n        ]\r\n      },\r\n      options: {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        plugins: {\r\n          legend: {\r\n            position: 'top',\r\n            labels: {\r\n              boxWidth: 12,\r\n              font: {\r\n                size: 10\r\n              }\r\n            }\r\n          },\r\n          title: {\r\n            display: true,\r\n            text: 'Ventas por Día',\r\n            font: {\r\n              size: 14\r\n            }\r\n          }\r\n        },\r\n        scales: {\r\n          y: {\r\n            beginAtZero: true,\r\n            title: {\r\n              display: true,\r\n              text: 'Ventas (CLP)',\r\n              font: {\r\n                size: 10\r\n              }\r\n            },\r\n            ticks: {\r\n              font: {\r\n                size: 8\r\n              },\r\n              callback: function(value) {\r\n                return '$ ' + value.toLocaleString('es-CL');\r\n              }\r\n            }\r\n          },\r\n          x: {\r\n            title: {\r\n              display: false\r\n            },\r\n            ticks: {\r\n              font: {\r\n                size: 8\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    };\r\n  \r\n    this.chart = new Chart(ctx, config);\r\n  }\r\n\r\n  private async getDailySales(startDate: Date, endDate: Date): Promise<DailySale[]> {\r\n    const dailySales: DailySale[] = [];\r\n    const daysOfWeek = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];\r\n    let currentDate = new Date(startDate);\r\n    \r\n    while (currentDate <= endDate) {\r\n      const [dayTotal, canceledTotal, canceledOrders] = await Promise.all([\r\n        this.databaseService.calculateTotalSales(\r\n          currentDate.toISOString().split('T')[0],\r\n          currentDate.toISOString().split('T')[0],\r\n          ['Solicitado', 'En proceso', 'Listo', 'Entregado']\r\n        ),\r\n        this.databaseService.calculateTotalSales(\r\n          currentDate.toISOString().split('T')[0],\r\n          currentDate.toISOString().split('T')[0],\r\n          ['Cancelado']\r\n        ),\r\n        this.databaseService.getOrdersCount(['Cancelado'], currentDate.toISOString().split('T')[0])\r\n      ]);\r\n      \r\n      dailySales.push({\r\n        day: daysOfWeek[currentDate.getDay()],\r\n        date: new Date(currentDate),\r\n        amount: dayTotal,\r\n        canceledAmount: canceledTotal,\r\n        canceledOrders: canceledOrders\r\n      });\r\n  \r\n      currentDate.setDate(currentDate.getDate() + 1);\r\n    }\r\n  \r\n    return dailySales;\r\n  }\r\n\r\n  private async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'bottom'\r\n    });\r\n    await toast.present();\r\n  }\r\n\r\n  private async checkAndRequestStoragePermission(): Promise<boolean> {\r\n    try {\r\n      const permissionStatus = await Permissions['checkPermissions']({ permissions: ['storage'] });\r\n      console.log('Estado inicial de permisos:', permissionStatus);\r\n\r\n      if (permissionStatus.storage !== 'granted') {\r\n        console.log('Solicitando permisos de almacenamiento...');\r\n        const requestResult = await Permissions['requestPermissions']({ permissions: ['storage'] });\r\n        console.log('Resultado de la solicitud de permisos:', requestResult);\r\n\r\n        if (requestResult.storage !== 'granted') {\r\n          await this.showPermissionDeniedAlert();\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Error al verificar o solicitar permisos:', error);\r\n      await this.presentToast('Error al verificar permisos: ' + JSON.stringify(error));\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private async showPermissionDeniedAlert() {\r\n    const alert = await this.alertController.create({\r\n      header: 'Permisos necesarios',\r\n      message: 'Esta aplicación necesita permisos de almacenamiento para guardar informes. Por favor, habilita los permisos en la configuración de la aplicación.',\r\n      buttons: ['OK']\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  async generateReport() {\r\n    if (Capacitor.isNativePlatform()) {\r\n      try {\r\n        await Filesystem.writeFile({\r\n          path: 'test.txt',\r\n          data: 'This is a test',\r\n          directory: Directory.Documents,\r\n          encoding: Encoding.UTF8\r\n        });\r\n  \r\n        await Filesystem.deleteFile({\r\n          path: 'test.txt',\r\n          directory: Directory.Documents\r\n        });\r\n      } catch (error) {\r\n        console.error('Error al verificar permisos:', error);\r\n        const alertResult = await this.showPermissionAlert();\r\n        if (!alertResult) {\r\n          await this.presentToast('Se necesitan permisos para generar el informe');\r\n          return;\r\n        }\r\n      }\r\n    }\r\n  \r\n    const loading = await this.loadingController.create({\r\n      message: 'Generando informe...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const endDate = new Date();\r\n      const startDate = new Date(endDate);\r\n      startDate.setDate(startDate.getDate() - 30); // Últimos 30 días\r\n  \r\n      const [totalSales, topSellingProducts, dailySales] = await Promise.all([\r\n        this.databaseService.calculateTotalSales(\r\n          startDate.toISOString().split('T')[0],\r\n          endDate.toISOString().split('T')[0]\r\n        ),\r\n        this.databaseService.getTopSellingProducts(5),\r\n        this.getDailySales(startDate, endDate)\r\n      ]);\r\n  \r\n      const documentDefinition: TDocumentDefinitions = {\r\n        content: [\r\n          { text: 'Informe de Ventas', style: 'header' },\r\n          { text: `Período: ${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}`, style: 'subheader' },\r\n          { text: `Ventas Totales: $${totalSales.toLocaleString('es-CL')}`, style: 'subheader' },\r\n          { text: 'Productos Más Vendidos', style: 'subheader' },\r\n          {\r\n            ul: topSellingProducts.map(product => `${product.name}: ${product.totalSold} unidades`)\r\n          },\r\n          { text: 'Ventas Diarias', style: 'subheader' },\r\n          {\r\n            table: {\r\n              headerRows: 1,\r\n              widths: ['*', '*'],\r\n              body: [\r\n                ['Día', 'Ventas'],\r\n                ...dailySales.map(sale => [sale.day, `$${sale.amount.toLocaleString('es-CL')}`])\r\n              ]\r\n            }\r\n          }\r\n        ],\r\n        styles: {\r\n          header: {\r\n            fontSize: 18,\r\n            bold: true,\r\n            margin: [0, 0, 0, 10]\r\n          },\r\n          subheader: {\r\n            fontSize: 14,\r\n            bold: true,\r\n            margin: [0, 10, 0, 5]\r\n          }\r\n        }\r\n      };\r\n  \r\n      const pdfDocGenerator = pdfMake.createPdf(documentDefinition);\r\n  \r\n      if (Capacitor.isNativePlatform()) {\r\n        pdfDocGenerator.getBase64(async (base64) => {\r\n          const fileName = `informe_ventas_${startDate.toISOString().split('T')[0]}_${endDate.toISOString().split('T')[0]}.pdf`;\r\n          \r\n          try {\r\n            const result = await Filesystem.writeFile({\r\n              path: `Download/${fileName}`,\r\n              data: base64,\r\n              directory: Directory.ExternalStorage,\r\n              encoding: Encoding.UTF8\r\n            });\r\n  \r\n            console.log('Archivo guardado en:', result.uri);\r\n            await this.presentToast(`Informe generado y guardado en Descargas/${fileName}`);\r\n          } catch (error) {\r\n            console.error('Error al guardar el archivo:', error);\r\n            if (error instanceof Error) {\r\n              if (error.message.includes('Permission denied')) {\r\n                await this.presentToast('No se tienen permisos para guardar el archivo. Por favor, verifique los permisos de la aplicación.');\r\n              } else {\r\n                await this.presentToast('Error al guardar el informe: ' + error.message);\r\n              }\r\n            } else {\r\n              await this.presentToast('Error desconocido al guardar el informe');\r\n            }\r\n          }\r\n        });\r\n      } else {\r\n        pdfDocGenerator.download(`informe_ventas_${startDate.toISOString().split('T')[0]}_${endDate.toISOString().split('T')[0]}.pdf`);\r\n        await this.presentToast('Informe generado y descargado con éxito');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al generar el informe:', error);\r\n      await this.presentToast('Error al generar el informe. Por favor, intente de nuevo.');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  private async showPermissionAlert(): Promise<boolean> {\r\n    return new Promise(async (resolve) => {\r\n      const alert = await this.alertController.create({\r\n        header: 'Permisos necesarios',\r\n        message: 'Esta aplicación necesita acceso al almacenamiento para guardar informes. Por favor, habilita los permisos en la configuración de la aplicación.',\r\n        buttons: [\r\n          {\r\n            text: 'Cancelar',\r\n            role: 'cancel',\r\n            handler: () => resolve(false)\r\n          },\r\n          {\r\n            text: 'Entendido',\r\n            handler: () => {\r\n              this.presentToast('Por favor, abra la configuración de la aplicación y otorgue los permisos necesarios.');\r\n              resolve(true);\r\n            }\r\n          }\r\n        ]\r\n      });\r\n\r\n      await alert.present();\r\n    });\r\n  }\r\n  \r\n  async requestStoragePermission() {\r\n    if (Capacitor.isNativePlatform()) {\r\n      try {\r\n        const permissionStatus = await Permissions['query']({ name: 'storage' });\r\n        if (permissionStatus.state !== 'granted') {\r\n          const requestResult = await Permissions['request']({ name: 'storage' });\r\n          return requestResult.state === 'granted';\r\n        }\r\n        return true;\r\n      } catch (error) {\r\n        console.error('Error requesting permissions:', error);\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  selectCancelOrders(): number {\r\n    if (this.selectedDay) {\r\n      return Math.round(this.selectedDay.canceledAmount);\r\n    }\r\n    return 0;\r\n  }\r\n}\r\n"
      },
      "app-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { PreloadAllModules, RouterModule, Routes } from '@angular/router';\r\nimport { AuthGuard } from './guards/auth.guard';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    canActivate: [AuthGuard],\r\n    children: [\r\n      {\r\n        path: '',\r\n        redirectTo: '/login',\r\n        pathMatch: 'full'\r\n      },\r\n      {\r\n        path: 'admin',\r\n        loadChildren: () => import('./admin/admin.module').then(m => m.AdminPageModule)\r\n      },\r\n\r\n      {\r\n        path: 'schedule-meeting',\r\n        loadChildren: () => import('./schedule-meeting/schedule-meeting.module').then(m => m.ScheduleMeetingPageModule)\r\n      },\r\n      {\r\n        path: 'admin-dashboard',\r\n        loadChildren: () => import('./admin-dashboard/admin-dashboard.module').then(m => m.AdminDashboardPageModule)\r\n      },\r\n      {\r\n        path: 'carro-compras',\r\n        loadChildren: () => import('./carro-compras/carro-compras.module').then(m => m.CarroComprasPageModule)\r\n      },\r\n      {\r\n        path: 'comandas',\r\n        loadChildren: () => import('./comandas/comandas.module').then(m => m.ComandasPageModule)\r\n      },\r\n      {\r\n        path: 'crud',\r\n        loadChildren: () => import('./crud/crud.module').then(m => m.CrudPageModule)\r\n      },\r\n      {\r\n        path: 'employee-dashboard',\r\n        loadChildren: () => import('./employee-dashboard/employee-dashboard.module').then(m => m.EmployeeDashboardPageModule)\r\n      },\r\n      {\r\n        path: 'employee-management',\r\n        loadChildren: () => import('./employee-management/employee-management.module').then(m => m.EmployeeManagementPageModule)\r\n      },\r\n      {\r\n        path: 'main',\r\n        loadChildren: () => import('./main/main.module').then(m => m.MainPageModule)\r\n      },\r\n      {\r\n        path: 'perfil',\r\n        loadChildren: () => import('./perfil/perfil.module').then(m => m.PerfilPageModule)\r\n      }\r\n    ]\r\n  },\r\n    {\r\n      path: 'login',\r\n      loadChildren: () => import('./login/login.module').then(m => m.LoginPageModule)\r\n    },\r\n    {\r\n      path: 'register',\r\n      loadChildren: () => import('./register/register.module').then(m => m.RegisterPageModule)\r\n    },\r\n    {\r\n      path: 'forgot-password',\r\n      loadChildren: () => import('./forgot-password/forgot-password.module').then(m => m.ForgotPasswordPageModule)\r\n    },\r\n    {\r\n      path: 'not-found',\r\n      loadChildren: () => import('./not-found/not-found.module').then(m => m.NotFoundPageModule)\r\n    },\r\n    {\r\n      path: '**',\r\n      redirectTo: 'not-found',\r\n      pathMatch: 'full'\r\n    }\r\n  ];\r\n\r\n@NgModule({\r\n  imports: [\r\n    RouterModule.forRoot(routes, { preloadingStrategy: PreloadAllModules })\r\n  ],\r\n  exports: [RouterModule]\r\n})\r\nexport class AppRoutingModule { }",
      "app.component.html": "<ion-app>\r\n  <ion-split-pane contentId=\"main-content\">\r\n    <ion-menu contentId=\"main-content\" type=\"overlay\">\r\n      <ion-content>\r\n        <div class=\"logo-container\">\r\n          <img src=\"assets/logo.jpg\" alt=\"CaffeManagement Logo\" class=\"company-logo\">\r\n          <h2 class=\"company-name\">CaffeManagement</h2>\r\n        </div>\r\n        <ion-list id=\"inbox-list\">\r\n          <ion-note *ngIf=\"isLoggedIn\">Bienvenido, {{ currentUserName }}</ion-note>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/main\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon slot=\"start\" name=\"home-outline\"></ion-icon>\r\n              <ion-label>Inicio</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"isLoggedIn\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/comandas\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon slot=\"start\" name=\"receipt-outline\"></ion-icon>\r\n              <ion-label>Comandas</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"isAdmin\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/admin-dashboard\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon name=\"stats-chart-outline\"></ion-icon>\r\n              <ion-label>Dashboard Admin</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"isEmployee\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/employee-dashboard\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon name=\"briefcase-outline\"></ion-icon>\r\n              <ion-label>Dashboard Empleado</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"isAdmin\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/admin\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon name=\"briefcase-outline\"></ion-icon>\r\n              <ion-label>Reporte ventas</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"!isLoggedIn\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/login\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon slot=\"start\" name=\"log-in-outline\"></ion-icon>\r\n              <ion-label>Iniciar Sesión</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"!isLoggedIn\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/register\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon slot=\"start\" name=\"person-add-outline\"></ion-icon>\r\n              <ion-label>Registrarse</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"isLoggedIn\">\r\n            <ion-item routerDirection=\"root\" routerLink=\"/perfil\" lines=\"none\" detail=\"false\" routerLinkActive=\"selected\">\r\n              <ion-icon slot=\"start\" name=\"person-outline\"></ion-icon>\r\n              <ion-label>Perfil</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n\r\n          <ion-menu-toggle auto-hide=\"false\" *ngIf=\"isLoggedIn\">\r\n            <ion-item lines=\"none\" (click)=\"logout()\">\r\n              <ion-icon slot=\"start\" name=\"log-out-outline\"></ion-icon>\r\n              <ion-label>Cerrar Sesión</ion-label>\r\n            </ion-item>\r\n          </ion-menu-toggle>\r\n        </ion-list>\r\n      </ion-content>\r\n    </ion-menu>\r\n    <ion-router-outlet id=\"main-content\"></ion-router-outlet>\r\n  </ion-split-pane>\r\n</ion-app>",
      "app.component.scss": ":root {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n  --ion-font-family: 'Roboto', sans-serif;\r\n}\r\n\r\nion-menu {\r\n  --background: var(--ion-color-light);\r\n  --width: 280px;\r\n\r\n  ion-content {\r\n    --background: var(--ion-color-light);\r\n  }\r\n\r\n  .logo-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    padding: 20px 0;\r\n    background-color: var(--ion-color-primary);\r\n  }\r\n\r\n  .company-logo {\r\n    width: 80px;\r\n    height: 80px;\r\n    object-fit: contain;\r\n    margin-bottom: 10px;\r\n    border-radius: 50%;\r\n    background-color: white;\r\n    padding: 5px;\r\n  }\r\n\r\n  .company-name {\r\n    font-size: 20px;\r\n    font-weight: bold;\r\n    color: var(--ion-color-light);\r\n    margin: 0;\r\n  }\r\n\r\n  ion-list {\r\n    background: transparent;\r\n    padding-top: 10px;\r\n  }\r\n\r\n  ion-note {\r\n    color: var(--ion-color-dark);\r\n    font-size: 14px;\r\n    margin: 10px 0;\r\n    padding: 0 16px;\r\n  }\r\n\r\n  ion-item {\r\n    --background: transparent;\r\n    --color: var(--ion-color-dark);\r\n    --padding-start: 16px;\r\n    --padding-end: 16px;\r\n    --min-height: 50px;\r\n    margin-bottom: 4px;\r\n\r\n    &.selected, &:hover {\r\n      --background: rgba(132, 176, 162, 0.2);\r\n      --color: var(--ion-color-primary);\r\n    }\r\n  }\r\n\r\n  ion-icon {\r\n    color: var(--ion-color-dark);\r\n    margin-right: 16px;\r\n    font-size: 20px;\r\n  }\r\n\r\n  ion-label {\r\n    font-size: 16px;\r\n    font-weight: 400;\r\n  }\r\n\r\n  ion-menu-toggle ion-item:hover ion-icon {\r\n    color: var(--ion-color-primary);\r\n  }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  ion-menu {\r\n    --width: 250px;\r\n  }\r\n\r\n  .company-logo {\r\n    width: 60px;\r\n    height: 60px;\r\n  }\r\n\r\n  .company-name {\r\n    font-size: 18px;\r\n  }\r\n\r\n  ion-item {\r\n    --min-height: 45px;\r\n  }\r\n\r\n  ion-label {\r\n    font-size: 14px;\r\n  }\r\n}\r\n\r\n// Mantén las animaciones si lo deseas\r\n@keyframes fadeInLeft {\r\n  from {\r\n    opacity: 0;\r\n    transform: translate3d(-20px, 0, 0);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translate3d(0, 0, 0);\r\n  }\r\n}\r\n\r\nion-menu-toggle ion-item {\r\n  animation: fadeInLeft 0.3s ease-out;\r\n  animation-fill-mode: both;\r\n}\r\n\r\nion-menu-toggle ion-item:nth-child(1) { animation-delay: 0.05s; }\r\nion-menu-toggle ion-item:nth-child(2) { animation-delay: 0.1s; }\r\nion-menu-toggle ion-item:nth-child(3) { animation-delay: 0.15s; }\r\nion-menu-toggle ion-item:nth-child(4) { animation-delay: 0.2s; }\r\nion-menu-toggle ion-item:nth-child(5) { animation-delay: 0.25s; }",
      "app.component.spec.ts": "",
      "app.component.ts": "import { Component } from '@angular/core';\r\nimport { Platform, AlertController, ToastController } from '@ionic/angular';\r\nimport { DatabaseService } from './services/database.service';\r\nimport { addIcons } from 'ionicons';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport { Filesystem, Directory, Encoding } from '@capacitor/filesystem';\r\nimport { Router } from '@angular/router';\r\nimport { App } from '@capacitor/app';\r\n\r\n\r\nimport { \r\n  homeOutline, \r\n  cartOutline, \r\n  personOutline, \r\n  logInOutline, \r\n  personAddOutline,\r\n  settingsOutline,\r\n  logOutOutline,\r\n  statsChartOutline,\r\n  briefcaseOutline,\r\n  cafeOutline\r\n} from 'ionicons/icons';\r\n\r\n@Component({\r\n  selector: 'app-root',\r\n  templateUrl: 'app.component.html',\r\n  styleUrls: ['app.component.scss'],\r\n})\r\nexport class AppComponent {\r\n  profilePicture: string | null = null;\r\n  \r\n  constructor(\r\n    private platform: Platform,\r\n    private databaseService: DatabaseService,\r\n    private router: Router,\r\n    private alertController: AlertController,\r\n    private toastController: ToastController \r\n  ) {\r\n    this.initializeApp();\r\n    this.addIonicons();\r\n  }\r\n\r\n  private addIonicons() {\r\n    addIcons({\r\n      homeOutline,\r\n      cartOutline,\r\n      personOutline,\r\n      logInOutline,\r\n      personAddOutline,\r\n      settingsOutline,\r\n      logOutOutline,\r\n      statsChartOutline,\r\n      briefcaseOutline,\r\n      cafeOutline\r\n    });\r\n  }\r\n\r\n  handleImageError(event: any) {\r\n    event.target.src = 'assets/default-avatar.png';\r\n  }\r\n\r\n  async initializeApp() {\r\n    try {\r\n      await this.platform.ready();\r\n      console.log('Platform ready');\r\n      console.log('Is native platform:', Capacitor.isNativePlatform());\r\n  \r\n      console.log('Initializing database...');\r\n      await this.databaseService.initializeDatabase();\r\n      console.log('Database initialized successfully');\r\n  \r\n      this.databaseService.dbState().subscribe({\r\n        next: async (isReady) => {\r\n          if (isReady) {\r\n            console.log('Database is ready');\r\n          }\r\n        },\r\n        error: (error) => {\r\n          console.error('Error in dbState subscription:', error);\r\n          this.presentAlert('Error', 'Database state subscription error');\r\n        }\r\n      });\r\n  \r\n      if (Capacitor.isNativePlatform()) {\r\n        await this.checkPermissions();\r\n      }\r\n  \r\n    } catch (error) {\r\n      console.error('Error initializing app:', error);\r\n      await this.presentAlert('Error', 'Failed to initialize the app. Please try again.');\r\n    }\r\n  }\r\n\r\n  async checkPermissions() {\r\n    if (Capacitor.isNativePlatform()) {\r\n      try {\r\n        await Filesystem.writeFile({\r\n          path: 'test.txt',\r\n          data: 'This is a test',\r\n          directory: Directory.Documents,\r\n          encoding: Encoding.UTF8\r\n        });\r\n\r\n        await Filesystem.deleteFile({\r\n          path: 'test.txt',\r\n          directory: Directory.Documents\r\n        });\r\n\r\n        console.log('Storage permission granted');\r\n      } catch (error) {\r\n        console.error('Storage permission not granted:', error);\r\n        await this.requestPermissions();\r\n      }\r\n    }\r\n  }\r\n  async requestPermissions() {\r\n    if (Capacitor.isNativePlatform()) {\r\n      const alert = await this.alertController.create({\r\n        header: 'Permisos necesarios',\r\n        message: 'Esta aplicación necesita acceso al almacenamiento. Por favor, otorgue los permisos en la configuración de la aplicación.',\r\n        buttons: [\r\n          {\r\n            text: 'Cancelar',\r\n            role: 'cancel'\r\n          },\r\n          {\r\n            text: 'Entendido',\r\n            handler: () => {\r\n              this.presentToast('Por favor, abra la configuración de la aplicación y otorgue los permisos necesarios.');\r\n            }\r\n          }\r\n        ]\r\n      });\r\n  \r\n      await alert.present();\r\n    }\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 3000,\r\n      position: 'bottom'\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  private async checkAndInsertSeedData() {\r\n    try {\r\n      const users = await this.databaseService.fetchUsers().toPromise();\r\n      if (users && users.length === 0) {\r\n        console.log('No users found, inserting seed data');\r\n        // Asumiendo que tienes un método para insertar datos de prueba\r\n        // await this.databaseService.insertSeedData();\r\n        console.log('Seed data inserted successfully');\r\n      } else {\r\n        console.log('Users already exist, skipping seed data insertion');\r\n      }\r\n\r\n      // Prueba de consulta\r\n      const products = await this.databaseService.fetchProducts().toPromise();\r\n      console.log('Products in database:', products ? products.length : 0);\r\n\r\n    } catch (error) {\r\n      console.error('Error checking or inserting seed data:', error);\r\n      await this.presentAlert('Error', 'Failed to check or insert seed data.');\r\n    }\r\n  }\r\n\r\n\r\n  get isLoggedIn(): boolean {\r\n    return !!localStorage.getItem('currentUser');\r\n  }\r\n\r\nget isAdmin(): boolean {\r\n  const user = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n  return user.role === 'admin';\r\n}\r\n\r\n  get isEmployee(): boolean {\r\n    const user = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    return user.role === 'employee';\r\n  }\r\n\r\n  get currentUserName(): string {\r\n    const userString = localStorage.getItem('currentUser');\r\n    console.log('Usuario almacenado:', userString);\r\n    if (userString) {\r\n      const user = JSON.parse(userString);\r\n      console.log('Usuario parseado:', JSON.stringify(user));\r\n      return user.name || 'Usuario';\r\n    }\r\n    return 'Usuario';\r\n  }\r\n  logout() {\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    if (currentUser.id) {\r\n      // Limpiar datos específicos del usuario\r\n      localStorage.removeItem(`cart_${currentUser.id}`);\r\n      localStorage.removeItem(`lastOrderNumber_${currentUser.id}`);\r\n    }\r\n    // Limpiar datos de sesión\r\n    localStorage.removeItem('currentUser');\r\n    this.router.navigate(['/login']);\r\n  }\r\n\r\n  checkAuthState() {\r\n    const user = JSON.parse(localStorage.getItem('currentUser') || 'null');\r\n    if (user) {\r\n      // Usuario autenticado\r\n      console.log('Usuario autenticado:', user);\r\n      if (this.router.url === '/login') {\r\n        this.router.navigate(['/main']);\r\n      }\r\n    } else {\r\n      // Usuario no autenticado\r\n      console.log('Usuario no autenticado');\r\n      if (this.router.url !== '/login' && this.router.url !== '/register') {\r\n        this.router.navigate(['/login']);\r\n      }\r\n    }\r\n  }\r\n\r\n  async presentAlert(header: string, message: string) {\r\n    const alert = await this.alertController.create({\r\n      header,\r\n      message,\r\n      buttons: ['OK']\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n}",
      "app.module.spec.ts": "// src/app/app.module.spec.ts\r\nimport { TestBed, ComponentFixture } from '@angular/core/testing';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { SQLite } from '@awesome-cordova-plugins/sqlite/ngx';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { RouterTestingModule } from '@angular/router/testing';\r\nimport { DatabaseService } from './services/database.service';\r\nimport { DatabaseServiceMock } from './mocks/database.service.mock';\r\nimport { SQLiteMock } from './mocks/sqlite.mock';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\n\r\nexport const testModuleConfig = {\r\n  imports: [\r\n    IonicModule.forRoot(),\r\n    FormsModule,\r\n    RouterTestingModule\r\n  ],\r\n  providers: [\r\n    { provide: SQLite, useClass: SQLiteMock },\r\n    { provide: DatabaseService, useClass: DatabaseServiceMock }\r\n  ],\r\n  schemas: [CUSTOM_ELEMENTS_SCHEMA] \r\n};",
      "app.module.ts": "import { NgModule } from '@angular/core';\r\nimport { BrowserModule } from '@angular/platform-browser';\r\nimport { RouteReuseStrategy } from '@angular/router';\r\nimport { IonicModule, IonicRouteStrategy } from '@ionic/angular';\r\nimport { AppComponent } from './app.component';\r\nimport { AppRoutingModule } from './app-routing.module';\r\nimport { EmailService } from './services/email.service';\r\nimport { SQLite } from '@awesome-cordova-plugins/sqlite/ngx';\r\nimport { DatabaseService } from './services/database.service';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { HttpClientModule } from '@angular/common/http';\r\n\r\n@NgModule({\r\n  declarations: [AppComponent],\r\n  imports: [\r\n    BrowserModule,\r\n    BrowserAnimationsModule,\r\n    IonicModule.forRoot(),\r\n    AppRoutingModule,\r\n    HttpClientModule\r\n  ],\r\n  providers: [\r\n    { provide: RouteReuseStrategy, useClass: IonicRouteStrategy },\r\n    EmailService,\r\n    SQLite,\r\n    DatabaseService\r\n  ],\r\n  bootstrap: [AppComponent]\r\n})\r\nexport class AppModule {}",
      "carro-compras": {
        "carro-compras-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { CarroComprasPage } from './carro-compras.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: CarroComprasPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class CarroComprasPageRoutingModule {}\r\n",
        "carro-compras.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { CarroComprasPageRoutingModule } from './carro-compras-routing.module';\r\nimport { CarroComprasPage } from './carro-compras.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    CarroComprasPageRoutingModule\r\n  ],\r\n  declarations: [CarroComprasPage]\r\n})\r\nexport class CarroComprasPageModule {}",
        "carro-compras.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Orden #{{ currentOrder.orderNumber }}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <h1 class=\"order-summary-title\">Resumen de la Orden</h1>\r\n  \r\n  <ion-list class=\"cart-items\">\r\n    <ion-item-sliding *ngFor=\"let item of currentOrder.items\">\r\n      <ion-item lines=\"none\">\r\n        <ion-thumbnail slot=\"start\">\r\n          <img [src]=\"item.image\" [alt]=\"item.name\">\r\n        </ion-thumbnail>\r\n        <ion-label>\r\n          <h2>{{ item.name }}</h2>\r\n          <p>{{ item.selectedSize }}, leche de {{ item.selectedMilk }}</p>\r\n          <ion-badge color=\"primary\" mode=\"ios\">{{ item.quantity }}</ion-badge>\r\n        </ion-label>\r\n        <ion-note slot=\"end\" color=\"primary\">\r\n          ${{ (item.finalPrice * item.quantity).toFixed(0) }}\r\n        </ion-note>\r\n      </ion-item>\r\n      <ion-item-options side=\"end\">\r\n        <ion-item-option color=\"danger\" (click)=\"removeItem(item)\">\r\n          <ion-icon slot=\"icon-only\" name=\"trash-outline\"></ion-icon>\r\n        </ion-item-option>\r\n      </ion-item-options>\r\n    </ion-item-sliding>\r\n  </ion-list>\r\n  \r\n  <div class=\"order-details\">\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Número de Mesa</ion-label>\r\n      <ion-input type=\"number\" [(ngModel)]=\"currentOrder.tableNumber\"></ion-input>\r\n    </ion-item>\r\n    \r\n    <ion-item>\r\n      <ion-label position=\"floating\">Nota</ion-label>\r\n      <ion-textarea [(ngModel)]=\"currentOrder.notes\" rows=\"3\"></ion-textarea>\r\n    </ion-item>\r\n\r\n    <ion-item class=\"total-amount\">\r\n      <ion-label>\r\n        <h2>Total</h2>\r\n      </ion-label>\r\n      <ion-note slot=\"end\" color=\"primary\">\r\n        ${{ calculateTotal().toFixed(0) }}\r\n      </ion-note>\r\n    </ion-item>\r\n  </div>\r\n</ion-content>\r\n\r\n<ion-footer class=\"ion-no-border\">\r\n  <ion-toolbar>\r\n    <ion-button expand=\"block\" (click)=\"confirmarOrden()\" [disabled]=\"currentOrder.items.length === 0\">\r\n      Confirmar Orden\r\n    </ion-button>\r\n  </ion-toolbar>\r\n</ion-footer>\r\n\r\n<ion-toast\r\n  [isOpen]=\"showToast\"\r\n  [message]=\"toastMessage\"\r\n  [duration]=\"3000\"\r\n  position=\"bottom\"\r\n  color=\"success\"\r\n></ion-toast>",
        "carro-compras.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #f4f5f8;\r\n}\r\n\r\nion-content {\r\n  --background: #D4E7EE;\r\n}\r\n\r\n.order-summary-title {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  color: #405770;\r\n  margin-bottom: 20px;\r\n  padding-left: 16px;\r\n}\r\n\r\n.cart-items {\r\n  background: transparent;\r\n\r\n  ion-item-sliding {\r\n    margin-bottom: 12px;\r\n    border-radius: 12px;\r\n    overflow: hidden;\r\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n  }\r\n\r\n  ion-item {\r\n    --background: #ffffff;\r\n    --border-radius: 12px;\r\n    --padding-start: 12px;\r\n    --padding-end: 12px;\r\n    --inner-padding-end: 0;\r\n\r\n    ion-thumbnail {\r\n      --size: 70px;\r\n      --border-radius: 8px;\r\n      margin-right: 16px;\r\n    }\r\n\r\n    ion-label {\r\n      h2 {\r\n        font-size: 18px;\r\n        font-weight: 600;\r\n        color: #405770;\r\n        margin-bottom: 4px;\r\n      }\r\n\r\n      p {\r\n        font-size: 14px;\r\n        color: var(--ion-color-medium);\r\n        margin-bottom: 6px;\r\n      }\r\n\r\n      ion-badge {\r\n        font-size: 12px;\r\n        padding: 4px 8px;\r\n        border-radius: 12px;\r\n      }\r\n    }\r\n\r\n    ion-note {\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      color: var(--ion-color-primary);\r\n    }\r\n  }\r\n}\r\n\r\n.order-details {\r\n  margin-top: 24px;\r\n  background: #ffffff;\r\n  border-radius: 12px;\r\n  padding: 16px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n\r\n  ion-item {\r\n    --background: transparent;\r\n    --padding-start: 0;\r\n    --inner-padding-end: 0;\r\n    --border-color: rgba(var(--ion-color-medium-rgb), 0.2);\r\n\r\n    &:last-child {\r\n      --border-color: transparent;\r\n    }\r\n  }\r\n\r\n  .total-amount {\r\n    --background: rgba(var(--ion-color-primary-rgb), 0.1);\r\n    border-radius: 10px;\r\n    margin-top: 16px;\r\n\r\n    ion-label h2 {\r\n      font-size: 18px;\r\n      color: #405770;\r\n      font-weight: bold;\r\n    }\r\n\r\n    ion-note {\r\n      font-size: 20px;\r\n      font-weight: 600;\r\n    }\r\n  }\r\n}\r\n\r\nion-footer {\r\n  ion-toolbar {\r\n    --background: transparent;\r\n    --border-color: transparent;\r\n  }\r\n\r\n  ion-button {\r\n    margin: 10px;\r\n    --border-radius: 10px;\r\n    font-weight: 600;\r\n    font-size: 16px;\r\n    height: 50px;\r\n  }\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  .order-summary-title {\r\n    font-size: 20px;\r\n    padding-left: 8px;\r\n  }\r\n\r\n  .cart-items ion-item {\r\n    ion-thumbnail {\r\n      --size: 60px;\r\n    }\r\n\r\n    ion-label h2 {\r\n      font-size: 16px;\r\n    }\r\n\r\n    ion-note {\r\n      font-size: 14px;\r\n    }\r\n  }\r\n\r\n  .order-details .total-amount {\r\n    ion-label h2, ion-note {\r\n      font-size: 16px;\r\n    }\r\n  }\r\n}\r\n\r\n// Animations\r\n@keyframes fadeIn {\r\n  from { opacity: 0; transform: translateY(20px); }\r\n  to { opacity: 1; transform: translateY(0); }\r\n}\r\n\r\n.cart-items ion-item-sliding, .order-details, ion-footer {\r\n  animation: fadeIn 0.3s ease-out forwards;\r\n}\r\n\r\n.cart-items ion-item-sliding:nth-child(1) { animation-delay: 0.1s; }\r\n.cart-items ion-item-sliding:nth-child(2) { animation-delay: 0.2s; }\r\n.cart-items ion-item-sliding:nth-child(3) { animation-delay: 0.3s; }\r\n.order-details { animation-delay: 0.4s; }\r\nion-footer { animation-delay: 0.5s; }",
        "carro-compras.page.spec.ts": "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { IonicModule, ToastController, LoadingController, AlertController } from '@ionic/angular';\r\nimport { CarroComprasPage } from './carro-compras.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { Router } from '@angular/router';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\n\r\ndescribe('CarroComprasPage', () => {\r\n  let component: CarroComprasPage;\r\n  let fixture: ComponentFixture<CarroComprasPage>;\r\n  let mockDatabaseService: jasmine.SpyObj<DatabaseService>;\r\n  let mockRouter: jasmine.SpyObj<Router>;\r\n  let mockToastController: jasmine.SpyObj<ToastController>;\r\n  let mockLoadingController: jasmine.SpyObj<LoadingController>;\r\n  let mockAlertController: jasmine.SpyObj<AlertController>;\r\n\r\n  const mockCartItem = {\r\n    id: 1,\r\n    name: 'Test Product',\r\n    description: 'Test Description',\r\n    price: 100,\r\n    image: 'test.jpg',\r\n    selectedSize: 'medium',\r\n    selectedMilk: 'regular',\r\n    quantity: 1,\r\n    finalPrice: 100\r\n  };\r\n\r\n  const mockUser = {\r\n    id: 1,\r\n    name: 'Test User'\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    mockDatabaseService = jasmine.createSpyObj('DatabaseService', {\r\n      'createOrder': Promise.resolve(1),\r\n      'addProductToOrder': Promise.resolve()\r\n    });\r\n\r\n    mockRouter = jasmine.createSpyObj('Router', ['navigate']);\r\n\r\n    const mockAlert = {\r\n      present: jasmine.createSpy('present').and.returnValue(Promise.resolve()),\r\n      dismiss: jasmine.createSpy('dismiss').and.returnValue(Promise.resolve())\r\n    };\r\n\r\n    mockAlertController = jasmine.createSpyObj('AlertController', {\r\n      create: Promise.resolve(mockAlert)\r\n    });\r\n\r\n    mockToastController = jasmine.createSpyObj('ToastController', {\r\n      create: Promise.resolve({\r\n        present: () => Promise.resolve()\r\n      })\r\n    });\r\n\r\n    mockLoadingController = jasmine.createSpyObj('LoadingController', {\r\n      create: Promise.resolve({\r\n        present: () => Promise.resolve(),\r\n        dismiss: () => Promise.resolve()\r\n      })\r\n    });\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [CarroComprasPage],\r\n      imports: [IonicModule.forRoot()],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: mockDatabaseService },\r\n        { provide: Router, useValue: mockRouter },\r\n        { provide: ToastController, useValue: mockToastController },\r\n        { provide: LoadingController, useValue: mockLoadingController },\r\n        { provide: AlertController, useValue: mockAlertController }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    spyOn(localStorage, 'getItem').and.callFake((key) => {\r\n      if (key === 'currentUser') return JSON.stringify(mockUser);\r\n      if (key === 'cart_1') return JSON.stringify({ orderNumber: 1, items: [mockCartItem] });\r\n      return null;\r\n    });\r\n    spyOn(localStorage, 'setItem');\r\n    spyOn(localStorage, 'removeItem');\r\n\r\n    fixture = TestBed.createComponent(CarroComprasPage);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('1. debe crear el componente', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('2.  debe tener las dependencias inyectadas', () => {\r\n    expect(mockDatabaseService).toBeTruthy();\r\n    expect(mockRouter).toBeTruthy();\r\n    expect(mockToastController).toBeTruthy();\r\n    expect(mockLoadingController).toBeTruthy();\r\n    expect(mockAlertController).toBeTruthy();\r\n  });\r\n\r\n  it('3.  debe inicializar con valores predeterminados', () => {\r\n    expect(component.showToast).toBeFalse();\r\n    expect(component.toastMessage).toBe('');\r\n    expect(component.currentOrder).toBeDefined();\r\n    expect(component.currentOrderItems).toBeDefined();\r\n  });\r\n\r\n  it('4. debe tener ion-header y ion-content', () => {\r\n    const compiled = fixture.nativeElement;\r\n    expect(compiled.querySelector('ion-header')).toBeTruthy();\r\n    expect(compiled.querySelector('ion-content')).toBeTruthy();\r\n  });\r\n\r\n  it('5.  debe suscribirse y desuscribirse de observables', fakeAsync(() => {\r\n    component.ngOnInit();\r\n    tick();\r\n    \r\n    expect(localStorage.getItem).toHaveBeenCalledWith('currentUser');\r\n    expect(component.currentOrderItems.length).toBeGreaterThan(0);\r\n  }));\r\n\r\n\r\n  it('1. debe calcular el total correctamente', () => {\r\n    component.currentOrderItems = [\r\n      { ...mockCartItem, quantity: 2, finalPrice: 100 },\r\n      { ...mockCartItem, id: 2, quantity: 1, finalPrice: 50 }\r\n    ];\r\n    \r\n    const total = component.calculateTotal();\r\n    expect(total).toBe(250); // (100 * 2) + (50 * 1)\r\n  });\r\n\r\n  it('2. Debe actualizar la cantidad y gestionar la eliminación de artículos cuando la cantidad llega a cero', fakeAsync(async () => {\r\n    // Arrange\r\n    component.currentOrderItems = [{ ...mockCartItem }];\r\n    \r\n    // Act - Decrementar la cantidad a 0\r\n    await component.updateQuantity(component.currentOrderItems[0], -1);\r\n    tick();\r\n    \r\n    // Assert\r\n    expect(mockAlertController.create).toHaveBeenCalledWith({\r\n      header: 'Confirmar eliminación',\r\n      message: `¿Está seguro de que desea eliminar Test Product de su orden?`,\r\n      buttons: [\r\n        {\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Eliminar',\r\n          handler: jasmine.any(Function)\r\n        }\r\n      ]\r\n    });\r\n  }));\r\n\r\n  \r\n  it('2. Debería mostrarse una alerta al retirar el elemento directamente', fakeAsync(async () => {\r\n    // Arrange\r\n    component.currentOrderItems = [{ ...mockCartItem }];\r\n    \r\n    // Act\r\n    await component.removeItem(component.currentOrderItems[0]);\r\n    tick();\r\n    \r\n    // Assert\r\n    expect(mockAlertController.create).toHaveBeenCalledWith({\r\n      header: 'Confirmar eliminación',\r\n      message: `¿Está seguro de que desea eliminar Test Product de su orden?`,\r\n      buttons: jasmine.any(Array)\r\n    });\r\n  }));\r\n\r\n  it('3. Debe validar el pedido antes de la confirmación.', fakeAsync(async () => {\r\n    component.currentOrder.tableNumber = null;\r\n    await component.confirmarOrden();\r\n    tick();\r\n    \r\n    expect(mockToastController.create).toHaveBeenCalledWith(\r\n      jasmine.objectContaining({\r\n        message: 'Por favor, seleccione un número de mesa antes de confirmar la orden.'\r\n      })\r\n    );\r\n  }));\r\n\r\n  it('4. La confirmación del pedido debería procesarse con éxito', fakeAsync(async () => {\r\n    component.currentOrder.tableNumber = 1;\r\n    component.currentOrderItems = [mockCartItem];\r\n    \r\n    await component.confirmarOrden();\r\n    tick();\r\n    \r\n    expect(mockDatabaseService.createOrder).toHaveBeenCalled();\r\n    expect(mockDatabaseService.addProductToOrder).toHaveBeenCalled();\r\n    expect(mockRouter.navigate).toHaveBeenCalledWith(['/main']);\r\n  }));\r\n\r\n  it('5. Debe gestionar la confirmación de la eliminación del artículo.', fakeAsync(async () => {\r\n    component.currentOrderItems = [mockCartItem];\r\n    \r\n    await component.removeItem(mockCartItem);\r\n    tick();\r\n    \r\n    expect(mockAlertController.create).toHaveBeenCalledWith(\r\n      jasmine.objectContaining({\r\n        header: 'Confirmar eliminación',\r\n        message: jasmine.any(String)\r\n      })\r\n    );\r\n  }));\r\n});",
        "carro-compras.page.ts": "import { Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { ToastController, LoadingController, AlertController } from '@ionic/angular';\r\nimport { Order } from '../models/order.model';\r\nimport { OrderDetail } from '../models/order-detail.model';\r\n\r\ninterface CartItem {\r\n  id: number;\r\n  name: string;\r\n  description: string;\r\n  price: number;\r\n  image: string;\r\n  selectedSize: string;\r\n  selectedMilk: string;\r\n  quantity: number;\r\n  finalPrice: number;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-carro-compras',\r\n  templateUrl: './carro-compras.page.html',\r\n  styleUrls: ['./carro-compras.page.scss'],\r\n})\r\nexport class CarroComprasPage implements OnInit {\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n  \r\n  currentOrder: Order & { items: any[] } = {\r\n    orderNumber: 0,\r\n    id: 0,\r\n    userId: 0,\r\n    tableNumber: null,\r\n    status: 'Solicitado',\r\n    notes: '',\r\n    totalAmount: 0,\r\n    paymentMethod: '',\r\n    items: []\r\n  };\r\n  currentOrderItems: any[] = [];\r\n  constructor(\r\n    private router: Router,\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController,\r\n    private loadingController: LoadingController,\r\n    private alertController: AlertController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.loadOrder();\r\n  }\r\n\r\n  private getCurrentUserId(): number | null {\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    return currentUser.id || null;\r\n  }\r\n  loadOrder() {\r\n    const userId = this.getCurrentUserId();\r\n    if (!userId) {\r\n      this.router.navigate(['/login']);\r\n      return;\r\n    }\r\n  \r\n    const storedOrder = JSON.parse(localStorage.getItem(`cart_${userId}`) || 'null');\r\n    if (storedOrder && storedOrder.userId === userId) {\r\n      this.currentOrder.orderNumber = storedOrder.orderNumber;\r\n      this.currentOrder.items = storedOrder.items;\r\n      this.currentOrderItems = storedOrder.items;\r\n    } else {\r\n      this.router.navigate(['/main']);\r\n    }\r\n    this.calculateTotal();\r\n  }\r\n\r\n  calculateTotal(): number {\r\n    this.currentOrder.totalAmount = this.currentOrderItems.reduce((total, item) => total + (item.finalPrice * item.quantity), 0);\r\n    return this.currentOrder.totalAmount;\r\n  }\r\n\r\n  async updateQuantity(item: CartItem, change: number) {\r\n    item.quantity += change;\r\n    if (item.quantity <= 0) {\r\n      await this.removeItem(item);\r\n    } else {\r\n      this.calculateTotal();\r\n      this.updateLocalStorage();\r\n    }\r\n  }\r\n\r\n  async removeItem(item: CartItem) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Confirmar eliminación',\r\n      message: `¿Está seguro de que desea eliminar ${item.name} de su orden?`,\r\n      buttons: [\r\n        {\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Eliminar',\r\n          handler: () => {\r\n            const index = this.currentOrderItems.indexOf(item);\r\n            if (index > -1) {\r\n              this.currentOrderItems.splice(index, 1);\r\n              this.calculateTotal();\r\n              this.updateLocalStorage();\r\n              this.presentToast('Producto eliminado de la orden');\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  updateLocalStorage() {\r\n    const userId = this.getCurrentUserId();\r\n    if (userId) {\r\n      localStorage.setItem(`cart_${userId}`, JSON.stringify({\r\n        orderNumber: this.currentOrder.id,\r\n        items: this.currentOrderItems\r\n      }));\r\n    }\r\n  }\r\n\r\n\r\n  async confirmarOrden() {\r\n    if (this.currentOrderItems.length === 0) {\r\n      await this.presentToast('No hay productos en la orden. Añada productos antes de confirmar.');\r\n      return;\r\n    }\r\n  \r\n    if (this.currentOrder.tableNumber === null) {\r\n      await this.presentToast('Por favor, seleccione un número de mesa antes de confirmar la orden.');\r\n      return;\r\n    }\r\n\r\n    const userId = this.getCurrentUserId();\r\n    if (!userId) {\r\n      await this.presentToast('Error: Sesión no válida. Por favor, inicie sesión nuevamente.');\r\n      this.router.navigate(['/login']);\r\n      return;\r\n    }\r\n  \r\n    const loading = await this.loadingController.create({\r\n      message: 'Procesando orden...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      // Asignamos el userId\r\n      this.currentOrder.userId = userId;\r\n  \r\n      const orderToSave: Order = {\r\n        userId: this.currentOrder.userId,\r\n        orderNumber: this.currentOrder.orderNumber,\r\n        tableNumber: this.currentOrder.tableNumber,\r\n        status: 'Solicitado',\r\n        notes: this.currentOrder.notes,\r\n        totalAmount: this.calculateTotal(),\r\n        paymentMethod: '',\r\n      };\r\n  \r\n      const orderId = await this.databaseService.createOrder(orderToSave);\r\n  \r\n      // Añadir los items de la orden\r\n      for (const item of this.currentOrderItems) {\r\n        const orderDetail: OrderDetail = {\r\n          orderId: orderId,\r\n          productId: item.id,\r\n          quantity: item.quantity,\r\n          size: item.selectedSize,\r\n          milkType: item.selectedMilk,\r\n          price: item.finalPrice\r\n        };\r\n        await this.databaseService.addProductToOrder(orderDetail);\r\n      }\r\n  \r\n      // Limpiar datos específicos del usuario actual\r\n      localStorage.removeItem(`cart_${userId}`);\r\n      localStorage.removeItem(`lastOrderNumber_${userId}`);\r\n      \r\n      // Resetear el carrito\r\n      this.currentOrderItems = [];\r\n      this.currentOrder.items = [];\r\n      \r\n      await loading.dismiss();\r\n      await this.presentToast('Orden confirmada con éxito');\r\n      \r\n      // Navegar a la página principal\r\n      this.router.navigate(['/main']);\r\n  \r\n    } catch (error) {\r\n      console.error('Error al confirmar la orden:', error);\r\n      await loading.dismiss();\r\n      await this.presentToast('Error al confirmar la orden. Por favor, intente de nuevo.');\r\n    }\r\n}\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 3000,\r\n      position: 'top'\r\n    });\r\n    toast.present();\r\n  }\r\n}"
      },
      "comandas": {
        "comandas-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ComandasPage } from './comandas.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ComandasPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class ComandasPageRoutingModule {}\r\n",
        "comandas.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { ComandasPageRoutingModule } from './comandas-routing.module';\r\nimport { ComandasPage } from './comandas.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ComandasPageRoutingModule\r\n  ],\r\n  declarations: [ComandasPage]\r\n})\r\nexport class ComandasPageModule {}",
        "comandas.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Comandas</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <ion-segment [(ngModel)]=\"currentSegment\" (ionChange)=\"segmentChanged($event)\" mode=\"ios\" class=\"custom-segment\">\r\n    <ion-segment-button value=\"solicitadas\">\r\n      <ion-icon name=\"receipt-outline\"></ion-icon>\r\n      <ion-label>Nuevas</ion-label>\r\n    </ion-segment-button>\r\n    <ion-segment-button value=\"enProceso\">\r\n      <ion-icon name=\"cafe-outline\"></ion-icon>\r\n      <ion-label>Proceso</ion-label>\r\n    </ion-segment-button>\r\n    <ion-segment-button value=\"listas\">\r\n      <ion-icon name=\"checkmark-circle-outline\"></ion-icon>\r\n      <ion-label>Listas</ion-label>\r\n    </ion-segment-button>\r\n    <ion-segment-button value=\"canceladas\">\r\n      <ion-icon name=\"close-circle-outline\"></ion-icon>\r\n      <ion-label>Cancel.</ion-label>\r\n    </ion-segment-button>\r\n  </ion-segment>\r\n\r\n  <div [ngSwitch]=\"currentSegment\">\r\n    <ng-container *ngSwitchCase=\"'solicitadas'\">\r\n      <ion-card *ngFor=\"let orden of ordenesSolicitadas\" class=\"orden-card\">\r\n        <ion-card-header>\r\n          <ion-card-title>Orden #{{ orden.id || 'N/A' }} - Mesa {{ orden.tableNumber || 'N/A' }}</ion-card-title>\r\n          <ion-card-subtitle>\r\n            <ion-badge color=\"warning\">{{ orden.status || 'Desconocido' }}</ion-badge>\r\n          </ion-card-subtitle>\r\n        </ion-card-header>\r\n        <ion-card-content>\r\n          <div class=\"items-list\">\r\n            <p *ngFor=\"let item of orden.items\">\r\n              {{ item.name || 'Producto desconocido' }} x{{ item.quantity || 0 }}\r\n              <span *ngIf=\"item.size || item.milkType\" class=\"item-details\">\r\n                ({{ item.size || 'Tamaño estándar' }}\r\n                <ng-container *ngIf=\"item.milkType\">, leche {{ item.milkType }}</ng-container>)\r\n              </span>\r\n              <ion-note slot=\"end\">{{ (item.price * item.quantity) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n            </p>\r\n          </div>\r\n          <p class=\"total-amount\">\r\n            <strong>Total:</strong> \r\n            <ion-note slot=\"end\" color=\"primary\">{{ getOrderTotal(orden) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n          </p>\r\n          <p *ngIf=\"orden.notes\" class=\"notes\">\r\n            <ion-icon name=\"create-outline\"></ion-icon>\r\n            <strong>Notas:</strong> {{ orden.notes }}\r\n          </p>\r\n        </ion-card-content>\r\n        <div class=\"action-buttons\">\r\n          <ion-button (click)=\"cambiarEstado(orden, 'En proceso')\" color=\"primary\">En Proceso</ion-button>\r\n          <ion-button (click)=\"cambiarEstado(orden, 'Cancelado')\" color=\"danger\">Cancelar</ion-button>\r\n        </div>\r\n      </ion-card>\r\n    </ng-container>\r\n\r\n    <ng-container *ngSwitchCase=\"'enProceso'\">\r\n      <ion-card *ngFor=\"let orden of ordenesEnProceso\" class=\"orden-card\">\r\n        <ion-card-header>\r\n          <ion-card-title>Orden #{{ orden.id || 'N/A' }} - Mesa {{ orden.tableNumber || 'N/A' }}</ion-card-title>\r\n          <ion-card-subtitle>\r\n            <ion-badge color=\"primary\">{{ orden.status || 'Desconocido' }}</ion-badge>\r\n          </ion-card-subtitle>\r\n        </ion-card-header>\r\n        <ion-card-content>\r\n          <!-- Mismo contenido que en 'solicitadas' -->\r\n          <div class=\"items-list\">\r\n            <p *ngFor=\"let item of orden.items\">\r\n              {{ item.name || 'Producto desconocido' }} x{{ item.quantity || 0 }}\r\n              <span *ngIf=\"item.size || item.milkType\" class=\"item-details\">\r\n                ({{ item.size || 'Tamaño estándar' }}\r\n                <ng-container *ngIf=\"item.milkType\">, leche {{ item.milkType }}</ng-container>)\r\n              </span>\r\n              <ion-note slot=\"end\">{{ (item.price * item.quantity) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n            </p>\r\n          </div>\r\n          <p class=\"total-amount\">\r\n            <strong>Total:</strong> \r\n            <ion-note slot=\"end\" color=\"primary\">{{ getOrderTotal(orden) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n          </p>\r\n          <p *ngIf=\"orden.notes\" class=\"notes\">\r\n            <ion-icon name=\"create-outline\"></ion-icon>\r\n            <strong>Notas:</strong> {{ orden.notes }}\r\n          </p>\r\n        </ion-card-content>\r\n        <div class=\"action-buttons\">\r\n          <ion-button (click)=\"cambiarEstado(orden, 'Listo')\" color=\"success\">Listo</ion-button>\r\n          <ion-button (click)=\"cambiarEstado(orden, 'Cancelado')\" color=\"danger\">Cancelar</ion-button>\r\n        </div>\r\n      </ion-card>\r\n    </ng-container>\r\n\r\n    <ng-container *ngSwitchCase=\"'listas'\">\r\n      <ion-card *ngFor=\"let orden of ordenesListas\" class=\"orden-card\">\r\n        <ion-card-header>\r\n          <ion-card-title>Orden #{{ orden.id || 'N/A' }} - Mesa {{ orden.tableNumber || 'N/A' }}</ion-card-title>\r\n          <ion-card-subtitle>\r\n            <ion-badge color=\"success\">{{ orden.status || 'Desconocido' }}</ion-badge>\r\n          </ion-card-subtitle>\r\n        </ion-card-header>\r\n        <ion-card-content>\r\n          <!-- Mismo contenido que en 'solicitadas' -->\r\n          <div class=\"items-list\">\r\n            <p *ngFor=\"let item of orden.items\">\r\n              {{ item.name || 'Producto desconocido' }} x{{ item.quantity || 0 }}\r\n              <span *ngIf=\"item.size || item.milkType\" class=\"item-details\">\r\n                ({{ item.size || 'Tamaño estándar' }}\r\n                <ng-container *ngIf=\"item.milkType\">, leche {{ item.milkType }}</ng-container>)\r\n              </span>\r\n              <ion-note slot=\"end\">{{ (item.price * item.quantity) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n            </p>\r\n          </div>\r\n          <p class=\"total-amount\">\r\n            <strong>Total:</strong> \r\n            <ion-note slot=\"end\" color=\"primary\">{{ getOrderTotal(orden) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n          </p>\r\n          <p *ngIf=\"orden.notes\" class=\"notes\">\r\n            <ion-icon name=\"create-outline\"></ion-icon>\r\n            <strong>Notas:</strong> {{ orden.notes }}\r\n          </p>\r\n        </ion-card-content>\r\n        <div class=\"action-buttons\">\r\n          <ion-button (click)=\"cambiarEstado(orden, 'Entregado')\" color=\"tertiary\">Entregado</ion-button>\r\n        </div>\r\n      </ion-card>\r\n    </ng-container>\r\n\r\n    <ng-container *ngSwitchCase=\"'canceladas'\">\r\n      <ion-card *ngFor=\"let orden of ordenesCanceladas\" class=\"orden-card\">\r\n        <ion-card-header>\r\n          <ion-card-title>Orden #{{ orden.id || 'N/A' }} - Mesa {{ orden.tableNumber || 'N/A' }}</ion-card-title>\r\n          <ion-card-subtitle>\r\n            <ion-badge color=\"danger\">{{ orden.status || 'Desconocido' }}</ion-badge>\r\n          </ion-card-subtitle>\r\n        </ion-card-header>\r\n        <ion-card-content>\r\n          <!-- Mismo contenido que en 'solicitadas' -->\r\n          <div class=\"items-list\">\r\n            <p *ngFor=\"let item of orden.items\">\r\n              {{ item.name || 'Producto desconocido' }} x{{ item.quantity || 0 }}\r\n              <span *ngIf=\"item.size || item.milkType\" class=\"item-details\">\r\n                ({{ item.size || 'Tamaño estándar' }}\r\n                <ng-container *ngIf=\"item.milkType\">, leche {{ item.milkType }}</ng-container>)\r\n              </span>\r\n              <ion-note slot=\"end\">{{ (item.price * item.quantity) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n            </p>\r\n          </div>\r\n          <p class=\"total-amount\">\r\n            <strong>Total:</strong> \r\n            <ion-note slot=\"end\" color=\"primary\">{{ getOrderTotal(orden) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n          </p>\r\n          <p *ngIf=\"orden.notes\" class=\"notes\">\r\n            <ion-icon name=\"create-outline\"></ion-icon>\r\n            <strong>Notas:</strong> {{ orden.notes }}\r\n          </p>\r\n        </ion-card-content>\r\n      </ion-card>\r\n    </ng-container>\r\n  </div>\r\n\r\n  <ion-item *ngIf=\"!hayOrdenes()\">\r\n    <ion-label>\r\n      No hay órdenes en esta sección en este momento.\r\n    </ion-label>\r\n  </ion-item>\r\n</ion-content>\r\n\r\n<ion-footer *ngIf=\"hayOrdenes()\">\r\n  <ion-toolbar>\r\n    <ion-title>Total de órdenes hoy: {{ totalOrdenesDiarias }}</ion-title>\r\n  </ion-toolbar>\r\n</ion-footer>\r\n\r\n<ion-toast\r\n  [isOpen]=\"showToast\"\r\n  [message]=\"toastMessage\"\r\n  [duration]=\"3000\"\r\n  position=\"top\"\r\n  color=\"success\"\r\n></ion-toast>",
        "comandas.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n}\r\n\r\n.custom-segment {\r\n  background: var(--ion-color-light);\r\n  border-radius: 20px;\r\n  margin: 10px 0;\r\n  --background: #ffffff;\r\n\r\n  ion-segment-button {\r\n    --padding-top: 8px;\r\n    --padding-bottom: 8px;\r\n    --background-checked: var(--ion-color-primary);\r\n    --color-checked: #ffffff;\r\n    --indicator-color: transparent;\r\n    min-height: 60px;\r\n    font-size: 12px;\r\n    font-weight: 500;\r\n    border-radius: 20px;\r\n    margin: 2px;\r\n    transition: background-color 0.3s, color 0.3s;\r\n\r\n    &::part(indicator-background) {\r\n      background: var(--ion-color-primary);\r\n    }\r\n\r\n    ion-icon {\r\n      font-size: 24px;\r\n    }\r\n\r\n    &.segment-button-checked {\r\n      background: var(--ion-color-primary);\r\n      color: #ffffff;\r\n    }\r\n  }\r\n}\r\n\r\nion-content {\r\n  --background: var(--ion-color-light);\r\n}\r\n\r\n.orden-card {\r\n  margin-bottom: 20px;\r\n  border-radius: 10px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  background-color: #ffffff;\r\n\r\n  ion-card-header {\r\n    background-color: var(--ion-color-light);\r\n    padding: 16px;\r\n\r\n    ion-card-title {\r\n      font-size: 18px;\r\n      font-weight: bold;\r\n      color: var(--ion-color-dark);\r\n    }\r\n\r\n    ion-card-subtitle {\r\n      display: flex;\r\n      justify-content: flex-start;\r\n      margin-top: 8px;\r\n    }\r\n\r\n    ion-badge {\r\n      font-size: 12px;\r\n      padding: 4px 8px;\r\n      border-radius: 4px;\r\n    }\r\n  }\r\n\r\n  ion-card-content {\r\n    padding: 16px;\r\n\r\n    .items-list {\r\n      margin-bottom: 12px;\r\n\r\n      p {\r\n        margin: 8px 0;\r\n        font-size: 14px;\r\n        color: var(--ion-color-dark);\r\n\r\n        .item-details {\r\n          font-size: 12px;\r\n          color: var(--ion-color-medium);\r\n          font-style: italic;\r\n          margin-left: 8px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .total-amount {\r\n      font-weight: bold;\r\n      font-size: 16px;\r\n      color: var(--ion-color-dark);\r\n      margin-top: 12px;\r\n      border-top: 1px solid var(--ion-color-light);\r\n      padding-top: 12px;\r\n    }\r\n\r\n    .notes {\r\n      font-style: italic;\r\n      font-size: 14px;\r\n      color: var(--ion-color-medium);\r\n      margin-top: 12px;\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      ion-icon {\r\n        margin-right: 8px;\r\n        font-size: 18px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .action-buttons {\r\n    display: flex;\r\n    justify-content: space-around;\r\n    padding: 0 16px 16px;\r\n\r\n    ion-button {\r\n      --border-radius: 20px;\r\n      font-size: 14px;\r\n      margin: 0 4px;\r\n    }\r\n  }\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  .orden-card {\r\n    ion-card-header {\r\n      ion-card-title {\r\n        font-size: 16px;\r\n      }\r\n\r\n      ion-badge {\r\n        font-size: 10px;\r\n      }\r\n    }\r\n\r\n    ion-card-content {\r\n      .items-list p {\r\n        font-size: 13px;\r\n\r\n        .item-details {\r\n          font-size: 11px;\r\n        }\r\n      }\r\n\r\n      .total-amount {\r\n        font-size: 15px;\r\n      }\r\n\r\n      .notes {\r\n        font-size: 13px;\r\n      }\r\n    }\r\n\r\n    .action-buttons {\r\n      flex-direction: column;\r\n      \r\n      ion-button {\r\n        margin-bottom: 8px;\r\n        font-size: 12px;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Animaciones\r\n@keyframes fadeIn {\r\n  from { opacity: 0; transform: translateY(20px); }\r\n  to { opacity: 1; transform: translateY(0); }\r\n}\r\n\r\n.orden-card {\r\n  animation: fadeIn 0.3s ease-out;\r\n}",
        "comandas.page.spec.ts": "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { IonicModule, ToastController, LoadingController } from '@ionic/angular';\r\nimport { ComandasPage } from './comandas.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { of } from 'rxjs';\r\nimport { Order } from '../models/order.model';\r\nimport { OrderDetail } from '../models/order-detail.model';\r\n\r\ndescribe('ComandasPage', () => {\r\n  let component: ComandasPage;\r\n  let fixture: ComponentFixture<ComandasPage>;\r\n  let databaseService: jasmine.SpyObj<DatabaseService>;\r\n  let toastController: jasmine.SpyObj<ToastController>;\r\n  let loadingController: jasmine.SpyObj<LoadingController>;\r\n\r\n  // Mock completo de Order con tipos correctos\r\n  const mockOrders: Order[] = [\r\n    {\r\n      id: 1,\r\n      orderNumber: 1001,\r\n      userId: 1,\r\n      status: 'Solicitado',\r\n      tableNumber: 1,\r\n      notes: '',\r\n      totalAmount: 100,\r\n      paymentMethod: 'efectivo',\r\n      createdAt: new Date(),\r\n      items: []\r\n    },\r\n    {\r\n      id: 2,\r\n      orderNumber: 1002,\r\n      userId: 1,\r\n      status: 'En proceso',\r\n      tableNumber: 2,\r\n      notes: '',\r\n      totalAmount: 200,\r\n      paymentMethod: 'efectivo',\r\n      createdAt: new Date(),\r\n      items: []\r\n    },\r\n    {\r\n      id: 3,\r\n      orderNumber: 1003,\r\n      userId: 1,\r\n      status: 'Listo',\r\n      tableNumber: 3,\r\n      notes: '',\r\n      totalAmount: 300,\r\n      paymentMethod: 'efectivo',\r\n      createdAt: new Date(),\r\n      items: []\r\n    }\r\n  ];\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', [\r\n      'getOrdersByStatus',\r\n      'getOrderDetails',\r\n      'updateOrderStatus',\r\n      'getOrdersCount'\r\n    ]);\r\n    const toastSpy = jasmine.createSpyObj('ToastController', ['create']);\r\n    const loadingSpy = jasmine.createSpyObj('LoadingController', ['create']);\r\n\r\n    // Mock responses\r\n    dbSpy.getOrdersByStatus.and.returnValue(of(mockOrders));\r\n    dbSpy.getOrderDetails.and.returnValue(of([]));\r\n    dbSpy.updateOrderStatus.and.returnValue(of(true));\r\n    dbSpy.getOrdersCount.and.returnValue(Promise.resolve(3));\r\n\r\n    toastSpy.create.and.returnValue(Promise.resolve({\r\n      present: () => Promise.resolve(),\r\n      dismiss: () => Promise.resolve()\r\n    }));\r\n\r\n    loadingSpy.create.and.returnValue(Promise.resolve({\r\n      present: () => Promise.resolve(),\r\n      dismiss: () => Promise.resolve()\r\n    }));\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [ComandasPage],\r\n      imports: [IonicModule.forRoot()],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { provide: ToastController, useValue: toastSpy },\r\n        { provide: LoadingController, useValue: loadingSpy }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(ComandasPage);\r\n    component = fixture.componentInstance;\r\n    databaseService = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    toastController = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    loadingController = TestBed.inject(LoadingController) as jasmine.SpyObj<LoadingController>;\r\n    fixture.detectChanges();\r\n  });\r\n  \r\n  it('1. debe cargar el componente', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('2. debe tener las dependencias inyectadas', () => {\r\n    expect(databaseService).toBeTruthy();\r\n    expect(toastController).toBeTruthy();\r\n    expect(loadingController).toBeTruthy();\r\n  });\r\n\r\n  it('3. debe inicializar con valores predeterminados', () => {\r\n    expect(component.ordenesSolicitadas).toEqual([]);\r\n    expect(component.ordenesEnProceso).toEqual([]);\r\n    expect(component.ordenesListas).toEqual([]);\r\n    expect(component.ordenesCanceladas).toEqual([]);\r\n    expect(component.currentSegment).toBe('solicitadas');\r\n  });\r\n\r\n  it('4. debe tener ion-header y ion-content', () => {\r\n    const compiled = fixture.nativeElement;\r\n    expect(compiled.querySelector('ion-header')).toBeTruthy();\r\n    expect(compiled.querySelector('ion-content')).toBeTruthy();\r\n    expect(compiled.querySelector('ion-segment')).toBeTruthy();\r\n  });\r\n\r\n  it('5. debe suscribirse y desuscribirse de observables', () => {\r\n    const subscription = component['subscriptions'];\r\n    expect(subscription).toBeTruthy();\r\n    component.ngOnDestroy();\r\n    expect(subscription.closed).toBeTrue();\r\n  });\r\n\r\n\r\n  it('1. Debe cargar pedidos y calcular el total diario al inicio.', fakeAsync(async () => {\r\n    await component.ngOnInit();\r\n    tick();\r\n\r\n    expect(databaseService.getOrdersByStatus).toHaveBeenCalledWith([\r\n      'Solicitado', 'En proceso', 'Listo', 'Cancelado'\r\n    ]);\r\n    expect(databaseService.getOrdersCount).toHaveBeenCalled();\r\n    expect(component.totalOrdenesDiarias).toBe(3);\r\n  }));\r\n\r\n  it('2. Debería actualizar el estado del pedido y moverlo a la lista correcta', fakeAsync(async () => {\r\n    component.ordenesSolicitadas = [mockOrders[0]];\r\n    component.ordenesEnProceso = [];\r\n\r\n    await component.cambiarEstado(mockOrders[0], 'En proceso');\r\n    tick();\r\n\r\n    expect(databaseService.updateOrderStatus).toHaveBeenCalledWith(1, 'En proceso');\r\n    expect(toastController.create).toHaveBeenCalled();\r\n    expect(component.ordenesSolicitadas.length).toBe(0);\r\n    expect(component.ordenesEnProceso.length).toBe(1);\r\n    expect(component.ordenesEnProceso[0].status).toBe('En proceso');\r\n  }));\r\n\r\n  it('3. Debería calcular correctamente los pedidos totales.', () => {\r\n    component.ordenesSolicitadas = [mockOrders[0]];\r\n    component.ordenesEnProceso = [mockOrders[1]];\r\n    component.ordenesListas = [mockOrders[2]];\r\n    \r\n    expect(component.totalOrdenes()).toBe(3);\r\n    expect(component.hayOrdenes()).toBeTrue();\r\n  });\r\n\r\n  it('4. Debe manejar los cambios de segmento correctamente.', () => {\r\n    const mockEvent = { detail: { value: 'enProceso' } };\r\n    component.segmentChanged(mockEvent);\r\n    expect(component.currentSegment).toBe('enProceso');\r\n  });\r\n\r\n  it('5. Debería calcular correctamente el total del pedido.', () => {\r\n    const mockOrder: Order = {\r\n      ...mockOrders[0],\r\n      items: [\r\n        { id: 1, orderId: 1, productId: 1, quantity: 2, price: 100, productName: 'Test Product' } as OrderDetail,\r\n        { id: 2, orderId: 1, productId: 2, quantity: 1, price: 50, productName: 'Test Product 2' } as OrderDetail\r\n      ]\r\n    };\r\n    \r\n    const total = component.getOrderTotal(mockOrder);\r\n    expect(total).toBe(250);\r\n  });\r\n});",
        "comandas.page.ts": "import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { ToastController, LoadingController } from '@ionic/angular';\r\nimport { Order } from '../models/order.model';\r\nimport { OrderDetail } from '../models/order-detail.model';\r\nimport { Subscription, Observable, from, of } from 'rxjs';\r\nimport { mergeMap, toArray, map, catchError } from 'rxjs/operators';\r\nimport { firstValueFrom } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-comandas',\r\n  templateUrl: './comandas.page.html',\r\n  styleUrls: ['./comandas.page.scss'],\r\n})\r\nexport class ComandasPage implements OnInit, OnDestroy {\r\n\r\n  ordenesSolicitadas: Order[] = [];\r\n  ordenesEnProceso: Order[] = [];\r\n  ordenesListas: Order[] = [];\r\n  ordenesCanceladas: Order[] = [];\r\n  totalOrdenesDiarias: number = 0;\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n  \r\n  ordenes: Order[] = [];\r\n  private subscriptions: Subscription = new Subscription();\r\n  \r\n  constructor(\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController,\r\n    private loadingController: LoadingController\r\n  ) { }\r\n\r\n  async ngOnInit() {\r\n    await this.cargarOrdenes();\r\n    await this.calcularTotalOrdenesDiarias();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscriptions.unsubscribe();\r\n  }\r\n\r\n  async cargarOrdenes() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando órdenes...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const ordenes = await firstValueFrom(this.databaseService.getOrdersByStatus(['Solicitado', 'En proceso', 'Listo', 'Cancelado']));\r\n      console.log('Órdenes obtenidas:', ordenes);\r\n      \r\n      const ordenesConDetalles = await Promise.all(ordenes.map(async (orden) => {\r\n        const detalles = await firstValueFrom(this.databaseService.getOrderDetails(orden.id!));\r\n        return { \r\n          ...orden, \r\n          items: detalles,\r\n          id: orden.id ?? 0,\r\n          tableNumber: orden.tableNumber ?? 0\r\n        };\r\n      }));\r\n      \r\n      this.ordenesSolicitadas = ordenesConDetalles.filter(orden => orden.status === 'Solicitado');\r\n      this.ordenesEnProceso = ordenesConDetalles.filter(orden => orden.status === 'En proceso');\r\n      this.ordenesListas = ordenesConDetalles.filter(orden => orden.status === 'Listo');\r\n      this.ordenesCanceladas = ordenesConDetalles.filter(orden => orden.status === 'Cancelado');\r\n      \r\n      console.log('Órdenes procesadas:', {\r\n        solicitadas: this.ordenesSolicitadas,\r\n        enProceso: this.ordenesEnProceso,\r\n        listas: this.ordenesListas,\r\n        canceladas: this.ordenesCanceladas\r\n      });\r\n    } catch (error) {\r\n      console.error('Error al cargar órdenes:', error);\r\n      this.presentToast('Error al cargar órdenes. Por favor, intente de nuevo.');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  \r\n  private getOrdersByStatus(statuses: string[]): Promise<Order[]> {\r\n    const result = this.databaseService.getOrdersByStatus(statuses);\r\n    if (result instanceof Observable) {\r\n      return firstValueFrom(result.pipe(\r\n        map((orders: Order[]) => orders || []),\r\n        catchError(() => of([]))\r\n      ));\r\n    }\r\n    return Promise.resolve(result || []);\r\n  }\r\n\r\n  async cargarDetallesOrdenes() {\r\n    const detallesPromises = this.ordenes.map(async (orden) => {\r\n      try {\r\n        const detalles = await this.getOrderDetails(orden.id!);\r\n        orden.items = detalles;\r\n        return orden;\r\n      } catch (error) {\r\n        console.error(`Error al cargar detalles para la orden ${orden.id}:`, error);\r\n        return orden;\r\n      }\r\n    });\r\n  \r\n    try {\r\n      this.ordenes = await Promise.all(detallesPromises);\r\n      console.log('Órdenes con detalles:', this.ordenes);  // Para depuración\r\n    } catch (error) {\r\n      console.error('Error al cargar detalles de órdenes:', error);\r\n    }\r\n  }\r\n\r\n  private async getOrderDetails(orderId: number): Promise<OrderDetail[]> {\r\n    try {\r\n      const result = this.databaseService.getOrderDetails(orderId);\r\n      if (result instanceof Observable) {\r\n        return await firstValueFrom(result.pipe(\r\n          map(details => details || []),\r\n          catchError(() => of([]))\r\n        ));\r\n      }\r\n      return result || [];\r\n    } catch (error) {\r\n      console.error(`Error al obtener detalles de la orden ${orderId}:`, error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  async cambiarEstado(orden: Order, nuevoEstado: 'En proceso' | 'Listo' | 'Cancelado' | 'Entregado') {\r\n    if (!orden.id) {\r\n      this.presentToast('Error: ID de orden no válido');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await this.updateOrderStatus(orden.id, nuevoEstado);\r\n      orden.status = nuevoEstado;\r\n      this.presentToast(`Orden #${orden.id} actualizada a ${nuevoEstado}`);\r\n\r\n      this.moverOrden(orden);\r\n\r\n    } catch (error) {\r\n      console.error('Error al actualizar estado de la orden:', error);\r\n      this.presentToast('Error al actualizar el estado. Por favor, intente de nuevo.');\r\n    }\r\n  }\r\n\r\n  private moverOrden(orden: Order) {\r\n    // Remover la orden de su lista actual\r\n    this.ordenesSolicitadas = this.ordenesSolicitadas.filter(o => o.id !== orden.id);\r\n    this.ordenesEnProceso = this.ordenesEnProceso.filter(o => o.id !== orden.id);\r\n    this.ordenesListas = this.ordenesListas.filter(o => o.id !== orden.id);\r\n    this.ordenesCanceladas = this.ordenesCanceladas.filter(o => o.id !== orden.id);\r\n\r\n    // Añadir la orden a su nueva lista\r\n    switch (orden.status) {\r\n      case 'Solicitado':\r\n        this.ordenesSolicitadas.push(orden);\r\n        break;\r\n      case 'En proceso':\r\n        this.ordenesEnProceso.push(orden);\r\n        break;\r\n      case 'Listo':\r\n        this.ordenesListas.push(orden);\r\n        break;\r\n      case 'Cancelado':\r\n        this.ordenesCanceladas.push(orden);\r\n        break;\r\n    }\r\n  }\r\n\r\n  private async updateOrderStatus(orderId: number, status: string): Promise<void> {\r\n    const result = this.databaseService.updateOrderStatus(orderId, status);\r\n    if (result instanceof Observable) {\r\n      await firstValueFrom(result.pipe(\r\n        map(() => {}),\r\n        catchError(() => of(undefined))\r\n      ));\r\n    }\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'top'\r\n    });\r\n    await toast.present();\r\n  }\r\n\r\n  getOrderTotal(orden: Order): number {\r\n    return orden.items?.reduce((total, item) => total + ((item.price || 0) * (item.quantity || 0)), 0) || 0;\r\n  }\r\n\r\n  currentSegment: string = 'solicitadas';\r\n\r\n  segmentChanged(event: any) {\r\n    console.log('Segment changed', event);\r\n    this.currentSegment = event.detail.value;\r\n  }\r\n\r\n  hayOrdenes(): boolean {\r\n    return this.ordenesSolicitadas.length > 0 || \r\n           this.ordenesEnProceso.length > 0 || \r\n           this.ordenesListas.length > 0 || \r\n           this.ordenesCanceladas.length > 0;\r\n  }\r\n\r\n  async calcularTotalOrdenesDiarias() {\r\n    const fechaActual = new Date().toISOString().split('T')[0]; // Obtiene la fecha actual en formato YYYY-MM-DD\r\n    try {\r\n      this.totalOrdenesDiarias = await this.databaseService.getOrdersCount(['Solicitado', 'En proceso', 'Listo', 'Entregado'], fechaActual);\r\n    } catch (error) {\r\n      console.error('Error al calcular el total de órdenes diarias:', error);\r\n      this.presentToast('Error al calcular el total de órdenes diarias.');\r\n    }\r\n  }\r\n\r\n  totalOrdenes(): number {\r\n    return this.ordenesSolicitadas.length + \r\n           this.ordenesEnProceso.length + \r\n           this.ordenesListas.length + \r\n           this.ordenesCanceladas.length;\r\n  }\r\n\r\n}"
      },
      "crud": {
        "crud-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { CrudPage } from './crud.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: CrudPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class CrudPageRoutingModule {}\r\n",
        "crud.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { CrudPageRoutingModule } from './crud-routing.module';\r\nimport { CrudPage } from './crud.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    CrudPageRoutingModule\r\n  ],\r\n  declarations: [CrudPage]\r\n})\r\nexport class CrudPageModule {}",
        "crud.page.html": "<ion-header>\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-back-button defaultHref=\"/admin\"></ion-back-button>\r\n    </ion-buttons>\r\n    <ion-title>Gestión de Productos</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <div class=\"crud-menu\">\r\n    <ion-button fill=\"clear\" (click)=\"setActiveSection('add')\" [class.active]=\"activeSection === 'add'\">\r\n      <ion-icon name=\"add-circle-outline\"></ion-icon>\r\n    </ion-button>\r\n    <ion-button fill=\"clear\" (click)=\"setActiveSection('edit')\" [class.active]=\"activeSection === 'edit'\">\r\n      <ion-icon name=\"create-outline\"></ion-icon>\r\n    </ion-button>\r\n    <ion-button fill=\"clear\" (click)=\"setActiveSection('delete')\" [class.active]=\"activeSection === 'delete'\">\r\n      <ion-icon name=\"trash-outline\"></ion-icon>\r\n    </ion-button>\r\n    <ion-button fill=\"clear\" (click)=\"setActiveSection('view')\" [class.active]=\"activeSection === 'view'\">\r\n      <ion-icon name=\"list-outline\"></ion-icon>\r\n    </ion-button>\r\n  </div>\r\n\r\n  <!-- Agregar Producto -->\r\n  <div *ngIf=\"activeSection === 'add'\">\r\n    <h2>Agregar Producto</h2>\r\n    <form (ngSubmit)=\"addProduct()\" #productForm=\"ngForm\">\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Nombre</ion-label>\r\n        <ion-input [(ngModel)]=\"currentProduct.name\" name=\"name\" required minlength=\"3\" #name=\"ngModel\"></ion-input>\r\n      </ion-item>\r\n      <ion-note *ngIf=\"name.invalid && name.touched\" color=\"danger\">\r\n        El nombre es requerido y debe tener al menos 3 caracteres.\r\n      </ion-note>\r\n  \r\n      <ion-item>\r\n        <ion-label position=\"floating\">Descripción</ion-label>\r\n        <ion-textarea [(ngModel)]=\"currentProduct.description\" name=\"description\" required></ion-textarea>\r\n      </ion-item>\r\n      \r\n      <ion-item>\r\n        <ion-label position=\"floating\">Precio</ion-label>\r\n        <ion-input type=\"number\" [(ngModel)]=\"currentProduct.price\" name=\"price\" required min=\"0\" #price=\"ngModel\"></ion-input>\r\n      </ion-item>\r\n      <ion-note *ngIf=\"price.invalid && price.touched\" color=\"danger\">\r\n        El precio es requerido y no puede ser negativo.\r\n      </ion-note>\r\n  \r\n      <ion-item>\r\n        <ion-label position=\"floating\">Categoría</ion-label>\r\n        <ion-input [(ngModel)]=\"currentProduct.category\" name=\"category\" required></ion-input>\r\n      </ion-item>\r\n  \r\n      <ion-item>\r\n        <ion-label>Imagen del producto</ion-label>\r\n        <ion-button (click)=\"selectImage()\">\r\n          <ion-icon name=\"camera-outline\" slot=\"start\"></ion-icon>\r\n          Seleccionar imagen\r\n        </ion-button>\r\n      </ion-item>\r\n  \r\n      <ion-item *ngIf=\"currentProduct.imageURL\">\r\n        <img [src]=\"currentProduct.imageURL\" alt=\"Vista previa de la imagen\" style=\"max-width: 100%; height: auto;\">\r\n      </ion-item>\r\n  \r\n      <ion-button expand=\"block\" type=\"submit\" class=\"ion-margin-top\" [disabled]=\"productForm.invalid\">\r\n        Agregar Producto\r\n      </ion-button>\r\n    </form>\r\n  </div>\r\n\r\n  <!-- Editar Producto -->\r\n<div *ngIf=\"activeSection === 'edit'\">\r\n  <h2>Editar Producto</h2>\r\n  <form (ngSubmit)=\"updateProduct()\" #editProductForm=\"ngForm\">\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Nombre</ion-label>\r\n      <ion-input [(ngModel)]=\"currentProduct.name\" name=\"name\" required></ion-input>\r\n    </ion-item>\r\n    <div *ngIf=\"editProductForm.submitted && !editProductForm.controls['name']?.valid\" class=\"error\">\r\n      El nombre es obligatorio.\r\n    </div>\r\n\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Descripción</ion-label>\r\n      <ion-textarea [(ngModel)]=\"currentProduct.description\" name=\"description\" required></ion-textarea>\r\n    </ion-item>\r\n    <div *ngIf=\"editProductForm.submitted && !editProductForm.controls['description']?.valid\" class=\"error\">\r\n      La descripción es obligatoria.\r\n    </div>\r\n\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Precio</ion-label>\r\n      <ion-input type=\"number\" [(ngModel)]=\"currentProduct.price\" name=\"price\" required></ion-input>\r\n    </ion-item>\r\n    <div *ngIf=\"editProductForm.submitted && (!editProductForm.controls['price']?.valid || currentProduct.price < 0)\" class=\"error\">\r\n      El precio debe ser mayor o igual a 0.\r\n    </div>\r\n\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Categoría</ion-label>\r\n      <ion-input [(ngModel)]=\"currentProduct.category\" name=\"category\" required></ion-input>\r\n    </ion-item>\r\n    <div *ngIf=\"editProductForm.submitted && !editProductForm.controls['category']?.valid\" class=\"error\">\r\n      La categoría es obligatoria.\r\n    </div>\r\n\r\n    <ion-item>\r\n      <ion-label>Imagen del producto</ion-label>\r\n      <ion-button (click)=\"selectImage()\">\r\n        <ion-icon name=\"camera-outline\" slot=\"start\"></ion-icon>\r\n        Cambiar imagen\r\n      </ion-button>\r\n    </ion-item>\r\n    <ion-item *ngIf=\"currentProduct.imageURL\">\r\n      <img [src]=\"currentProduct.imageURL\" alt=\"Vista previa de la imagen\" style=\"max-width: 100%; height: auto;\">\r\n    </ion-item>\r\n\r\n    <ion-button expand=\"block\" type=\"submit\" class=\"ion-margin-top\" [disabled]=\"!editProductForm.valid || currentProduct.price < 0\">\r\n      Actualizar Producto\r\n    </ion-button>\r\n  </form>\r\n</div>\r\n\r\n\r\n  <!-- Eliminar Producto -->\r\n  <div *ngIf=\"activeSection === 'delete'\">\r\n    <h2>Eliminar Producto</h2>\r\n    <ion-list>\r\n      <ion-item *ngFor=\"let product of products\">\r\n        <ion-thumbnail slot=\"start\">\r\n          <img [src]=\"product.imageURL\" [alt]=\"product.name\" (error)=\"handleImageError($event)\">\r\n        </ion-thumbnail>\r\n        <ion-label>\r\n          <h2>{{ product.name }}</h2>\r\n          <p>Precio: {{ product.price | currency:'CLP':'symbol-narrow':'1.0-0' }}</p>\r\n        </ion-label>\r\n        <ion-button slot=\"end\" color=\"danger\" (click)=\"deleteProduct(product.id ?? 0)\">Eliminar</ion-button>\r\n      </ion-item>\r\n    </ion-list>\r\n  </div>\r\n\r\n  <!-- Ver Productos -->\r\n  <div *ngIf=\"activeSection === 'view'\">\r\n    <h2>Lista de Productos</h2>\r\n    <ion-list>\r\n      <ion-item *ngFor=\"let product of products\">\r\n        <ion-thumbnail slot=\"start\">\r\n          <img [src]=\"product.imageURL\" [alt]=\"product.name\" (error)=\"handleImageError($event)\">\r\n        </ion-thumbnail>\r\n        <ion-label>\r\n          <h2>{{ product.name }}</h2>\r\n          <p>{{ product.description }}</p>\r\n          <p>Precio: {{ product.price | currency:'CLP':'symbol-narrow':'1.0-0' }}</p>\r\n        </ion-label>\r\n      </ion-item>\r\n    </ion-list>\r\n  </div>\r\n</ion-content>\r\n\r\n<ion-toast\r\n  [isOpen]=\"showToast\"\r\n  [message]=\"toastMessage\"\r\n  [duration]=\"3000\"\r\n  position=\"bottom\"\r\n  color=\"success\">\r\n</ion-toast>",
        "crud.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n}\r\n\r\n.crud-menu {\r\n  display: flex;\r\n  justify-content: space-around;\r\n  background-color: var(--ion-color-light);\r\n  border-radius: 15px;\r\n  padding: 10px;\r\n  margin-bottom: 20px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n\r\n  ion-button {\r\n    --padding-start: 10px;\r\n    --padding-end: 10px;\r\n\r\n    &.active {\r\n      --background: var(--ion-color-primary);\r\n      --color: #ffffff;\r\n    }\r\n\r\n    ion-icon {\r\n      font-size: 24px;\r\n    }\r\n  }\r\n}\r\n\r\nion-content {\r\n  --background: #D4E7EE;\r\n}\r\n\r\nform {\r\n  background-color: white;\r\n  padding: 20px;\r\n  border-radius: 10px;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n\r\n  ion-item {\r\n    --padding-start: 0;\r\n    --inner-padding-end: 0;\r\n    --background: transparent;\r\n\r\n    &:not(:last-child) {\r\n      --border-color: var(--ion-color-light);\r\n      --border-width: 0 0 1px 0;\r\n    }\r\n  }\r\n\r\n  ion-button[type=\"submit\"] {\r\n    margin-top: 20px;\r\n  }\r\n}\r\n\r\nh2 {\r\n  color: var(--ion-color-primary);\r\n  font-weight: bold;\r\n  margin-bottom: 20px;\r\n}\r\n\r\nion-list {\r\n  background: transparent;\r\n\r\n  ion-item {\r\n    --background: white;\r\n    --border-radius: 10px;\r\n    margin-bottom: 10px;\r\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n\r\n    ion-thumbnail {\r\n      --size: 80px;\r\n      --border-radius: 10px;\r\n    }\r\n\r\n    ion-label {\r\n      h2 {\r\n        font-weight: bold;\r\n        color: var(--ion-color-dark);\r\n      }\r\n\r\n      p {\r\n        color: var(--ion-color-medium);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nion-button {\r\n  --border-radius: 10px;\r\n}\r\n\r\n// Animaciones\r\n@keyframes fadeIn {\r\n  from { opacity: 0; }\r\n  to { opacity: 1; }\r\n}\r\n\r\n.crud-menu, form, ion-list {\r\n  animation: fadeIn 0.3s ease-in-out;\r\n}",
        "crud.page.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { IonicModule, LoadingController, ToastController } from '@ionic/angular';\r\nimport { CrudPage } from './crud.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { of } from 'rxjs';\r\n\r\ndescribe('CrudPage', () => {\r\n  let component: CrudPage;\r\n  let fixture: ComponentFixture<CrudPage>;\r\n  let databaseServiceSpy: jasmine.SpyObj<DatabaseService>;\r\n  let loadingControllerSpy: jasmine.SpyObj<LoadingController>;\r\n  let toastControllerSpy: jasmine.SpyObj<ToastController>;\r\n\r\n  // Mock Data\r\n  const mockProducts = [\r\n    {\r\n      id: 1,\r\n      name: 'Test Product',\r\n      description: 'Test Description',\r\n      price: 100,\r\n      category: 'Test Category',\r\n      imageURL: 'test.jpg',\r\n      isAvailable: true\r\n    }\r\n  ];\r\n\r\n  beforeEach(async () => {\r\n    // Create spies\r\n    databaseServiceSpy = jasmine.createSpyObj('DatabaseService', {\r\n      getAllProducts: of(mockProducts),\r\n      createProduct: Promise.resolve(1),\r\n      updateProduct: of(true),\r\n      deleteProduct: of(true)\r\n    });\r\n\r\n    const mockLoading = {\r\n      present: jasmine.createSpy('present').and.returnValue(Promise.resolve()),\r\n      dismiss: jasmine.createSpy('dismiss').and.returnValue(Promise.resolve())\r\n    };\r\n\r\n    const mockToast = {\r\n      present: jasmine.createSpy('present').and.returnValue(Promise.resolve())\r\n    };\r\n\r\n    loadingControllerSpy = jasmine.createSpyObj('LoadingController', {\r\n      create: Promise.resolve(mockLoading)\r\n    });\r\n\r\n    toastControllerSpy = jasmine.createSpyObj('ToastController', {\r\n      create: Promise.resolve(mockToast)\r\n    });\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [CrudPage],\r\n      imports: [IonicModule.forRoot()],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: databaseServiceSpy },\r\n        { provide: LoadingController, useValue: loadingControllerSpy },\r\n        { provide: ToastController, useValue: toastControllerSpy }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(CrudPage);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  // Test de creación del componente\r\n  it('1. debe crear el componente', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  // Test de inicialización\r\n  it('2. debe inicializar correctamente', () => {\r\n    expect(component.products).toEqual([]);\r\n    expect(component.currentProduct).toBeDefined();\r\n    expect(component.isEditing).toBeFalse();\r\n    expect(component.activeSection).toBe('view');\r\n    expect(component.showToast).toBeFalse();\r\n  });\r\n\r\n  // Test de carga de productos\r\n  it('3. debe cargar productos', async () => {\r\n    await component.loadProducts();\r\n    expect(databaseServiceSpy.getAllProducts).toHaveBeenCalled();\r\n    expect(component.products.length).toBeGreaterThan(0);\r\n  });\r\n\r\n  // Test de reset del formulario\r\n  it('4. debe resetear el formulario', () => {\r\n    component.resetForm();\r\n    expect(component.currentProduct).toEqual({\r\n      id: 0,\r\n      name: '',\r\n      description: '',\r\n      price: 0,\r\n      category: '',\r\n      imageURL: '',\r\n      isAvailable: true\r\n    });\r\n    expect(component.isEditing).toBeFalse();\r\n  });\r\n\r\n  // Test de manejo de imagen por defecto\r\n  it('1. Debería manejar el error de imagen configurando la imagen predeterminada', () => {\r\n    const event = { target: { src: '' } };\r\n    component.handleImageError(event);\r\n    expect(event.target.src).toBe('assets/default-product-image.jpg');\r\n  });\r\n\r\n  // Test de cambio de sección\r\n  it('2. Debería cambiar la sección', () => {\r\n    component.setActiveSection('add');\r\n    expect(component.activeSection).toBe('add');\r\n    expect(component.isEditing).toBeFalse();\r\n  });\r\n\r\n  // Test de edición de producto\r\n  it('3. Debería editar un producto', () => {\r\n    const productToEdit = mockProducts[0];\r\n    component.editProduct(productToEdit);\r\n    expect(component.currentProduct).toEqual(productToEdit);\r\n    expect(component.isEditing).toBeTrue();\r\n    expect(component.activeSection).toBe('edit');\r\n  });\r\n\r\n  // Test de presentación de toast\r\n  it('4. Debería presentar un toast', async () => {\r\n    const message = 'Test message';\r\n    await component.presentToast(message);\r\n    expect(toastControllerSpy.create).toHaveBeenCalled();\r\n  });\r\n\r\n  // Test de URL de imagen\r\n  it('5. Debería obtener la URL de la imagen', () => {\r\n    // @ts-ignore: Accessing private method for testing\r\n    const imageUrl = component.getImageUrl('test.jpg');\r\n    expect(imageUrl).toBe('assets/test.jpg');\r\n\r\n    // @ts-ignore: Accessing private method for testing\r\n    const defaultImageUrl = component.getImageUrl('');\r\n    expect(defaultImageUrl).toBe('assets/default-product-image.jpg');\r\n\r\n    // @ts-ignore: Accessing private method for testing\r\n    const dataUrl = component.getImageUrl('data:image/jpeg;base64,test');\r\n    expect(dataUrl).toBe('data:image/jpeg;base64,test');\r\n  });\r\n\r\n  afterEach(() => {\r\n    fixture.destroy();\r\n  });\r\n});",
        "crud.page.ts": "import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { Product } from '../models/product.model';\r\nimport { ToastController, LoadingController } from '@ionic/angular';\r\nimport { Subscription, Observable, from, of, lastValueFrom} from 'rxjs';\r\nimport { map, catchError } from 'rxjs/operators';\r\nimport { Filesystem, Directory } from '@capacitor/filesystem';\r\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\r\nimport { firstValueFrom } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-crud',\r\n  templateUrl: './crud.page.html',\r\n  styleUrls: ['./crud.page.scss'],\r\n})\r\nexport class CrudPage implements OnInit, OnDestroy {\r\n\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n\r\n  products: Product[] = [];\r\n  currentProduct: Product = { id: 0, name: '', description: '', price: 0, category: '', imageURL: '', isAvailable: true };\r\n  isEditing = false;\r\n  activeSection: 'add' | 'edit' | 'delete' | 'view' = 'view';\r\n\r\n  private subscriptions: Subscription = new Subscription();\r\n\r\n  constructor(\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController,\r\n    private loadingController: LoadingController\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.loadProducts();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscriptions.unsubscribe();\r\n  }\r\n\r\n  async selectImage() {\r\n    try {\r\n      const image = await Camera.getPhoto({\r\n        quality: 90,\r\n        allowEditing: true,\r\n        resultType: CameraResultType.DataUrl,\r\n        source: CameraSource.Photos\r\n      });\r\n\r\n      if (image.dataUrl) {\r\n        this.currentProduct.imageURL = image.dataUrl;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al seleccionar la imagen:', error);\r\n      this.presentToast('Error al seleccionar la imagen');\r\n    }\r\n  }\r\n\r\n  async loadProducts() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando productos...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const products = await this.getAllProducts();\r\n      console.log('Productos obtenidos de la base de datos:', products);\r\n  \r\n      this.products = products.map(product => ({\r\n        ...product,\r\n        imageURL: this.getImageUrl(product.imageURL),\r\n        showOptions: false,\r\n        selectedSize: 'medium',\r\n        selectedMilk: 'regular'\r\n      }));\r\n  \r\n      console.log('Productos procesados:', this.products);\r\n    } catch (error) {\r\n      console.error('Error al cargar los productos:', error);\r\n      await this.presentToast('Error al cargar los productos. Por favor, intente de nuevo.');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  private getImageUrl(imageUri: string): string {\r\n    if (!imageUri) {\r\n      return 'assets/default-product-image.jpg';\r\n    }\r\n  \r\n    if (imageUri.startsWith('data:image') || imageUri.startsWith('assets/')) {\r\n      return imageUri;\r\n    }\r\n  \r\n    return `assets/${imageUri}`;\r\n  }\r\n\r\n\r\n  private getAllProducts(): Promise<Product[]> {\r\n    return firstValueFrom(this.databaseService.getAllProducts().pipe(\r\n      catchError(error => {\r\n        console.error('Error al obtener productos:', error);\r\n        return of([]);\r\n      })\r\n    ));\r\n  }\r\n  \r\n  async addProduct() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Agregando producto...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      if (this.currentProduct.imageURL && this.currentProduct.imageURL.startsWith('data:image')) {\r\n        const fileName = `product_${new Date().getTime()}.jpeg`;\r\n        this.currentProduct.imageURL = await this.saveImage(this.currentProduct.imageURL, fileName);\r\n      }\r\n  \r\n      const newProductId = await this.createProduct(this.currentProduct);\r\n      if (newProductId !== undefined) {\r\n        this.currentProduct.id = newProductId;\r\n        this.products.push({ ...this.currentProduct });\r\n        this.presentToast('Producto agregado con éxito');\r\n        this.resetForm();\r\n        await this.loadProducts();\r\n      } else {\r\n        throw new Error('No se pudo crear el producto');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error adding product:', error);\r\n      this.presentToast('Error al agregar el producto');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n  \r\n\r\n  \r\n\r\n  private createProduct(product: Product): Promise<number | undefined> {\r\n    const result = this.databaseService.createProduct(product);\r\n    if (result instanceof Observable) {\r\n      return result.toPromise();\r\n    }\r\n    return result;\r\n  }\r\n\r\n\r\n  async updateProduct() {\r\n    if (this.currentProduct.price < 0) {\r\n      this.presentToast('El precio debe ser mayor o igual a 0');\r\n      return;\r\n    }\r\n  \r\n    const loading = await this.loadingController.create({\r\n      message: 'Actualizando producto...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      if (this.currentProduct.imageURL && this.currentProduct.imageURL.startsWith('data:image')) {\r\n        const fileName = `product_${this.currentProduct.id}_${new Date().getTime()}.jpeg`;\r\n        this.currentProduct.imageURL = await this.saveImage(this.currentProduct.imageURL, fileName);\r\n      }\r\n  \r\n      const success = await this.updateProductInDb(this.currentProduct);\r\n      if (success) {\r\n        const index = this.products.findIndex(p => p.id === this.currentProduct.id);\r\n        if (index !== -1) {\r\n          this.products[index] = { ...this.currentProduct };\r\n        }\r\n        this.presentToast('Producto actualizado con éxito');\r\n        this.resetForm();\r\n      } else {\r\n        throw new Error('No se pudo actualizar el producto');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al actualizar el producto:', error);\r\n      this.presentToast('Error al actualizar el producto');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n  private async saveImage(imageDataUrl: string, fileName: string): Promise<string> {\r\n    try {\r\n      // Extraer la base64 del Data URL\r\n      const base64Data = imageDataUrl.split(',')[1];\r\n  \r\n      // Guardar el archivo en el directorio de datos de la aplicación\r\n      const savedFile = await Filesystem.writeFile({\r\n        path: fileName,\r\n        data: base64Data,\r\n        directory: Directory.Data\r\n      });\r\n  \r\n      // Devolver la ruta completa del archivo guardado\r\n      return savedFile.uri;\r\n    } catch (error) {\r\n      console.error('Error al guardar la imagen:', error);\r\n      throw new Error('No se pudo guardar la imagen');\r\n    }\r\n  }\r\n\r\n  private updateProductInDb(product: Product): Promise<boolean> {\r\n    const result = this.databaseService.updateProduct(product);\r\n    if (result instanceof Observable) {\r\n      return result.pipe(\r\n        map(() => true),\r\n        catchError(() => of(false))\r\n      ).toPromise().then(value => value ?? false);\r\n    }\r\n    return Promise.resolve(!!result);\r\n  }\r\n\r\n  async deleteProduct(id: number) {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Eliminando producto...',\r\n    });\r\n    await loading.present();\r\n\r\n    try {\r\n      const success = await this.deleteProductFromDb(id);\r\n      if (success) {\r\n        this.products = this.products.filter(p => p.id !== id);\r\n        this.presentToast('Producto eliminado con éxito');\r\n        await this.loadProducts();\r\n      } else {\r\n        throw new Error('No se pudo eliminar el producto');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting product:', error);\r\n      this.presentToast('Error al eliminar el producto');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  private deleteProductFromDb(id: number): Promise<boolean> {\r\n    const result = this.databaseService.deleteProduct(id);\r\n    if (result instanceof Observable) {\r\n      return result.pipe(\r\n        map(() => true),\r\n        catchError(() => of(false))\r\n      ).toPromise().then(value => value ?? false);\r\n    }\r\n    return Promise.resolve(!!result);\r\n  }\r\n\r\n  editProduct(product: Product) {\r\n    this.currentProduct = { ...product };\r\n    this.isEditing = true;\r\n    this.activeSection = 'edit';\r\n  }\r\n\r\n  resetForm() {\r\n    this.currentProduct = { id: 0, name: '', description: '', price: 0, category: '', imageURL: '', isAvailable: true };\r\n    this.isEditing = false;\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'bottom'\r\n    });\r\n    await toast.present();\r\n  }\r\n\r\n  setActiveSection(section: 'add' | 'edit' | 'delete' | 'view') {\r\n    this.activeSection = section;\r\n    if (section !== 'edit') {\r\n      this.resetForm();\r\n    }\r\n  }\r\n\r\n\r\n  handleImageError(event: any) {\r\n    event.target.src = 'assets/default-product-image.jpg';\r\n  }\r\n\r\n\r\n}"
      },
      "employee-dashboard": {
        "employee-dashboard-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { EmployeeDashboardPage } from './employee-dashboard.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: EmployeeDashboardPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class EmployeeDashboardPageRoutingModule {}\r\n",
        "employee-dashboard.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { RouterModule } from '@angular/router';\r\n\r\nimport { EmployeeDashboardPageRoutingModule } from './employee-dashboard-routing.module';\r\nimport { EmployeeDashboardPage } from './employee-dashboard.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    EmployeeDashboardPageRoutingModule,\r\n    RouterModule\r\n  ],\r\n  declarations: [EmployeeDashboardPage]\r\n})\r\nexport class EmployeeDashboardPageModule {}",
        "employee-dashboard.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar color=\"primary\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Dashboard de Empleado</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <div class=\"welcome-section\">\r\n    <ion-avatar>\r\n      <img [src]=\"profilePicture || 'assets/default-avatar.png'\" \r\n     (error)=\"handleImageError($event)\" \r\n     alt=\"Foto de perfil\" \r\n     class=\"profile-picture\">\r\n    </ion-avatar>\r\n    <h2>Bienvenido, {{ employeeName }}</h2>\r\n  </div>\r\n  \r\n  <ion-grid>\r\n    <ion-row>\r\n      <ion-col size=\"12\" size-md=\"6\">\r\n        <ion-card class=\"dashboard-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"today-outline\" color=\"primary\"></ion-icon>\r\n            <ion-card-title>Órdenes de Hoy</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <h3>{{ ordersToday }}</h3>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n      <ion-col size=\"12\" size-md=\"6\">\r\n        <ion-card class=\"dashboard-card\">\r\n          <ion-card-header>\r\n            <ion-icon name=\"hourglass-outline\" color=\"warning\"></ion-icon>\r\n            <ion-card-title>Órdenes Pendientes</ion-card-title>\r\n          </ion-card-header>\r\n          <ion-card-content>\r\n            <h3>{{ pendingOrders }}</h3>\r\n          </ion-card-content>\r\n        </ion-card>\r\n      </ion-col>\r\n    </ion-row>\r\n  </ion-grid>\r\n\r\n  <div class=\"action-buttons\">\r\n    <ion-button expand=\"block\" routerLink=\"/main\" class=\"main-action\">\r\n      <ion-icon name=\"add-circle-outline\" slot=\"start\"></ion-icon>\r\n      Tomar Nueva Orden\r\n    </ion-button>\r\n    <ion-button expand=\"block\" routerLink=\"/comandas\" color=\"secondary\">\r\n      <ion-icon name=\"list-outline\" slot=\"start\"></ion-icon>\r\n      Ver Órdenes Actuales\r\n    </ion-button>\r\n    <ion-button expand=\"block\" routerLink=\"/perfil\" color=\"tertiary\">\r\n      <ion-icon name=\"person-outline\" slot=\"start\"></ion-icon>\r\n      Mi Perfil\r\n    </ion-button>\r\n    <ion-button expand=\"block\" (click)=\"logout()\" color=\"danger\">\r\n      <ion-icon name=\"log-out-outline\" slot=\"start\"></ion-icon>\r\n      Cerrar Sesión\r\n    </ion-button>\r\n  </div>\r\n</ion-content>",
        "employee-dashboard.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n}\r\n\r\nion-content {\r\n  --background: var(--ion-color-light);\r\n}\r\n\r\n.welcome-section {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 30px;\r\n  background-color: #ffffff;\r\n  border-radius: 15px;\r\n  padding: 20px;\r\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\r\n\r\n  ion-avatar {\r\n    width: 70px;\r\n    height: 70px;\r\n    margin-right: 20px;\r\n    border: 3px solid var(--ion-color-primary);\r\n  }\r\n\r\n  h2 {\r\n    color: var(--ion-color-dark);\r\n    font-size: 24px;\r\n    font-weight: 600;\r\n    margin: 0;\r\n  }\r\n}\r\n\r\n.dashboard-card {\r\n  border-radius: 15px;\r\n  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\r\n  margin-bottom: 25px;\r\n  background-color: #ffffff;\r\n  transition: all 0.3s ease;\r\n\r\n  &:hover {\r\n    transform: translateY(-5px);\r\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);\r\n  }\r\n\r\n  ion-card-header {\r\n    display: flex;\r\n    align-items: center;\r\n    background-color: rgba(132, 176, 162, 0.1);\r\n    border-bottom: 1px solid #e0e0e0;\r\n    padding: 15px;\r\n    \r\n    ion-icon {\r\n      font-size: 28px;\r\n      margin-right: 15px;\r\n    }\r\n\r\n    ion-card-title {\r\n      font-size: 18px;\r\n      font-weight: bold;\r\n      color: var(--ion-color-dark);\r\n    }\r\n  }\r\n\r\n  ion-card-content {\r\n    padding: 25px;\r\n    text-align: center;\r\n\r\n    h3 {\r\n      font-size: 42px;\r\n      font-weight: bold;\r\n      color: var(--ion-color-primary);\r\n      margin: 0;\r\n    }\r\n  }\r\n}\r\n\r\n.action-buttons {\r\n  margin-top: 30px;\r\n  display: grid;\r\n  gap: 15px;\r\n\r\n  ion-button {\r\n    --border-radius: 10px;\r\n    font-weight: 600;\r\n    font-size: 16px;\r\n    height: 50px;\r\n    \r\n    ion-icon {\r\n      margin-right: 10px;\r\n      font-size: 20px;\r\n    }\r\n\r\n    &.main-action {\r\n      --background: var(--ion-color-primary);\r\n      --color: #ffffff;\r\n      font-size: 18px;\r\n      height: 60px;\r\n    }\r\n  }\r\n}\r\n\r\n// Animations\r\n@keyframes fadeInUp {\r\n  from { \r\n    opacity: 0; \r\n    transform: translateY(20px); \r\n  }\r\n  to { \r\n    opacity: 1; \r\n    transform: translateY(0); \r\n  }\r\n}\r\n\r\n.welcome-section, .dashboard-card, .action-buttons ion-button {\r\n  animation: fadeInUp 0.5s ease-out forwards;\r\n}\r\n\r\n.welcome-section { animation-delay: 0.1s; }\r\n.dashboard-card:nth-child(1) { animation-delay: 0.2s; }\r\n.dashboard-card:nth-child(2) { animation-delay: 0.3s; }\r\n.action-buttons ion-button:nth-child(1) { animation-delay: 0.4s; }\r\n.action-buttons ion-button:nth-child(2) { animation-delay: 0.5s; }\r\n.action-buttons ion-button:nth-child(3) { animation-delay: 0.6s; }\r\n.action-buttons ion-button:nth-child(4) { animation-delay: 0.7s; }\r\n\r\n@media (max-width: 768px) {\r\n  .welcome-section {\r\n    flex-direction: column;\r\n    text-align: center;\r\n    padding: 15px;\r\n\r\n    ion-avatar {\r\n      margin-right: 0;\r\n      margin-bottom: 15px;\r\n    }\r\n\r\n    h2 {\r\n      font-size: 22px;\r\n    }\r\n  }\r\n\r\n  .dashboard-card {\r\n    ion-card-content {\r\n      h3 {\r\n        font-size: 36px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .action-buttons {\r\n    ion-button {\r\n      height: 45px;\r\n      font-size: 14px;\r\n\r\n      &.main-action {\r\n        height: 55px;\r\n        font-size: 16px;\r\n      }\r\n    }\r\n  }\r\n}",
        "employee-dashboard.page.spec.ts": "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { IonicModule, LoadingController, ToastController, NavController } from '@ionic/angular';\r\nimport { EmployeeDashboardPage } from './employee-dashboard.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { Router } from '@angular/router';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { of } from 'rxjs';\r\n\r\ndescribe('EmployeeDashboardPage', () => {\r\n  let component: EmployeeDashboardPage;\r\n  let fixture: ComponentFixture<EmployeeDashboardPage>;\r\n  let mockDatabaseService: any;\r\n  let mockLoadingController: any;\r\n  let mockToastController: any;\r\n  let mockRouter: any;\r\n  let mockNavController: any;\r\n\r\n  // Mock user data\r\n  const mockUser = {\r\n    id: 1,\r\n    name: 'Test Employee',\r\n    profilePicture: 'test-profile.jpg'\r\n  };\r\n\r\n  // Mock loading element\r\n  const mockLoadingElement = {\r\n    present: () => Promise.resolve(),\r\n    dismiss: () => Promise.resolve()\r\n  };\r\n\r\n  // Mock toast element\r\n  const mockToastElement = {\r\n    present: () => Promise.resolve(),\r\n    dismiss: () => Promise.resolve()\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    // Initialize mock services\r\n    mockDatabaseService = {\r\n      getUserProfilePicture: jasmine.createSpy('getUserProfilePicture').and.returnValue(of('test-profile.jpg')),\r\n      getOrderCountForToday: jasmine.createSpy('getOrderCountForToday').and.returnValue(Promise.resolve(5)),\r\n      getOrdersCount: jasmine.createSpy('getOrdersCount').and.returnValue(Promise.resolve(3))\r\n    };\r\n\r\n    mockLoadingController = {\r\n      create: jasmine.createSpy('create').and.returnValue(Promise.resolve(mockLoadingElement))\r\n    };\r\n\r\n    mockToastController = {\r\n      create: jasmine.createSpy('create').and.returnValue(Promise.resolve(mockToastElement))\r\n    };\r\n\r\n    mockRouter = {\r\n      navigate: jasmine.createSpy('navigate')\r\n    };\r\n\r\n    mockNavController = {\r\n      navigateForward: jasmine.createSpy('navigateForward'),\r\n      navigateRoot: jasmine.createSpy('navigateRoot')\r\n    };\r\n\r\n    // Configure TestBed\r\n    await TestBed.configureTestingModule({\r\n      declarations: [EmployeeDashboardPage],\r\n      imports: [IonicModule.forRoot()],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: mockDatabaseService },\r\n        { provide: LoadingController, useValue: mockLoadingController },\r\n        { provide: ToastController, useValue: mockToastController },\r\n        { provide: Router, useValue: mockRouter },\r\n        { provide: NavController, useValue: mockNavController }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    // Create component and inject services\r\n    fixture = TestBed.createComponent(EmployeeDashboardPage);\r\n    component = fixture.componentInstance;\r\n\r\n    // Mock localStorage\r\n    spyOn(localStorage, 'getItem').and.returnValue(JSON.stringify(mockUser));\r\n    spyOn(localStorage, 'removeItem');\r\n\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  // Basic component tests\r\n  it('1. debe cerar el componente', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('2. debe inicializarse con valores predeterminados', async () => {\r\n    await fixture.whenStable();\r\n    expect(component.employeeName).toBeDefined();\r\n    expect(component.ordersToday).toBeDefined();\r\n    expect(component.pendingOrders).toBeDefined();\r\n  });\r\n\r\n  // Service injection tests\r\n  it('3. Debe tener todos los servicios requeridoss', () => {\r\n    expect(TestBed.inject(DatabaseService)).toBeTruthy();\r\n    expect(TestBed.inject(LoadingController)).toBeTruthy();\r\n    expect(TestBed.inject(ToastController)).toBeTruthy();\r\n    expect(TestBed.inject(Router)).toBeTruthy();\r\n    expect(TestBed.inject(NavController)).toBeTruthy();\r\n  });\r\n\r\n  // Template tests\r\n  it('4.Debe proporcionar los elementos ionic necesarios', () => {\r\n    const compiled = fixture.nativeElement;\r\n    expect(compiled.querySelector('ion-header')).toBeTruthy();\r\n    expect(compiled.querySelector('ion-content')).toBeTruthy();\r\n  });\r\n\r\n  // Functionality tests\r\n  it('5. Debe cargar los datos del usuario desde localStorage al iniciar.', async () => {\r\n    await fixture.whenStable();\r\n    expect(localStorage.getItem).toHaveBeenCalledWith('currentUser');\r\n    expect(component.profilePicture).toBe(mockUser.profilePicture);\r\n  });\r\n\r\n  it('1. Debería cargar los datos de los empleados con éxito', fakeAsync(() => {\r\n    component.loadEmployeeData();\r\n    tick();\r\n\r\n    expect(mockDatabaseService.getUserProfilePicture).toHaveBeenCalled();\r\n    expect(mockDatabaseService.getOrderCountForToday).toHaveBeenCalled();\r\n    expect(mockDatabaseService.getOrdersCount).toHaveBeenCalled();\r\n    expect(component.ordersToday).toBe(5);\r\n    expect(component.pendingOrders).toBe(3);\r\n  }));\r\n\r\n  it('2. Debería gestionar el cierre de sesión correctamente', () => {\r\n    component.logout();\r\n    expect(localStorage.removeItem).toHaveBeenCalledWith('currentUser');\r\n    expect(mockRouter.navigate).toHaveBeenCalledWith(['/login']);\r\n  });\r\n\r\n  it('3. Debería manejar el error de imagen configurando el avatar predeterminado', () => {\r\n    const event = { target: { src: '' } };\r\n    component.handleImageError(event);\r\n    expect(event.target.src).toBe('assets/default-avatar.png');\r\n  });\r\n\r\n  it('4. Debe mostrar y descartar el indicador de carga durante la carga de datos', fakeAsync(() => {\r\n    component.loadEmployeeData();\r\n    tick();\r\n    \r\n    expect(mockLoadingController.create).toHaveBeenCalled();\r\n    expect(mockLoadingElement.present).toBeDefined();\r\n    expect(mockLoadingElement.dismiss).toBeDefined();\r\n  }));\r\n\r\n  it('5. Debe mostrar un mensaje de error si ocurre un error al cargar los datos', fakeAsync(() => {\r\n    mockDatabaseService.getOrderCountForToday.and.returnValue(Promise.reject('Error'));\r\n    const toastSpy = spyOn(component, 'presentToast');\r\n    \r\n    component.loadEmployeeData();\r\n    tick();\r\n    \r\n    expect(toastSpy).toHaveBeenCalledWith('Error al cargar datos. Por favor, intente de nuevo.');\r\n  }));\r\n});",
        "employee-dashboard.page.ts": "import { Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { LoadingController, ToastController } from '@ionic/angular';\r\nimport { DatabaseService } from '../services/database.service';\r\n\r\n@Component({\r\n  selector: 'app-employee-dashboard',\r\n  templateUrl: './employee-dashboard.page.html',\r\n  styleUrls: ['./employee-dashboard.page.scss'],\r\n})\r\nexport class EmployeeDashboardPage implements OnInit {\r\n  employeeName: string = 'Empleado';\r\n  employeeProfilePicture: string | null = null;\r\n  ordersToday: number = 0;\r\n  pendingOrders: number = 0;\r\n  profilePicture: string | null = null;\r\n\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private loadingController: LoadingController,\r\n    private toastController: ToastController,\r\n    private databaseService: DatabaseService\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.loadEmployeeData();\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    this.profilePicture = currentUser.profilePicture || null;\r\n  }\r\n\r\n  async loadEmployeeData() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando datos...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n      this.employeeName = currentUser.name || 'Empleado';\r\n  \r\n      // Cargar la foto de perfil\r\n      if (currentUser.id) {\r\n        try {\r\n          const profilePicture = await this.databaseService.getUserProfilePicture(currentUser.id).toPromise();\r\n          this.employeeProfilePicture = profilePicture !== undefined ? profilePicture : null;\r\n          console.log('Foto de perfil cargada:', this.employeeProfilePicture);\r\n        } catch (error) {\r\n          console.error('Error al cargar la foto de perfil:', error);\r\n          this.employeeProfilePicture = null;\r\n        }\r\n      }\r\n  \r\n      // Obtener el número real de órdenes del día\r\n      this.ordersToday = await this.databaseService.getOrderCountForToday();\r\n      console.log('Número de órdenes del día:', this.ordersToday);\r\n  \r\n      // Obtener el número real de órdenes pendientes\r\n      this.pendingOrders = await this.databaseService.getOrdersCount(['Solicitado', 'En proceso']);\r\n      console.log('Número de órdenes pendientes:', this.pendingOrders);\r\n  \r\n    } catch (error) {\r\n      console.error('Error al cargar datos del dashboard:', error);\r\n      this.presentToast('Error al cargar datos. Por favor, intente de nuevo.');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  logout() {\r\n    localStorage.removeItem('currentUser');\r\n    this.router.navigate(['/login']);\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'bottom'\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  handleImageError(event: any) {\r\n    event.target.src = 'assets/default-avatar.png';\r\n  }\r\n}"
      },
      "employee-management": {
        "employee-management-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { EmployeeManagementPage } from './employee-management.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: EmployeeManagementPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class EmployeeManagementPageRoutingModule {}\r\n",
        "employee-management.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { EmployeeManagementPageRoutingModule } from './employee-management-routing.module';\r\nimport { EmployeeManagementPage } from './employee-management.page';\r\nimport { AddUserModalComponent } from '../add-user-modal/add-user-modal.component';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    EmployeeManagementPageRoutingModule\r\n  ],\r\n  declarations: [\r\n    EmployeeManagementPage,\r\n    AddUserModalComponent  // Declara el nuevo componente\r\n  ]\r\n})\r\nexport class EmployeeManagementPageModule {}",
        "employee-management.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar color=\"primary\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Gestión de Empleados</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <ion-searchbar placeholder=\"Buscar empleados\" (ionInput)=\"searchEmployees($event)\" animated></ion-searchbar>\r\n\r\n  <ion-list>\r\n    <ion-item-sliding *ngFor=\"let user of filteredUsers\">\r\n      <ion-item class=\"user-item\">\r\n        <ion-avatar slot=\"start\">\r\n          <img [src]=\"user.ProfilePicture || 'assets/default-avatar.png'\" \r\n               (error)=\"handleImageError($event)\"\r\n               alt=\"Foto de perfil\">\r\n        </ion-avatar>\r\n        <ion-label>\r\n          <h2>{{ user.Name }}</h2>\r\n          <p>{{ user.Email }}</p>\r\n          <div class=\"badge-container\">\r\n            <ion-badge [color]=\"getApprovalStatusColor(user.ApprovalStatus)\">\r\n              {{ getApprovalStatusLabel(user.ApprovalStatus) }}\r\n            </ion-badge>\r\n            <ion-badge [color]=\"getRoleColor(user.Role)\">\r\n              {{ getRoleLabel(user.Role) }}\r\n            </ion-badge>\r\n          </div>\r\n        </ion-label>\r\n      </ion-item>\r\n      <ion-item-options side=\"end\">\r\n        <ion-item-option (click)=\"changeApprovalStatus(user)\" color=\"primary\">\r\n          <ion-icon name=\"checkmark-circle-outline\" slot=\"icon-only\"></ion-icon>\r\n        </ion-item-option>\r\n        <ion-item-option (click)=\"changeRole(user)\" color=\"secondary\">\r\n          <ion-icon name=\"people-outline\" slot=\"icon-only\"></ion-icon>\r\n        </ion-item-option>\r\n        <ion-item-option (click)=\"editUser(user)\" color=\"tertiary\">\r\n          <ion-icon name=\"create-outline\" slot=\"icon-only\"></ion-icon>\r\n        </ion-item-option>\r\n        <ion-item-option (click)=\"confirmDeleteUser(user)\" color=\"danger\">\r\n          <ion-icon name=\"trash-outline\" slot=\"icon-only\"></ion-icon>\r\n        </ion-item-option>\r\n      </ion-item-options>\r\n    </ion-item-sliding>\r\n  </ion-list>\r\n\r\n  <ion-infinite-scroll (ionInfinite)=\"loadMoreUsers($event)\">\r\n    <ion-infinite-scroll-content loadingSpinner=\"bubbles\" loadingText=\"Cargando más empleados...\">\r\n    </ion-infinite-scroll-content>\r\n  </ion-infinite-scroll>\r\n</ion-content>\r\n\r\n<ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\">\r\n  <ion-fab-button (click)=\"openAddUserModal()\">\r\n    <ion-icon name=\"add\"></ion-icon>\r\n  </ion-fab-button>\r\n</ion-fab>\r\n\r\n<ion-toast\r\n  [isOpen]=\"showToast\"\r\n  [message]=\"toastMessage\"\r\n  [duration]=\"3000\"\r\n  position=\"top\"\r\n  [color]=\"toastColor\">\r\n</ion-toast>",
        "employee-management.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n}\r\n\r\nion-content {\r\n  --background: var(--ion-color-light);\r\n}\r\n\r\nion-searchbar {\r\n  --box-shadow: none;\r\n  --background: #ffffff;\r\n  --border-radius: 10px;\r\n  padding: 0;\r\n  margin-bottom: 16px;\r\n}\r\n\r\nion-list {\r\n  background: transparent;\r\n  padding: 0;\r\n}\r\n\r\n.user-item {\r\n  --background: #ffffff;\r\n  --padding-start: 16px;\r\n  --inner-padding-end: 16px;\r\n  margin-bottom: 16px;\r\n  border-radius: 12px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  overflow: hidden;\r\n\r\n  ion-avatar {\r\n    width: 50px;\r\n    height: 50px;\r\n    margin-right: 16px;\r\n  }\r\n\r\n  ion-label {\r\n    h2 {\r\n      font-size: 18px;\r\n      font-weight: 600;\r\n      color: var(--ion-color-dark);\r\n      margin-bottom: 4px;\r\n    }\r\n\r\n    p {\r\n      font-size: 14px;\r\n      color: var(--ion-color-medium);\r\n      margin-bottom: 8px;\r\n    }\r\n\r\n    .badge-container {\r\n      display: flex;\r\n      gap: 8px;\r\n\r\n      ion-badge {\r\n        font-size: 12px;\r\n        font-weight: 500;\r\n        padding: 4px 8px;\r\n        border-radius: 4px;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nion-item-options {\r\n  border-radius: 0 12px 12px 0;\r\n  overflow: hidden;\r\n\r\n  ion-item-option {\r\n    --padding-start: 12px;\r\n    --padding-end: 12px;\r\n    font-size: 14px;\r\n\r\n    ion-icon {\r\n      font-size: 20px;\r\n      margin-right: 4px;\r\n    }\r\n  }\r\n}\r\n\r\nion-fab-button {\r\n  --background: var(--ion-color-primary);\r\n  --box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\nion-modal {\r\n  --height: auto;\r\n  --width: 90%;\r\n  --border-radius: 16px;\r\n  --box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n@media (min-width: 768px) {\r\n  ion-modal {\r\n    --width: 600px;\r\n  }\r\n}\r\n\r\n.ion-padding {\r\n  padding: 20px;\r\n}\r\n\r\nform {\r\n  ion-item {\r\n    --padding-start: 0;\r\n    --inner-padding-end: 0;\r\n    --background: transparent;\r\n  }\r\n}\r\n\r\n\r\n// Animations\r\n@keyframes fadeInUp {\r\n  from { \r\n    opacity: 0;\r\n    transform: translateY(20px);\r\n  }\r\n  to { \r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\nion-item-sliding {\r\n  animation: fadeInUp 0.3s ease-out;\r\n  animation-fill-mode: both;\r\n\r\n  @for $i from 1 through 10 {\r\n    &:nth-child(#{$i}) {\r\n      animation-delay: #{$i * 0.05}s;\r\n    }\r\n  }\r\n}",
        "employee-management.page.spec.ts": "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { IonicModule, AlertController, LoadingController, ToastController, ModalController } from '@ionic/angular';\r\nimport { EmployeeManagementPage } from './employee-management.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { RouterTestingModule } from '@angular/router/testing';\r\nimport { Camera } from '@capacitor/camera';\r\nimport { of } from 'rxjs';\r\nimport { User } from '../models/user.model';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\n\r\ndescribe('EmployeeManagementPage', () => {\r\n  let component: EmployeeManagementPage;\r\n  let fixture: ComponentFixture<EmployeeManagementPage>;\r\n  let databaseServiceSpy: jasmine.SpyObj<DatabaseService>;\r\n  let toastControllerSpy: jasmine.SpyObj<ToastController>;\r\n  let loadingControllerSpy: jasmine.SpyObj<LoadingController>;\r\n  let alertControllerSpy: jasmine.SpyObj<AlertController>;\r\n  let modalControllerSpy: jasmine.SpyObj<ModalController>;\r\n\r\n  const mockUser: User = {\r\n    UserID: 1,\r\n    Username: 'testUser',\r\n    Password: 'password123',\r\n    Role: 'employee',\r\n    Name: 'Test User',\r\n    Email: 'test@example.com',\r\n    ApprovalStatus: 'approved',\r\n    ProfilePicture: 'assets/default-avatar.png'\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', [\r\n      'getAllUsers',\r\n      'getUserProfilePicture',\r\n      'updateUserProfilePicture',\r\n      'getUserById',\r\n      'updateUserFromDb',\r\n      'updateUserApprovalStatus',\r\n      'deleteUser',\r\n      'createUser'\r\n    ]);\r\n\r\n    // Configurar retornos de los spies\r\n    dbSpy.getAllUsers.and.returnValue(of([mockUser]));\r\n    dbSpy.getUserProfilePicture.and.returnValue(of('test.jpg'));\r\n    dbSpy.updateUserProfilePicture.and.returnValue(Promise.resolve(true));\r\n    dbSpy.getUserById.and.returnValue(of(mockUser));\r\n    dbSpy.updateUserFromDb.and.returnValue(Promise.resolve(true));\r\n    dbSpy.updateUserApprovalStatus.and.returnValue(of(true));\r\n    dbSpy.deleteUser.and.returnValue(of(true));\r\n    dbSpy.createUser.and.returnValue(Promise.resolve(1));\r\n\r\n    const mockIonicController = {\r\n      create: () => Promise.resolve({\r\n        present: () => Promise.resolve(),\r\n        dismiss: () => Promise.resolve(),\r\n        onDidDismiss: () => Promise.resolve({ role: 'confirm', data: mockUser })\r\n      })\r\n    };\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [EmployeeManagementPage],\r\n      imports: [IonicModule.forRoot(), RouterTestingModule],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { provide: ToastController, useValue: mockIonicController },\r\n        { provide: LoadingController, useValue: mockIonicController },\r\n        { provide: AlertController, useValue: mockIonicController },\r\n        { provide: ModalController, useValue: mockIonicController }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(EmployeeManagementPage);\r\n    component = fixture.componentInstance;\r\n    databaseServiceSpy = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    toastControllerSpy = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    loadingControllerSpy = TestBed.inject(LoadingController) as jasmine.SpyObj<LoadingController>;\r\n    alertControllerSpy = TestBed.inject(AlertController) as jasmine.SpyObj<AlertController>;\r\n    modalControllerSpy = TestBed.inject(ModalController) as jasmine.SpyObj<ModalController>;\r\n\r\n    spyOn(localStorage, 'getItem').and.returnValue(JSON.stringify({\r\n      id: 1,\r\n      profilePicture: 'test.jpg'\r\n    }));\r\n    spyOn(localStorage, 'setItem').and.callFake(() => {});\r\n\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('1. debe crear el componente', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('2. Debería tener una matriz de usuarios inicial vacía', () => {\r\n    expect(component.users).toEqual([]);\r\n  });\r\n\r\n  it('3. Debería tener ion-title', () => {\r\n    const compiled = fixture.nativeElement;\r\n    expect(compiled.querySelector('ion-title')).toBeTruthy();\r\n  });\r\n\r\n  it('4. should have ion-searchbar', () => {\r\n    const compiled = fixture.nativeElement;\r\n    expect(compiled.querySelector('ion-searchbar')).toBeTruthy();\r\n  });\r\n\r\n  it('5. Debería tener ion-fab-button', () => {\r\n    const compiled = fixture.nativeElement;\r\n    expect(compiled.querySelector('ion-fab-button')).toBeTruthy();\r\n  });\r\n\r\n  it('1. Debería cargar usuarios al iniciar.', fakeAsync(() => {\r\n    component.ngOnInit();\r\n    tick();\r\n    expect(databaseServiceSpy.getAllUsers).toHaveBeenCalled();\r\n  }));\r\n\r\n  it('2. Debería filtrar a los usuarios correctamente', () => {\r\n    component.users = [mockUser];\r\n    component.searchEmployees({ target: { value: 'test' } });\r\n    expect(component.filteredUsers.length).toBe(1);\r\n    \r\n    component.searchEmployees({ target: { value: 'nonexistent' } });\r\n    expect(component.filteredUsers.length).toBe(0);\r\n  });\r\n\r\n  it('3. Debería gestionar la eliminación de usuarios', fakeAsync(() => {\r\n    component.users = [mockUser];\r\n    component.filteredUsers = [mockUser];\r\n    \r\n    component.deleteUser(mockUser);\r\n    tick();\r\n    \r\n    expect(databaseServiceSpy.deleteUser).toHaveBeenCalledWith(mockUser.UserID);\r\n  }));\r\n\r\n  it('4. Debería actualizar el estado de aprobación del usuario.', fakeAsync(() => {\r\n    component.updateUserApprovalStatus(mockUser, 'approved');\r\n    tick();\r\n    \r\n    expect(databaseServiceSpy.updateUserApprovalStatus).toHaveBeenCalledWith(\r\n      mockUser.UserID,\r\n      'approved'\r\n    );\r\n  }));\r\n\r\n  it('5. should handle basic user data updates', fakeAsync(() => {\r\n    const updatedUser = { ...mockUser, Name: 'Updated Name' };\r\n    component.updateUser(updatedUser);\r\n    tick();\r\n    expect(databaseServiceSpy.updateUserFromDb).toHaveBeenCalledWith(updatedUser);\r\n  }));\r\n\r\n  // Pruebas adicionales\r\n  it('Debe manejar actualizaciones de datos básicos del usuario.', () => {\r\n    expect(component.getRoleColor('admin')).toBe('primary');\r\n    expect(component.getRoleColor('employee')).toBe('secondary');\r\n  });\r\n\r\n  it('Debería obtener los colores de estado de aprobación correctos', () => {\r\n    expect(component.getApprovalStatusColor('approved')).toBe('success');\r\n    expect(component.getApprovalStatusColor('pending')).toBe('warning');\r\n    expect(component.getApprovalStatusColor('rejected')).toBe('danger');\r\n  });\r\n\r\n  it('Debería manejar correctamente a los empleados de búsqueda.', () => {\r\n    component.users = [mockUser];\r\n    \r\n    component.searchEmployees({ target: { value: 'Test' } });\r\n    expect(component.filteredUsers.length).toBe(1);\r\n    \r\n    component.searchEmployees({ target: { value: 'xyz' } });\r\n    expect(component.filteredUsers.length).toBe(0);\r\n  });\r\n\r\n  it('Debería manejar el error de imagen', () => {\r\n    const event = { target: { src: '' } };\r\n    component.handleImageError(event);\r\n    expect(event.target.src).toBe('assets/default-avatar.png');\r\n  });\r\n\r\n  it('Deberían obtenerse las etiquetas de roles correctas', () => {\r\n    expect(component.getRoleLabel('admin')).toBe('Administrador');\r\n    expect(component.getRoleLabel('employee')).toBe('Empleado');\r\n  });\r\n\r\n  it('Deberían obtenerse etiquetas de estado correctas', () => {\r\n    expect(component.getApprovalStatusLabel('approved')).toBe('Aprobado');\r\n    expect(component.getApprovalStatusLabel('pending')).toBe('Pendiente');\r\n    expect(component.getApprovalStatusLabel('rejected')).toBe('Rechazado');\r\n  });\r\n});",
        "employee-management.page.ts": "import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { AlertController, LoadingController, ToastController, ModalController } from '@ionic/angular';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { User } from '../models/user.model';\r\nimport { Subscription } from 'rxjs';\r\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\r\nimport { first } from 'rxjs/operators';\r\nimport { AddUserModalComponent } from '../add-user-modal/add-user-modal.component';\r\n\r\n@Component({\r\n  selector: 'app-employee-management',\r\n  templateUrl: './employee-management.page.html',\r\n  styleUrls: ['./employee-management.page.scss'],\r\n})\r\nexport class EmployeeManagementPage implements OnInit, OnDestroy {\r\n  users: User[] = [];\r\n  private subscriptions: Subscription = new Subscription();\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n  toastColor: string = 'success';\r\n  selectedDay: string = 'monday';\r\n  selectedDayAnalytics: any;\r\n  filteredUsers: User[] = [];\r\n  profilePicture: string | null = null;\r\n\r\n  constructor(\r\n    private databaseService: DatabaseService,\r\n    private alertController: AlertController,\r\n    private loadingController: LoadingController,\r\n    private toastController: ToastController,\r\n    private modalController: ModalController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.loadUsers();\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    this.profilePicture = currentUser.profilePicture || null;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscriptions.unsubscribe();\r\n  }\r\n\r\n  loadMoreUsers(event: any) {\r\n    // Implement pagination logic here if needed\r\n    event.target.complete();\r\n  }\r\n\r\n  async openAddUserModal() {\r\n    const modal = await this.modalController.create({\r\n      component: AddUserModalComponent\r\n    });\r\n    \r\n    await modal.present();\r\n\r\n    const { data, role } = await modal.onDidDismiss();\r\n    if (role === 'confirm' && data) {\r\n      await this.submitAddUser(data);\r\n    }\r\n  }\r\n\r\n  async submitAddUser(userData: User) {\r\n    if (userData.Name && userData.Email && userData.Password) {\r\n      userData.Username = userData.Email;\r\n      try {\r\n        const userId = await this.databaseService.createUser(userData);\r\n        if (userId) {\r\n          userData.UserID = userId;\r\n          this.users.push({ ...userData });\r\n          this.filteredUsers = [...this.users];\r\n          this.presentToast('Usuario creado con éxito', 'success');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error al crear usuario:', error);\r\n        this.presentToast('Error al crear usuario', 'danger');\r\n      }\r\n    } else {\r\n      this.presentToast('Por favor, complete todos los campos', 'warning');\r\n    }\r\n  }\r\n\r\n  searchEmployees(event: any) {\r\n    const searchTerm = event.target.value.toLowerCase();\r\n    this.filteredUsers = this.users.filter(user => \r\n      user.Name.toLowerCase().includes(searchTerm) || \r\n      user.Email.toLowerCase().includes(searchTerm)\r\n    );\r\n  }\r\n\r\n  async loadUsers() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando empleados...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      console.log('Iniciando carga de usuarios...');\r\n      const users = await this.databaseService.getAllUsers().pipe(first()).toPromise();\r\n      console.log('Usuarios obtenidos de la base de datos:', users);\r\n  \r\n      if (!users) {\r\n        throw new Error('No se obtuvieron usuarios de la base de datos');\r\n      }\r\n  \r\n      this.users = await Promise.all(users.map(async user => {\r\n        try {\r\n          const profilePicture = await this.databaseService.getUserProfilePicture(user.UserID!).toPromise();\r\n          console.log(`Foto de perfil obtenida para el usuario ${user.UserID}:`, profilePicture);\r\n          return { \r\n            ...user, \r\n            ProfilePicture: profilePicture || 'assets/default-avatar.png'\r\n          };\r\n        } catch (error) {\r\n          console.error(`Error al obtener la foto de perfil para el usuario ${user.UserID}:`, error);\r\n          return { ...user, ProfilePicture: 'assets/default-avatar.png' };\r\n        }\r\n      }));\r\n  \r\n      this.filteredUsers = [...this.users];\r\n      console.log('Usuarios cargados y procesados:', this.users);\r\n  \r\n      if (this.users.length === 0) {\r\n        this.presentToast('No se encontraron empleados.', 'warning');\r\n      } else {\r\n        this.presentToast(`Se cargaron ${this.users.length} empleados.`, 'success');\r\n      }\r\n  \r\n      if (this.users.length > 0) {\r\n        this.showSlideInstruction();\r\n      }\r\n  \r\n    } catch (error) {\r\n      console.error('Error al cargar empleados:', error);\r\n      this.presentToast('Error al cargar empleados. Por favor, intente de nuevo.', 'danger');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  async changeProfilePicture(user: User) {\r\n    try {\r\n      const image = await Camera.getPhoto({\r\n        quality: 90,\r\n        allowEditing: true,\r\n        resultType: CameraResultType.DataUrl,\r\n        source: CameraSource.Prompt\r\n      });\r\n  \r\n      const profilePicture = image.dataUrl;\r\n      if (profilePicture) {\r\n        await this.databaseService.updateUserProfilePicture(user.UserID!, profilePicture);\r\n        \r\n        const index = this.users.findIndex(u => u.UserID === user.UserID);\r\n        if (index !== -1) {\r\n          this.users[index].ProfilePicture = profilePicture;\r\n          this.filteredUsers = [...this.users];\r\n        }\r\n  \r\n        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n        if (currentUser.id === user.UserID) {\r\n          currentUser.profilePicture = profilePicture;\r\n          localStorage.setItem('currentUser', JSON.stringify(currentUser));\r\n          this.profilePicture = profilePicture;\r\n        }\r\n  \r\n        this.presentToast('Foto de perfil actualizada con éxito', 'success');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al cambiar la foto de perfil:', error);\r\n      this.presentToast('Error al cambiar la foto de perfil', 'danger');\r\n    }\r\n  }\r\n\r\n  async reloadUser(userId: number) {\r\n    try {\r\n      const updatedUser = await this.databaseService.getUserById(userId).toPromise();\r\n      if (updatedUser) {\r\n        const profilePicture = await this.databaseService.getUserProfilePicture(userId).toPromise();\r\n        updatedUser.ProfilePicture = profilePicture || 'assets/default-avatar.png';\r\n  \r\n        const index = this.users.findIndex(u => u.UserID === userId);\r\n        if (index !== -1) {\r\n          this.users[index] = updatedUser;\r\n          this.filteredUsers = this.filteredUsers.map(u => u.UserID === userId ? updatedUser : u);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al recargar usuario:', error);\r\n    }\r\n  }\r\n\r\n  async changeRole(user: User) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Cambiar Rol',\r\n      message: `Cambiar rol de ${user.Name}`,\r\n      inputs: [\r\n        {\r\n          name: 'role',\r\n          type: 'radio',\r\n          label: 'Empleado',\r\n          value: 'employee',\r\n          checked: user.Role === 'employee'\r\n        },\r\n        {\r\n          name: 'role',\r\n          type: 'radio',\r\n          label: 'Administrador',\r\n          value: 'admin',\r\n          checked: user.Role === 'admin'\r\n        }\r\n      ],\r\n      buttons: [\r\n        { text: 'Cancelar', role: 'cancel' },\r\n        {\r\n          text: 'Cambiar',\r\n          handler: async (data) => {\r\n            user.Role = data;\r\n            await this.updateUser(user);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  async changeApprovalStatus(user: User) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Cambiar Estado de Aprobación',\r\n      message: `Cambiar estado de aprobación de ${user.Name}`,\r\n      inputs: [\r\n        {\r\n          name: 'approvalStatus',\r\n          type: 'radio',\r\n          label: 'Aprobado',\r\n          value: 'approved',\r\n          checked: user.ApprovalStatus === 'approved'\r\n        },\r\n        {\r\n          name: 'approvalStatus',\r\n          type: 'radio',\r\n          label: 'Pendiente',\r\n          value: 'pending',\r\n          checked: user.ApprovalStatus === 'pending'\r\n        },\r\n        {\r\n          name: 'approvalStatus',\r\n          type: 'radio',\r\n          label: 'Rechazado',\r\n          value: 'rejected',\r\n          checked: user.ApprovalStatus === 'rejected'\r\n        }\r\n      ],\r\n      buttons: [\r\n        { text: 'Cancelar', role: 'cancel' },\r\n        {\r\n          text: 'Cambiar',\r\n          handler: async (data) => {\r\n            await this.updateUserApprovalStatus(user, data);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  async updateUser(user: User) {\r\n    try {\r\n      const success = await this.databaseService.updateUserFromDb(user);\r\n      if (success) {\r\n        await this.reloadUser(user.UserID!);\r\n        this.presentToast('Usuario actualizado con éxito', 'success');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al actualizar usuario:', error);\r\n      this.presentToast('Error al actualizar usuario', 'danger');\r\n    }\r\n  }\r\n\r\n  async updateUserApprovalStatus(user: User, status: 'approved' | 'pending' | 'rejected') {\r\n    try {\r\n      let success: boolean;\r\n      \r\n      if (status === 'pending') {\r\n        success = true;\r\n      } else {\r\n        const result = await this.databaseService.updateUserApprovalStatus(user.UserID!, status).toPromise();\r\n        success = result !== undefined ? result : false;\r\n      }\r\n  \r\n      if (success) {\r\n        user.ApprovalStatus = status;\r\n        this.presentToast(`Usuario ${status === 'approved' ? 'aprobado' : status === 'pending' ? 'pendiente' : 'rechazado'} con éxito`, 'success');\r\n        await this.loadUsers();\r\n      } else {\r\n        throw new Error('No se pudo actualizar el estado de aprobación');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al actualizar el estado de aprobación:', error);\r\n      this.presentToast('Error al actualizar el estado de aprobación', 'danger');\r\n    }\r\n  }\r\n\r\n  async deleteUser(user: User) {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Eliminando usuario...',\r\n    });\r\n    await loading.present();\r\n\r\n    try {\r\n      const success = await this.databaseService.deleteUser(user.UserID!).toPromise();\r\n      if (success) {\r\n        this.users = this.users.filter(u => u.UserID !== user.UserID);\r\n        this.filteredUsers = this.filteredUsers.filter(u => u.UserID !== user.UserID);\r\n        this.presentToast('Usuario eliminado con éxito', 'success');\r\n      } else {\r\n        throw new Error('No se pudo eliminar el usuario');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al eliminar usuario:', error);\r\n      this.presentToast('Error al eliminar usuario', 'danger');\r\n    } finally {\r\n      loading.dismiss();\r\n    }\r\n  }\r\n\r\n  async presentToast(message: string, color: string = 'success') {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'bottom',\r\n      color: color\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  getRoleColor(role: string): string {\r\n    return role === 'admin' ? 'primary' : 'secondary';\r\n  }\r\n\r\n  getApprovalStatusColor(status: string): string {\r\n    switch (status) {\r\n      case 'approved':\r\n        return 'success';\r\n      case 'pending':\r\n        return 'warning';\r\n      case 'rejected':\r\n        return 'danger';\r\n      default:\r\n        return 'medium';\r\n    }\r\n  }\r\n\r\n  getRoleLabel(role: string): string {\r\n    switch (role) {\r\n      case 'admin':\r\n        return 'Administrador';\r\n      case 'employee':\r\n        return 'Empleado';\r\n      default:\r\n        return role;\r\n    }\r\n  }\r\n\r\n  getApprovalStatusLabel(status: string): string {\r\n    switch (status) {\r\n      case 'approved':\r\n        return 'Aprobado';\r\n      case 'pending':\r\n        return 'Pendiente';\r\n      case 'rejected':\r\n        return 'Rechazado';\r\n      default:\r\n        return status;\r\n    }\r\n  }\r\n\r\n  async editUser(user: User) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Editar Usuario',\r\n      inputs: [\r\n        {\r\n          name: 'name',\r\n          type: 'text',\r\n          value: user.Name,\r\n          placeholder: 'Nombre'\r\n        },\r\n        {\r\n          name: 'email',\r\n          type: 'email',\r\n          value: user.Email,\r\n          placeholder: 'Correo electrónico'\r\n        }\r\n      ],\r\n      buttons: [\r\n        {\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Cambiar Foto',\r\n          handler: () => {\r\n            this.changeProfilePicture(user);\r\n          }\r\n        },\r\n        {\r\n          text: 'Guardar',\r\n          handler: (data) => {\r\n            user.Name = data.name;\r\n            user.Email = data.email;\r\n            this.updateUser(user);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  async confirmDeleteUser(user: User) {\r\n    const alert = await this.alertController.create({\r\n      header: 'Confirmar eliminación',\r\n      message: `¿Está seguro de que desea eliminar a ${user.Name}?`,\r\n      buttons: [\r\n        {\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Eliminar',\r\n          handler: () => {\r\n            this.deleteUser(user);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  async showSlideInstruction() {\r\n    const toast = await this.toastController.create({\r\n      message: 'Desliza hacia la izquierda sobre un empleado para modificarlo',\r\n      duration: 3000,\r\n      position: 'bottom',\r\n      color: 'primary',\r\n      buttons: [\r\n        {\r\n          side: 'end',\r\n          icon: 'close',\r\n          role: 'cancel'\r\n        }\r\n      ]\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  handleImageError(event: any) {\r\n    event.target.src = 'assets/default-avatar.png';\r\n  }\r\n}"
      },
      "forgot-password": {
        "forgot-password-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ForgotPasswordPage } from './forgot-password.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ForgotPasswordPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class ForgotPasswordPageRoutingModule {}\r\n",
        "forgot-password.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { ForgotPasswordPageRoutingModule } from './forgot-password-routing.module';\r\n\r\nimport { ForgotPasswordPage } from './forgot-password.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ForgotPasswordPageRoutingModule\r\n  ],\r\n  declarations: [ForgotPasswordPage]\r\n})\r\nexport class ForgotPasswordPageModule {}\r\n",
        "forgot-password.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-button (click)=\"goBack()\">\r\n        <ion-icon name=\"arrow-back-outline\"></ion-icon>\r\n      </ion-button>\r\n    </ion-buttons>\r\n    <ion-title>Recuperar Contraseña</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <div class=\"forgot-password-container\">\r\n    <!-- Paso 1: Introducir email -->\r\n    <div *ngIf=\"step === 'email'\" class=\"step-container\">\r\n      <h2>Recuperar Contraseña</h2>\r\n      <p>Ingrese su correo electrónico para recibir un código de verificación</p>\r\n      \r\n      <ion-item>\r\n        <ion-label position=\"floating\">Correo Electrónico</ion-label>\r\n        <ion-input type=\"email\" [(ngModel)]=\"email\" required></ion-input>\r\n      </ion-item>\r\n\r\n      <ion-button expand=\"block\" (click)=\"sendVerificationCode()\" class=\"ion-margin-top\">\r\n        Enviar Código\r\n      </ion-button>\r\n    </div>\r\n\r\n    <!-- Paso 2: Verificar código -->\r\n    <div *ngIf=\"step === 'verify'\" class=\"step-container\">\r\n      <h2>Verificar Código</h2>\r\n      <p>Ingrese el código de 4 dígitos enviado a su correo</p>\r\n      \r\n      <ion-item>\r\n        <ion-label position=\"floating\">Código de Verificación</ion-label>\r\n        <ion-input type=\"number\" [(ngModel)]=\"verificationCode\" maxlength=\"4\" required></ion-input>\r\n      </ion-item>\r\n\r\n      <ion-button expand=\"block\" (click)=\"verifyCode()\" class=\"ion-margin-top\">\r\n        Verificar Código\r\n      </ion-button>\r\n    </div>\r\n\r\n    <!-- Paso 3: Reset contraseña -->\r\n    <div *ngIf=\"step === 'reset'\" class=\"step-container\">\r\n      <h2>Nueva Contraseña</h2>\r\n      <p>Ingrese su nueva contraseña</p>\r\n      \r\n      <ion-item>\r\n        <ion-label position=\"floating\">Nueva Contraseña</ion-label>\r\n        <ion-input type=\"password\" [(ngModel)]=\"newPassword\" required></ion-input>\r\n      </ion-item>\r\n\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Confirmar Contraseña</ion-label>\r\n        <ion-input type=\"password\" [(ngModel)]=\"confirmPassword\" required></ion-input>\r\n      </ion-item>\r\n\r\n      <ion-text color=\"medium\" class=\"password-requirements\">\r\n        <p>La contraseña debe contener:</p>\r\n        <ul>\r\n          <li>Al menos 6 caracteres</li>\r\n          <li>Una letra mayúscula</li>\r\n          <li>Una letra minúscula</li>\r\n          <li>Un número</li>\r\n          <li>Un carácter especial</li>\r\n        </ul>\r\n      </ion-text>\r\n\r\n      <ion-button expand=\"block\" (click)=\"resetPassword()\" class=\"ion-margin-top\">\r\n        Cambiar Contraseña\r\n      </ion-button>\r\n    </div>\r\n  </div>\r\n</ion-content>\r\n\r\n<ion-toast\r\n  [isOpen]=\"showToast\"\r\n  [message]=\"toastMessage\"\r\n  [duration]=\"3000\"\r\n  position=\"top\"\r\n  color=\"primary\">\r\n</ion-toast>",
        "forgot-password.page.scss": ":host {\r\n    --ion-color-primary: #84B0A2;\r\n    --ion-color-secondary: #D4A082;\r\n    --ion-color-tertiary: #ECC9A3;\r\n    --ion-color-success: #2dd36f;\r\n    --ion-color-warning: #ffc409;\r\n    --ion-color-danger: #eb445a;\r\n    --ion-color-medium: #92949c;\r\n    --ion-color-light: #D4E7EE;\r\n    --ion-color-dark: #405770;\r\n  }\r\n  \r\n  ion-content {\r\n    --background: var(--ion-color-light);\r\n  }\r\n  \r\n  .forgot-password-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n    height: 100%;\r\n    padding: 20px;\r\n    color: var(--ion-color-dark);\r\n  \r\n    .step-container {\r\n      background: #ffffff;\r\n      border-radius: 16px;\r\n      padding: 24px;\r\n      width: 100%;\r\n      max-width: 400px;\r\n      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  \r\n      h2 {\r\n        font-size: 24px;\r\n        font-weight: 600;\r\n        color: var(--ion-color-primary);\r\n        margin-bottom: 16px;\r\n        text-align: center;\r\n      }\r\n  \r\n      p {\r\n        color: var(--ion-color-medium);\r\n        text-align: center;\r\n        margin-bottom: 24px;\r\n      }\r\n    }\r\n  }\r\n  \r\n  ion-item {\r\n    --background: transparent;\r\n    --border-color: var(--ion-color-medium);\r\n    --highlight-height: 1px;\r\n    --highlight-color-focused: var(--ion-color-primary);\r\n    margin-bottom: 16px;\r\n  \r\n    &:last-child {\r\n      margin-bottom: 0;\r\n    }\r\n  }\r\n  \r\n  ion-button {\r\n    --background: var(--ion-color-primary);\r\n    --background-hover: var(--ion-color-primary-shade);\r\n    --color: #ffffff;\r\n    --border-radius: 8px;\r\n    margin-top: 24px;\r\n    height: 48px;\r\n    font-weight: 600;\r\n    font-size: 16px;\r\n  }\r\n  \r\n  .password-requirements {\r\n    font-size: 14px;\r\n    margin-top: 16px;\r\n  \r\n    ul {\r\n      margin-top: 8px;\r\n      padding-left: 20px;\r\n  \r\n      li {\r\n        margin-bottom: 4px;\r\n      }\r\n    }\r\n  }\r\n  \r\n  // Animaciones\r\n  @keyframes fadeIn {\r\n    from {\r\n      opacity: 0;\r\n      transform: translateY(20px);\r\n    }\r\n    to {\r\n      opacity: 1;\r\n      transform: translateY(0);\r\n    }\r\n  }\r\n  \r\n  .step-container {\r\n    animation: fadeIn 0.3s ease-out;\r\n  }",
        "forgot-password.page.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { IonicModule, LoadingController, ToastController, AlertController, Platform } from '@ionic/angular';\r\nimport { ForgotPasswordPage } from './forgot-password.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { EmailService } from '../services/email.service';\r\nimport { EmailResult } from '../models/email.interface';\r\nimport { RouterTestingModule } from '@angular/router/testing';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { of } from 'rxjs';\r\nimport { User } from '../models/user.model';\r\n\r\ndescribe('ForgotPasswordPage', () => {\r\n  let component: ForgotPasswordPage;\r\n  let fixture: ComponentFixture<ForgotPasswordPage>;\r\n  let databaseServiceSpy: jasmine.SpyObj<DatabaseService>;\r\n  let emailServiceSpy: jasmine.SpyObj<EmailService>;\r\n  let loadingControllerSpy: jasmine.SpyObj<LoadingController>;\r\n  let toastControllerSpy: jasmine.SpyObj<ToastController>;\r\n  let alertControllerSpy: jasmine.SpyObj<AlertController>;\r\n  let routerSpy: jasmine.SpyObj<Router>;\r\n  let platformSpy: jasmine.SpyObj<Platform>;\r\n\r\n  const mockUser: User = {\r\n    UserID: 1,\r\n    Username: 'testuser',\r\n    Password: 'password123',\r\n    Role: 'employee',\r\n    Name: 'Test User',\r\n    Email: 'test@test.com',\r\n    ApprovalStatus: 'approved'\r\n  };\r\n\r\n  const mockEmailResult: EmailResult = {\r\n    messageId: 'test-message-id',\r\n    success: true\r\n  };\r\n\r\n  const mockErrorEmailResult: EmailResult = {\r\n    messageId: '',\r\n    success: false,\r\n    error: 'Error al enviar el correo'\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', ['getUserByEmail', 'updatePassword']);\r\n    const emailSpy = jasmine.createSpyObj('EmailService', ['sendVerificationCode']);\r\n    const loadingSpy = jasmine.createSpyObj('LoadingController', ['create']);\r\n    const toastSpy = jasmine.createSpyObj('ToastController', ['create']);\r\n    const alertSpy = jasmine.createSpyObj('AlertController', ['create']);\r\n    const routerSpyObj = jasmine.createSpyObj('Router', ['navigate']);\r\n    const platSpy = jasmine.createSpyObj('Platform', ['is', 'ready']);\r\n\r\n    platSpy.ready.and.returnValue(Promise.resolve());\r\n    platSpy.is.and.returnValue(true);\r\n\r\n    const mockLoadingElement = {\r\n      present: jasmine.createSpy('present'),\r\n      dismiss: jasmine.createSpy('dismiss')\r\n    };\r\n    loadingSpy.create.and.returnValue(Promise.resolve(mockLoadingElement));\r\n\r\n    const mockToastElement = {\r\n      present: jasmine.createSpy('present')\r\n    };\r\n    toastSpy.create.and.returnValue(Promise.resolve(mockToastElement));\r\n\r\n    const mockAlertElement = {\r\n      present: jasmine.createSpy('present')\r\n    };\r\n    alertSpy.create.and.returnValue(Promise.resolve(mockAlertElement));\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [ ForgotPasswordPage ],\r\n      imports: [ \r\n        IonicModule.forRoot(),\r\n        RouterTestingModule,\r\n        FormsModule\r\n      ],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { provide: EmailService, useValue: emailSpy },\r\n        { provide: LoadingController, useValue: loadingSpy },\r\n        { provide: ToastController, useValue: toastSpy },\r\n        { provide: AlertController, useValue: alertSpy },\r\n        { provide: Router, useValue: routerSpyObj },\r\n        { provide: Platform, useValue: platSpy }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(ForgotPasswordPage);\r\n    component = fixture.componentInstance;\r\n    databaseServiceSpy = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    emailServiceSpy = TestBed.inject(EmailService) as jasmine.SpyObj<EmailService>;\r\n    loadingControllerSpy = TestBed.inject(LoadingController) as jasmine.SpyObj<LoadingController>;\r\n    toastControllerSpy = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    alertControllerSpy = TestBed.inject(AlertController) as jasmine.SpyObj<AlertController>;\r\n    routerSpy = TestBed.inject(Router) as jasmine.SpyObj<Router>;\r\n    platformSpy = TestBed.inject(Platform) as jasmine.SpyObj<Platform>;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  describe('Estado inicial', () => {\r\n    it('1. Debería inicializarse con el paso de correo electrónico.', () => {\r\n      expect(component.step).toBe('email');\r\n    });\r\n\r\n    it('2. Debe tener valores iniciales vacíos.', () => {\r\n      expect(component.email).toBe('');\r\n      expect(component.verificationCode).toBe('');\r\n      expect(component.newPassword).toBe('');\r\n      expect(component.confirmPassword).toBe('');\r\n    });\r\n  });\r\n\r\n  describe('Enviar código de verificación', () => {\r\n    beforeEach(() => {\r\n      component.step = 'email';\r\n    });\r\n\r\n    it('3. should validate empty email', async () => {\r\n      component.email = '';\r\n      await component.sendVerificationCode();\r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Por favor, ingrese su correo electrónico',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('4. Debería gestionar el correo electrónico inexistente.', async () => {\r\n      component.email = 'nonexistent@test.com';\r\n      databaseServiceSpy.getUserByEmail.and.returnValue(of(null));\r\n      \r\n      await component.sendVerificationCode();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'No existe una cuenta con este correo electrónico',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('5. Debería manejar el envío exitoso del código de verificación', async () => {\r\n      component.email = 'test@test.com';\r\n      databaseServiceSpy.getUserByEmail.and.returnValue(of(mockUser));\r\n      emailServiceSpy.sendVerificationCode.and.returnValue(of(mockEmailResult));\r\n      \r\n      await component.sendVerificationCode();\r\n      \r\n      expect(component.step).toBe('verify');\r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Código de verificación enviado a su correo',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Código de verificación', () => {\r\n    beforeEach(() => {\r\n      component.step = 'verify';\r\n      component.generatedCode = '1234';\r\n    });\r\n\r\n    it('Debería verificar el código correcto', async () => {\r\n      component.verificationCode = '1234';\r\n      await component.verifyCode();\r\n      expect(component.step).toBe('reset');\r\n    });\r\n\r\n    it('Debería manejar el código incorrecto', async () => {\r\n      component.verificationCode = '5678';\r\n      await component.verifyCode();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Código de verificación incorrecto',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n      expect(component.step).toBe('verify');\r\n    });\r\n  });\r\n\r\n  describe('Restablecer contraseña', () => {\r\n    beforeEach(() => {\r\n      component.step = 'reset';\r\n      component.email = 'test@test.com';\r\n    });\r\n\r\n    it('Debe validar los campos vacíos', async () => {\r\n      component.newPassword = '';\r\n      component.confirmPassword = '';\r\n      \r\n      await component.resetPassword();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Por favor, complete todos los campos',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('Debe validar que las contraseñas coincidan', async () => {\r\n      component.newPassword = 'StrongPass123!';\r\n      component.confirmPassword = 'DifferentPass123!';\r\n      \r\n      await component.resetPassword();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Las contraseñas no coinciden',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('Debe validar los requisitos de contraseña', async () => {\r\n      component.newPassword = 'weak';\r\n      component.confirmPassword = 'weak';\r\n      \r\n      await component.resetPassword();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'La contraseña debe contener al menos 6 caracteres, una mayúscula, una minúscula, un número y un carácter especial',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('Debería gestionar el restablecimiento de contraseña con éxito', async () => {\r\n      component.newPassword = 'StrongPass123!';\r\n      component.confirmPassword = 'StrongPass123!';\r\n      \r\n      databaseServiceSpy.getUserByEmail.and.returnValue(of(mockUser));\r\n      databaseServiceSpy.updatePassword.and.returnValue(of(true));\r\n      \r\n      await component.resetPassword();\r\n      \r\n      expect(alertControllerSpy.create).toHaveBeenCalledWith({\r\n        header: 'Éxito',\r\n        message: 'Su contraseña ha sido actualizada correctamente',\r\n        buttons: ['OK']\r\n      });\r\n      expect(routerSpy.navigate).toHaveBeenCalledWith(['/login']);\r\n    });\r\n  });\r\n\r\n  describe('Navigation', () => {\r\n    it('Debería navegar correctamente desde el paso de verificación.', () => {\r\n      component.step = 'verify';\r\n      component.goBack();\r\n      expect(component.step).toBe('email');\r\n    });\r\n\r\n    it('Debería navegar correctamente desde el paso de reinicio', () => {\r\n      component.step = 'reset';\r\n      component.goBack();\r\n      expect(component.step).toBe('verify');\r\n    });\r\n\r\n    it('debería navegar hasta el paso de inicio de sesión desde el correo electrónico', () => {\r\n      component.step = 'email';\r\n      component.goBack();\r\n      expect(routerSpy.navigate).toHaveBeenCalledWith(['/login']);\r\n    });\r\n  });\r\n});",
        "forgot-password.page.ts": "import { Component } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { LoadingController, ToastController, AlertController } from '@ionic/angular';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { EmailService } from '../services/email.service';\r\n\r\n@Component({\r\n  selector: 'app-forgot-password',\r\n  templateUrl: './forgot-password.page.html',\r\n  styleUrls: ['./forgot-password.page.scss'],\r\n})\r\nexport class ForgotPasswordPage {\r\n  email: string = '';\r\n  verificationCode: string = '';\r\n  newPassword: string = '';\r\n  confirmPassword: string = '';\r\n  generatedCode: string = '';\r\n  step: 'email' | 'verify' | 'reset' = 'email';\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private databaseService: DatabaseService,\r\n    private emailService: EmailService,\r\n    private loadingController: LoadingController,\r\n    private toastController: ToastController,\r\n    private alertController: AlertController\r\n  ) {}\r\n\r\n  async sendVerificationCode() {\r\n    if (!this.email) {\r\n      await this.presentToast('Por favor, ingrese su correo electrónico');\r\n      return;\r\n    }\r\n\r\n    const loading = await this.loadingController.create({\r\n      message: 'Verificando correo...',\r\n    });\r\n    await loading.present();\r\n\r\n    try {\r\n      // Verificar si el email existe en la base de datos\r\n      const user = await this.databaseService.getUserByEmail(this.email).toPromise();\r\n      \r\n      if (!user) {\r\n        await loading.dismiss();\r\n        await this.presentToast('No existe una cuenta con este correo electrónico');\r\n        return;\r\n      }\r\n\r\n      // Generar código de 4 dígitos\r\n      this.generatedCode = Math.floor(1000 + Math.random() * 9000).toString();\r\n\r\n      // Enviar correo con el código usando el nuevo servicio\r\n      await this.emailService.sendVerificationCode(this.email, this.generatedCode).toPromise();\r\n\r\n      this.step = 'verify';\r\n      await this.presentToast('Código de verificación enviado a su correo');\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      await this.presentToast('Error al enviar el código de verificación');\r\n    }\r\n\r\n    await loading.dismiss();\r\n  }\r\n\r\n  async verifyCode() {\r\n    if (this.verificationCode === this.generatedCode) {\r\n      this.step = 'reset';\r\n    } else {\r\n      await this.presentToast('Código de verificación incorrecto');\r\n    }\r\n  }\r\n\r\n  async resetPassword() {\r\n    if (!this.newPassword || !this.confirmPassword) {\r\n      await this.presentToast('Por favor, complete todos los campos');\r\n      return;\r\n    }\r\n\r\n    if (this.newPassword !== this.confirmPassword) {\r\n      await this.presentToast('Las contraseñas no coinciden');\r\n      return;\r\n    }\r\n\r\n    if (!this.isValidPassword(this.newPassword)) {\r\n      await this.presentToast('La contraseña debe contener al menos 6 caracteres, una mayúscula, una minúscula, un número y un carácter especial');\r\n      return;\r\n    }\r\n\r\n    const loading = await this.loadingController.create({\r\n      message: 'Actualizando contraseña...',\r\n    });\r\n    await loading.present();\r\n\r\n    try {\r\n      const user = await this.databaseService.getUserByEmail(this.email).toPromise();\r\n      if (!user) {\r\n        throw new Error('Usuario no encontrado');\r\n      }\r\n\r\n      // Actualizar contraseña en la base de datos\r\n      await this.databaseService.updatePassword(user.UserID!, this.newPassword).toPromise();\r\n      \r\n      await this.presentAlert(\r\n        'Éxito',\r\n        'Su contraseña ha sido actualizada correctamente'\r\n      );\r\n      this.router.navigate(['/login']);\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n      await this.presentToast('Error al actualizar la contraseña');\r\n    }\r\n\r\n    await loading.dismiss();\r\n  }\r\n\r\n  private isValidPassword(password: string): boolean {\r\n    const hasUpperCase = /[A-Z]/.test(password);\r\n    const hasLowerCase = /[a-z]/.test(password);\r\n    const hasNumbers = /\\d/.test(password);\r\n    const hasSpecialChar = /[!@#$%^&*(),.?\":{}|<>]/.test(password);\r\n    const isLongEnough = password.length >= 6;\r\n\r\n    return hasUpperCase && hasLowerCase && hasNumbers && hasSpecialChar && isLongEnough;\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'top'\r\n    });\r\n    await toast.present();\r\n  }\r\n\r\n  async presentAlert(header: string, message: string) {\r\n    const alert = await this.alertController.create({\r\n      header: header,\r\n      message: message,\r\n      buttons: ['OK']\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  goBack() {\r\n    if (this.step === 'verify') {\r\n      this.step = 'email';\r\n    } else if (this.step === 'reset') {\r\n      this.step = 'verify';\r\n    } else {\r\n      this.router.navigate(['/login']);\r\n    }\r\n  }\r\n}"
      },
      "guards": {
        "auth.guard.ts": "import { Injectable } from '@angular/core';\r\nimport { CanActivate, ActivatedRouteSnapshot, RouterStateSnapshot, UrlTree, Router } from '@angular/router';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class AuthGuard implements CanActivate {\r\n  constructor(private router: Router) {}\r\n\r\n  canActivate(\r\n    next: ActivatedRouteSnapshot,\r\n    state: RouterStateSnapshot): Observable<boolean | UrlTree> | Promise<boolean | UrlTree> | boolean | UrlTree {\r\n    \r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    \r\n    if (currentUser && currentUser.id) {\r\n      // Usuario autenticado\r\n      if (state.url === '/login' || state.url === '/') {\r\n        // Si el usuario intenta acceder a la página de login o la raíz estando autenticado\r\n        if (currentUser.role === 'admin') {\r\n          this.router.navigate(['/admin-dashboard']);\r\n        } else {\r\n          this.router.navigate(['/employee-dashboard']);\r\n        }\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n\r\n    // Usuario no autenticado\r\n    if (state.url !== '/login' && \r\n      state.url !== '/register' && \r\n      state.url !== '/forgot-password') { \r\n    this.router.navigate(['/login']);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n}"
      },
      "login": {
        "login-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { LoginPage } from './login.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: LoginPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class LoginPageRoutingModule {}\r\n",
        "login.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { RouterModule } from '@angular/router';\r\n\r\nimport { LoginPageRoutingModule } from './login-routing.module';\r\nimport { LoginPage } from './login.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    LoginPageRoutingModule,\r\n    RouterModule\r\n  ],\r\n  declarations: [LoginPage]\r\n})\r\nexport class LoginPageModule {}",
        "login.page.html": "<ion-content class=\"ion-padding\">\r\n  <div class=\"login-container\">\r\n    <h1>Bienvenido</h1>\r\n    <h2>Inicio de sesión</h2>\r\n    <form (ngSubmit)=\"onSubmit()\">\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Correo</ion-label>\r\n        <ion-input type=\"email\" [(ngModel)]=\"email\" name=\"email\" required></ion-input>\r\n      </ion-item>\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Contraseña</ion-label>\r\n        <ion-input type=\"password\" [(ngModel)]=\"password\" name=\"password\" required></ion-input>\r\n      </ion-item>\r\n      <ion-button expand=\"block\" type=\"submit\">Iniciar sesión</ion-button>\r\n    </form>\r\n    <a [routerLink]=\"['/register']\" class=\"register-link\">Registrarse</a>\r\n    <a [routerLink]=\"['/forgot-password']\" class=\"forgot-password-link\">¿Olvidaste tu contraseña?</a>\r\n  </div>\r\n</ion-content>\r\n<ion-toast\r\n[isOpen]=\"showToast\"\r\n[message]=\"toastMessage\"\r\n[duration]=\"3000\"\r\nposition=\"top\"\r\ncolor=\"success\"\r\n></ion-toast> ",
        "login.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n}\r\n\r\nion-content {\r\n  --background: linear-gradient(135deg, var(--ion-color-light) 0%, #c3cfe2 100%);\r\n}\r\n\r\n.login-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 100%;\r\n  padding: 20px;\r\n  color: var(--ion-color-dark);\r\n}\r\n\r\n.logo {\r\n  width: 120px;\r\n  height: 120px;\r\n  margin-bottom: 40px;\r\n}\r\n\r\nh1 {\r\n  font-size: 2.5rem;\r\n  margin-bottom: 10px;\r\n  color: var(--ion-color-primary);\r\n}\r\n\r\nh2 {\r\n  font-size: 1.8rem;\r\n  margin-bottom: 30px;\r\n  color: var(--ion-color-secondary);\r\n}\r\n\r\nform {\r\n  width: 100%;\r\n  max-width: 400px;\r\n}\r\n\r\nion-item {\r\n  --background: rgba(255, 255, 255, 0.2);\r\n  --border-color: var(--ion-color-primary);\r\n  --highlight-height: 1px;\r\n  border-radius: 8px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\nion-label {\r\n  color: var(--ion-color-dark);\r\n  font-weight: 500;\r\n}\r\n\r\nion-input {\r\n  --padding-start: 10px;\r\n  font-size: 16px;\r\n  --placeholder-color: var(--ion-color-medium);\r\n  --placeholder-opacity: 0.8;\r\n  color: var(--ion-color-dark);\r\n}\r\n\r\nion-button {\r\n  margin-top: 30px;\r\n  height: 54px;\r\n  font-size: 18px;\r\n  text-transform: none;\r\n  --background: var(--ion-color-primary);\r\n  --box-shadow: 0 4px 10px rgba(132, 176, 162, 0.3);\r\n  --border-radius: 27px;\r\n}\r\n\r\n.forgot-password, .register-link {\r\n  margin-top: 20px;\r\n  color: var(--ion-color-secondary);\r\n  font-size: 16px;\r\n  text-decoration: none;\r\n  text-align: center;\r\n  display: block;\r\n  \r\n  &:hover {\r\n    text-decoration: underline;\r\n    color: var(--ion-color-tertiary);\r\n  }\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  .logo {\r\n    width: 100px;\r\n    height: 100px;\r\n    margin-bottom: 30px;\r\n  }\r\n\r\n  h1 {\r\n    font-size: 2rem;\r\n  }\r\n\r\n  h2 {\r\n    font-size: 24px;\r\n    margin-bottom: 25px;\r\n    color: var(--ion-color-secondary);\r\n  }\r\n  \r\n  ion-button {\r\n    font-size: 16px;\r\n    height: 50px;\r\n  }\r\n}\r\n\r\n// Animaciones\r\n@keyframes fadeInUp {\r\n  from {\r\n    opacity: 0;\r\n    transform: translate3d(0, 30px, 0);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translate3d(0, 0, 0);\r\n  }\r\n}\r\n\r\n.login-container > * {\r\n  animation: fadeInUp 0.5s ease-out;\r\n  animation-fill-mode: both;\r\n}\r\n\r\n.login-container > *:nth-child(1) { animation-delay: 0.1s; }\r\n.login-container > *:nth-child(2) { animation-delay: 0.2s; }\r\n.login-container > *:nth-child(3) { animation-delay: 0.3s; }\r\n.login-container > *:nth-child(4) { animation-delay: 0.4s; }\r\n.login-container > *:nth-child(5) { animation-delay: 0.5s; }",
        "login.page.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { IonicModule, ToastController, NavController, Platform } from '@ionic/angular';\r\nimport { LoginPage } from './login.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { Router } from '@angular/router';\r\nimport { User } from '../models/user.model';\r\nimport { of, EMPTY } from 'rxjs';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\n\r\ndescribe('LoginPage', () => {\r\n  let component: LoginPage;\r\n  let fixture: ComponentFixture<LoginPage>;\r\n  let databaseServiceSpy: jasmine.SpyObj<DatabaseService>;\r\n  let toastControllerSpy: jasmine.SpyObj<ToastController>;\r\n  let routerSpy: jasmine.SpyObj<Router>;\r\n  let navControllerSpy: jasmine.SpyObj<NavController>;\r\n  let platformSpy: jasmine.SpyObj<Platform>;\r\n  let mockStorage: { [key: string]: string };\r\n  let localStorageGetItemSpy: jasmine.Spy;\r\n  let localStorageSetItemSpy: jasmine.Spy;\r\n\r\n  const mockUser: User = {\r\n    UserID: 1,\r\n    Username: 'testuser',\r\n    Password: 'password123',\r\n    Role: 'employee',\r\n    Name: 'Test User',\r\n    Email: 'test@test.com',\r\n    ApprovalStatus: 'approved'\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', ['authenticateUser', 'updateUserLastLogin']);\r\n    const toastSpy = jasmine.createSpyObj('ToastController', ['create']);\r\n    const routerSpyObj = jasmine.createSpyObj('Router', ['navigate']);\r\n    const navSpy = jasmine.createSpyObj('NavController', ['navigateForward', 'navigateRoot']);\r\n    const platSpy = jasmine.createSpyObj('Platform', ['is', 'ready']);\r\n\r\n    // Configure Platform spy\r\n    platSpy.ready.and.returnValue(Promise.resolve());\r\n    platSpy.is.and.returnValue(true);\r\n\r\n    // Mock localStorage\r\n    mockStorage = {};\r\n    localStorageGetItemSpy = spyOn(localStorage, 'getItem').and.callFake(key => mockStorage[key] || null);\r\n    localStorageSetItemSpy = spyOn(localStorage, 'setItem').and.callFake((key, value) => mockStorage[key] = value);\r\n\r\n    // Mock toast\r\n    const mockToastElement = {\r\n      present: jasmine.createSpy('present')\r\n    };\r\n    toastSpy.create.and.returnValue(Promise.resolve(mockToastElement));\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [ LoginPage ],\r\n      imports: [IonicModule.forRoot()],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { provide: ToastController, useValue: toastSpy },\r\n        { provide: Router, useValue: routerSpyObj },\r\n        { provide: NavController, useValue: navSpy },\r\n        { provide: Platform, useValue: platSpy }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(LoginPage);\r\n    component = fixture.componentInstance;\r\n    databaseServiceSpy = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    toastControllerSpy = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    routerSpy = TestBed.inject(Router) as jasmine.SpyObj<Router>;\r\n    navControllerSpy = TestBed.inject(NavController) as jasmine.SpyObj<NavController>;\r\n    platformSpy = TestBed.inject(Platform) as jasmine.SpyObj<Platform>;\r\n\r\n    // Configure updateUserLastLogin to return Observable\r\n    databaseServiceSpy.updateUserLastLogin.and.returnValue(of(true));\r\n\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  describe('Authentication Checks', () => {\r\n    it('should redirect to admin dashboard if user is admin', () => {\r\n      mockStorage['currentUser'] = JSON.stringify({ id: 1, role: 'admin' });\r\n      component.ngOnInit();\r\n      expect(routerSpy.navigate).toHaveBeenCalledWith(['/admin-dashboard']);\r\n    });\r\n\r\n    it('should redirect to employee dashboard if user is employee', () => {\r\n      mockStorage['currentUser'] = JSON.stringify({ id: 1, role: 'employee' });\r\n      component.ngOnInit();\r\n      expect(routerSpy.navigate).toHaveBeenCalledWith(['/employee-dashboard']);\r\n    });\r\n\r\n    it('should stay on login if no user is authenticated', () => {\r\n      mockStorage = {};\r\n      component.ngOnInit();\r\n      expect(routerSpy.navigate).toHaveBeenCalledWith(['/login']);\r\n    });\r\n  });\r\n\r\n  describe('Login Process', () => {\r\n    it('should show error toast if email or password is missing', async () => {\r\n      component.email = '';\r\n      component.password = 'password123';\r\n      await component.onSubmit();\r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Por favor, ingrese email y contraseña.',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('should authenticate user successfully', async () => {\r\n      component.email = 'test@test.com';\r\n      component.password = 'password123';\r\n      \r\n      databaseServiceSpy.authenticateUser.and.returnValue(Promise.resolve(mockUser));\r\n      \r\n      await component.onSubmit();\r\n      \r\n      expect(localStorageSetItemSpy).toHaveBeenCalled();\r\n      expect(databaseServiceSpy.updateUserLastLogin).toHaveBeenCalledWith(mockUser.UserID);\r\n      expect(routerSpy.navigate).toHaveBeenCalledWith(['/employee-dashboard']);\r\n    });\r\n\r\n    it('should handle pending approval status', async () => {\r\n      const pendingUser = { ...mockUser, ApprovalStatus: 'pending' as 'pending' };\r\n      component.email = 'test@test.com';\r\n      component.password = 'password123';\r\n      \r\n      databaseServiceSpy.authenticateUser.and.returnValue(Promise.resolve(pendingUser));\r\n      \r\n      await component.onSubmit();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Su cuenta está pendiente de aprobación. Por favor, espere la confirmación del administrador.',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('should handle rejected approval status', async () => {\r\n      const rejectedUser = { ...mockUser, ApprovalStatus: 'rejected' as 'rejected' };\r\n      component.email = 'test@test.com';\r\n      component.password = 'password123';\r\n      \r\n      databaseServiceSpy.authenticateUser.and.returnValue(Promise.resolve(rejectedUser));\r\n      \r\n      await component.onSubmit();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Su cuenta ha sido rechazada. Por favor, contacte al administrador.',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('should handle invalid credentials', async () => {\r\n      component.email = 'test@test.com';\r\n      component.password = 'wrongpassword';\r\n      \r\n      databaseServiceSpy.authenticateUser.and.returnValue(Promise.resolve(null));\r\n      \r\n      await component.onSubmit();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Credenciales incorrectas. Por favor, intente de nuevo.',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('should handle authentication error', async () => {\r\n      component.email = 'test@test.com';\r\n      component.password = 'password123';\r\n      \r\n      databaseServiceSpy.authenticateUser.and.rejectWith(new Error('Database error'));\r\n      \r\n      await component.onSubmit();\r\n      \r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Ocurrió un error durante el inicio de sesión. Por favor, intente de nuevo.',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n  });\r\n\r\n  describe('Password Recovery', () => {\r\n    it('should show toast message when forgot password is clicked', async () => {\r\n      await component.forgotPassword();\r\n      expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n        message: 'Se ha enviado un correo con instrucciones para recuperar tu contraseña.',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n  });\r\n});",
        "login.page.ts": "import { Component } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { ToastController } from '@ionic/angular';\r\nimport { User } from '../models/user.model';\r\nimport { firstValueFrom } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-login',\r\n  templateUrl: './login.page.html',\r\n  styleUrls: ['./login.page.scss'],\r\n})\r\nexport class LoginPage {\r\n\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n\r\n  email: string = '';\r\n  password: string = '';\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.checkAuthAndRedirect();\r\n  }\r\n\r\n  private checkAuthAndRedirect() {\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    if (currentUser && currentUser.id) {\r\n      console.log('Usuario autenticado:', currentUser);\r\n      if (currentUser.role === 'admin') {\r\n        this.router.navigate(['/admin-dashboard']);\r\n      } else {\r\n        this.router.navigate(['/employee-dashboard']);\r\n      }\r\n    } else {\r\n      console.log('Usuario no autenticado');\r\n      this.router.navigate(['/login']);\r\n    }\r\n  }\r\n\r\n  async onSubmit() {\r\n    console.log('Iniciando proceso de login');\r\n    if (!this.email || !this.password) {\r\n      await this.presentToast('Por favor, ingrese email y contraseña.');\r\n      return;\r\n    }\r\n  \r\n    try {\r\n      console.log('Intentando autenticar:', this.email);\r\n      const user = await this.databaseService.authenticateUser(this.email, this.password);\r\n      console.log('Resultado de autenticación:', user);\r\n      \r\n      if (user) {\r\n        if (user.ApprovalStatus === 'approved') {\r\n          // Guardar información del usuario en el almacenamiento local\r\n          const userInfo = {\r\n            id: user.UserID,\r\n            name: user.Name,\r\n            email: user.Email,\r\n            role: user.Role\r\n          };\r\n          localStorage.setItem('currentUser', JSON.stringify(userInfo));\r\n  \r\n          // Actualizar la fecha del último login\r\n          await this.databaseService.updateUserLastLogin(user.UserID!);\r\n  \r\n          // Redireccionar basado en el rol\r\n          if (user.Role === 'admin') {\r\n            this.router.navigate(['/admin-dashboard']);\r\n          } else {\r\n            this.router.navigate(['/employee-dashboard']);\r\n          }\r\n  \r\n          await this.presentToast(`Bienvenido, ${user.Name}!`);\r\n        } else if (user.ApprovalStatus === 'pending') {\r\n          await this.presentToast('Su cuenta está pendiente de aprobación. Por favor, espere la confirmación del administrador.');\r\n        } else {\r\n          await this.presentToast('Su cuenta ha sido rechazada. Por favor, contacte al administrador.');\r\n        }\r\n      } else {\r\n        await this.presentToast('Credenciales incorrectas. Por favor, intente de nuevo.');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error durante login:', error);\r\n      await this.presentToast('Ocurrió un error durante el inicio de sesión. Por favor, intente de nuevo.');\r\n    }\r\n  }\r\n\r\n\r\n  private async handleSuccessfulLogin(user: User) {\r\n    console.log('Usuario autenticado:', JSON.stringify(user));\r\n    const safeUserInfo = {\r\n      id: user.UserID,\r\n      username: user.Username,\r\n      name: user.Name,\r\n      email: user.Email,\r\n      role: user.Role\r\n    };\r\n    console.log('Información de usuario a guardar:', JSON.stringify(safeUserInfo));\r\n    localStorage.setItem('currentUser', JSON.stringify(safeUserInfo));\r\n    \r\n    if (user.UserID !== undefined) {\r\n      await this.databaseService.updateUserLastLogin(user.UserID);\r\n    }\r\n    \r\n    await this.presentToast(`Bienvenido, ${user.Name}!`);\r\n    \r\n    this.router.navigate(['/main']);\r\n  }\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'top'\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n  forgotPassword() {\r\n    // Implement password recovery logic here\r\n    this.presentToast('Se ha enviado un correo con instrucciones para recuperar tu contraseña.');\r\n  }\r\n}"
      },
      "main": {
        "main-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { MainPage } from './main.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: MainPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class MainPageRoutingModule {}\r\n",
        "main.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { MainPage } from './main.page';\r\nimport { MainPageRoutingModule } from './main-routing.module';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    MainPageRoutingModule\r\n  ],\r\n  declarations: [MainPage]\r\n})\r\nexport class MainPageModule {}",
        "main.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Inicio</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content>\r\n  <div class=\"menu-container\">\r\n    <ion-grid>\r\n      <ion-row *ngIf=\"products && products.length > 0; else noProducts\">\r\n        <ion-col size=\"12\" size-md=\"6\" size-lg=\"4\" *ngFor=\"let product of products; let i = index\">\r\n          <ion-card class=\"product-card\">\r\n            <img [src]=\"product.imageURL\" [alt]=\"product.name || 'Imagen del producto'\"\r\n              (error)=\"handleImageError($event)\" />\r\n            <ion-card-header>\r\n              <ion-card-title>{{ product.name || 'Producto sin nombre' }}</ion-card-title>\r\n            </ion-card-header>\r\n            <ion-card-content>\r\n              <p>{{ product.description || 'Sin descripción disponible' }}</p>\r\n              <ion-text color=\"primary\">\r\n                <h2>{{ calculatePrice(product) | currency:'CLP':'symbol-narrow':'1.0-0' }}</h2>\r\n              </ion-text>\r\n              <ion-button expand=\"block\" (click)=\"toggleOptions(i)\">\r\n                {{ product.showOptions ? 'Ocultar opciones' : 'Personalizar y Añadir' }}\r\n              </ion-button>\r\n            </ion-card-content>\r\n          </ion-card>\r\n\r\n          <ion-card *ngIf=\"product.showOptions\" class=\"options-card\" [@slideInOut]>\r\n            <ion-card-content>\r\n              <ion-item>\r\n                <ion-label position=\"stacked\">Tamaño</ion-label>\r\n                <ion-select [(ngModel)]=\"product.selectedSize\" (ionChange)=\"updatePrice(product)\" interface=\"popover\"\r\n                  placeholder=\"Seleccione un tamaño\">\r\n                  <ion-select-option value=\"pequeño\">Pequeño (-$1.000)</ion-select-option>\r\n                  <ion-select-option value=\"medium\">Mediano</ion-select-option>\r\n                  <ion-select-option value=\"grande\">Grande (+$1.000)</ion-select-option>\r\n                </ion-select>\r\n              </ion-item>\r\n              <ion-item>\r\n                <ion-label position=\"stacked\">Tipo de leche</ion-label>\r\n                <ion-select [(ngModel)]=\"product.selectedMilk\" interface=\"popover\"\r\n                  placeholder=\"Seleccione un tipo de leche\">\r\n                  <ion-select-option value=\"regular\">Regular</ion-select-option>\r\n                  <ion-select-option value=\"descremada\">Descremada</ion-select-option>\r\n                  <ion-select-option value=\"soya\">Soya</ion-select-option>\r\n                  <ion-select-option value=\"almendra\">Almendra</ion-select-option>\r\n                </ion-select>\r\n              </ion-item>\r\n              <ion-button expand=\"block\" (click)=\"addToCart(product)\">Añadir al Carrito</ion-button>\r\n            </ion-card-content>\r\n          </ion-card>\r\n        </ion-col>\r\n      </ion-row>\r\n      <ng-template #noProducts>\r\n        <ion-col>\r\n          <ion-card>\r\n            <ion-card-header>\r\n              <ion-card-title>No hay productos disponibles</ion-card-title>\r\n            </ion-card-header>\r\n            <ion-card-content>\r\n              <p>Lo sentimos, no hay productos disponibles en este momento. Por favor, intente más tarde.</p>\r\n            </ion-card-content>\r\n          </ion-card>\r\n        </ion-col>\r\n      </ng-template>\r\n    </ion-grid>\r\n  </div>\r\n</ion-content>\r\n\r\n<ion-footer>\r\n  <ion-toolbar>\r\n    <ion-button expand=\"block\" \r\n    routerLink=\"/carro-compras\" \r\n    [disabled]=\"currentOrderItems.length === 0\">\r\nCompletar Orden ({{ currentOrderItems.length }} items)\r\n</ion-button>\r\n  </ion-toolbar>\r\n</ion-footer>\r\n\r\n<ion-toast [isOpen]=\"showToast\" [message]=\"toastMessage\" [duration]=\"3000\" position=\"top\" color=\"primary\">\r\n</ion-toast>",
        "main.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n}\r\n\r\n.menu-container {\r\n  padding: 16px;\r\n}\r\n\r\n.product-card {\r\n  margin-bottom: 20px;\r\n  border-radius: 10px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  overflow: hidden;\r\n  background-color: white;\r\n\r\n  img {\r\n    width: 100%;\r\n    height: 200px;\r\n    object-fit: cover;\r\n  }\r\n\r\n  ion-card-header {\r\n    padding: 16px;\r\n  }\r\n\r\n  ion-card-title {\r\n    font-size: 1.2rem;\r\n    font-weight: bold;\r\n    color: var(--ion-color-dark);\r\n  }\r\n\r\n  ion-card-content {\r\n    padding: 0 16px 16px;\r\n\r\n    p {\r\n      font-size: 0.9rem;\r\n      color: var(--ion-color-medium);\r\n      margin-bottom: 10px;\r\n    }\r\n\r\n    h2 {\r\n      font-size: 1.4rem;\r\n      font-weight: bold;\r\n      margin: 10px 0;\r\n      color: var(--ion-color-primary);\r\n    }\r\n\r\n    ion-button {\r\n      margin-top: 10px;\r\n      --background: var(--ion-color-secondary);\r\n      --color: white;\r\n    }\r\n  }\r\n}\r\n\r\n.options-card {\r\n  margin-top: -10px;\r\n  border-top-left-radius: 0;\r\n  border-top-right-radius: 0;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  background-color: var(--ion-color-light);\r\n\r\n  ion-card-content {\r\n    padding: 16px;\r\n  }\r\n\r\n  ion-item {\r\n    --padding-start: 0;\r\n    --inner-padding-end: 0;\r\n    --background: transparent;\r\n  }\r\n\r\n  ion-select {\r\n    width: 100%;\r\n    max-width: 100%;\r\n  }\r\n\r\n  ion-button {\r\n    margin-top: 16px;\r\n    --background: var(--ion-color-primary);\r\n    --color: white;\r\n  }\r\n}\r\n\r\nion-footer {\r\n  ion-toolbar {\r\n    --background: var(--ion-color-light);\r\n    --padding-top: 0;\r\n    --padding-bottom: 0;\r\n    --padding-start: 16px;\r\n    --padding-end: 16px;\r\n  }\r\n\r\n  ion-button {\r\n    margin: 10px 0;\r\n    --background: var(--ion-color-primary);\r\n    --color: white;\r\n  }\r\n}\r\n\r\n// Animaciones\r\n@keyframes fadeIn {\r\n  from { opacity: 0; }\r\n  to { opacity: 1; }\r\n}\r\n\r\n.product-card {\r\n  animation: fadeIn 0.5s ease-out;\r\n}\r\n\r\n// Estilos responsivos\r\n@media (max-width: 576px) {\r\n  .product-card {\r\n    ion-card-title {\r\n      font-size: 1.1rem;\r\n    }\r\n\r\n    ion-card-content {\r\n      p {\r\n        font-size: 0.85rem;\r\n      }\r\n\r\n      h2 {\r\n        font-size: 1.3rem;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Estilos para el badge del carrito\r\nion-badge {\r\n  position: absolute;\r\n  top: 5px;\r\n  right: 5px;\r\n  font-size: 12px;\r\n  padding: 2px 4px;\r\n  border-radius: 50%;\r\n  background-color: var(--ion-color-secondary);\r\n  color: white;\r\n}\r\n\r\nion-content {\r\n  --background: var(--ion-color-light);\r\n}",
        "main.page.spec.ts": "import { ComponentFixture, TestBed, fakeAsync, tick } from '@angular/core/testing';\r\nimport { IonicModule, ToastController, LoadingController } from '@ionic/angular';\r\nimport { MainPage } from './main.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { DatabaseServiceMock } from '../mocks/database.service.mock';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { RouterTestingModule } from '@angular/router/testing';\r\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\r\nimport { Router } from '@angular/router';\r\nimport { Product } from '../models/product.model';\r\n\r\ninterface ExtendedProduct extends Product {\r\n  showOptions: boolean;\r\n  selectedSize: string;\r\n  selectedMilk: string;\r\n  imageURL: string;\r\n}\r\n\r\ndescribe('MainPage', () => {\r\n  let component: MainPage;\r\n  let fixture: ComponentFixture<MainPage>;\r\n  let databaseService: DatabaseServiceMock;\r\n  let toastController: jasmine.SpyObj<ToastController>;\r\n  let loadingController: jasmine.SpyObj<LoadingController>;\r\n  let router: Router;\r\n  let localStorageGetItemSpy: jasmine.Spy;\r\n  let localStorageSetItemSpy: jasmine.Spy;\r\n  let mockStorage: { [key: string]: string };\r\n\r\n  const mockProduct: ExtendedProduct = {\r\n    id: 1,\r\n    name: 'Test Product',\r\n    description: 'Test Description',\r\n    price: 2500,\r\n    category: 'Test Category',\r\n    imageURL: 'test.jpg',\r\n    isAvailable: true,\r\n    showOptions: false,\r\n    selectedSize: 'medium',\r\n    selectedMilk: 'regular'\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    // Inicializar mockStorage\r\n    mockStorage = {\r\n      'currentUser': JSON.stringify({ id: 1, name: 'Test User' }),\r\n      'lastOrderNumber': '10'\r\n    };\r\n\r\n    // Crear spies para localStorage\r\n    localStorageGetItemSpy = spyOn(localStorage, 'getItem').and.callFake(key => mockStorage[key] || null);\r\n    localStorageSetItemSpy = spyOn(localStorage, 'setItem').and.callFake((key, value) => mockStorage[key] = value);\r\n    spyOn(localStorage, 'removeItem').and.callFake(key => delete mockStorage[key]);\r\n\r\n    const toastSpy = jasmine.createSpyObj('ToastController', ['create']);\r\n    const loadingSpy = jasmine.createSpyObj('LoadingController', ['create']);\r\n\r\n    const mockLoadingElement = {\r\n      present: jasmine.createSpy('present'),\r\n      dismiss: jasmine.createSpy('dismiss')\r\n    };\r\n    loadingSpy.create.and.returnValue(Promise.resolve(mockLoadingElement));\r\n\r\n    const mockToastElement = {\r\n      present: jasmine.createSpy('present')\r\n    };\r\n    toastSpy.create.and.returnValue(Promise.resolve(mockToastElement));\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [MainPage],\r\n      imports: [\r\n        IonicModule.forRoot(),\r\n        RouterTestingModule,\r\n        BrowserAnimationsModule\r\n      ],\r\n      providers: [\r\n        { provide: DatabaseService, useClass: DatabaseServiceMock },\r\n        { provide: ToastController, useValue: toastSpy },\r\n        { provide: LoadingController, useValue: loadingSpy }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(MainPage);\r\n    component = fixture.componentInstance;\r\n    databaseService = TestBed.inject(DatabaseService) as unknown as DatabaseServiceMock;\r\n    toastController = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    loadingController = TestBed.inject(LoadingController) as jasmine.SpyObj<LoadingController>;\r\n    router = TestBed.inject(Router);\r\n  });\r\n\r\n  describe('Cart Management', () => {\r\n    it('should prevent adding to cart when not logged in', async () => {\r\n      // Limpiar mockStorage para simular usuario no logueado\r\n      mockStorage = {};\r\n      spyOn(router, 'navigate');\r\n      \r\n      const testProduct = { ...mockProduct } as ExtendedProduct;\r\n      await component.addToCart(testProduct);\r\n      \r\n      expect(router.navigate).toHaveBeenCalledWith(['/login']);\r\n      expect(component.currentOrderItems.length).toBe(0);\r\n    });\r\n\r\n    it('should add product to cart when logged in', async () => {\r\n      const testProduct = { ...mockProduct } as ExtendedProduct;\r\n      await component.addToCart(testProduct);\r\n      expect(component.currentOrderItems.length).toBe(1);\r\n      expect(component.currentOrderItems[0].id).toBe(testProduct.id);\r\n    });\r\n\r\n    it('should update quantity correctly', () => {\r\n      const testProduct = { ...mockProduct } as ExtendedProduct;\r\n      component.currentOrderItems = [{ ...testProduct, quantity: 1 }];\r\n      \r\n      component.updateQuantity(testProduct, 1);\r\n      expect(component.currentOrderItems[0].quantity).toBe(2);\r\n      \r\n      component.updateQuantity(testProduct, -2);\r\n      expect(component.currentOrderItems.length).toBe(0);\r\n    });\r\n\r\n    it('should get correct quantity in cart', () => {\r\n      const testProduct = { ...mockProduct } as ExtendedProduct;\r\n      component.currentOrderItems = [{ ...testProduct, quantity: 2 }];\r\n      expect(component.getQuantityInCart(testProduct)).toBe(2);\r\n    });\r\n  });\r\n\r\n  describe('LocalStorage Management', () => {\r\n    it('should update local storage when cart changes', () => {\r\n      const testProduct = { ...mockProduct } as ExtendedProduct;\r\n      component.currentOrderItems = [{ ...testProduct, quantity: 1 }];\r\n      component.updateLocalStorage();\r\n      expect(localStorageSetItemSpy).toHaveBeenCalled();\r\n    });\r\n\r\n    it('should load current order from localStorage', () => {\r\n      const mockStoredOrder = {\r\n        orderNumber: 1,\r\n        items: [{ ...mockProduct, quantity: 1 }]\r\n      };\r\n      mockStorage['cart_1'] = JSON.stringify(mockStoredOrder);\r\n      \r\n      component.loadCurrentOrder();\r\n      expect(component.currentOrderItems.length).toBe(1);\r\n    });\r\n\r\n    it('should handle cart reset correctly', () => {\r\n      component.resetCart();\r\n      expect(localStorageSetItemSpy).toHaveBeenCalled();\r\n      expect(component.currentOrderNumber).toBeGreaterThan(0);\r\n    });\r\n  });\r\n  describe('Error Handling', () => {\r\n    it('should present toast on error', async () => {\r\n      await component.presentToast('Test message');\r\n      expect(toastController.create).toHaveBeenCalledWith({\r\n        message: 'Test message',\r\n        duration: 2000,\r\n        position: 'top'\r\n      });\r\n    });\r\n\r\n    it('should handle loading error gracefully', fakeAsync(() => {\r\n      spyOn(databaseService, 'getAllProducts').and.throwError('Test error');\r\n      component.loadProducts();\r\n      tick();\r\n      expect(toastController.create).toHaveBeenCalled();\r\n    }));\r\n  });\r\n});",
        "main.page.ts": "import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Router, NavigationEnd } from '@angular/router';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { ToastController, LoadingController } from '@ionic/angular';\r\nimport { Product } from '../models/product.model';\r\nimport { trigger, state, style, animate, transition } from '@angular/animations';\r\nimport { Subscription } from 'rxjs';\r\nimport { filter } from 'rxjs/operators';\r\n\r\ninterface ExtendedProduct extends Product {\r\n  showOptions: boolean;\r\n  selectedSize: string;\r\n  selectedMilk: string;\r\n  imageURL: string;\r\n}\r\n\r\n\r\n@Component({\r\n  selector: 'app-main',\r\n  templateUrl: './main.page.html',\r\n  styleUrls: ['./main.page.scss'],\r\n  animations: [\r\n    trigger('slideInOut', [\r\n      transition(':enter', [\r\n        style({ transform: 'translateY(100%)' }),\r\n        animate('200ms ease-out', style({ transform: 'translateY(0%)' }))\r\n      ]),\r\n      transition(':leave', [\r\n        animate('200ms ease-in', style({ transform: 'translateY(100%)' }))\r\n      ])\r\n    ])\r\n  ]\r\n})\r\nexport class MainPage implements OnInit {\r\n  products: ExtendedProduct[] = [];\r\n  currentOrderNumber: number = 1;\r\n  currentOrderItems: any[] = [];\r\n  isLoading: boolean = false;\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n\r\n  currentOrder: {\r\n    orderNumber: number;\r\n    id: number;\r\n    userId: number;\r\n    tableNumber: number | null;\r\n    status: string;\r\n    notes: string;\r\n    totalAmount: number;\r\n    paymentMethod: string;\r\n    items: any[];\r\n  } = {\r\n    orderNumber: 0,\r\n    id: 0,\r\n    userId: 0,\r\n    tableNumber: null,\r\n    status: 'Solicitado',\r\n    notes: '',\r\n    totalAmount: 0,\r\n    paymentMethod: '',\r\n    items: []\r\n  };\r\n\r\n\r\n\r\n  private navigationSubscription: Subscription = new Subscription();\r\n  \r\n  private getCurrentUserId(): number | null {\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    return currentUser.id || null;\r\n  }\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController,\r\n    \r\n    private loadingController: LoadingController\r\n    \r\n  ) {\r\n    const lastOrderNumber = parseInt(localStorage.getItem('lastOrderNumber') || '0');\r\n    this.currentOrderNumber = lastOrderNumber + 1;\r\n    this.navigationSubscription = new Subscription();\r\n    this.loadCurrentOrderNumber();\r\n  }\r\n\r\n  ngOnInit() {\r\n    // Llamar a loadProducts solo una vez cuando la página se inicializa\r\n    this.loadProducts();\r\n    this.loadCurrentOrder(); // Carga de la orden actual\r\n    \r\n    // Mantén la lógica de la suscripción para la orden, pero sin recargar los productos\r\n    this.navigationSubscription.add(\r\n      this.router.events.pipe(\r\n        filter((event): event is NavigationEnd => event instanceof NavigationEnd)\r\n      ).subscribe(() => {\r\n        this.loadCurrentOrder(); // Solo recargar la orden, no los productos\r\n      })\r\n    );\r\n  }\r\n  \r\n  ngOnDestroy() {\r\n    if (this.navigationSubscription) {\r\n      this.navigationSubscription.unsubscribe();\r\n    }\r\n  }\r\n\r\n  loadCurrentOrder() {\r\n    const userId = this.getCurrentUserId();\r\n    \r\n    // Si no hay usuario actual, limpiar el carrito\r\n    if (!userId) {\r\n      this.currentOrderItems = [];\r\n      this.currentOrder = {\r\n        orderNumber: 0,\r\n        id: 0,\r\n        userId: 0,\r\n        tableNumber: null,\r\n        status: 'Solicitado',\r\n        notes: '',\r\n        totalAmount: 0,\r\n        paymentMethod: '',\r\n        items: []\r\n      };\r\n      return;\r\n    }\r\n\r\n    // Cargar el carrito específico del usuario actual\r\n    const storedOrder = JSON.parse(localStorage.getItem(`cart_${userId}`) || 'null');\r\n    if (storedOrder) {\r\n      // Verificar que el carrito pertenezca al usuario actual\r\n      if (storedOrder.userId === userId) {\r\n        this.currentOrder.orderNumber = storedOrder.orderNumber;\r\n        this.currentOrder.items = storedOrder.items;\r\n        this.currentOrderItems = storedOrder.items;\r\n      } else {\r\n        // Si el carrito pertenece a otro usuario, limpiarlo\r\n        this.resetCart();\r\n      }\r\n    } else {\r\n      this.loadCurrentOrderNumber();\r\n      this.currentOrderItems = [];\r\n    }\r\n  }\r\n\r\n  resetCart() {\r\n    const userId = this.getCurrentUserId();\r\n    if (userId) {\r\n      const lastOrderNumber = parseInt(localStorage.getItem(`lastOrderNumber_${userId}`) || '0');\r\n      this.currentOrderNumber = lastOrderNumber + 1;\r\n      localStorage.setItem(`lastOrderNumber_${userId}`, this.currentOrderNumber.toString());\r\n    }\r\n  }\r\n\r\n\r\n  async loadProducts() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando productos...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const products = await this.getAllProducts();\r\n      console.log('Productos obtenidos de la base de datos:', products);\r\n  \r\n      this.products = products.map(product => ({\r\n        ...product,\r\n        imageURL: this.getImageUrl(product.imageURL),\r\n        showOptions: false,\r\n        selectedSize: 'medium',\r\n        selectedMilk: 'regular'\r\n      }));\r\n  \r\n      console.log('Productos procesados:', this.products);\r\n    } catch (error) {\r\n      console.error('Error al cargar los productos:', error);\r\n      await this.presentToast('Error al cargar los productos. Por favor, intente de nuevo.');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n  private getImageUrl(imageUri: string): string {\r\n    if (!imageUri) {\r\n      return 'assets/default-product-image.jpg';\r\n    }\r\n  \r\n    if (imageUri.startsWith('data:image') || imageUri.startsWith('assets/')) {\r\n      return imageUri;\r\n    }\r\n  \r\n    return `assets/${imageUri}`;\r\n  }\r\n\r\n  private getAllProducts(): Promise<Product[]> {\r\n    return new Promise((resolve, reject) => {\r\n      this.databaseService.getAllProducts().subscribe({\r\n        next: (products) => {\r\n          resolve(products);\r\n        },\r\n        error: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  get isLoggedIn(): boolean {\r\n    return !!localStorage.getItem('currentUser');\r\n  }\r\n\r\n  get currentUserName(): string | null {\r\n    const userString = localStorage.getItem('currentUser');\r\n    if (userString) {\r\n      const user = JSON.parse(userString);\r\n      return user.name || null;\r\n    }\r\n    return null;\r\n  }\r\n  toggleOptions(index: number) {\r\n    this.products[index].showOptions = !this.products[index].showOptions;\r\n  }\r\n\r\n  calculatePrice(product: ExtendedProduct): number {\r\n    let adjustedPrice = product.price;\r\n    if (product.selectedSize === 'pequeño') {\r\n      adjustedPrice -= 1000;\r\n    } else if (product.selectedSize === 'grande') {\r\n      adjustedPrice += 1000;\r\n    }\r\n    return adjustedPrice;\r\n  }\r\n\r\n  updatePrice(product: ExtendedProduct) {\r\n    // La lógica para actualizar el precio puede ir aquí si es necesario\r\n  }\r\n\r\n  async addToCart(product: ExtendedProduct) {\r\n    if (!this.isLoggedIn) {\r\n      await this.presentToast('Por favor, inicia sesión para añadir productos al carrito');\r\n      this.router.navigate(['/login']);\r\n      return;\r\n    }\r\n  \r\n    const existingItemIndex = this.currentOrderItems.findIndex(item => \r\n      item.id === product.id && \r\n      item.selectedSize === product.selectedSize && \r\n      item.selectedMilk === product.selectedMilk\r\n    );\r\n  \r\n    if (existingItemIndex !== -1) {\r\n      this.currentOrderItems[existingItemIndex].quantity += 1;\r\n    } else {\r\n      this.currentOrderItems.push({\r\n        ...product,\r\n        quantity: 1,\r\n        finalPrice: this.calculatePrice(product),\r\n        image: product.imageURL\r\n      });\r\n    }\r\n  \r\n    product.showOptions = false;\r\n  \r\n    this.updateLocalStorage();\r\n    console.log('Item added to cart:', this.currentOrderItems);\r\n  }\r\n\r\n  updateLocalStorage() {\r\n    const userId = this.getCurrentUserId();\r\n    if (userId) {\r\n      localStorage.setItem(`cart_${userId}`, JSON.stringify({\r\n        orderNumber: this.currentOrderNumber,\r\n        userId: userId, \r\n        items: this.currentOrderItems\r\n      }));\r\n      localStorage.setItem(`lastOrderNumber_${userId}`, this.currentOrderNumber.toString());\r\n    }\r\n  }\r\n  async completeOrder() {\r\n    if (this.currentOrderItems.length === 0) {\r\n      await this.presentToast('El carrito está vacío. Añada productos antes de completar la orden.');\r\n      return;\r\n    }\r\n\r\n  // Guardar el número de orden actual antes de navegar\r\n  const currentOrderNumber = this.currentOrderNumber;\r\n\r\n  \r\n    this.updateLocalStorage();\r\n    this.router.navigate(['/carro-compras']);\r\n    \r\n    // Resetear el carrito después de navegar\r\n    this.currentOrderItems = [];\r\n    this.currentOrderNumber++;\r\n    this.updateLocalStorage();\r\n\r\n    setTimeout(() => {\r\n      this.currentOrderItems = [];\r\n      this.currentOrderNumber = currentOrderNumber + 1;\r\n      this.updateLocalStorage();\r\n    }, 100);\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'top'\r\n    });\r\n    toast.present();\r\n  }\r\n  \r\n  loadCurrentOrderNumber() {\r\n    const userId = this.getCurrentUserId();\r\n    if (userId) {\r\n      const lastOrderNumber = parseInt(localStorage.getItem(`lastOrderNumber_${userId}`) || '0');\r\n      this.currentOrderNumber = lastOrderNumber + 1;\r\n      localStorage.setItem(`lastOrderNumber_${userId}`, this.currentOrderNumber.toString());\r\n    }\r\n  }\r\n\r\n  // Método para manejar la actualización de cantidad directamente en la página principal\r\n  updateQuantity(product: ExtendedProduct, change: number) {\r\n    const index = this.currentOrderItems.findIndex(item => \r\n      item.id === product.id && \r\n      item.selectedSize === product.selectedSize && \r\n      item.selectedMilk === product.selectedMilk\r\n    );\r\n\r\n    if (index !== -1) {\r\n      this.currentOrderItems[index].quantity += change;\r\n      if (this.currentOrderItems[index].quantity <= 0) {\r\n        this.currentOrderItems.splice(index, 1);\r\n      }\r\n    }\r\n\r\n    this.updateLocalStorage();\r\n  }\r\n\r\n  // Método para obtener la cantidad actual de un producto en el carrito\r\n  getQuantityInCart(product: ExtendedProduct): number {\r\n    const item = this.currentOrderItems.find(item => \r\n      item.id === product.id && \r\n      item.selectedSize === product.selectedSize && \r\n      item.selectedMilk === product.selectedMilk\r\n    );\r\n    return item ? item.quantity : 0;\r\n  }\r\n\r\n  handleImageError(event: any) {\r\n    event.target.src = 'assets/default-product-image.jpg';\r\n  }\r\n\r\n}\r\n\r\n\r\n"
      },
      "mocks": {
        "database.service.mock.ts": "// src/app/mocks/database.service.mock.ts\r\nimport { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { User } from '../models/user.model';\r\nimport { Product } from '../models/product.model';\r\nimport { Order } from '../models/order.model';\r\nimport { OrderDetail } from '../models/order-detail.model';\r\n\r\n@Injectable()\r\nexport class DatabaseServiceMock {\r\n  private dbReady: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  private users = new BehaviorSubject<User[]>([]);\r\n  private products = new BehaviorSubject<Product[]>([]);\r\n  private orders = new BehaviorSubject<Order[]>([]);\r\n  \r\n  constructor() {\r\n    this.dbReady.next(true);\r\n  }\r\n\r\n  // Database initialization methods\r\n  initializeDatabase() {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  createTablesIfNotExist() {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  getUserCount(): Promise<number> {\r\n    return Promise.resolve(1);\r\n  }\r\n\r\n  insertSeedDataIfEmpty() {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  // Observable methods\r\n  dbState() {\r\n    return of(true);\r\n  }\r\n\r\n  fetchUsers(): Observable<User[]> {\r\n    return this.users.asObservable();\r\n  }\r\n\r\n  fetchProducts(): Observable<Product[]> {\r\n    return this.products.asObservable();\r\n  }\r\n\r\n  fetchOrders(): Observable<Order[]> {\r\n    return this.orders.asObservable();\r\n  }\r\n\r\n  // User methods\r\n  createUser(user: User): Promise<number> {\r\n    return Promise.resolve(1);\r\n  }\r\n\r\n  getAllUsers(): Observable<User[]> {\r\n    return of([{\r\n      UserID: 1,\r\n      Username: 'testUser',\r\n      Password: '',\r\n      Role: 'employee',\r\n      Name: 'Test User',\r\n      Email: 'test@test.com',\r\n      ApprovalStatus: 'approved'\r\n    }]);\r\n  }\r\n\r\n  getPendingUsers(): Observable<User[]> {\r\n    return of([]);\r\n  }\r\n\r\n  updateUserApprovalStatus(userId: number, status: 'approved' | 'rejected' | 'pending'): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  // Product methods\r\n  createProduct(product: Product): Promise<number> {\r\n    return Promise.resolve(1);\r\n  }\r\n\r\n  getAllProducts(): Observable<Product[]> {\r\n    return of([{\r\n      id: 1,\r\n      name: 'Test Product',\r\n      description: 'Test Description',\r\n      price: 1000,\r\n      category: 'Test Category',\r\n      imageURL: 'test.jpg',\r\n      isAvailable: true\r\n    }]);\r\n  }\r\n\r\n  // Order methods\r\n  createOrder(order: Order): Promise<number> {\r\n    return Promise.resolve(1);\r\n  }\r\n\r\n  getOrdersByStatus(statuses: string[]): Observable<Order[]> {\r\n    return of([]);\r\n  }\r\n\r\n  getOrdersCount(statuses: string[], date?: string): Promise<number> {\r\n    return Promise.resolve(0);\r\n  }\r\n\r\n  // Authentication\r\n  authenticateUser(email: string, password: string): Promise<User | null> {\r\n    return Promise.resolve({\r\n      UserID: 1,\r\n      Username: 'testUser',\r\n      Password: '',\r\n      Role: 'employee',\r\n      Name: 'Test User',\r\n      Email: email,\r\n      ApprovalStatus: 'approved'\r\n    });\r\n  }\r\n\r\n  // Order details\r\n  addProductToOrder(orderDetail: OrderDetail): Promise<number> {\r\n    return Promise.resolve(1);\r\n  }\r\n\r\n  getOrderDetails(orderId: number): Observable<OrderDetail[]> {\r\n    return of([]);\r\n  }\r\n\r\n  updateOrderStatus(orderId: number, status: string): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  // Product management\r\n  updateProduct(product: Product): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  deleteProduct(id: number): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  // User management\r\n  updateUserFromDb(user: User): Promise<boolean> {\r\n    return Promise.resolve(true);\r\n  }\r\n\r\n  deleteUser(userId: number): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  updateUserLastLogin(userId: number): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  getUserById(id: number): Observable<User> {\r\n    return of({\r\n      UserID: id,\r\n      Username: 'testUser',\r\n      Password: '',\r\n      Role: 'employee',\r\n      Name: 'Test User',\r\n      Email: 'test@test.com',\r\n      ApprovalStatus: 'approved'\r\n    });\r\n  }\r\n\r\n  getUserByEmail(email: string): Observable<User | null> {\r\n    return of({\r\n      UserID: 1,\r\n      Username: 'testUser',\r\n      Password: '',\r\n      Role: 'employee',\r\n      Name: 'Test User',\r\n      Email: email,\r\n      ApprovalStatus: 'approved'\r\n    });\r\n  }\r\n\r\n  updateUserPassword(userId: number, currentPassword: string, newPassword: string): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  // Statistics and reports\r\n  calculateTotalSales(startDate: string, endDate: string, statuses: string[]): Promise<number> {\r\n    return Promise.resolve(0);\r\n  }\r\n\r\n  getTopSellingProducts(limit: number = 5): Promise<{productId: number, name: string, totalSold: number}[]> {\r\n    return Promise.resolve([]);\r\n  }\r\n\r\n  getOrderCountForToday(): Promise<number> {\r\n    return Promise.resolve(0);\r\n  }\r\n\r\n  getActiveEmployeesCount(): Promise<number> {\r\n    return Promise.resolve(0);\r\n  }\r\n\r\n  getProductDetails(productName: string): Promise<any> {\r\n    return Promise.resolve({});\r\n  }\r\n\r\n  // Profile picture management\r\n  updateUserProfilePicture(userId: number, profilePicture: string): Promise<boolean> {\r\n    return Promise.resolve(true);\r\n  }\r\n\r\n  getUserProfilePicture(userId: number): Observable<string | null> {\r\n    return of(null);\r\n  }\r\n\r\n  saveProfilePicture(userId: number, imageData: string): Promise<string> {\r\n    return Promise.resolve('mock-profile-picture.jpg');\r\n  }\r\n\r\n  getProfilePicture(userId: number): Promise<string | null> {\r\n    return Promise.resolve(null);\r\n  }\r\n\r\n  // Misc methods\r\n  removeDuplicateProducts(): Promise<void> {\r\n    return Promise.resolve();\r\n  }\r\n\r\n  updatePassword(userId: number, newPassword: string): Observable<boolean> {\r\n    return of(true);\r\n  }\r\n\r\n  presentAlert(titulo: string, msj: string): Promise<void> {\r\n    return Promise.resolve();\r\n  }\r\n}",
        "nodemailer.mock.ts": "export const mockNodemailer = {\r\n    createTransport: jest.fn().mockReturnValue({\r\n      sendMail: jest.fn().mockImplementation((mailOptions) => {\r\n        return Promise.resolve({\r\n          messageId: 'test-message-id',\r\n          envelope: {\r\n            from: mailOptions.from,\r\n            to: mailOptions.to\r\n          }\r\n        });\r\n      })\r\n    })\r\n  };",
        "sqlite.mock.ts": "export class SQLiteMock {\r\n    create() {\r\n      return Promise.resolve({\r\n        executeSql: () => Promise.resolve({ rows: { items: [] } }),\r\n        transaction: (fn: any) => Promise.resolve(),\r\n        close: () => Promise.resolve()\r\n      });\r\n    }\r\n  }"
      },
      "models": {
        "daily-sale.model.ts": "export interface DailySale {\r\n  day: string;\r\n  date: Date;\r\n  amount: number;\r\n  canceledAmount: number;\r\n  canceledOrders: number;\r\n}",
        "email.interface.ts": "export interface EmailResult {\r\n  messageId: string;\r\n  success: boolean;\r\n  error?: string;\r\n}",
        "inventory.model.ts": "export interface Inventory {\r\n    id?: number;\r\n    productId: number;\r\n    quantity: number;\r\n    lastRestockedAt?: Date;\r\n  }",
        "order-detail.model.js": "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n",
        "order-detail.model.ts": "export interface OrderDetail {\r\n  id?: number;\r\n  orderId: number;\r\n  productId: number;\r\n  quantity: number;\r\n  size?: string;\r\n  milkType?: string;\r\n  price: number;\r\n  name?: string;\r\n  image?: string;\r\n  selectedSize?: string;\r\n  selectedMilk?: string;\r\n  finalPrice?: number;\r\n}",
        "order.model.js": "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n",
        "order.model.ts": "import { OrderDetail } from './order-detail.model';\r\n\r\nexport interface Order {\r\n  id?: number;\r\n  orderNumber: number;\r\n  userId: number;\r\n  tableNumber: number | null;\r\n  status: 'Solicitado' | 'En proceso' | 'Listo' | 'Cancelado' | 'Entregado';\r\n  notes: string;\r\n  totalAmount: number;  \r\n  paymentMethod: string;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n  items?: OrderDetail[];\r\n}",
        "product.model.js": "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n",
        "product.model.ts": "export interface Product {\r\n  id?: number;\r\n  name: string;\r\n  description: string;\r\n  price: number;\r\n  category: string;\r\n  imageURL: string;\r\n  isAvailable: boolean;\r\n}",
        "sales-report.model.ts": "export interface SalesReport {\r\n    id?: number;\r\n    date: string;\r\n    totalSales: number;\r\n    totalOrders: number;\r\n    averageOrderValue: number;\r\n    topSellingProduct: number;\r\n    generatedBy: number;\r\n    createdAt?: string;\r\n  }",
        "table.model.ts": "export interface Table {\r\n    id?: number;\r\n    tableNumber: number;\r\n    capacity: number;\r\n    status: 'Libre' | 'Ocupada' | 'Reservada';\r\n  }",
        "top-product.model.ts": "export interface TopProduct {\r\n    productId: number;\r\n    name: string;\r\n    totalSold: number;\r\n    sales: number;\r\n  }",
        "user.model.js": "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n",
        "user.model.ts": "export interface User {\r\n  UserID?: number;\r\n  Username: string;\r\n  Password: string;\r\n  Role: 'employee' | 'admin' | 'manager';\r\n  Name: string;\r\n  Email: string;\r\n  PhoneNumber?: string;\r\n  HireDate?: Date;\r\n  LastLogin?: Date;\r\n  ApprovalStatus: 'pending' | 'approved' | 'rejected';\r\n  ProfilePicture?: string | null;\r\n}"
      },
      "not-found": {
        "not-found-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { NotFoundPage } from './not-found.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: NotFoundPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class NotFoundPageRoutingModule {}\r\n",
        "not-found.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { NotFoundPageRoutingModule } from './not-found-routing.module';\r\n\r\nimport { NotFoundPage } from './not-found.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    NotFoundPageRoutingModule\r\n  ],\r\n  declarations: [NotFoundPage]\r\n})\r\nexport class NotFoundPageModule {}\r\n",
        "not-found.page.html": "<ion-header>\r\n  <ion-toolbar>\r\n    <ion-title>Página no encontrada</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <div class=\"not-found-container\">\r\n    <h1>404</h1>\r\n    <h2>Página no encontrada</h2>\r\n    <p>Lo sentimos, la página que estás buscando no existe.</p>\r\n    <ion-button routerLink=\"/login\">Volver al inicio</ion-button>\r\n  </div>\r\n</ion-content>",
        "not-found.page.scss": ".not-found-container {\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    height: 100%;\r\n    text-align: center;\r\n  \r\n    h1 {\r\n      font-size: 6rem;\r\n      margin-bottom: 0;\r\n      color: var(--ion-color-primary);\r\n    }\r\n  \r\n    h2 {\r\n      font-size: 2rem;\r\n      margin-top: 0;\r\n      color: var(--ion-color-dark);\r\n    }\r\n  \r\n    p {\r\n      font-size: 1.2rem;\r\n      color: var(--ion-color-medium);\r\n      margin-bottom: 2rem;\r\n    }\r\n  }",
        "not-found.page.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { NotFoundPage } from './not-found.page';\r\n\r\ndescribe('NotFoundPage', () => {\r\n  let component: NotFoundPage;\r\n  let fixture: ComponentFixture<NotFoundPage>;\r\n\r\n  beforeEach(() => {\r\n    fixture = TestBed.createComponent(NotFoundPage);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n});\r\n",
        "not-found.page.ts": "import { Component, OnInit } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-not-found',\r\n  templateUrl: './not-found.page.html',\r\n  styleUrls: ['./not-found.page.scss'],\r\n})\r\nexport class NotFoundPage implements OnInit {\r\n\r\n  constructor() { }\r\n\r\n  ngOnInit() {\r\n  }\r\n\r\n}\r\n"
      },
      "orden-card": {
        "orden-card.component.html": "<!-- orden-card.component.html -->\r\n<ion-card class=\"orden-card\">\r\n  <ion-card-header>\r\n    <ion-card-title>Orden #{{ orden.id || 'N/A' }} - Mesa {{ orden.tableNumber || 'N/A' }}</ion-card-title>\r\n    <ion-card-subtitle>\r\n      <ion-badge [color]=\"orden.status === 'Solicitado' ? 'warning' : \r\n                          orden.status === 'En proceso' ? 'primary' : \r\n                          orden.status === 'Listo' ? 'success' : 'danger'\">\r\n        {{ orden.status || 'Desconocido' }}\r\n      </ion-badge>\r\n    </ion-card-subtitle>\r\n  </ion-card-header>\r\n\r\n  <ion-card-content>\r\n    <div class=\"items-list\">\r\n      <p *ngFor=\"let item of orden.items\">\r\n        {{ item.name || 'Producto desconocido' }} x{{ item.quantity || 0 }}\r\n        <span *ngIf=\"item.size || item.milkType\" class=\"item-details\">\r\n          ({{ item.size || 'Tamaño estándar' }}\r\n          <ng-container *ngIf=\"item.milkType\">, leche {{ item.milkType }}</ng-container>)\r\n        </span>\r\n        <ion-note slot=\"end\">{{ (item.price * item.quantity) | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n      </p>\r\n    </div>\r\n    <p class=\"total-amount\">\r\n      <strong>Total:</strong> \r\n      <ion-note slot=\"end\" color=\"primary\">{{ getOrderTotal() | currency:'CLP':'symbol-narrow':'1.0-0' }}</ion-note>\r\n    </p>\r\n    <p *ngIf=\"orden.notes\" class=\"notes\">\r\n      <ion-icon name=\"create-outline\"></ion-icon>\r\n      <strong>Notas:</strong> {{ orden.notes }}\r\n    </p>\r\n  </ion-card-content>\r\n\r\n  <div class=\"action-buttons\">\r\n    <ion-button [disabled]=\"orden.status !== 'Solicitado'\" (click)=\"onCambiarEstado('En proceso')\" color=\"primary\">\r\n      En Proceso\r\n    </ion-button>\r\n    <ion-button [disabled]=\"orden.status !== 'En proceso'\" (click)=\"onCambiarEstado('Listo')\" color=\"success\">\r\n      Lista\r\n    </ion-button>\r\n    <ion-button [disabled]=\"orden.status === 'Listo' || orden.status === 'Cancelado'\" (click)=\"onCambiarEstado('Cancelado')\" color=\"danger\">\r\n      Cancelar\r\n    </ion-button>\r\n  </div>\r\n</ion-card>",
        "orden-card.component.scss": "",
        "orden-card.component.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { OrdenCardComponent } from './orden-card.component';\r\nimport { Order } from '../models/order.model';\r\nimport { OrderDetail } from '../models/order-detail.model';\r\n\r\ndescribe('OrdenCardComponent', () => {\r\n  let component: OrdenCardComponent;\r\n  let fixture: ComponentFixture<OrdenCardComponent>;\r\n\r\n  // Mock OrderDetail para pruebas\r\n  const mockItems: OrderDetail[] = [\r\n    {\r\n      id: 1,\r\n      orderId: 1,\r\n      productId: 1,\r\n      quantity: 2,\r\n      price: 2500,\r\n      name: 'Café',\r\n      size: 'Grande',\r\n      milkType: 'Normal',\r\n      image: 'cafe.jpg'\r\n    },\r\n    {\r\n      id: 2,\r\n      orderId: 1,\r\n      productId: 2,\r\n      quantity: 1,\r\n      price: 3500,\r\n      name: 'Pastel',\r\n      size: 'Normal',\r\n      milkType: null,\r\n      image: 'pastel.jpg'\r\n    }\r\n  ];\r\n\r\n  // Mock order para pruebas\r\n  const mockOrder: Order = {\r\n    id: 1,\r\n    orderNumber: 1001,\r\n    userId: 1,\r\n    status: 'Solicitado',\r\n    tableNumber: 5,\r\n    createdAt: new Date(),\r\n    updatedAt: new Date(),\r\n    notes: \"Nota de prueba\",\r\n    totalAmount: 8500,\r\n    paymentMethod: \"efectivo\",\r\n    items: mockItems\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    await TestBed.configureTestingModule({\r\n      declarations: [ OrdenCardComponent ],\r\n      imports: [IonicModule.forRoot()]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(OrdenCardComponent);\r\n    component = fixture.componentInstance;\r\n    \r\n    component.orden = mockOrder;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('should correctly initialize with input order', () => {\r\n    expect(component.orden).toBeTruthy();\r\n    expect(component.orden.id).toBe(1);\r\n    expect(component.orden.status).toBe('Solicitado');\r\n    expect(component.orden.tableNumber).toBe(5);\r\n  });\r\n\r\n  it('should calculate order total correctly', () => {\r\n    const total = component.getOrderTotal();\r\n    expect(total).toBe(8500);\r\n  });\r\n\r\n  it('should handle order total calculation with empty items array', () => {\r\n    component.orden = {\r\n      id: 2,\r\n      orderNumber: 1002,\r\n      userId: 1,\r\n      status: 'Solicitado',\r\n      tableNumber: 1,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n      notes: \"\",\r\n      totalAmount: 0,\r\n      paymentMethod: \"efectivo\",\r\n      items: []\r\n    };\r\n    const total = component.getOrderTotal();\r\n    expect(total).toBe(0);\r\n  });\r\n\r\n  it('should handle order total calculation with undefined items', () => {\r\n    component.orden = {\r\n      id: 3,\r\n      orderNumber: 1003,\r\n      userId: 1,\r\n      status: 'Solicitado',\r\n      tableNumber: 1,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n      notes: \"\",\r\n      totalAmount: 0,\r\n      paymentMethod: \"efectivo\"\r\n    };\r\n    const total = component.getOrderTotal();\r\n    expect(total).toBe(0);\r\n  });\r\n\r\n  it('should emit cambiarEstado event with correct values', () => {\r\n    spyOn(component.cambiarEstado, 'emit');\r\n    \r\n    const nuevoEstado = 'En proceso';\r\n    component.onCambiarEstado(nuevoEstado);\r\n    \r\n    expect(component.cambiarEstado.emit).toHaveBeenCalledWith({\r\n      orden: component.orden,\r\n      nuevoEstado: nuevoEstado\r\n    });\r\n  });\r\n\r\n  it('should handle items with missing price or quantity', () => {\r\n    const incompleteMockItems: OrderDetail[] = [\r\n      {\r\n        id: 1,\r\n        orderId: 4,\r\n        productId: 1,\r\n        quantity: 2,\r\n        price: 0,\r\n        name: 'Café',\r\n        size: 'Grande',\r\n        milkType: 'Normal',\r\n        image: 'cafe.jpg'\r\n      },\r\n      {\r\n        id: 2,\r\n        orderId: 4,\r\n        productId: 2,\r\n        quantity: 1,\r\n        price: 3500,\r\n        name: 'Pastel',\r\n        size: 'Normal',\r\n        milkType: null,\r\n        image: 'pastel.jpg'\r\n      }\r\n    ];\r\n\r\n    component.orden = {\r\n      id: 4,\r\n      orderNumber: 1004,\r\n      userId: 1,\r\n      status: 'Solicitado',\r\n      tableNumber: 1,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n      notes: \"\",\r\n      totalAmount: 3500,\r\n      paymentMethod: \"efectivo\",\r\n      items: incompleteMockItems\r\n    };\r\n    \r\n    const total = component.getOrderTotal();\r\n    expect(total).toBe(3500);\r\n  });\r\n\r\n  it('should handle state changes for different status values', () => {\r\n    spyOn(component.cambiarEstado, 'emit');\r\n    \r\n    const estados = ['Solicitado', 'En proceso', 'Listo', 'Entregado', 'Cancelado'];\r\n    \r\n    estados.forEach(estado => {\r\n      component.onCambiarEstado(estado);\r\n      expect(component.cambiarEstado.emit).toHaveBeenCalledWith({\r\n        orden: component.orden,\r\n        nuevoEstado: estado\r\n      });\r\n    });\r\n    \r\n    expect(component.cambiarEstado.emit).toHaveBeenCalledTimes(estados.length);\r\n  });\r\n});",
        "orden-card.component.ts": "import { Component, Input, Output, EventEmitter } from '@angular/core';\r\nimport { Order } from '../models/order.model';\r\n\r\n@Component({\r\n  selector: 'app-orden-card',\r\n  templateUrl: './orden-card.component.html',\r\n  styleUrls: ['./orden-card.component.scss']\r\n})\r\nexport class OrdenCardComponent {\r\n  @Input() orden!: Order;\r\n  @Output() cambiarEstado = new EventEmitter<{orden: Order, nuevoEstado: string}>();\r\n\r\n  onCambiarEstado(nuevoEstado: string) {\r\n    this.cambiarEstado.emit({orden: this.orden, nuevoEstado});\r\n  }\r\n\r\n  getOrderTotal(): number {\r\n    return this.orden.items?.reduce((total, item) => total + ((item.price || 0) * (item.quantity || 0)), 0) || 0;\r\n  }\r\n}"
      },
      "perfil": {
        "perfil-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { PerfilPage } from './perfil.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: PerfilPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class PerfilPageRoutingModule {}\r\n",
        "perfil.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { PerfilPageRoutingModule } from './perfil-routing.module';\r\nimport { PerfilPage } from './perfil.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    PerfilPageRoutingModule\r\n  ],\r\n  declarations: [PerfilPage]\r\n})\r\nexport class PerfilPageModule {}",
        "perfil.page.html": "<ion-header class=\"ion-no-border\">\r\n  <ion-toolbar color=\"primary\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-menu-button></ion-menu-button>\r\n    </ion-buttons>\r\n    <ion-title>Mi Perfil</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <!-- Sección de Foto de Perfil -->\r\n  <div class=\"profile-picture-container\">\r\n    <img [src]=\"profilePicture || 'assets/default-avatar.png'\" \r\n         (error)=\"handleImageError($event)\" \r\n         alt=\"Foto de perfil\" \r\n         class=\"profile-picture\">\r\n    <ion-button (click)=\"takePicture()\" expand=\"block\" fill=\"outline\">\r\n      <ion-icon name=\"camera-outline\" slot=\"start\"></ion-icon>\r\n      Cambiar foto\r\n    </ion-button>\r\n  </div>\r\n\r\n  <!-- Sección de Información Personal (Solo Lectura) -->\r\n  <ion-card>\r\n    <ion-card-header>\r\n      <ion-card-title>\r\n        <ion-icon name=\"person-outline\"></ion-icon>\r\n        Información Personal\r\n      </ion-card-title>\r\n    </ion-card-header>\r\n    <ion-card-content>\r\n      <ion-list lines=\"none\">\r\n        <ion-item>\r\n          <ion-label>\r\n            <h2 class=\"ion-text-muted\">Nombre</h2>\r\n            <p>{{ usuario.Name }}</p>\r\n          </ion-label>\r\n        </ion-item>\r\n\r\n        <ion-item>\r\n          <ion-label>\r\n            <h2 class=\"ion-text-muted\">Email</h2>\r\n            <p>{{ usuario.Email }}</p>\r\n          </ion-label>\r\n        </ion-item>\r\n\r\n        <ion-item>\r\n          <ion-label>\r\n            <h2 class=\"ion-text-muted\">Rol</h2>\r\n            <p>{{ usuario.Role === 'admin' ? 'Administrador' : 'Empleado' }}</p>\r\n          </ion-label>\r\n        </ion-item>\r\n\r\n        <ion-item>\r\n          <ion-label>\r\n            <h2 class=\"ion-text-muted\">Estado</h2>\r\n            <p>{{ usuario.ApprovalStatus === 'approved' ? 'Aprobado' : 'Pendiente' }}</p>\r\n          </ion-label>\r\n        </ion-item>\r\n      </ion-list>\r\n    </ion-card-content>\r\n  </ion-card>\r\n\r\n  <!-- Sección de Cambio de Contraseña -->\r\n  <ion-card>\r\n    <ion-card-header>\r\n      <ion-card-title>\r\n        <ion-icon name=\"lock-closed-outline\"></ion-icon>\r\n        Cambiar Contraseña\r\n      </ion-card-title>\r\n    </ion-card-header>\r\n    <ion-card-content>\r\n      <form [formGroup]=\"passwordForm\" (ngSubmit)=\"cambiarContrasena()\">\r\n        <ion-item>\r\n          <ion-label position=\"stacked\">Contraseña Actual</ion-label>\r\n          <ion-input type=\"password\" formControlName=\"contrasenaActual\"></ion-input>\r\n        </ion-item>\r\n        <ion-text color=\"danger\" *ngIf=\"passwordForm.get('contrasenaActual')?.hasError('required') && passwordForm.get('contrasenaActual')?.touched\">\r\n          La contraseña actual es requerida\r\n        </ion-text>\r\n        <ion-text color=\"danger\" *ngIf=\"passwordForm.get('contrasenaActual')?.hasError('incorrectPassword') && passwordForm.get('contrasenaActual')?.touched\">\r\n          La contraseña actual es incorrecta\r\n        </ion-text>\r\n\r\n        <ion-item>\r\n          <ion-label position=\"stacked\">Nueva Contraseña</ion-label>\r\n          <ion-input type=\"password\" formControlName=\"nuevaContrasena\"></ion-input>\r\n        </ion-item>\r\n        <ion-text color=\"danger\" *ngIf=\"passwordForm.get('nuevaContrasena')?.hasError('required') && passwordForm.get('nuevaContrasena')?.touched\">\r\n          La nueva contraseña es requerida\r\n        </ion-text>\r\n        <ion-text color=\"danger\" *ngIf=\"passwordForm.get('nuevaContrasena')?.hasError('minlength') && passwordForm.get('nuevaContrasena')?.touched\">\r\n          La contraseña debe tener al menos 6 caracteres\r\n        </ion-text>\r\n        <ion-text color=\"danger\" *ngIf=\"passwordForm.get('nuevaContrasena')?.hasError('invalidPassword') && passwordForm.get('nuevaContrasena')?.touched\">\r\n          La contraseña debe contener al menos una letra mayúscula, una minúscula, un número y un carácter especial\r\n        </ion-text>\r\n\r\n        <ion-item>\r\n          <ion-label position=\"stacked\">Confirmar Nueva Contraseña</ion-label>\r\n          <ion-input type=\"password\" formControlName=\"confirmarContrasena\"></ion-input>\r\n        </ion-item>\r\n        <ion-text color=\"danger\" *ngIf=\"passwordForm.get('confirmarContrasena')?.hasError('required') && passwordForm.get('confirmarContrasena')?.touched\">\r\n          Debe confirmar la nueva contraseña\r\n        </ion-text>\r\n        <ion-text color=\"danger\" *ngIf=\"passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmarContrasena')?.touched\">\r\n          Las contraseñas no coinciden\r\n        </ion-text>\r\n\r\n        <ion-button expand=\"block\" type=\"submit\" [disabled]=\"!passwordForm.valid\" class=\"ion-margin-top\">\r\n          <ion-icon name=\"key-outline\" slot=\"start\"></ion-icon>\r\n          Cambiar Contraseña\r\n        </ion-button>\r\n      </form>\r\n    </ion-card-content>\r\n  </ion-card>\r\n\r\n  <ion-button expand=\"block\" (click)=\"logout()\" color=\"danger\" class=\"logout-button ion-margin-top\">\r\n    <ion-icon name=\"log-out-outline\" slot=\"start\"></ion-icon>\r\n    Cerrar Sesión\r\n  </ion-button>\r\n</ion-content>\r\n\r\n<ion-toast\r\n  [isOpen]=\"showToast\"\r\n  [message]=\"toastMessage\"\r\n  [duration]=\"3000\"\r\n  position=\"top\"\r\n  [color]=\"toastColor\">\r\n</ion-toast>",
        "perfil.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n}\r\n\r\nion-content {\r\n  --background: var(--ion-color-light);\r\n}\r\n\r\n.profile-picture-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-bottom: 24px;\r\n  padding: 24px;\r\n  background-color: #ffffff;\r\n  border-radius: 16px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n\r\n  .profile-picture {\r\n    width: 150px;\r\n    height: 150px;\r\n    border-radius: 50%;\r\n    object-fit: cover;\r\n    border: 4px solid var(--ion-color-primary);\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  ion-button {\r\n    --background: var(--ion-color-secondary);\r\n    --color: #ffffff;\r\n    font-weight: 600;\r\n  }\r\n}\r\n\r\nion-card {\r\n  border-radius: 16px;\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  margin-bottom: 24px;\r\n  background-color: #ffffff;\r\n  overflow: hidden;\r\n\r\n  ion-card-header {\r\n    background-color: var(--ion-color-primary);\r\n    padding: 16px;\r\n\r\n    ion-card-title {\r\n      font-size: 20px;\r\n      font-weight: 600;\r\n      color: #ffffff;\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      ion-icon {\r\n        margin-right: 8px;\r\n        font-size: 24px;\r\n      }\r\n    }\r\n  }\r\n\r\n  ion-card-content {\r\n    padding: 20px;\r\n  }\r\n}\r\n\r\nion-item {\r\n  --padding-start: 0;\r\n  --inner-padding-end: 0;\r\n  --background: transparent;\r\n  --border-color: var(--ion-color-medium);\r\n  --border-width: 0 0 1px 0;\r\n  --border-style: solid;\r\n  margin-bottom: 16px;\r\n\r\n  &:last-child {\r\n    --border-width: 0;\r\n  }\r\n\r\n  ion-label {\r\n    color: var(--ion-color-dark);\r\n    font-size: 16px;\r\n    font-weight: 500;\r\n  }\r\n\r\n  ion-input, ion-textarea, ion-select {\r\n    --padding-start: 0;\r\n    font-size: 16px;\r\n    color: var(--ion-color-dark);\r\n  }\r\n}\r\n\r\nion-button {\r\n  margin-top: 24px;\r\n  --background: var(--ion-color-primary);\r\n  --background-hover: var(--ion-color-primary-shade);\r\n  --color: #ffffff;\r\n  --border-radius: 8px;\r\n  font-weight: 600;\r\n  text-transform: uppercase;\r\n  letter-spacing: 0.5px;\r\n\r\n  &[color=\"danger\"] {\r\n    --background: var(--ion-color-danger);\r\n    --background-hover: var(--ion-color-danger-shade);\r\n  }\r\n}\r\n\r\nion-text {\r\n  color: var(--ion-color-danger);\r\n  font-size: 12px;\r\n  margin-top: 4px;\r\n  display: block;\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  .profile-picture-container {\r\n    padding: 16px;\r\n\r\n    .profile-picture {\r\n      width: 120px;\r\n      height: 120px;\r\n    }\r\n  }\r\n\r\n  ion-card {\r\n    ion-card-header {\r\n      ion-card-title {\r\n        font-size: 18px;\r\n      }\r\n    }\r\n  }\r\n\r\n  ion-item {\r\n    ion-label {\r\n      font-size: 14px;\r\n    }\r\n\r\n    ion-input, ion-textarea, ion-select {\r\n      font-size: 14px;\r\n    }\r\n  }\r\n}\r\n\r\n// Animaciones\r\n@keyframes fadeInUp {\r\n  from { \r\n    opacity: 0;\r\n    transform: translateY(20px);\r\n  }\r\n  to { \r\n    opacity: 1;\r\n    transform: translateY(0);\r\n  }\r\n}\r\n\r\n.profile-picture-container, ion-card {\r\n  animation: fadeInUp 0.3s ease-out;\r\n}\r\n\r\n.profile-picture-container {\r\n  animation-delay: 0.1s;\r\n}\r\n\r\nion-card:nth-child(2) {\r\n  animation-delay: 0.2s;\r\n}\r\n\r\nion-card:nth-child(3) {\r\n  animation-delay: 0.3s;\r\n}\r\n\r\nion-button[color=\"danger\"] {\r\n  animation: fadeInUp 0.3s ease-out;\r\n  animation-delay: 0.4s;\r\n}",
        "perfil.page.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { PerfilPage } from './perfil.page';\r\nimport { IonicModule, ToastController, LoadingController, AlertController } from '@ionic/angular';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { Router } from '@angular/router';\r\nimport { FormBuilder, ReactiveFormsModule } from '@angular/forms';\r\nimport { of } from 'rxjs';\r\nimport { User } from '../models/user.model';\r\n\r\ndescribe('PerfilPage', () => {\r\n  let component: PerfilPage;\r\n  let fixture: ComponentFixture<PerfilPage>;\r\n  let databaseServiceSpy: jasmine.SpyObj<DatabaseService>;\r\n  let toastControllerSpy: jasmine.SpyObj<ToastController>;\r\n  let loadingControllerSpy: jasmine.SpyObj<LoadingController>;\r\n  let alertControllerSpy: jasmine.SpyObj<AlertController>;\r\n  let routerSpy: jasmine.SpyObj<Router>;\r\n\r\n  const mockUser: User = {\r\n    UserID: 1,\r\n    Username: 'testUser',\r\n    Password: 'Test123!',\r\n    Role: 'employee',\r\n    Name: 'Test User',\r\n    Email: 'test@test.com',\r\n    LastLogin: new Date(),\r\n    ApprovalStatus: 'approved'\r\n  };\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', [\r\n      'getUserById', \r\n      'getUserProfilePicture', \r\n      'updateUserFromDb',\r\n      'updateUserPassword',\r\n      'updateUserProfilePicture'\r\n    ]);\r\n    const toastSpy = jasmine.createSpyObj('ToastController', ['create']);\r\n    const loadingSpy = jasmine.createSpyObj('LoadingController', ['create']);\r\n    const alertSpy = jasmine.createSpyObj('AlertController', ['create']);\r\n    const routerSpyObj = jasmine.createSpyObj('Router', ['navigate']);\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [ PerfilPage ],\r\n      imports: [ \r\n        IonicModule.forRoot(),\r\n        ReactiveFormsModule\r\n      ],\r\n      providers: [\r\n        FormBuilder,\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { provide: ToastController, useValue: toastSpy },\r\n        { provide: LoadingController, useValue: loadingSpy },\r\n        { provide: AlertController, useValue: alertSpy },\r\n        { provide: Router, useValue: routerSpyObj }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    databaseServiceSpy = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    toastControllerSpy = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    loadingControllerSpy = TestBed.inject(LoadingController) as jasmine.SpyObj<LoadingController>;\r\n    alertControllerSpy = TestBed.inject(AlertController) as jasmine.SpyObj<AlertController>;\r\n    routerSpy = TestBed.inject(Router) as jasmine.SpyObj<Router>;\r\n\r\n    // Mock localStorage\r\n    const mockLocalStorage = {\r\n      currentUser: JSON.stringify({ id: 1, profilePicture: 'test.jpg' })\r\n    };\r\n    spyOn(localStorage, 'getItem').and.callFake(key => mockLocalStorage[key] || null);\r\n    spyOn(localStorage, 'setItem').and.callFake((key, value) => mockLocalStorage[key] = value);\r\n\r\n    // Setup default spy returns\r\n    databaseServiceSpy.getUserById.and.returnValue(of(mockUser));\r\n    databaseServiceSpy.getUserProfilePicture.and.returnValue(of('test.jpg'));\r\n    \r\n    const mockLoading = {\r\n      present: jasmine.createSpy('present'),\r\n      dismiss: jasmine.createSpy('dismiss')\r\n    };\r\n    loadingControllerSpy.create.and.returnValue(Promise.resolve(mockLoading as any));\r\n\r\n    const mockToast = {\r\n      present: jasmine.createSpy('present')\r\n    };\r\n    toastControllerSpy.create.and.returnValue(Promise.resolve(mockToast as any));\r\n\r\n    fixture = TestBed.createComponent(PerfilPage);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('should initialize with invalid forms', () => {\r\n    expect(component.perfilForm.valid).toBeFalsy();\r\n    expect(component.passwordForm.valid).toBeFalsy();\r\n  });\r\n\r\n  it('should validate password requirements', () => {\r\n    const passwordControl = component.passwordForm.get('nuevaContrasena');\r\n    \r\n    // Test invalid password\r\n    passwordControl?.setValue('weak');\r\n    expect(passwordControl?.errors?.['invalidPassword']).toBeTruthy();\r\n    \r\n    // Test valid password\r\n    passwordControl?.setValue('StrongPass123!');\r\n    expect(passwordControl?.errors).toBeNull();\r\n  });\r\n\r\n  it('should validate password match', () => {\r\n    const nuevaContrasena = component.passwordForm.get('nuevaContrasena');\r\n    const confirmarContrasena = component.passwordForm.get('confirmarContrasena');\r\n    \r\n    nuevaContrasena?.setValue('StrongPass123!');\r\n    confirmarContrasena?.setValue('DifferentPass123!');\r\n    expect(component.passwordForm.errors?.['passwordMismatch']).toBeTruthy();\r\n    \r\n    confirmarContrasena?.setValue('StrongPass123!');\r\n    expect(component.passwordForm.errors?.['passwordMismatch']).toBeFalsy();\r\n  });\r\n\r\n  it('should load user profile successfully', async () => {\r\n    // Mock successful profile loading\r\n    databaseServiceSpy.getUserById.and.returnValue(of(mockUser));\r\n    databaseServiceSpy.getUserProfilePicture.and.returnValue(of('test.jpg'));\r\n\r\n    await component.cargarPerfilUsuario();\r\n\r\n    expect(component.usuario).toEqual(mockUser);\r\n    expect(component.profilePicture).toBe('test.jpg');\r\n    expect(component.perfilForm.get('name')?.value).toBe(mockUser.Name);\r\n    expect(component.perfilForm.get('email')?.value).toBe(mockUser.Email);\r\n  });\r\n});",
        "perfil.page.ts": "import { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { ToastController, LoadingController, AlertController } from '@ionic/angular';\r\nimport { Subscription } from 'rxjs';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { User } from '../models/user.model';\r\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\r\nimport { FormBuilder, FormGroup, Validators, AbstractControl } from '@angular/forms';\r\n@Component({\r\n  selector: 'app-perfil',\r\n  templateUrl: './perfil.page.html',\r\n  styleUrls: ['./perfil.page.scss'],\r\n})\r\nexport class PerfilPage implements OnInit, OnDestroy {\r\n  toastColor: string = 'success';\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n  profilePicture: string | null = null;\r\n  \r\n  usuario: User = {\r\n    UserID: 0,\r\n    Username: '',\r\n    Password: '',\r\n    Role: 'employee',\r\n    Name: '',\r\n    Email: '',\r\n    LastLogin: new Date(),\r\n    ApprovalStatus: 'approved'\r\n  };\r\n\r\n  perfilForm: FormGroup;\r\n  passwordForm: FormGroup;\r\n  private currentPassword: string = '';\r\n\r\n  esAdmin: boolean = false;\r\n  private subscriptions: Subscription = new Subscription();\r\n\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController,\r\n    private loadingController: LoadingController,\r\n    private alertController: AlertController,\r\n    private router: Router\r\n  ) { \r\n    this.perfilForm = this.formBuilder.group({\r\n      name: ['', [Validators.required, Validators.minLength(3)]],\r\n      email: ['', [Validators.required, Validators.email]]\r\n    });\r\n\r\n    this.passwordForm = this.formBuilder.group({\r\n      contrasenaActual: ['', [Validators.required]],\r\n      nuevaContrasena: ['', [Validators.required, Validators.minLength(6), this.passwordValidator]],\r\n      confirmarContrasena: ['', [Validators.required]]\r\n    }, { validators: this.passwordMatchValidator });\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.cargarPerfilUsuario();\r\n    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n    this.profilePicture = currentUser.profilePicture || null;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscriptions.unsubscribe();\r\n  }\r\n\r\n  passwordValidator(control: AbstractControl): { [key: string]: boolean } | null {\r\n    const password = control.value;\r\n    const hasSpecialChar = /[!@#$%^&*(),.?\":{}|<>]/.test(password);\r\n    const hasUpperCase = /[A-Z]/.test(password);\r\n    const hasLowerCase = /[a-z]/.test(password);\r\n    const hasNumber = /\\d/.test(password);\r\n    \r\n    if (!hasSpecialChar || !hasUpperCase || !hasLowerCase || !hasNumber) {\r\n      return { 'invalidPassword': true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  passwordMatchValidator(group: AbstractControl): { [key: string]: boolean } | null {\r\n    const nuevaContrasena = group.get('nuevaContrasena');\r\n    const confirmarContrasena = group.get('confirmarContrasena');\r\n    return nuevaContrasena && confirmarContrasena && nuevaContrasena.value !== confirmarContrasena.value\r\n      ? { 'passwordMismatch': true }\r\n      : null;\r\n  }\r\n\r\n  async cargarPerfilUsuario() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cargando perfil...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      const userId = this.obtenerIdUsuarioActual();\r\n      if (!userId) {\r\n        throw new Error('No se encontró un usuario activo');\r\n      }\r\n      this.usuario = await this.getUserById(userId);\r\n      this.esAdmin = this.usuario.Role === 'admin';\r\n      await this.loadProfilePicture(userId);\r\n      \r\n      this.perfilForm.patchValue({\r\n        name: this.usuario.Name,\r\n        email: this.usuario.Email,\r\n        phoneNumber: this.usuario.PhoneNumber\r\n      });\r\n      \r\n      console.log('Usuario cargado:', this.usuario);\r\n      console.log('Es admin:', this.esAdmin);\r\n    } catch (error) {\r\n      console.error('Error al cargar el perfil del usuario:', error);\r\n      await this.presentToast('Error al cargar el perfil. Por favor, intente de nuevo.');\r\n      this.router.navigate(['/login']);\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  private getUserById(userId: number): Promise<User> {\r\n    return new Promise((resolve, reject) => {\r\n      this.databaseService.getUserById(userId).subscribe(\r\n        (user) => {\r\n          if (user) {\r\n            resolve(user);\r\n          } else {\r\n            reject(new Error('Usuario no encontrado'));\r\n          }\r\n        },\r\n        (error) => reject(error)\r\n      );\r\n    });\r\n  }\r\n\r\n  async loadProfilePicture(userId: number) {\r\n    try {\r\n      const result = await this.databaseService.getUserProfilePicture(userId).toPromise();\r\n      this.profilePicture = result || 'assets/default-avatar.png';\r\n      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n      currentUser.profilePicture = this.profilePicture;\r\n      localStorage.setItem('currentUser', JSON.stringify(currentUser));\r\n    } catch (error) {\r\n      console.error('Error loading profile picture:', error);\r\n      this.profilePicture = 'assets/default-avatar.png';\r\n    }\r\n  }\r\n\r\n  async takePicture() {\r\n    try {\r\n      const image = await Camera.getPhoto({\r\n        quality: 90,\r\n        allowEditing: true,\r\n        resultType: CameraResultType.DataUrl,\r\n        source: CameraSource.Prompt\r\n      });\r\n  \r\n      this.profilePicture = image.dataUrl || null;\r\n      const userId = this.obtenerIdUsuarioActual();\r\n      if (userId && this.profilePicture) {\r\n        await this.databaseService.updateUserProfilePicture(userId, this.profilePicture);\r\n        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');\r\n        currentUser.profilePicture = this.profilePicture;\r\n        localStorage.setItem('currentUser', JSON.stringify(currentUser));\r\n        await this.presentToast('Foto de perfil actualizada con éxito');\r\n      } else {\r\n        throw new Error('No se pudo obtener el ID del usuario o la imagen');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error detallado al tomar la foto:', error);\r\n      if (error instanceof Error) {\r\n        await this.presentToast(`Error al tomar la foto: ${error.message}`);\r\n      } else {\r\n        await this.presentToast('Error desconocido al tomar la foto');\r\n      }\r\n    }\r\n  }\r\n\r\n  async updatePerfil() {\r\n    if (this.perfilForm.valid) {\r\n      const loading = await this.loadingController.create({\r\n        message: 'Actualizando perfil...',\r\n      });\r\n      await loading.present();\r\n    \r\n      try {\r\n        const formValues = this.perfilForm.value;\r\n        this.usuario.Name = formValues.name;\r\n        this.usuario.Email = formValues.email;\r\n        this.usuario.PhoneNumber = formValues.phoneNumber;\r\n\r\n        const success = await this.updateUser(this.usuario);\r\n        if (success) {\r\n          await this.presentToast('Perfil actualizado con éxito');\r\n        } else {\r\n          throw new Error('No se pudo actualizar el perfil');\r\n        }\r\n      } catch (error) {\r\n        console.error('Error al actualizar el perfil:', error);\r\n        await this.presentToast('Error al actualizar el perfil. Por favor, intente de nuevo.');\r\n      } finally {\r\n        await loading.dismiss();\r\n      }\r\n    } else {\r\n      await this.presentToast('Por favor, complete todos los campos correctamente.');\r\n    }\r\n  }\r\n\r\n  private async updateUser(user: User): Promise<boolean> {\r\n    try {\r\n      const result = await this.databaseService.updateUserFromDb(user);\r\n      return result !== undefined ? result : false;\r\n    } catch (error) {\r\n      console.error('Error updating user:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async cambiarContrasena() {\r\n    if (this.passwordForm.valid) {\r\n      const formValues = this.passwordForm.value;\r\n      \r\n      // Verificar que la contraseña actual coincida\r\n      if (formValues.contrasenaActual !== this.currentPassword) {\r\n        this.toastColor = 'danger';\r\n        await this.presentToast('La contraseña actual no es correcta');\r\n        return;\r\n      }\r\n\r\n      const alert = await this.alertController.create({\r\n        header: 'Confirmar cambio de contraseña',\r\n        message: '¿Estás seguro de que quieres cambiar tu contraseña?',\r\n        buttons: [\r\n          {\r\n            text: 'Cancelar',\r\n            role: 'cancel'\r\n          },\r\n          {\r\n            text: 'Confirmar',\r\n            handler: () => {\r\n              this.realizarCambioContrasena();\r\n            }\r\n          }\r\n        ]\r\n      });\r\n\r\n      await alert.present();\r\n    } else {\r\n      this.toastColor = 'danger';\r\n      await this.presentToast('Por favor, complete todos los campos correctamente');\r\n    }\r\n  }\r\n\r\n  private async realizarCambioContrasena() {\r\n    const loading = await this.loadingController.create({\r\n      message: 'Cambiando contraseña...',\r\n    });\r\n    await loading.present();\r\n\r\n    try {\r\n      const formValues = this.passwordForm.value;\r\n      const success = await this.databaseService\r\n        .updateUserPassword(\r\n          this.usuario.UserID!,\r\n          formValues.contrasenaActual,\r\n          formValues.nuevaContrasena\r\n        ).toPromise();\r\n\r\n      if (success) {\r\n        this.currentPassword = formValues.nuevaContrasena;\r\n        this.toastColor = 'success';\r\n        await this.presentToast('Contraseña cambiada con éxito');\r\n        this.passwordForm.reset();\r\n      } else {\r\n        this.toastColor = 'danger';\r\n        await this.presentToast('Error al cambiar la contraseña');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al cambiar la contraseña:', error);\r\n      this.toastColor = 'danger';\r\n      await this.presentToast('Error al cambiar la contraseña');\r\n    } finally {\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n\r\n  private updateUserPassword(userId: number, currentPassword: string, newPassword: string): Promise<boolean> {\r\n    return new Promise((resolve, reject) => {\r\n      this.databaseService.updateUserPassword(userId, currentPassword, newPassword).subscribe(\r\n        (success) => resolve(success),\r\n        (error) => reject(error)\r\n      );\r\n    });\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'top',\r\n      color: this.toastColor\r\n    });\r\n    await toast.present();\r\n  }\r\n\r\n  private obtenerIdUsuarioActual(): number | null {\r\n    const usuarioActual = localStorage.getItem('currentUser');\r\n    if (usuarioActual) {\r\n      return JSON.parse(usuarioActual).id;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async logout() {\r\n    const alert = await this.alertController.create({\r\n      header: 'Cerrar sesión',\r\n      message: '¿Estás seguro de que quieres cerrar sesión?',\r\n      buttons: [\r\n        {\r\n          text: 'Cancelar',\r\n          role: 'cancel'\r\n        },\r\n        {\r\n          text: 'Sí, cerrar sesión',\r\n          handler: () => {\r\n            localStorage.removeItem('currentUser');\r\n            this.router.navigate(['/login']);\r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n  }\r\n\r\n  handleImageError(event: any) {\r\n    event.target.src = 'assets/default-avatar.png';\r\n  }\r\n}"
      },
      "register": {
        "register-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { RegisterPage } from './register.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: RegisterPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class RegisterPageRoutingModule {}\r\n",
        "register.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { ReactiveFormsModule } from '@angular/forms';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { RegisterPageRoutingModule } from './register-routing.module';\r\nimport { RegisterPage } from './register.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    ReactiveFormsModule,\r\n    IonicModule,\r\n    RegisterPageRoutingModule\r\n  ],\r\n  declarations: [RegisterPage]\r\n})\r\nexport class RegisterPageModule {}",
        "register.page.html": "<ion-content class=\"ion-padding\">\r\n  <div class=\"register-container\">\r\n    <h1>Únete a nosotros</h1>\r\n    <h2>Registro</h2>\r\n    <form [formGroup]=\"registerForm\" (ngSubmit)=\"onSubmit()\">\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Nombre</ion-label>\r\n        <ion-input type=\"text\" formControlName=\"name\"></ion-input>\r\n      </ion-item>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.get('name')?.hasError('required') && registerForm.get('name')?.touched\">\r\n        El nombre es requerido\r\n      </ion-text>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.get('name')?.hasError('minlength') && registerForm.get('name')?.touched\">\r\n        El nombre debe tener al menos 3 caracteres\r\n      </ion-text>\r\n\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Correo electrónico</ion-label>\r\n        <ion-input type=\"email\" formControlName=\"email\"></ion-input>\r\n      </ion-item>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.get('email')?.hasError('required') && registerForm.get('email')?.touched\">\r\n        El correo electrónico es requerido\r\n      </ion-text>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.get('email')?.hasError('email') && registerForm.get('email')?.touched\">\r\n        Por favor, ingrese un correo electrónico válido\r\n      </ion-text>\r\n\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Contraseña</ion-label>\r\n        <ion-input type=\"password\" formControlName=\"password\"></ion-input>\r\n      </ion-item>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.get('password')?.hasError('required') && registerForm.get('password')?.touched\">\r\n        La contraseña es requerida\r\n      </ion-text>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.get('password')?.hasError('minlength') && registerForm.get('password')?.touched\">\r\n        La contraseña debe tener al menos 6 caracteres\r\n      </ion-text>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.get('password')?.hasError('invalidPassword') && registerForm.get('password')?.touched\">\r\n        La contraseña debe contener al menos una letra mayúscula, una minúscula, un número y un carácter especial\r\n      </ion-text>\r\n\r\n      <ion-item>\r\n        <ion-label position=\"floating\">Confirmar Contraseña</ion-label>\r\n        <ion-input type=\"password\" formControlName=\"confirmPassword\"></ion-input>\r\n      </ion-item>\r\n      <ion-text color=\"danger\" *ngIf=\"registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched\">\r\n        Las contraseñas no coinciden\r\n      </ion-text>\r\n\r\n      <ion-button expand=\"block\" type=\"submit\" [disabled]=\"!registerForm.valid\">\r\n        Registrarse\r\n      </ion-button>\r\n    </form>\r\n    <a [routerLink]=\"['/login']\" class=\"login-link\">¿Ya tienes una cuenta? Inicia sesión</a>\r\n  </div>\r\n</ion-content>\r\n\r\n<ion-toast\r\n  [isOpen]=\"showToast\"\r\n  [message]=\"toastMessage\"\r\n  [duration]=\"3000\"\r\n  position=\"top\"\r\n  color=\"primary\">\r\n</ion-toast>",
        "register.page.scss": ":host {\r\n  --ion-color-primary: #84B0A2;\r\n  --ion-color-secondary: #D4A082;\r\n  --ion-color-tertiary: #ECC9A3;\r\n  --ion-color-success: #2dd36f;\r\n  --ion-color-warning: #ffc409;\r\n  --ion-color-danger: #eb445a;\r\n  --ion-color-medium: #92949c;\r\n  --ion-color-light: #D4E7EE;\r\n  --ion-color-dark: #405770;\r\n}\r\n\r\nion-content {\r\n  --background: linear-gradient(135deg, var(--ion-color-light) 0%, #c3cfe2 100%);\r\n}\r\n\r\n.register-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 100%;\r\n  padding: 20px;\r\n  color: var(--ion-color-dark);\r\n}\r\n\r\nh1 {\r\n  font-size: 2.5rem;\r\n  margin-bottom: 10px;\r\n  color: var(--ion-color-primary);\r\n}\r\n\r\nh2 {\r\n  font-size: 1.8rem;\r\n  margin-bottom: 30px;\r\n  color: var(--ion-color-secondary);\r\n}\r\n\r\nform {\r\n  width: 100%;\r\n  max-width: 400px;\r\n}\r\n\r\nion-item {\r\n  --background: rgba(255, 255, 255, 0.2);\r\n  --border-color: var(--ion-color-primary);\r\n  --highlight-height: 1px;\r\n  border-radius: 8px;\r\n  margin-bottom: 15px;\r\n}\r\n\r\nion-label {\r\n  color: var(--ion-color-dark);\r\n  font-weight: 500;\r\n}\r\n\r\nion-input {\r\n  --padding-start: 10px;\r\n  font-size: 16px;\r\n  --placeholder-color: var(--ion-color-medium);\r\n  --placeholder-opacity: 0.8;\r\n  color: var(--ion-color-dark);\r\n}\r\n\r\nion-button {\r\n  margin-top: 30px;\r\n  height: 54px;\r\n  font-size: 18px;\r\n  text-transform: none;\r\n  --background: var(--ion-color-primary);\r\n  --box-shadow: 0 4px 10px rgba(132, 176, 162, 0.3);\r\n  --border-radius: 27px;\r\n}\r\n\r\n.login-link {\r\n  margin-top: 20px;\r\n  color: var(--ion-color-secondary);\r\n  font-size: 16px;\r\n  text-decoration: none;\r\n  text-align: center;\r\n  display: block;\r\n  \r\n  &:hover {\r\n    text-decoration: underline;\r\n    color: var(--ion-color-tertiary);\r\n  }\r\n}\r\n\r\n@media (max-width: 576px) {\r\n  h1 {\r\n    font-size: 2rem;\r\n  }\r\n\r\n  h2 {\r\n    font-size: 24px;\r\n    margin-bottom: 25px;\r\n    color: var(--ion-color-secondary);\r\n  }\r\n  \r\n  ion-button {\r\n    font-size: 16px;\r\n    height: 50px;\r\n  }\r\n}\r\n\r\n// Animaciones\r\n@keyframes fadeInUp {\r\n  from {\r\n    opacity: 0;\r\n    transform: translate3d(0, 30px, 0);\r\n  }\r\n  to {\r\n    opacity: 1;\r\n    transform: translate3d(0, 0, 0);\r\n  }\r\n}\r\n\r\n.register-container > * {\r\n  animation: fadeInUp 0.5s ease-out;\r\n  animation-fill-mode: both;\r\n}\r\n\r\n.register-container > *:nth-child(1) { animation-delay: 0.1s; }\r\n.register-container > *:nth-child(2) { animation-delay: 0.2s; }\r\n.register-container > *:nth-child(3) { animation-delay: 0.3s; }\r\n.register-container > *:nth-child(4) { animation-delay: 0.4s; }\r\n.register-container > *:nth-child(5) { animation-delay: 0.5s; }",
        "register.page.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { RegisterPage } from './register.page';\r\nimport { FormBuilder, ReactiveFormsModule } from '@angular/forms';\r\nimport { IonicModule, ToastController, LoadingController, NavController, Platform } from '@ionic/angular';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { Router } from '@angular/router';\r\nimport { of, EMPTY } from 'rxjs';\r\n\r\ndescribe('RegisterPage', () => {\r\n  let component: RegisterPage;\r\n  let fixture: ComponentFixture<RegisterPage>;\r\n  let databaseServiceSpy: jasmine.SpyObj<DatabaseService>;\r\n  let toastControllerSpy: jasmine.SpyObj<ToastController>;\r\n  let loadingControllerSpy: jasmine.SpyObj<LoadingController>;\r\n  let routerSpy: jasmine.SpyObj<Router>;\r\n  let navControllerSpy: jasmine.SpyObj<NavController>;\r\n  let platformSpy: jasmine.SpyObj<Platform>;\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', ['getUserByEmail', 'createUser']);\r\n    const toastSpy = jasmine.createSpyObj('ToastController', ['create']);\r\n    const loadingSpy = jasmine.createSpyObj('LoadingController', ['create']);\r\n    const routerSpyObj = jasmine.createSpyObj('Router', ['navigate']);\r\n    const navSpy = jasmine.createSpyObj('NavController', ['navigateForward', 'navigateRoot']);\r\n    const platSpy = jasmine.createSpyObj('Platform', ['is', 'ready']);\r\n    \r\n    platSpy.ready.and.returnValue(Promise.resolve());\r\n    platSpy.is.and.returnValue(true);\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [ RegisterPage ],\r\n      imports: [ \r\n        IonicModule.forRoot(),\r\n        ReactiveFormsModule\r\n      ],\r\n      providers: [\r\n        FormBuilder,\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { provide: ToastController, useValue: toastSpy },\r\n        { provide: LoadingController, useValue: loadingSpy },\r\n        { provide: Router, useValue: routerSpyObj },\r\n        { provide: NavController, useValue: navSpy },\r\n        { provide: Platform, useValue: platSpy }\r\n      ]\r\n    }).compileComponents();\r\n\r\n    databaseServiceSpy = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    toastControllerSpy = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n    loadingControllerSpy = TestBed.inject(LoadingController) as jasmine.SpyObj<LoadingController>;\r\n    routerSpy = TestBed.inject(Router) as jasmine.SpyObj<Router>;\r\n    navControllerSpy = TestBed.inject(NavController) as jasmine.SpyObj<NavController>;\r\n    platformSpy = TestBed.inject(Platform) as jasmine.SpyObj<Platform>;\r\n\r\n    fixture = TestBed.createComponent(RegisterPage);\r\n    component = fixture.componentInstance;\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  it('should initialize with invalid form', () => {\r\n    expect(component.registerForm.valid).toBeFalsy();\r\n  });\r\n\r\n  it('should validate password requirements', () => {\r\n    const passwordControl = component.registerForm.controls['password'];\r\n    \r\n    passwordControl.setValue('weak');\r\n    expect(passwordControl.errors?.['invalidPassword']).toBeTruthy();\r\n    \r\n    passwordControl.setValue('StrongPass123!');\r\n    expect(passwordControl.errors).toBeNull();\r\n  });\r\n\r\n  it('should validate password match', () => {\r\n    const password = component.registerForm.controls['password'];\r\n    const confirmPassword = component.registerForm.controls['confirmPassword'];\r\n    \r\n    password.setValue('StrongPass123!');\r\n    confirmPassword.setValue('DifferentPass123!');\r\n    \r\n    expect(component.registerForm.errors?.['passwordMismatch']).toBeTruthy();\r\n    \r\n    confirmPassword.setValue('StrongPass123!');\r\n    expect(component.registerForm.errors?.['passwordMismatch']).toBeFalsy();\r\n  });\r\n\r\n  it('should handle successful registration', async () => {\r\n    const mockLoadingElement = {\r\n      present: jasmine.createSpy('present'),\r\n      dismiss: jasmine.createSpy('dismiss'),\r\n      onDidDismiss: jasmine.createSpy('onDidDismiss'),\r\n      addEventListener: jasmine.createSpy('addEventListener'),\r\n      removeEventListener: jasmine.createSpy('removeEventListener'),\r\n      dispatchEvent: jasmine.createSpy('dispatchEvent'),\r\n      componentOnReady: jasmine.createSpy('componentOnReady')\r\n    };\r\n\r\n    const mockToastElement = {\r\n      present: jasmine.createSpy('present'),\r\n      dismiss: jasmine.createSpy('dismiss'),\r\n      onDidDismiss: jasmine.createSpy('onDidDismiss'),\r\n      addEventListener: jasmine.createSpy('addEventListener'),\r\n      removeEventListener: jasmine.createSpy('removeEventListener'),\r\n      dispatchEvent: jasmine.createSpy('dispatchEvent'),\r\n      componentOnReady: jasmine.createSpy('componentOnReady')\r\n    };\r\n    \r\n    loadingControllerSpy.create.and.returnValue(Promise.resolve(mockLoadingElement as any));\r\n    toastControllerSpy.create.and.returnValue(Promise.resolve(mockToastElement as any));\r\n    \r\n    databaseServiceSpy.getUserByEmail.and.returnValue(of(null));\r\n    databaseServiceSpy.createUser.and.returnValue(Promise.resolve(1));\r\n\r\n    component.registerForm.setValue({\r\n      name: 'Test User',\r\n      email: 'test@example.com',\r\n      password: 'StrongPass123!',\r\n      confirmPassword: 'StrongPass123!'\r\n    });\r\n\r\n    await component.onSubmit();\r\n\r\n    expect(databaseServiceSpy.createUser).toHaveBeenCalled();\r\n    expect(routerSpy.navigate).toHaveBeenCalledWith(['/login']);\r\n    expect(mockLoadingElement.dismiss).toHaveBeenCalled();\r\n  });\r\n});",
        "register.page.ts": "import { Component, OnDestroy } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { ToastController, LoadingController } from '@ionic/angular';\r\nimport { User } from '../models/user.model';\r\nimport { Subscription, Observable, from } from 'rxjs';\r\nimport { mergeMap, map } from 'rxjs/operators';\r\nimport { firstValueFrom } from 'rxjs';\r\nimport { AbstractControl, FormBuilder, FormGroup, Validators } from '@angular/forms';\r\n@Component({\r\n  selector: 'app-register',\r\n  templateUrl: './register.page.html',\r\n  styleUrls: ['./register.page.scss'],\r\n})\r\nexport class RegisterPage implements OnDestroy {\r\n  showToast: boolean = false;\r\n  toastMessage: string = '';\r\n  name: string = '';\r\n  email: string = '';\r\n  password: string = '';\r\n  confirmPassword: string = '';\r\n  registerForm: FormGroup;\r\n\r\n  private subscriptions: Subscription = new Subscription();\r\n\r\n  constructor(\r\n    private router: Router,\r\n    private databaseService: DatabaseService,\r\n    private toastController: ToastController,\r\n    private loadingController: LoadingController,\r\n    private formBuilder: FormBuilder\r\n  ) {\r\n    this.registerForm = this.formBuilder.group({\r\n      name: ['', [Validators.required, Validators.minLength(3)]],\r\n      email: ['', [Validators.required, Validators.email]],\r\n      password: ['', [Validators.required, Validators.minLength(6), this.passwordValidator]],\r\n      confirmPassword: ['', [Validators.required]]\r\n    }, { validator: this.passwordMatchValidator });\r\n  }\r\n\r\n  passwordValidator(control: AbstractControl): { [key: string]: boolean } | null {\r\n    const password = control.value;\r\n    const hasSpecialChar = /[!@#$%^&*(),.?\":{}|<>]/.test(password);\r\n    const hasUpperCase = /[A-Z]/.test(password);\r\n    const hasLowerCase = /[a-z]/.test(password);\r\n    const hasNumber = /\\d/.test(password);\r\n    \r\n    if (!hasSpecialChar || !hasUpperCase || !hasLowerCase || !hasNumber) {\r\n      return { 'invalidPassword': true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  passwordMatchValidator(control: AbstractControl): { [key: string]: boolean } | null {\r\n    const password = control.get('password');\r\n    const confirmPassword = control.get('confirmPassword');\r\n    if (password && confirmPassword && password.value !== confirmPassword.value) {\r\n      return { 'passwordMismatch': true };\r\n    }\r\n    return null;\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscriptions.unsubscribe();\r\n  }\r\n\r\n  async onSubmit() {\r\n    console.log('Iniciando proceso de registro');\r\n    if (this.registerForm.invalid) {\r\n      console.log('Formulario inválido');\r\n      await this.presentToast('Por favor, complete todos los campos correctamente.');\r\n      return;\r\n    }\r\n  \r\n    const loading = await this.loadingController.create({\r\n      message: 'Registrando usuario...',\r\n    });\r\n    await loading.present();\r\n  \r\n    try {\r\n      console.log('Verificando usuario existente');\r\n      const existingUser = await firstValueFrom(this.databaseService.getUserByEmail(this.registerForm.get('email')?.value));\r\n      if (existingUser) {\r\n        console.log('Usuario ya existe');\r\n        await this.presentToast('El email ya está registrado. Por favor, use otro.');\r\n        return;\r\n      }\r\n  \r\n      console.log('Creando nuevo usuario');\r\n      const newUser: User = {\r\n        Name: this.registerForm.get('name')?.value,\r\n        Email: this.registerForm.get('email')?.value,\r\n        Password: this.registerForm.get('password')?.value,\r\n        Role: 'employee',\r\n        Username: this.registerForm.get('email')?.value,\r\n        ApprovalStatus: 'pending'\r\n      };\r\n      \r\n      console.log('Llamando a createUser');\r\n      const userId = await this.databaseService.createUser(newUser);\r\n      console.log('Usuario creado con ID:', userId);\r\n      if (userId) {\r\n        console.log('Registro exitoso');\r\n        await this.presentToast('Registro exitoso. Por favor, espere la aprobación del administrador.');\r\n        this.router.navigate(['/login']);\r\n      } else {\r\n        console.log('Fallo en la creación del usuario');\r\n        throw new Error('Failed to create user');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error durante el registro:', error);\r\n      await this.presentToast('Ocurrió un error durante el registro. Por favor, intente de nuevo.');\r\n    } finally {\r\n      console.log('Proceso de registro finalizado');\r\n      await loading.dismiss();\r\n    }\r\n  }\r\n  private isFormValid(): boolean {\r\n    return !!(this.name && this.email && this.password && this.confirmPassword);\r\n  }\r\n\r\n  private getUserByEmail(email: string): Promise<User | null> {\r\n    const result = this.databaseService.getUserByEmail(email);\r\n    \r\n    if (result instanceof Observable) {\r\n      return result.toPromise().then(res => res !== undefined ? res : null);\r\n    }\r\n  \r\n    return Promise.resolve(result !== undefined ? result : null);\r\n  }\r\n\r\n  private async createUser(user: User): Promise<number | undefined> {\r\n    try {\r\n      const result = await this.databaseService.createUser(user);\r\n      // Si el resultado es null, lo convertimos a undefined\r\n      return result !== null ? result : undefined;\r\n    } catch (error) {\r\n      console.error('Error creating user:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async presentToast(message: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'top'\r\n    });\r\n    await toast.present();\r\n  }\r\n}"
      },
      "schedule-meeting": {
        "schedule-meeting-routing.module.ts": "import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ScheduleMeetingPage } from './schedule-meeting.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ScheduleMeetingPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class ScheduleMeetingPageRoutingModule {}\r\n",
        "schedule-meeting.module.ts": "import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { ScheduleMeetingPageRoutingModule } from './schedule-meeting-routing.module';\r\n\r\nimport { ScheduleMeetingPage } from './schedule-meeting.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ScheduleMeetingPageRoutingModule\r\n  ],\r\n  declarations: [ScheduleMeetingPage]\r\n})\r\nexport class ScheduleMeetingPageModule {}\r\n",
        "schedule-meeting.page.html": "<ion-header>\r\n  <script type=\"text/javascript\" src=\"https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\"></script>\r\n  <ion-toolbar>\r\n    <ion-buttons slot=\"start\">\r\n      <ion-back-button></ion-back-button>\r\n    </ion-buttons>\r\n    <ion-title>Programar Reunión</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n\r\n<ion-content class=\"ion-padding\">\r\n  <form (ngSubmit)=\"scheduleMeeting($event)\" #meetingForm=\"ngForm\">\r\n    \r\n    <!-- Título de la reunión -->\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Título de la reunión</ion-label>\r\n      <ion-input [(ngModel)]=\"meeting.title\" name=\"title\" required></ion-input>\r\n    </ion-item>\r\n\r\n    <!-- Fecha y hora de la reunión (combinados en un solo campo) -->\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Fecha y hora</ion-label>\r\n      <ion-datetime\r\n        [(ngModel)]=\"meeting.datetime\"\r\n        name=\"datetime\"\r\n        displayFormat=\"DD/MM/YYYY HH:mm\"\r\n        min=\"{{ currentDate }}\"\r\n        presentation=\"date-time\"\r\n        required>\r\n      </ion-datetime>\r\n    </ion-item>\r\n\r\n    <!-- Descripción de la reunión -->\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Descripción</ion-label>\r\n      <ion-textarea [(ngModel)]=\"meeting.description\" name=\"description\" rows=\"3\"></ion-textarea>\r\n    </ion-item>\r\n\r\n    <!-- Correos de los participantes (selección de usuarios registrados) -->\r\n    <ion-item>\r\n      <ion-label position=\"floating\">Participantes</ion-label>\r\n      <ion-select multiple=\"true\" [(ngModel)]=\"meeting.participants\" name=\"participants\">\r\n        <ion-select-option *ngFor=\"let user of users\" [value]=\"user.Email\">{{ user.Name }} ({{ user.Email }})</ion-select-option>\r\n      </ion-select>\r\n    </ion-item>\r\n\r\n    <!-- Botón para programar la reunión -->\r\n    <ion-button expand=\"block\" type=\"submit\" [disabled]=\"!meetingForm.form.valid\" class=\"ion-margin-top\">\r\n      Programar Reunión\r\n    </ion-button>\r\n  </form>\r\n</ion-content>",
        "schedule-meeting.page.scss": ":host {\r\n    --ion-color-primary: #84B0A2;\r\n    --ion-color-secondary: #D4A082;\r\n    --ion-color-tertiary: #ECC9A3;\r\n    --ion-color-success: #2dd36f;\r\n    --ion-color-warning: #ffc409;\r\n    --ion-color-danger: #eb445a;\r\n    --ion-color-medium: #92949c;\r\n    --ion-color-light: #D4E7EE;\r\n    --ion-color-dark: #405770;\r\n  }\r\n  \r\n  ion-content {\r\n    --background: var(--ion-color-light);\r\n  }\r\n  \r\n  form {\r\n    background-color: #ffffff;\r\n    border-radius: 10px;\r\n    padding: 20px;\r\n    margin-top: 20px;\r\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  }\r\n  \r\n  ion-item {\r\n    --background: transparent;\r\n    --border-color: var(--ion-color-medium);\r\n    --highlight-height: 1px;\r\n    --highlight-color-focused: var(--ion-color-primary);\r\n    margin-bottom: 16px;\r\n  \r\n    &:last-child {\r\n      margin-bottom: 0;\r\n    }\r\n  }\r\n  \r\n  ion-label {\r\n    color: var(--ion-color-dark);\r\n    font-weight: 500;\r\n  }\r\n  \r\n  ion-input, ion-textarea, ion-datetime {\r\n    --padding-start: 0;\r\n    font-size: 16px;\r\n    color: var(--ion-color-dark);\r\n  }\r\n  \r\n  ion-button {\r\n    --background: var(--ion-color-primary);\r\n    --background-hover: var(--ion-color-primary-shade);\r\n    --color: #ffffff;\r\n    --border-radius: 8px;\r\n    margin-top: 24px;\r\n    font-weight: 600;\r\n    text-transform: uppercase;\r\n    letter-spacing: 0.5px;\r\n  }\r\n  \r\n  // Animaciones\r\n  @keyframes fadeIn {\r\n    from { opacity: 0; transform: translateY(20px); }\r\n    to { opacity: 1; transform: translateY(0); }\r\n  }\r\n  \r\n  form {\r\n    animation: fadeIn 0.3s ease-out;\r\n  }\r\n  \r\n  // Estilos responsivos\r\n  @media (max-width: 576px) {\r\n    form {\r\n      padding: 16px;\r\n    }\r\n  \r\n    ion-input, ion-textarea, ion-datetime {\r\n      font-size: 14px;\r\n    }\r\n  \r\n    ion-button {\r\n      font-size: 14px;\r\n    }\r\n  }",
        "schedule-meeting.page.spec.ts": "import { ComponentFixture, TestBed } from '@angular/core/testing';\r\nimport { IonicModule, ToastController } from '@ionic/angular';\r\nimport { ScheduleMeetingPage } from './schedule-meeting.page';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { SQLite } from '@awesome-cordova-plugins/sqlite/ngx';\r\nimport { of } from 'rxjs';\r\nimport { User } from '../models/user.model';\r\nimport { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\ndescribe('ScheduleMeetingPage', () => {\r\n  let component: ScheduleMeetingPage;\r\n  let fixture: ComponentFixture<ScheduleMeetingPage>;\r\n  let databaseServiceSpy: jasmine.SpyObj<DatabaseService>;\r\n  let toastControllerSpy: jasmine.SpyObj<ToastController>;\r\n\r\n  const mockUsers: User[] = [\r\n    {\r\n      UserID: 1,\r\n      Username: 'user1',\r\n      Password: 'password123',\r\n      Email: 'user1@test.com',\r\n      Role: 'employee',\r\n      Name: 'User One',\r\n      ApprovalStatus: 'approved',\r\n      PhoneNumber: '1234567890',\r\n      HireDate: new Date(),\r\n      LastLogin: new Date(),\r\n      ProfilePicture: null\r\n    },\r\n    {\r\n      UserID: 2,\r\n      Username: 'user2',\r\n      Password: 'password123',\r\n      Email: 'user2@test.com',\r\n      Role: 'employee',\r\n      Name: 'User Two',\r\n      ApprovalStatus: 'approved',\r\n      PhoneNumber: '0987654321',\r\n      HireDate: new Date(),\r\n      LastLogin: new Date(),\r\n      ProfilePicture: null\r\n    }\r\n  ];\r\n\r\n  beforeEach(async () => {\r\n    const dbSpy = jasmine.createSpyObj('DatabaseService', {\r\n      getAllUsers: of(mockUsers)\r\n    });\r\n\r\n    const mockToast = {\r\n      present: jasmine.createSpy('present').and.returnValue(Promise.resolve())\r\n    };\r\n\r\n    await TestBed.configureTestingModule({\r\n      declarations: [ScheduleMeetingPage],\r\n      imports: [\r\n        IonicModule.forRoot(),\r\n        FormsModule\r\n      ],\r\n      providers: [\r\n        { provide: DatabaseService, useValue: dbSpy },\r\n        { \r\n          provide: ToastController, \r\n          useValue: { \r\n            create: () => Promise.resolve(mockToast) \r\n          }\r\n        },\r\n        { provide: SQLite, useValue: {} }\r\n      ],\r\n      schemas: [CUSTOM_ELEMENTS_SCHEMA]\r\n    }).compileComponents();\r\n\r\n    fixture = TestBed.createComponent(ScheduleMeetingPage);\r\n    component = fixture.componentInstance;\r\n    databaseServiceSpy = TestBed.inject(DatabaseService) as jasmine.SpyObj<DatabaseService>;\r\n    toastControllerSpy = TestBed.inject(ToastController) as jasmine.SpyObj<ToastController>;\r\n\r\n    fixture.detectChanges();\r\n  });\r\n\r\n  // Prueba 1: Creación del componente\r\n  it('should create', () => {\r\n    expect(component).toBeTruthy();\r\n  });\r\n\r\n  // Prueba 2: Inicialización de datos\r\n  it('should initialize with empty meeting form', () => {\r\n    expect(component.meeting).toEqual({\r\n      title: '',\r\n      datetime: '',\r\n      description: '',\r\n      participants: []\r\n    });\r\n    expect(component.currentDate).toBeTruthy();\r\n  });\r\n\r\n  // Prueba 3: Carga de usuarios\r\n  it('should load users on init', () => {\r\n    component.ngOnInit();\r\n    expect(component.users).toEqual(mockUsers);\r\n  });\r\n\r\n  // Prueba 4: Reset del formulario\r\n  it('should reset form correctly', () => {\r\n    component.meeting = {\r\n      title: 'Test Meeting',\r\n      datetime: '2024-01-01',\r\n      description: 'Test Description',\r\n      participants: ['user1@test.com']\r\n    };\r\n\r\n    component.resetForm();\r\n\r\n    expect(component.meeting).toEqual({\r\n      title: '',\r\n      datetime: '',\r\n      description: '',\r\n      participants: []\r\n    });\r\n  });\r\n\r\n  // Prueba 5: Prevención de reunión sin participantes\r\n  it('should prevent scheduling meeting without participants', async () => {\r\n    const event = new Event('submit');\r\n    spyOn(event, 'preventDefault');\r\n    \r\n    await component.scheduleMeeting(event);\r\n\r\n    expect(event.preventDefault).toHaveBeenCalled();\r\n  });\r\n\r\n  // Pruebas adicionales\r\n  it('should show toast message correctly', async () => {\r\n    const message = 'Test message';\r\n    const color = 'success';\r\n    const mockToast = { present: jasmine.createSpy('present') };\r\n    \r\n    toastControllerSpy.create = jasmine.createSpy().and.returnValue(Promise.resolve(mockToast));\r\n\r\n    await component.presentToast(message, color);\r\n\r\n    expect(toastControllerSpy.create).toHaveBeenCalledWith({\r\n      message,\r\n      duration: 2000,\r\n      color\r\n    });\r\n    expect(mockToast.present).toHaveBeenCalled();\r\n  });\r\n\r\n  it('should validate meeting datetime', () => {\r\n    const currentDate = new Date();\r\n    const componentDate = new Date(component.currentDate);\r\n    expect(componentDate.getTime()).toBeLessThanOrEqual(currentDate.getTime());\r\n  });\r\n});",
        "schedule-meeting.page.ts": "import { Component } from '@angular/core';\r\nimport { ToastController } from '@ionic/angular';\r\nimport { DatabaseService } from '../services/database.service';\r\nimport { EmailService } from '../services/email.service';\r\nimport { User } from '../models/user.model';\r\nimport { firstValueFrom } from 'rxjs';\r\nimport emailjs from '@emailjs/browser';\r\ninterface EmailResult {\r\n  messageId: string;\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\n@Component({\r\n  selector: 'app-schedule-meeting',\r\n  templateUrl: './schedule-meeting.page.html',\r\n  styleUrls: ['./schedule-meeting.page.scss'],\r\n})\r\nexport class ScheduleMeetingPage {\r\n  meeting = {\r\n    title: '',\r\n    datetime: '',\r\n    description: '',\r\n    participants: [] as string[]\r\n  };\r\n\r\n  users: User[] = [];\r\n  currentDate: string;\r\n\r\n  constructor(\r\n    private toastController: ToastController, \r\n    private databaseService: DatabaseService,\r\n    private emailService: EmailService\r\n  ) {\r\n    this.currentDate = new Date().toISOString();\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.databaseService.getAllUsers().subscribe(\r\n      users => this.users = users,\r\n      error => console.error('Error al cargar los usuarios:', error)\r\n    );\r\n  }\r\n\r\n  async scheduleMeeting(e: Event) {\r\n    e.preventDefault();\r\n\r\n    if (this.meeting.participants.length === 0) {\r\n      await this.presentToast('Debes seleccionar al menos un participante.', 'warning');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Enviar correo a cada participante\r\n      for (const participantEmail of this.meeting.participants) {\r\n        const templateParams = {\r\n          to_email: participantEmail,\r\n          meeting_title: this.meeting.title,\r\n          meeting_datetime: new Date(this.meeting.datetime).toLocaleString(),\r\n          meeting_description: this.meeting.description,\r\n          from_name: \"CaffeManagement\"\r\n        };\r\n\r\n        try {\r\n          const response = await emailjs.send(\r\n            'service_ilwn599',\r\n            'template_okp70bp',\r\n            templateParams,\r\n            'DKpjvXERVCYX9x65l'\r\n          );\r\n\r\n          if (!response) {\r\n            throw new Error(`Error al enviar correo a ${participantEmail}`);\r\n          }\r\n        } catch (emailError) {\r\n          console.error('Error al enviar email:', emailError);\r\n          throw new Error(`Error al enviar correo a ${participantEmail}: ${emailError}`);\r\n        }\r\n      }\r\n\r\n      await this.presentToast('Reunión programada y correos enviados con éxito', 'success');\r\n      this.resetForm();\r\n    } catch (error) {\r\n      console.error('Error al programar la reunión:', error);\r\n      await this.presentToast(\r\n        'Error al programar la reunión. Por favor, intente de nuevo.', \r\n        'danger'\r\n      );\r\n    }\r\n  }\r\n\r\n  resetForm() {\r\n    this.meeting = {\r\n      title: '',\r\n      datetime: '',\r\n      description: '',\r\n      participants: []\r\n    };\r\n  }\r\n\r\n  async presentToast(message: string, color: string) {\r\n    const toast = await this.toastController.create({\r\n      message: message,\r\n      duration: 2000,\r\n      position: 'top',\r\n      color: color\r\n    });\r\n    await toast.present();\r\n  }\r\n}"
      },
      "services": {
        "database.service.spec.ts": "",
        "database.service.ts": "import { Injectable } from '@angular/core';\r\nimport { SQLite, SQLiteObject } from '@awesome-cordova-plugins/sqlite/ngx';\r\nimport { AlertController, Platform } from '@ionic/angular';\r\nimport { BehaviorSubject, Observable, from,throwError } from 'rxjs';\r\nimport { map, catchError, switchMap } from 'rxjs/operators';\r\nimport { User } from '../models/user.model';\r\nimport { of, firstValueFrom, forkJoin } from 'rxjs';\r\nimport { Product } from '../models/product.model';\r\nimport { Order } from '../models/order.model';\r\nimport { OrderDetail } from '../models/order-detail.model';\r\nimport { Plugins } from '@capacitor/core';\r\nimport { Filesystem, Directory } from '@capacitor/filesystem';\r\nconst { Console } = Plugins;\r\n\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class DatabaseService {\r\n  private database!: SQLiteObject;\r\n  private dbReady: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n\r\n  constructor(\r\n    private platform: Platform, \r\n    private sqlite: SQLite,\r\n    private alertController: AlertController\r\n  ) {\r\n    this.platform.ready().then(() => {\r\n      this.initializeDatabase();\r\n    });\r\n  }\r\n\r\n  async initializeDatabase() {\r\n    try {\r\n      this.database = await this.sqlite.create({\r\n        name: 'cafeteria.db',\r\n        location: 'default'\r\n      });\r\n\r\n      await this.createTablesIfNotExist();\r\n      await this.insertSeedDataIfEmpty();\r\n      this.dbReady.next(true);\r\n    } catch (error) {\r\n      console.error('Error initializing database', error);\r\n      this.presentAlert('Error', 'Failed to initialize the database. Please try again.');\r\n    }\r\n  }\r\n\r\n  async createTablesIfNotExist() {\r\n    const tables = [this.tableUsers, this.tableProducts, this.tableOrders, this.tableOrderDetails, this.tableSalesReports];\r\n    for (const table of tables) {\r\n      await this.database.executeSql(table, []);\r\n    }\r\n  }\r\n\r\n  async getUserCount(): Promise<number> {\r\n    const result = await this.database.executeSql('SELECT COUNT(*) as count FROM Users', []);\r\n    return result.rows.item(0).count;\r\n  }\r\n\r\n  async insertSeedDataIfEmpty() {\r\n    const userCount = await this.getUserCount();\r\n    if (userCount === 0) {\r\n      await firstValueFrom(this.insertSeedData());\r\n    }\r\n  }\r\n\r\n  // Tablas\r\n  tableUsers: string = `\r\n  CREATE TABLE IF NOT EXISTS Users (\r\n    UserID INTEGER PRIMARY KEY AUTOINCREMENT,\r\n    Username TEXT NOT NULL UNIQUE,\r\n    Password TEXT NOT NULL,\r\n    Role TEXT NOT NULL CHECK (Role IN ('employee', 'admin', 'manager')),\r\n    Name TEXT NOT NULL,\r\n    Email TEXT UNIQUE,\r\n    PhoneNumber TEXT,\r\n    HireDate DATE,\r\n    LastLogin DATETIME,\r\n    ApprovalStatus TEXT NOT NULL CHECK (ApprovalStatus IN ('pending', 'approved', 'rejected')),\r\n    ProfilePicture TEXT\r\n  );`;\r\n\r\n  tableProducts: string = `\r\n  CREATE TABLE IF NOT EXISTS Products (\r\n    ProductID INTEGER PRIMARY KEY AUTOINCREMENT,\r\n    Name TEXT NOT NULL UNIQUE,\r\n    Description TEXT,\r\n    Price REAL NOT NULL,\r\n    Category TEXT NOT NULL,\r\n    ImageURL TEXT,\r\n    IsAvailable BOOLEAN DEFAULT 1,\r\n    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n    UpdatedAt DATETIME DEFAULT CURRENT_TIMESTAMP\r\n  );`;\r\n\r\n  tableOrders: string = `\r\n    CREATE TABLE IF NOT EXISTS Orders (\r\n      OrderID INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      UserID INTEGER,\r\n      TableNumber INTEGER,\r\n      Status TEXT NOT NULL CHECK (Status IN ('Solicitado', 'En proceso', 'Listo', 'Cancelado', 'Entregado')),\r\n      CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      UpdatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n      Notes TEXT,\r\n      TotalAmount REAL NOT NULL,\r\n      PaymentMethod TEXT,\r\n      FOREIGN KEY (UserID) REFERENCES Users(UserID)\r\n    );`;\r\n\r\n  tableOrderDetails: string = `\r\n    CREATE TABLE IF NOT EXISTS OrderDetails (\r\n      OrderDetailID INTEGER PRIMARY KEY AUTOINCREMENT,\r\n      OrderID INTEGER,\r\n      ProductID INTEGER,\r\n      Quantity INTEGER NOT NULL,\r\n      Size TEXT,\r\n      MilkType TEXT,\r\n      Price REAL NOT NULL,\r\n      FOREIGN KEY (OrderID) REFERENCES Orders(OrderID),\r\n      FOREIGN KEY (ProductID) REFERENCES Products(ProductID)\r\n    );`;\r\n\r\n  tableSalesReports: string = `\r\n    CREATE TABLE IF NOT EXISTS SalesReports (\r\n    ReportID INTEGER PRIMARY KEY AUTOINCREMENT,\r\n    StartDate DATE NOT NULL,\r\n    EndDate DATE NOT NULL,\r\n    TotalSales REAL NOT NULL,\r\n    TotalOrders INTEGER NOT NULL,\r\n    CanceledOrders INTEGER NOT NULL,\r\n    CanceledSales REAL NOT NULL,\r\n    TopSellingProducts TEXT NOT NULL,\r\n    DailySales TEXT NOT NULL,\r\n    GeneratedBy INTEGER,\r\n    CreatedAt DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n    FOREIGN KEY (GeneratedBy) REFERENCES Users(UserID)\r\n    );`;\r\n\r\n  // BehaviorSubjects para los listados\r\n  private users = new BehaviorSubject<User[]>([]);\r\n  private products = new BehaviorSubject<Product[]>([]);\r\n  private orders = new BehaviorSubject<Order[]>([]);\r\n\r\n  // Observable para el estado de la base de datos\r\n  private isDBReady: BehaviorSubject<boolean> = new BehaviorSubject(false);\r\n  \r\n\r\n  async presentAlert(titulo: string, msj: string) {\r\n    const alert = await this.alertController.create({\r\n      header: titulo,\r\n      message: msj,\r\n      buttons: ['OK'],\r\n    });\r\n    await alert.present();\r\n  }\r\n\r\n  // Observables\r\n  dbState() {\r\n    return this.isDBReady.asObservable();\r\n  }\r\n\r\n  fetchUsers(): Observable<User[]> {\r\n    return this.users.asObservable();\r\n  }\r\n\r\n  fetchProducts(): Observable<Product[]> {\r\n    return this.products.asObservable();\r\n  }\r\n\r\n  fetchOrders(): Observable<Order[]> {\r\n    return this.orders.asObservable();\r\n  }\r\n\r\n  async createTables() {\r\n    try {\r\n      await this.database.executeSql('DROP TABLE IF EXISTS Users', []);\r\n      await this.database.executeSql('DROP TABLE IF EXISTS Products', []);\r\n      await this.database.executeSql('DROP TABLE IF EXISTS Orders', []);\r\n      await this.database.executeSql('DROP TABLE IF EXISTS OrderDetails', []);\r\n      await this.database.executeSql('DROP TABLE IF EXISTS SalesReports', []);\r\n  \r\n      await this.database.executeSql(this.tableUsers, []);\r\n      await this.database.executeSql(this.tableProducts, []);\r\n      await this.database.executeSql(this.tableOrders, []);\r\n      await this.database.executeSql(this.tableOrderDetails, []);\r\n      await this.database.executeSql(this.tableSalesReports, []);\r\n  \r\n      await this.insertSeedData().toPromise();\r\n  \r\n      this.loadInitialData();\r\n      this.isDBReady.next(true);\r\n    } catch (e) {\r\n      this.presentAlert('Creación de Tablas', 'Error al crear las tablas: ' + JSON.stringify(e));\r\n    }\r\n  }\r\n\r\n  // Cargar datos iniciales\r\n  loadInitialData() {\r\n    forkJoin([\r\n      this.getAllUsers(),\r\n      this.getAllProducts(),\r\n      this.getOrdersByStatus(['Solicitado', 'En proceso', 'Listo'])\r\n    ]).subscribe({\r\n      next: ([users, products, orders]) => {\r\n        this.users.next(users);\r\n        this.products.next(products);\r\n        this.orders.next(orders);\r\n        console.log('Initial data loaded successfully');\r\n      },\r\n      error: error => console.error('Error loading initial data:', error)\r\n    });\r\n  }\r\n\r\n  // Métodos CRUD para Users\r\n  async createUser(user: User): Promise<number | null> {\r\n    console.log('Iniciando creación de usuario en la base de datos');\r\n    try {\r\n      const result = await this.database.executeSql(\r\n        'INSERT INTO Users (Username, Password, Role, Name, Email, ApprovalStatus) VALUES (?, ?, ?, ?, ?, ?)',\r\n        [user.Username, user.Password, user.Role, user.Name, user.Email, user.ApprovalStatus]\r\n      );\r\n      console.log('Usuario insertado con éxito, ID:', result.insertId);\r\n      return result.insertId;\r\n    } catch (error: unknown) {\r\n      console.error('Error al crear usuario:', error);\r\n      if (error instanceof Error && error.message.includes('UNIQUE constraint failed: Users.Email')) {\r\n        console.log('Error de email duplicado');\r\n        return null;\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  getAllUsers(): Observable<User[]> {\r\n    return from(this.database.executeSql('SELECT * FROM Users', [])).pipe(\r\n      map(data => {\r\n        console.log('Resultado de la consulta SQL:', data);\r\n        let users: User[] = [];\r\n        for (let i = 0; i < data.rows.length; i++) {\r\n          const row = data.rows.item(i);\r\n          users.push({\r\n            UserID: row.UserID,\r\n            Username: row.Username,\r\n            Password: '', // No devolvemos la contraseña real por seguridad\r\n            Role: row.Role as 'employee' | 'admin' | 'manager',\r\n            Name: row.Name,\r\n            Email: row.Email,\r\n            PhoneNumber: row.PhoneNumber,\r\n            HireDate: row.HireDate ? new Date(row.HireDate) : undefined,\r\n            LastLogin: row.LastLogin ? new Date(row.LastLogin) : undefined,\r\n            ApprovalStatus: row.ApprovalStatus as 'pending' | 'approved' | 'rejected',\r\n            ProfilePicture: row.ProfilePicture || undefined\r\n          });\r\n        }\r\n        console.log('Usuarios procesados:', users);\r\n        return users;\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error en getAllUsers:', error);\r\n        return throwError(() => new Error('Error al obtener usuarios: ' + error.message));\r\n      })\r\n    );\r\n  }\r\n\r\n  getPendingUsers(): Observable<User[]> {\r\n    return from(this.database.executeSql('SELECT * FROM Users WHERE ApprovalStatus = ?', ['pending'])).pipe(\r\n      map(data => {\r\n        let users: User[] = [];\r\n        for (let i = 0; i < data.rows.length; i++) {\r\n          users.push(data.rows.item(i));\r\n        }\r\n        return users;\r\n      })\r\n    );\r\n  }\r\n\r\n  updateUserApprovalStatus(userId: number, status: 'approved' | 'rejected' | 'pending'): Observable<boolean> {\r\n    console.log(`Actualizando estado de aprobación para usuario ${userId} a ${status}`);\r\n    return from(this.database.executeSql(\r\n      'UPDATE Users SET ApprovalStatus = ? WHERE UserID = ?',\r\n      [status, userId]\r\n    )).pipe(\r\n      map(result => {\r\n        console.log('Resultado de la actualización:', result);\r\n        return result.rowsAffected > 0;\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error al actualizar el estado de aprobación:', error);\r\n        return of(false);\r\n      })\r\n    );\r\n  }\r\n  // Métodos CRUD para Products\r\n  async createProduct(product: Product): Promise<number> {\r\n    const data = [product.name, product.description, product.price, product.category, product.imageURL, product.isAvailable ? 1 : 0];\r\n    const result = await this.database.executeSql('INSERT INTO Products (Name, Description, Price, Category, ImageURL, IsAvailable) VALUES (?, ?, ?, ?, ?, ?)', data);\r\n    this.getAllProducts();\r\n    return result.insertId;\r\n  }\r\n\r\n  getAllProducts(): Observable<Product[]> {\r\n    console.log('Obteniendo todos los productos...');\r\n    const query = `\r\n      SELECT DISTINCT p.*\r\n      FROM Products p\r\n      LEFT JOIN (\r\n        SELECT Name, MIN(ProductID) as MinID\r\n        FROM Products\r\n        GROUP BY Name\r\n      ) p2 ON p.Name = p2.Name AND p.ProductID = p2.MinID\r\n      WHERE p2.MinID IS NOT NULL\r\n    `;\r\n    return from(this.database.executeSql(query, [])).pipe(\r\n      map(data => {\r\n        console.log('Resultado de la consulta de productos:', JSON.stringify(data));\r\n        let products: Product[] = [];\r\n        \r\n        for (let i = 0; i < data.rows.length; i++) {\r\n          let item = data.rows.item(i);\r\n          console.log('Producto individual:', JSON.stringify(item));\r\n          \r\n          const product: Product = {\r\n            id: item.ProductID,\r\n            name: item.Name,\r\n            description: item.Description,\r\n            price: item.Price,\r\n            category: item.Category,\r\n            imageURL: item.ImageURL,\r\n            isAvailable: item.IsAvailable === 1\r\n          };\r\n          products.push(product);\r\n        }\r\n        \r\n        console.log('Productos procesados:', JSON.stringify(products));\r\n        return products;\r\n      }),\r\n      catchError(error => {\r\n        console.error('Error al obtener productos:', error);\r\n        return of([]);\r\n      })\r\n    );\r\n  }\r\n\r\n  // Métodos para Orders\r\n  async createOrder(order: Order): Promise<number> {\r\n    const data = [order.userId, order.tableNumber, order.status, order.notes, order.totalAmount, order.paymentMethod];\r\n    const result = await this.database.executeSql('INSERT INTO Orders (UserID, TableNumber, Status, Notes, TotalAmount, PaymentMethod) VALUES (?, ?, ?, ?, ?, ?)', data);\r\n    this.getOrdersByStatus(['Solicitado', 'En proceso', 'Listo']);\r\n    return result.insertId;\r\n  }\r\n\r\n  getOrdersByStatus(statuses: string[]): Observable<Order[]> {\r\n    const placeholders = statuses.map(() => '?').join(',');\r\n    return from(this.database.executeSql(`SELECT * FROM Orders WHERE Status IN (${placeholders})`, statuses)).pipe(\r\n      map(data => {\r\n        let orders: Order[] = [];\r\n        for (let i = 0; i < data.rows.length; i++) {\r\n          orders.push({\r\n            ...data.rows.item(i),\r\n            id: data.rows.item(i).OrderID,\r\n            status: data.rows.item(i).Status,\r\n            tableNumber: data.rows.item(i).TableNumber\r\n          });\r\n        }\r\n        return orders;\r\n      })\r\n    );\r\n  }\r\n  \r\n  async getOrdersCount(statuses: string[], date?: string): Promise<number> {\r\n    let placeholders = statuses.map(() => '?').join(',');\r\n    let query = `SELECT COUNT(*) as count FROM Orders WHERE Status IN (${placeholders})`;\r\n    let params = [...statuses];\r\n  \r\n    if (date) {\r\n      query += ' AND DATE(CreatedAt) = ?';\r\n      params.push(date);\r\n    }\r\n  \r\n    const result = await this.database.executeSql(query, params);\r\n    return result.rows.item(0).count;\r\n  }\r\n\r\n  \r\n  // Método de autenticación\r\n  async authenticateUser(email: string, password: string): Promise<User | null> {\r\n    console.log('Intentando autenticar usuario:', email);\r\n    try {\r\n      const query = 'SELECT * FROM Users WHERE Email = ?';\r\n      const result = await this.database.executeSql(query, [email]);\r\n      console.log('Resultado de la consulta:', JSON.stringify(result));\r\n  \r\n      if (result.rows.length > 0) {\r\n        const user = result.rows.item(0);\r\n        console.log('Usuario encontrado:', JSON.stringify(user));\r\n        if (user.Password === password) {\r\n          console.log('Contraseña correcta');\r\n          if (user.ApprovalStatus === 'approved') {\r\n            console.log('Usuario aprobado');\r\n            return user;\r\n          } else {\r\n            console.log('Usuario no aprobado. Estado:', user.ApprovalStatus);\r\n            return null;\r\n          }\r\n        } else {\r\n          console.log('Contraseña incorrecta');\r\n        }\r\n      } else {\r\n        console.log('No se encontró usuario con ese email');\r\n      }\r\n      return null;\r\n    } catch (error) {\r\n      console.error('Error durante la autenticación:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n\r\n  pdateProduct(product: Product): Promise<boolean> | Observable<any> {\r\n    const data = [product.name, product.description, product.price, product.category, product.imageURL, product.isAvailable ? 1 : 0, product.id];\r\n    return from(this.database.executeSql('UPDATE Products SET Name = ?, Description = ?, Price = ?, Category = ?, ImageURL = ?, IsAvailable = ? WHERE ProductID = ?', data))\r\n      .pipe(\r\n        map(() => {\r\n          this.getAllProducts();\r\n          return true;\r\n        })\r\n      );\r\n  }\r\n\r\n  // Método para calcular ventas totales\r\n  async calculateTotalSales(startDate: string, endDate: string, statuses: string[] = ['Solicitado', 'En proceso', 'Listo', 'Entregado']): Promise<number> {\r\n    const placeholders = statuses.map(() => '?').join(',');\r\n    const query = `\r\n      SELECT SUM(TotalAmount) as TotalSales \r\n      FROM Orders \r\n      WHERE DATE(CreatedAt) BETWEEN ? AND ? \r\n      AND Status IN (${placeholders})\r\n    `;\r\n    const params = [startDate, endDate, ...statuses];\r\n    \r\n    try {\r\n      const data = await this.database.executeSql(query, params);\r\n      return data.rows.item(0).TotalSales || 0;\r\n    } catch (error) {\r\n      console.error('Error al calcular ventas totales:', error);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  // Método para obtener productos más vendidos\r\n  async getTopSellingProducts(limit: number = 5): Promise<{productId: number, name: string, totalSold: number}[]> {\r\n    const query = `\r\n      SELECT \r\n        p.ProductID as productId, \r\n        p.Name as name, \r\n        SUM(od.Quantity) as totalSold\r\n      FROM OrderDetails od\r\n      JOIN Products p ON od.ProductID = p.ProductID\r\n      JOIN Orders o ON od.OrderID = o.OrderID\r\n      WHERE o.Status != 'Cancelado'\r\n      GROUP BY od.ProductID\r\n      ORDER BY totalSold DESC\r\n      LIMIT ?\r\n    `;\r\n    const data = await this.database.executeSql(query, [limit]);\r\n    let topProducts: {productId: number, name: string, totalSold: number}[] = [];\r\n    if (data.rows.length > 0) {\r\n      for (let i = 0; i < data.rows.length; i++) {\r\n        topProducts.push(data.rows.item(i));\r\n      }\r\n    }\r\n    return topProducts;\r\n  }\r\n\r\n  addProductToOrder(orderDetail: OrderDetail): Promise<number> {\r\n    return new Promise((resolve, reject) => {\r\n      const sql = 'INSERT INTO OrderDetails (OrderID, ProductID, Quantity, Size, MilkType, Price) VALUES (?, ?, ?, ?, ?, ?)';\r\n      const values = [orderDetail.orderId, orderDetail.productId, orderDetail.quantity, orderDetail.size, orderDetail.milkType, orderDetail.price];\r\n      \r\n      this.database.executeSql(sql, values)\r\n        .then(data => {\r\n          resolve(data.insertId);\r\n        })\r\n        .catch(error => {\r\n          reject(error);\r\n        });\r\n    });\r\n  }\r\n\r\n  getOrderDetails(orderId: number): Observable<OrderDetail[]> {\r\n    return from(this.database.executeSql(`\r\n      SELECT od.*, p.Name, p.ImageURL \r\n      FROM OrderDetails od\r\n      LEFT JOIN Products p ON od.ProductID = p.ProductID\r\n      WHERE od.OrderID = ?\r\n    `, [orderId])).pipe(\r\n      map(data => {\r\n        let orderDetails: OrderDetail[] = [];\r\n        for (let i = 0; i < data.rows.length; i++) {\r\n          const item = data.rows.item(i);\r\n          orderDetails.push({\r\n            id: item.OrderDetailID,\r\n            orderId: item.OrderID,\r\n            productId: item.ProductID,\r\n            quantity: item.Quantity,\r\n            size: item.Size,\r\n            milkType: item.MilkType,\r\n            price: item.Price,\r\n            name: item.Name || 'Producto desconocido',\r\n            image: item.ImageURL || 'assets/default-product-image.jpg'\r\n          });\r\n        }\r\n        return orderDetails;\r\n      })\r\n    );\r\n  }\r\n\r\n  updateOrderStatus(orderId: number, status: string): Observable<boolean> {\r\n    return new Observable(observer => {\r\n      const sql = 'UPDATE Orders SET Status = ? WHERE OrderID = ?';\r\n      this.database.executeSql(sql, [status, orderId])\r\n        .then(() => {\r\n          observer.next(true);\r\n          observer.complete();\r\n        })\r\n        .catch(e => observer.error(e));\r\n    });\r\n  }\r\n\r\n  updateProduct(product: Product): Observable<boolean> {\r\n    return new Observable(observer => {\r\n      const sql = 'UPDATE Products SET Name = ?, Description = ?, Price = ?, Category = ?, ImageURL = ?, IsAvailable = ? WHERE ProductID = ?';\r\n      const data = [product.name, product.description, product.price, product.category, product.imageURL, product.isAvailable ? 1 : 0, product.id];\r\n      \r\n      this.database.executeSql(sql, data)\r\n        .then(() => {\r\n          observer.next(true);\r\n          observer.complete();\r\n        })\r\n        .catch(e => observer.error(e));\r\n    });\r\n  }\r\n\r\n\r\n  deleteProduct(id: number): Promise<boolean> | Observable<any> {\r\n    return from(this.database.executeSql('DELETE FROM Products WHERE ProductID = ?', [id]))\r\n      .pipe(\r\n        map(() => {\r\n          this.getAllProducts();\r\n          return true;\r\n        })\r\n      );\r\n  }\r\n  public updateUserFromDb(user: User): Promise<boolean> {\r\n    const sql = 'UPDATE Users SET Username = ?, Name = ?, Email = ? WHERE UserID = ?';\r\n    const data = [user.Username, user.Name, user.Email, user.UserID];\r\n  \r\n    const result = new Observable<boolean>(observer => {\r\n      this.database.executeSql(sql, data)\r\n        .then(() => {\r\n          observer.next(true);\r\n          observer.complete();\r\n        })\r\n        .catch(error => {\r\n          observer.error(error);\r\n        });\r\n    });\r\n  \r\n    return result.pipe(\r\n      map(() => true),\r\n      catchError(() => of(false))\r\n    )\r\n    .toPromise()\r\n    .then(res => res !== undefined ? res : false);\r\n  }\r\n  \r\n\r\n  deleteUser(userId: number): Observable<boolean> {\r\n    return from(this.database.executeSql('DELETE FROM Users WHERE UserID = ?', [userId])).pipe(\r\n      map(result => result.rowsAffected > 0),\r\n      catchError(error => {\r\n        console.error('Error deleting user:', error);\r\n        return of(false);\r\n      })\r\n    );\r\n  }\r\n\r\n  updateUserLastLogin(userId: number): Observable<boolean> {\r\n    return new Observable(observer => {\r\n      const sql = 'UPDATE Users SET LastLogin = CURRENT_TIMESTAMP WHERE UserID = ?';\r\n      this.database.executeSql(sql, [userId])\r\n        .then(() => {\r\n          observer.next(true);\r\n          observer.complete();\r\n        })\r\n        .catch(e => observer.error(e));\r\n    });\r\n  }\r\n\r\n  getUserById(id: number): Observable<User> {\r\n    return new Observable(observer => {\r\n      const sql = 'SELECT * FROM Users WHERE UserID = ?';\r\n      this.database.executeSql(sql, [id])\r\n        .then(data => {\r\n          if (data.rows.length > 0) {\r\n            observer.next(data.rows.item(0));\r\n          } else {\r\n            observer.error('User not found');\r\n          }\r\n          observer.complete();\r\n        })\r\n        .catch(e => observer.error(e));\r\n    });\r\n  }\r\n\r\n  getUserByEmail(email: string): Observable<User | null> {\r\n    return from(this.database.executeSql('SELECT * FROM Users WHERE Email = ?', [email])).pipe(\r\n      map(data => {\r\n        if (data.rows.length > 0) {\r\n          return {\r\n            UserID: data.rows.item(0).UserID,\r\n            Username: data.rows.item(0).Username,\r\n            Password: data.rows.item(0).Password,\r\n            Role: data.rows.item(0).Role,\r\n            Name: data.rows.item(0).Name,\r\n            Email: data.rows.item(0).Email,\r\n            PhoneNumber: data.rows.item(0).PhoneNumber,\r\n            HireDate: data.rows.item(0).HireDate ? new Date(data.rows.item(0).HireDate) : undefined,\r\n            LastLogin: data.rows.item(0).LastLogin ? new Date(data.rows.item(0).LastLogin) : undefined,\r\n            ApprovalStatus: data.rows.item(0).ApprovalStatus\r\n          };\r\n        }\r\n        return null;\r\n      })\r\n    );\r\n  }\r\n  updateUserPassword(userId: number, currentPassword: string, newPassword: string): Observable<boolean> {\r\n    const sql = 'UPDATE Users SET Password = ? WHERE UserID = ? AND Password = ?';\r\n    const data = [newPassword, userId, currentPassword];\r\n  \r\n    return new Observable(observer => {\r\n      this.database.executeSql(sql, data)\r\n        .then(() => {\r\n          observer.next(true);  // Si la operación fue exitosa\r\n          observer.complete();\r\n        })\r\n        .catch(error => {\r\n          observer.error(error);  // Si hay un error, lo emitimos\r\n        });\r\n    });\r\n  }\r\n\r\n\r\ninsertSeedData(): Observable<boolean> {\r\n    const users = [\r\n      { username: 'Admin Carlos', password: 'admin123', role: 'admin', name: 'Carlos', email: 'admin@cafeteria.com', approvalStatus: 'approved' },\r\n      { username: 'Empleado', password: 'emp123', role: 'employee', name: 'Emp 1', email: 'empleado1@cafeteria.com', approvalStatus: 'approved' }\r\n    ];\r\n  \r\n    const products = [\r\n      { name: 'Café Americano', description: 'Café negro tradicional', price: 2500, category: 'Bebidas calientes', imageURL: 'americano.jpg', isAvailable: true },\r\n      { name: 'Cappuccino', description: 'Espresso con leche espumosa', price: 3000, category: 'Bebidas calientes', imageURL: 'cappuccino.jpg', isAvailable: true },\r\n      { name: 'Latte', description: 'Café con leche cremosa', price: 3200, category: 'Bebidas calientes', imageURL: 'latte.jpg', isAvailable: true },\r\n    ];\r\n  \r\n    return forkJoin([\r\n      ...users.map(user => \r\n        from(this.database.executeSql(\r\n          'INSERT OR IGNORE INTO Users (Username, Password, Role, Name, Email, ApprovalStatus) VALUES (?, ?, ?, ?, ?, ?)', \r\n          [user.username, user.password, user.role, user.name, user.email, user.approvalStatus]\r\n        ))\r\n      ),\r\n      ...products.map(product => \r\n        from(this.database.executeSql(\r\n          'INSERT OR IGNORE INTO Products (Name, Description, Price, Category, ImageURL, IsAvailable) VALUES (?, ?, ?, ?, ?, ?)', \r\n          [product.name, product.description, product.price, product.category, product.imageURL, product.isAvailable ? 1 : 0]\r\n        ))\r\n      )\r\n    ]).pipe(\r\n      map(() => true),\r\n      catchError(error => {\r\n        console.error('Error in insertSeedData:', error);\r\n        return of(false);\r\n      })\r\n    );\r\n  }\r\n\r\n  getOrderCountForToday(): Promise<number> {\r\n    return new Promise((resolve, reject) => {\r\n      const today = new Date().toISOString().split('T')[0];\r\n      const query = `SELECT COUNT(*) as count FROM Orders WHERE DATE(CreatedAt) = ?`;\r\n      this.database.executeSql(query, [today]).then(data => {\r\n        resolve(data.rows.item(0).count);\r\n      }, err => {\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n  getActiveEmployeesCount(): Promise<number> {\r\n    return new Promise((resolve, reject) => {\r\n      const query = `SELECT COUNT(*) as count FROM Users WHERE Role = 'employee' AND LastLogin IS NOT NULL`;\r\n      this.database.executeSql(query, []).then(data => {\r\n        resolve(data.rows.item(0).count);\r\n      }, err => {\r\n        reject(err);\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  async getProductDetails(productName: string): Promise<any> {\r\n    const query = `\r\n      SELECT \r\n        p.Name as name,\r\n        SUM(od.Quantity) as totalSold,\r\n        SUM(od.Quantity * od.Price) as totalRevenue,\r\n        p.Stock as currentStock\r\n      FROM Products p\r\n      LEFT JOIN OrderDetails od ON p.ProductID = od.ProductID\r\n      WHERE p.Name = ?\r\n      GROUP BY p.ProductID\r\n    `;\r\n    \r\n    try {\r\n      const result = await this.database.executeSql(query, [productName]);\r\n      if (result.rows.length > 0) {\r\n        return result.rows.item(0);\r\n      } else {\r\n        throw new Error('Producto no encontrado');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al obtener detalles del producto:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async updateUserProfilePicture(userId: number, profilePicture: string): Promise<boolean> {\r\n    const query = 'UPDATE Users SET ProfilePicture = ? WHERE UserID = ?';\r\n    try {\r\n      const result = await this.database.executeSql(query, [profilePicture, userId]);\r\n      console.log(`Foto de perfil actualizada para el usuario ${userId}`);\r\n      return result.rowsAffected > 0;\r\n    } catch (error) {\r\n      console.error('Error updating profile picture:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  getUserProfilePicture(userId: number): Observable<string | null> {\r\n    return from(this.database.executeSql('SELECT ProfilePicture FROM Users WHERE UserID = ?', [userId])).pipe(\r\n      map(data => {\r\n        if (data.rows.length > 0) {\r\n          const profilePicture = data.rows.item(0).ProfilePicture;\r\n          console.log(`Foto de perfil para usuario ${userId}:`, profilePicture);\r\n          return profilePicture;\r\n        }\r\n        return null;\r\n      }),\r\n      catchError(error => {\r\n        console.error(`Error al obtener la foto de perfil para el usuario ${userId}:`, error);\r\n        return of(null);\r\n      })\r\n    );\r\n  }\r\n\r\n  async saveProfilePicture(userId: number, imageData: string): Promise<string> {\r\n    const fileName = `profile_${userId}_${new Date().getTime()}.jpg`;\r\n    const savedFile = await Filesystem.writeFile({\r\n      path: fileName,\r\n      data: imageData,\r\n      directory: Directory.Data\r\n    });\r\n\r\n    // Guarda la ruta en la base de datos\r\n    await this.database.executeSql(\r\n      'UPDATE Users SET ProfilePicture = ? WHERE UserID = ?',\r\n      [savedFile.uri, userId]\r\n    );\r\n\r\n    return savedFile.uri;\r\n  }\r\n\r\n    async getProfilePicture(userId: number): Promise<string | null> {\r\n    const data = await this.database.executeSql(\r\n      'SELECT ProfilePicture FROM Users WHERE UserID = ?',\r\n      [userId]\r\n    );\r\n    if (data.rows.length > 0) {\r\n      const profilePicturePath = data.rows.item(0).ProfilePicture;\r\n      if (profilePicturePath) {\r\n        const readFile = await Filesystem.readFile({\r\n          path: profilePicturePath,\r\n          directory: Directory.Data\r\n        });\r\n        return `data:image/jpeg;base64,${readFile.data}`;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n\r\n  async removeDuplicateProducts() {\r\n    const query = `\r\n      DELETE FROM Products\r\n      WHERE ProductID NOT IN (\r\n        SELECT MIN(ProductID)\r\n        FROM Products\r\n        GROUP BY Name\r\n      )\r\n    `;\r\n    await this.database.executeSql(query, []);\r\n  }\r\n  \r\n  updatePassword(userId: number, newPassword: string): Observable<boolean> {\r\n    const sql = 'UPDATE Users SET Password = ? WHERE UserID = ?';\r\n    return new Observable(observer => {\r\n      this.database.executeSql(sql, [newPassword, userId])\r\n        .then(result => {\r\n          observer.next(result.rowsAffected > 0);\r\n          observer.complete();\r\n        })\r\n        .catch(error => {\r\n          observer.error(error);\r\n        });\r\n    });\r\n  }\r\n  \r\n}\r\n\r\n",
        "email.service.spec.ts": "",
        "email.service.ts": "// email.service.ts\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, from } from 'rxjs';\r\nimport { EmailResult } from '../models/email.interface';\r\nimport emailjs from '@emailjs/browser';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class EmailService {\r\n  constructor() {\r\n    // Inicializar EmailJS\r\n    emailjs.init(\"DKpjvXERVCYX9x65l\");\r\n  }\r\n\r\n  sendVerificationCode(to: string, code: string): Observable<EmailResult> {\r\n    const templateParams = {\r\n      to_email: to,\r\n      code: code,\r\n      from_name: \"CaffeManagement\",\r\n      subject: \"Código de verificación\"\r\n    };\r\n\r\n    return from(\r\n      emailjs.send(\r\n        'service_ilwn599',\r\n        'template_okp70bp',\r\n        templateParams,\r\n        'DKpjvXERVCYX9x65l'\r\n      ).then(() => ({\r\n        messageId: Date.now().toString(),\r\n        success: true\r\n      })).catch(error => ({\r\n        messageId: '',\r\n        success: false,\r\n        error: error.text\r\n      }))\r\n    );\r\n  }\r\n}\r\n"
      }
    }
  }
}