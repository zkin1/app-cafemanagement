"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1849],{1849:(y,m,s)=>{s.r(m),s.d(m,{PerfilPageModule:()=>O});var C=s(177),c=s(9417),a=s(4742),f=s(5563),d=s(467),P=s(8359),p=s(1985),h=s(6354),e=s(4438),M=s(9011);const b=[{path:"",component:(()=>{var i;class l{constructor(n,o,t,r,g){this.databaseService=n,this.toastController=o,this.loadingController=t,this.alertController=r,this.router=g,this.showToast=!1,this.toastMessage="",this.usuario={},this.datosContrasena={contrasenaActual:"",nuevaContrasena:"",confirmarContrasena:""},this.esAdmin=!1,this.subscriptions=new P.yU}ngOnInit(){this.cargarPerfilUsuario()}ngOnDestroy(){this.subscriptions.unsubscribe()}cargarPerfilUsuario(){var n=this;return(0,d.A)(function*(){const o=yield n.loadingController.create({message:"Cargando perfil..."});yield o.present();try{const t=n.obtenerIdUsuarioActual();if(!t)throw new Error("No se encontr\xf3 un usuario activo");n.usuario=yield n.getUserById(t),n.esAdmin="admin"===n.usuario.Role,console.log("Usuario cargado:",n.usuario),console.log("Es admin:",n.esAdmin)}catch(t){console.error("Error al cargar el perfil del usuario:",t),yield n.presentToast("Error al cargar el perfil. Por favor, intente de nuevo."),n.router.navigate(["/login"])}finally{yield o.dismiss()}})()}getUserById(n){const o=this.databaseService.getUserById(n);return o instanceof p.c?o.toPromise().then(t=>{if(void 0!==t)return t;throw new Error("User not found")}):Promise.resolve(void 0!==o?o:Promise.reject("User not found"))}updatePerfil(){var n=this;return(0,d.A)(function*(){const o=yield n.loadingController.create({message:"Actualizando perfil..."});yield o.present();try{const t=n.usuario.Role;if(!(yield n.updateUser(n.usuario)))throw new Error("No se pudo actualizar el perfil");n.usuario.Role=t,yield n.presentToast("Perfil actualizado con \xe9xito")}catch(t){console.error("Error al actualizar el perfil:",t),yield n.presentToast("Error al actualizar el perfil. Por favor, intente de nuevo.")}finally{yield o.dismiss()}})()}updateUser(n){const o=this.databaseService.updateUserFromDb(n);return o instanceof p.c?o.pipe((0,h.T)(()=>!0)).toPromise().then(t=>void 0!==t&&t):Promise.resolve(!0)}cambiarContrasena(){var n=this;return(0,d.A)(function*(){n.datosContrasena.nuevaContrasena===n.datosContrasena.confirmarContrasena?yield(yield n.alertController.create({header:"Confirmar cambio de contrase\xf1a",message:"\xbfEst\xe1s seguro de que quieres cambiar tu contrase\xf1a?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:()=>{n.realizarCambioContrasena()}}]})).present():yield n.presentToast("Las contrase\xf1as no coinciden")})()}realizarCambioContrasena(){var n=this;return(0,d.A)(function*(){const o=yield n.loadingController.create({message:"Cambiando contrase\xf1a..."});yield o.present();try{if(!(yield n.updateUserPassword(n.usuario.UserID,n.datosContrasena.contrasenaActual,n.datosContrasena.nuevaContrasena)))throw new Error("No se pudo cambiar la contrase\xf1a");yield n.presentToast("Contrase\xf1a cambiada con \xe9xito"),n.datosContrasena={contrasenaActual:"",nuevaContrasena:"",confirmarContrasena:""}}catch(t){console.error("Error al cambiar la contrase\xf1a:",t),yield n.presentToast("Error al cambiar la contrase\xf1a. Por favor, intente de nuevo.")}finally{yield o.dismiss()}})()}updateUserPassword(n,o,t){const r=this.databaseService.updateUserPassword(n,o,t);return r instanceof p.c?r.toPromise().then(g=>void 0!==g&&g):Promise.resolve(!1)}presentToast(n){var o=this;return(0,d.A)(function*(){yield(yield o.toastController.create({message:n,duration:2e3,position:"top"})).present()})()}obtenerIdUsuarioActual(){const n=localStorage.getItem("currentUser");return n?JSON.parse(n).id:null}logout(){var n=this;return(0,d.A)(function*(){yield(yield n.alertController.create({header:"Cerrar sesi\xf3n",message:"\xbfEst\xe1s seguro de que quieres cerrar sesi\xf3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"S\xed, cerrar sesi\xf3n",handler:()=>{localStorage.removeItem("currentUser"),n.router.navigate(["/login"])}}]})).present()})()}ionViewWillLeave(){}}return(i=l).\u0275fac=function(n){return new(n||i)(e.rXU(M.B),e.rXU(a.K_),e.rXU(a.Xi),e.rXU(a.hG),e.rXU(f.Ix))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-perfil"]],decls:50,vars:9,consts:[["slot","start"],["defaultHref","/"],[1,"ion-padding"],[3,"ngSubmit"],["position","floating"],["name","name","required","",3,"ngModelChange","ngModel"],["name","email","type","email","required","",3,"ngModelChange","ngModel"],["readonly","",3,"value"],["expand","block","type","submit",1,"ion-margin-top"],["name","contrasenaActual","type","password","required","",3,"ngModelChange","ngModel"],["name","nuevaContrasena","type","password","required","",3,"ngModelChange","ngModel"],["name","confirmarContrasena","type","password","required","",3,"ngModelChange","ngModel"],["expand","block","color","danger",1,"ion-margin-top",3,"click"],["position","top","color","success",3,"isOpen","message","duration"]],template:function(n,o){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Mi Perfil"),e.k0s()()(),e.j41(6,"ion-content",2)(7,"ion-card")(8,"ion-card-header")(9,"ion-card-title"),e.EFF(10,"Informaci\xf3n Personal"),e.k0s()(),e.j41(11,"ion-card-content")(12,"form",3),e.bIt("ngSubmit",function(){return o.updatePerfil()}),e.j41(13,"ion-item")(14,"ion-label",4),e.EFF(15,"Nombre"),e.k0s(),e.j41(16,"ion-input",5),e.mxI("ngModelChange",function(r){return e.DH7(o.usuario.Name,r)||(o.usuario.Name=r),r}),e.k0s()(),e.j41(17,"ion-item")(18,"ion-label",4),e.EFF(19,"Email"),e.k0s(),e.j41(20,"ion-input",6),e.mxI("ngModelChange",function(r){return e.DH7(o.usuario.Email,r)||(o.usuario.Email=r),r}),e.k0s()(),e.j41(21,"ion-item")(22,"ion-label",4),e.EFF(23,"Rol"),e.k0s(),e.nrm(24,"ion-input",7),e.k0s(),e.j41(25,"ion-button",8),e.EFF(26,"Actualizar Perfil"),e.k0s()()()(),e.j41(27,"ion-card")(28,"ion-card-header")(29,"ion-card-title"),e.EFF(30,"Cambiar Contrase\xf1a"),e.k0s()(),e.j41(31,"ion-card-content")(32,"form",3),e.bIt("ngSubmit",function(){return o.cambiarContrasena()}),e.j41(33,"ion-item")(34,"ion-label",4),e.EFF(35,"Contrase\xf1a Actual"),e.k0s(),e.j41(36,"ion-input",9),e.mxI("ngModelChange",function(r){return e.DH7(o.datosContrasena.contrasenaActual,r)||(o.datosContrasena.contrasenaActual=r),r}),e.k0s()(),e.j41(37,"ion-item")(38,"ion-label",4),e.EFF(39,"Nueva Contrase\xf1a"),e.k0s(),e.j41(40,"ion-input",10),e.mxI("ngModelChange",function(r){return e.DH7(o.datosContrasena.nuevaContrasena,r)||(o.datosContrasena.nuevaContrasena=r),r}),e.k0s()(),e.j41(41,"ion-item")(42,"ion-label",4),e.EFF(43,"Confirmar Nueva Contrase\xf1a"),e.k0s(),e.j41(44,"ion-input",11),e.mxI("ngModelChange",function(r){return e.DH7(o.datosContrasena.confirmarContrasena,r)||(o.datosContrasena.confirmarContrasena=r),r}),e.k0s()(),e.j41(45,"ion-button",8),e.EFF(46,"Cambiar Contrase\xf1a"),e.k0s()()()(),e.j41(47,"ion-button",12),e.bIt("click",function(){return o.logout()}),e.EFF(48," Cerrar Sesi\xf3n "),e.k0s()(),e.nrm(49,"ion-toast",13)),2&n&&(e.R7$(16),e.R50("ngModel",o.usuario.Name),e.R7$(4),e.R50("ngModel",o.usuario.Email),e.R7$(4),e.Y8G("value","admin"===o.usuario.Role?"Administrador":"Empleado"),e.R7$(12),e.R50("ngModel",o.datosContrasena.contrasenaActual),e.R7$(4),e.R50("ngModel",o.datosContrasena.nuevaContrasena),e.R7$(4),e.R50("ngModel",o.datosContrasena.confirmarContrasena),e.R7$(5),e.Y8G("isOpen",o.showToast)("message",o.toastMessage)("duration",3e3))},dependencies:[c.qT,c.BC,c.cb,c.YS,c.vS,c.cV,a.Jm,a.QW,a.b_,a.I9,a.ME,a.tN,a.W9,a.eU,a.$w,a.uz,a.he,a.BC,a.op,a.ai,a.Gw,a.el],styles:["[_nghost-%COMP%]{--ion-color-primary: #3880ff;--ion-color-secondary: #3dc2ff;--ion-color-tertiary: #5260ff;--ion-color-success: #2dd36f;--ion-color-warning: #ffc409;--ion-color-danger: #eb445a;--ion-color-medium: #92949c;--ion-color-light: #f4f5f8}ion-content[_ngcontent-%COMP%]{--background: #f4f5f8}.profile-header[_ngcontent-%COMP%]{background-color:#f0f0f0;padding:30px 20px;text-align:center;color:#333}.profile-header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%;margin:0 auto 20px;border:4px solid #ffffff;overflow:hidden}.profile-header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:24px;font-weight:700;color:#333}.profile-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0 0;font-size:16px;color:#666}.profile-content[_ngcontent-%COMP%]{padding:20px}ion-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:20px;background-color:#fff}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background-color:#f0f0f0;border-bottom:1px solid #e0e0e0}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#333}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:16px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;--background: transparent}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#333;font-size:14px}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 0;font-size:16px;color:#333}ion-button[_ngcontent-%COMP%]{margin-top:20px;--background: #5c9ce5;--background-hover: #4a90e2;--color: #ffffff;--border-radius: 8px}@media (max-width: 576px){.profile-header[_ngcontent-%COMP%]{padding:20px}.profile-header[_ngcontent-%COMP%]   .profile-image[_ngcontent-%COMP%]{width:100px;height:100px}.profile-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px}.profile-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:16px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:13px}ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{font-size:15px}}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}ion-card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .3s ease-out}.profile-header[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .5s ease-out}"]}),l})()}];let _=(()=>{var i;class l{}return(i=l).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[f.iI.forChild(b),f.iI]}),l})(),O=(()=>{var i;class l{}return(i=l).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[C.MD,c.YN,a.bv,_]}),l})()}}]);