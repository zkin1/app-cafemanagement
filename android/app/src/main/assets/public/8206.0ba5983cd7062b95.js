"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8206],{8206:(y,p,l)=>{l.r(p),l.d(p,{CarroComprasPageModule:()=>b});var O=l(177),m=l(9417),n=l(4742),g=l(5563),u=l(467),e=l(4438),f=l(9011);function M(o,c){if(1&o&&(e.j41(0,"ion-item")(1,"ion-thumbnail",0),e.nrm(2,"img",13),e.k0s(),e.j41(3,"ion-label")(4,"h2"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s(),e.j41(8,"p"),e.EFF(9),e.k0s()(),e.j41(10,"ion-note",10),e.EFF(11),e.k0s()()),2&o){const a=c.$implicit;e.R7$(2),e.Y8G("src",a.image,e.B4B)("alt",a.name),e.R7$(3),e.JRh(a.name),e.R7$(2),e.Lme("",a.selectedSize,", leche de ",a.selectedMilk,""),e.R7$(2),e.SpI("Cantidad: ",a.quantity,""),e.R7$(2),e.SpI("$",(a.finalPrice*a.quantity).toFixed(0),"")}}const P=[{path:"",component:(()=>{var o;class c{constructor(t,r,i,s,C){this.router=t,this.databaseService=r,this.toastController=i,this.loadingController=s,this.alertController=C,this.showToast=!1,this.toastMessage="",this.currentOrder={orderNumber:0,id:0,userId:0,tableNumber:null,status:"Solicitado",notes:"",totalAmount:0,paymentMethod:"",items:[]},this.currentOrderItems=[]}ngOnInit(){this.loadOrder()}loadOrder(){const t=JSON.parse(localStorage.getItem("currentOrder")||"null");t?(this.currentOrder.id=t.orderNumber,this.currentOrder.items=t.items,this.currentOrderItems=t.items):this.router.navigate(["/main"]),this.calculateTotal()}calculateTotal(){return this.currentOrder.totalAmount=this.currentOrderItems.reduce((t,r)=>t+r.finalPrice*r.quantity,0),this.currentOrder.totalAmount}updateQuantity(t,r){var i=this;return(0,u.A)(function*(){t.quantity+=r,t.quantity<=0?yield i.removeItem(t):(i.calculateTotal(),i.updateLocalStorage())})()}removeItem(t){var r=this;return(0,u.A)(function*(){yield(yield r.alertController.create({header:"Confirmar eliminaci\xf3n",message:`\xbfEst\xe1 seguro de que desea eliminar ${t.name} de su orden?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",handler:()=>{const s=r.currentOrderItems.indexOf(t);s>-1&&(r.currentOrderItems.splice(s,1),r.calculateTotal(),r.updateLocalStorage(),r.presentToast("Producto eliminado de la orden"))}}]})).present()})()}updateLocalStorage(){localStorage.setItem("currentOrder",JSON.stringify({orderNumber:this.currentOrder.id,items:this.currentOrderItems}))}confirmarOrden(){var t=this;return(0,u.A)(function*(){if(0===t.currentOrderItems.length)return void(yield t.presentToast("No hay productos en la orden. A\xf1ada productos antes de confirmar."));if(null===t.currentOrder.tableNumber)return void(yield t.presentToast("Por favor, seleccione un n\xfamero de mesa antes de confirmar la orden."));const r=yield t.loadingController.create({message:"Procesando orden..."});yield r.present();try{const i=JSON.parse(localStorage.getItem("currentUser")||"{}");t.currentOrder.userId=i.id;const s={userId:t.currentOrder.userId,orderNumber:t.currentOrder.orderNumber,tableNumber:t.currentOrder.tableNumber,status:"Solicitado",notes:t.currentOrder.notes,totalAmount:t.calculateTotal(),paymentMethod:""},C=yield t.databaseService.createOrder(s);for(const d of t.currentOrderItems){const _={orderId:C,productId:d.id,quantity:d.quantity,size:d.selectedSize,milkType:d.selectedMilk,price:d.finalPrice};yield t.databaseService.addProductToOrder(_)}yield r.dismiss(),yield t.presentToast("Orden confirmada con \xe9xito"),localStorage.removeItem("currentOrder"),t.router.navigate(["/main"])}catch(i){console.error("Error al confirmar la orden:",i),yield r.dismiss(),yield t.presentToast("Error al confirmar la orden. Por favor, intente de nuevo.")}})()}presentToast(t){var r=this;return(0,u.A)(function*(){(yield r.toastController.create({message:t,duration:3e3,position:"top"})).present()})()}}return(o=c).\u0275fac=function(t){return new(t||o)(e.rXU(g.Ix),e.rXU(f.B),e.rXU(n.K_),e.rXU(n.Xi),e.rXU(n.hG))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-carro-compras"]],decls:31,vars:8,consts:[["slot","start"],["defaultHref","/main"],[1,"ion-padding"],[1,"cart-items"],[4,"ngFor","ngForOf"],[1,"order-details"],["position","floating"],["type","number",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[1,"totalAmount"],["slot","end","color","primary"],["expand","block",3,"click"],["position","bottom","color","success",3,"isOpen","message","duration"],[3,"src","alt"]],template:function(t,r){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5),e.k0s()()(),e.j41(6,"ion-content",2)(7,"h1"),e.EFF(8,"Resumen de la Orden"),e.k0s(),e.j41(9,"ion-list",3),e.DNE(10,M,12,7,"ion-item",4),e.k0s(),e.j41(11,"div",5)(12,"ion-item")(13,"ion-label",6),e.EFF(14,"N\xfamero de Mesa"),e.k0s(),e.j41(15,"ion-input",7),e.mxI("ngModelChange",function(s){return e.DH7(r.currentOrder.tableNumber,s)||(r.currentOrder.tableNumber=s),s}),e.k0s()(),e.j41(16,"ion-item")(17,"ion-label",6),e.EFF(18,"Nota"),e.k0s(),e.j41(19,"ion-textarea",8),e.mxI("ngModelChange",function(s){return e.DH7(r.currentOrder.notes,s)||(r.currentOrder.notes=s),s}),e.k0s()(),e.j41(20,"ion-item",9)(21,"ion-label")(22,"h2"),e.EFF(23,"Total"),e.k0s()(),e.j41(24,"ion-note",10),e.EFF(25),e.k0s()()()(),e.j41(26,"ion-footer")(27,"ion-toolbar")(28,"ion-button",11),e.bIt("click",function(){return r.confirmarOrden()}),e.EFF(29,"Confirmar Orden"),e.k0s()()(),e.nrm(30,"ion-toast",12)),2&t&&(e.R7$(5),e.SpI("Orden #",r.currentOrder.orderNumber,""),e.R7$(5),e.Y8G("ngForOf",r.currentOrder.items),e.R7$(5),e.R50("ngModel",r.currentOrder.tableNumber),e.R7$(4),e.R50("ngModel",r.currentOrder.notes),e.R7$(6),e.SpI("$",r.calculateTotal().toFixed(0),""),e.R7$(5),e.Y8G("isOpen",r.showToast)("message",r.toastMessage)("duration",3e3))},dependencies:[O.Sq,m.BC,m.vS,n.Jm,n.QW,n.W9,n.M0,n.eU,n.$w,n.uz,n.he,n.nf,n.JI,n.nc,n.Zx,n.BC,n.op,n.ai,n.su,n.Gw,n.el],styles:["[_nghost-%COMP%]{--ion-color-primary: #3880ff;--ion-color-secondary: #3dc2ff;--ion-color-tertiary: #5260ff;--ion-color-success: #2dd36f;--ion-color-warning: #ffc409;--ion-color-danger: #eb445a;--ion-color-medium: #92949c;--ion-color-light: #f4f5f8}ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light)}h1[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:var(--ion-color-dark);margin-bottom:20px}.cart-items[_ngcontent-%COMP%]{background:transparent}.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: #ffffff;--border-radius: 10px;margin-bottom:10px;--padding-start: 0}.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{--size: 80px;--border-radius: 8px;margin-right:16px}.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:var(--ion-color-dark)}.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium)}.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:16px;font-weight:600}.order-details[_ngcontent-%COMP%]{margin-top:20px}.order-details[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: #ffffff;--border-radius: 10px;margin-bottom:10px}.order-details[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{--background: var(--ion-color-light);font-weight:700}.order-details[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;color:var(--ion-color-dark)}.order-details[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:18px;font-weight:600}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: var(--ion-color-light);--border-color: transparent}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:10px}@media (max-width: 576px){.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{--size: 60px}.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:16px}.cart-items[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:14px}.order-details[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .order-details[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:16px}}"]}),c})()}];let h=(()=>{var o;class c{}return(o=c).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[g.iI.forChild(P),g.iI]}),c})(),b=(()=>{var o;class c{}return(o=c).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[O.MD,m.YN,n.bv,h]}),c})()}}]);