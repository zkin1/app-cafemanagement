"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2249],{2249:(I,P,d)=>{d.r(P),d.d(P,{ComandasPageModule:()=>R});var g=d(177),M=d(9417),i=d(4742),O=d(5563),l=d(467),h=d(8359),p=d(1985),u=d(7673),m=d(6354),f=d(9437),C=d(4843),n=d(4438),y=d(9011);function b(e,s){if(1&e&&(n.qex(0),n.EFF(1),n.bVm()),2&e){const o=n.XpG(2).$implicit;n.R7$(),n.SpI(", leche ",o.milkType,"")}}function x(e,s){if(1&e&&(n.j41(0,"span",19),n.EFF(1),n.DNE(2,b,2,1,"ng-container",4),n.EFF(3,") "),n.k0s()),2&e){const o=n.XpG().$implicit;n.R7$(),n.SpI(" (",o.size||"Tama\xf1o est\xe1ndar"," "),n.R7$(),n.Y8G("ngIf",o.milkType)}}function F(e,s){if(1&e&&(n.j41(0,"p"),n.EFF(1),n.DNE(2,x,4,2,"span",17),n.j41(3,"ion-note",18),n.EFF(4),n.nI1(5,"currency"),n.k0s()()),2&e){const o=s.$implicit;n.R7$(),n.Lme(" ",o.name||"Producto desconocido"," x",o.quantity||0," "),n.R7$(),n.Y8G("ngIf",o.size||o.milkType),n.R7$(2),n.JRh(n.ii3(5,4,o.price*o.quantity,"CLP","symbol-narrow","1.0-0"))}}function v(e,s){if(1&e&&(n.j41(0,"p",20),n.nrm(1,"ion-icon",21),n.j41(2,"strong"),n.EFF(3,"Notas:"),n.k0s(),n.EFF(4),n.k0s()),2&e){const o=n.XpG().$implicit;n.R7$(4),n.SpI(" ",o.notes," ")}}function E(e,s){if(1&e){const o=n.RV6();n.j41(0,"ion-card",6)(1,"ion-card-header")(2,"ion-card-title"),n.EFF(3),n.k0s(),n.j41(4,"ion-card-subtitle")(5,"ion-badge",7),n.EFF(6),n.k0s()()(),n.j41(7,"ion-card-content")(8,"div",8),n.DNE(9,F,6,9,"p",9),n.k0s(),n.j41(10,"p",10)(11,"strong"),n.EFF(12,"Total:"),n.k0s(),n.j41(13,"ion-note",11),n.EFF(14),n.nI1(15,"currency"),n.k0s()(),n.DNE(16,v,5,1,"p",12),n.k0s(),n.j41(17,"div",13)(18,"ion-button",14),n.bIt("click",function(){const r=n.eBV(o).$implicit,a=n.XpG();return n.Njj(a.cambiarEstado(r,"En proceso"))}),n.EFF(19," En Proceso "),n.k0s(),n.j41(20,"ion-button",15),n.bIt("click",function(){const r=n.eBV(o).$implicit,a=n.XpG();return n.Njj(a.cambiarEstado(r,"Listo"))}),n.EFF(21," Lista "),n.k0s(),n.j41(22,"ion-button",16),n.bIt("click",function(){const r=n.eBV(o).$implicit,a=n.XpG();return n.Njj(a.cambiarEstado(r,"Cancelado"))}),n.EFF(23," Cancelar "),n.k0s()()()}if(2&e){const o=s.$implicit,t=n.XpG();n.R7$(3),n.Lme("Orden #",o.id||"N/A"," - Mesa ",o.tableNumber||"N/A",""),n.R7$(2),n.Y8G("color","Solicitado"===o.status?"warning":"En proceso"===o.status?"primary":"Listo"===o.status?"success":"danger"),n.R7$(),n.SpI(" ",o.status||"Desconocido"," "),n.R7$(3),n.Y8G("ngForOf",o.items),n.R7$(5),n.JRh(n.ii3(15,10,t.getOrderTotal(o),"CLP","symbol-narrow","1.0-0")),n.R7$(2),n.Y8G("ngIf",o.notes),n.R7$(2),n.Y8G("disabled","Solicitado"!==o.status),n.R7$(2),n.Y8G("disabled","En proceso"!==o.status),n.R7$(2),n.Y8G("disabled","Listo"===o.status||"Cancelado"===o.status)}}function $(e,s){1&e&&(n.j41(0,"ion-item")(1,"ion-label"),n.EFF(2," No hay \xf3rdenes pendientes en este momento. "),n.k0s()())}function T(e,s){if(1&e&&(n.j41(0,"ion-footer")(1,"ion-toolbar")(2,"ion-title"),n.EFF(3),n.k0s()()()),2&e){const o=n.XpG();n.R7$(3),n.SpI("Total de \xf3rdenes: ",o.ordenes.length,"")}}const j=[{path:"",component:(()=>{var e;class s{constructor(t,r,a){this.databaseService=t,this.toastController=r,this.loadingController=a,this.showToast=!1,this.toastMessage="",this.ordenes=[],this.subscriptions=new h.yU}ngOnInit(){this.cargarOrdenes()}ngOnDestroy(){this.subscriptions.unsubscribe()}cargarOrdenes(){var t=this;return(0,l.A)(function*(){const r=yield t.loadingController.create({message:"Cargando \xf3rdenes..."});yield r.present();try{const a=yield t.getOrdersByStatus(["Solicitado","En proceso","Listo"]);t.ordenes=a,yield t.cargarDetallesOrdenes()}catch(a){console.error("Error al cargar \xf3rdenes:",a),t.presentToast("Error al cargar \xf3rdenes. Por favor, intente de nuevo.")}finally{yield r.dismiss()}})()}getOrdersByStatus(t){const r=this.databaseService.getOrdersByStatus(t);return r instanceof p.c?(0,C._)(r.pipe((0,m.T)(a=>a||[]),(0,f.W)(()=>(0,u.of)([])))):Promise.resolve(r||[])}cargarDetallesOrdenes(){var t=this;return(0,l.A)(function*(){const r=t.ordenes.map(function(){var a=(0,l.A)(function*(c){try{const _=yield t.getOrderDetails(c.id);return c.items=_,c}catch(_){return console.error(`Error al cargar detalles para la orden ${c.id}:`,_),c}});return function(c){return a.apply(this,arguments)}}());try{t.ordenes=yield Promise.all(r),console.log("\xd3rdenes con detalles:",t.ordenes)}catch(a){console.error("Error al cargar detalles de \xf3rdenes:",a)}})()}getOrderDetails(t){var r=this;return(0,l.A)(function*(){try{const a=r.databaseService.getOrderDetails(t);return a instanceof p.c?yield(0,C._)(a.pipe((0,m.T)(c=>c||[]),(0,f.W)(()=>(0,u.of)([])))):a||[]}catch(a){return console.error(`Error al obtener detalles de la orden ${t}:`,a),[]}})()}cambiarEstado(t,r){var a=this;return(0,l.A)(function*(){if(t.id)try{yield a.updateOrderStatus(t.id,r),t.status=r,a.presentToast(`Orden #${t.id} actualizada a ${r}`),("Entregado"===r||"Cancelado"===r)&&(yield a.cargarOrdenes())}catch(c){console.error("Error al actualizar estado de la orden:",c),a.presentToast("Error al actualizar el estado. Por favor, intente de nuevo.")}else a.presentToast("Error: ID de orden no v\xe1lido")})()}updateOrderStatus(t,r){var a=this;return(0,l.A)(function*(){const c=a.databaseService.updateOrderStatus(t,r);c instanceof p.c&&(yield(0,C._)(c.pipe((0,m.T)(()=>{}),(0,f.W)(()=>(0,u.of)(void 0)))))})()}presentToast(t){var r=this;return(0,l.A)(function*(){yield(yield r.toastController.create({message:t,duration:2e3,position:"top"})).present()})()}getOrderTotal(t){var r;return(null===(r=t.items)||void 0===r?void 0:r.reduce((a,c)=>a+(c.price||0)*(c.quantity||0),0))||0}}return(e=s).\u0275fac=function(t){return new(t||e)(n.rXU(y.B),n.rXU(i.K_),n.rXU(i.Xi))},e.\u0275cmp=n.VBU({type:e,selectors:[["app-comandas"]],decls:11,vars:6,consts:[["slot","start"],["defaultHref","/"],[1,"ion-padding"],["class","orden-card",4,"ngFor","ngForOf"],[4,"ngIf"],["position","top","color","success",3,"isOpen","message","duration"],[1,"orden-card"],[3,"color"],[1,"items-list"],[4,"ngFor","ngForOf"],[1,"total-amount"],["slot","end","color","primary"],["class","notes",4,"ngIf"],[1,"action-buttons"],["color","primary",3,"click","disabled"],["color","success",3,"click","disabled"],["color","danger",3,"click","disabled"],["class","item-details",4,"ngIf"],["slot","end"],[1,"item-details"],[1,"notes"],["name","create-outline"]],template:function(t,r){1&t&&(n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),n.nrm(3,"ion-back-button",1),n.k0s(),n.j41(4,"ion-title"),n.EFF(5,"Comandas"),n.k0s()()(),n.j41(6,"ion-content",2),n.DNE(7,E,24,15,"ion-card",3)(8,$,3,0,"ion-item",4),n.k0s(),n.DNE(9,T,4,1,"ion-footer",4),n.nrm(10,"ion-toast",5)),2&t&&(n.R7$(7),n.Y8G("ngForOf",r.ordenes),n.R7$(),n.Y8G("ngIf",0===r.ordenes.length),n.R7$(),n.Y8G("ngIf",r.ordenes.length>0),n.R7$(),n.Y8G("isOpen",r.showToast)("message",r.toastMessage)("duration",3e3))},dependencies:[g.Sq,g.bT,i.In,i.Jm,i.QW,i.b_,i.I9,i.ME,i.HW,i.tN,i.W9,i.M0,i.eU,i.iq,i.uz,i.he,i.JI,i.BC,i.op,i.ai,i.el,g.oe],styles:["[_nghost-%COMP%]{--ion-color-primary: #3880ff;--ion-color-secondary: #3dc2ff;--ion-color-tertiary: #5260ff;--ion-color-success: #2dd36f;--ion-color-warning: #ffc409;--ion-color-danger: #eb445a;--ion-color-medium: #92949c;--ion-color-light: #f4f5f8}ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light)}.orden-card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 4px 6px #0000001a;background-color:#fff}.orden-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background-color:var(--ion-color-light);padding:16px}.orden-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:var(--ion-color-dark)}.orden-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-top:8px}.orden-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:12px;padding:4px 8px;border-radius:4px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:16px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]{margin-bottom:12px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;font-size:14px;color:var(--ion-color-dark)}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);font-style:italic;margin-left:8px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{font-weight:700;font-size:16px;color:var(--ion-color-dark);margin-top:12px;border-top:1px solid var(--ion-color-light);padding-top:12px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .nota[_ngcontent-%COMP%]{font-style:italic;font-size:14px;color:var(--ion-color-medium);margin-top:12px;display:flex;align-items:center}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .nota[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}.orden-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-around;padding:0 16px 16px}.orden-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 20px;font-size:14px;margin:0 4px}@media (max-width: 576px){.orden-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:16px}.orden-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:10px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .items-list[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]   .item-details[_ngcontent-%COMP%]{font-size:11px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{font-size:15px}.orden-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .nota[_ngcontent-%COMP%]{font-size:13px}.orden-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{flex-direction:column}.orden-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-bottom:8px;font-size:12px}}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.orden-card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-out}"]}),s})()}];let k=(()=>{var e;class s{}return(e=s).\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.$C({type:e}),e.\u0275inj=n.G2t({imports:[O.iI.forChild(j),O.iI]}),s})(),R=(()=>{var e;class s{}return(e=s).\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.$C({type:e}),e.\u0275inj=n.G2t({imports:[g.MD,M.YN,i.bv,k]}),s})()}}]);