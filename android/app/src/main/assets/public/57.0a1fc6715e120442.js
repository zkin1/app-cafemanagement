"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[57],{57:(j,m,d)=>{d.r(m),d.d(m,{MainPageModule:()=>R});var _=d(177),g=d(9417),a=d(4742),u=d(5563),h=d(467),l=function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n}(l||{});function P(n,e){return{type:l.Trigger,name:n,definitions:e,options:{}}}function f(n,e=null){return{type:l.Animate,styles:e,timings:n}}function p(n){return{type:l.Style,styles:n,offset:null}}function y(n,e,i=null){return{type:l.Transition,expr:n,animation:e,options:i}}var t=d(4438),S=d(9011);function I(n,e){if(1&n&&(t.j41(0,"ion-badge"),t.EFF(1),t.k0s()),2&n){const i=t.XpG();t.R7$(),t.JRh(i.currentOrderItems.length)}}function b(n,e){if(1&n){const i=t.RV6();t.j41(0,"ion-card",18)(1,"ion-card-content")(2,"ion-item")(3,"ion-label",19),t.EFF(4,"Tama\xf1o"),t.k0s(),t.j41(5,"ion-select",20),t.mxI("ngModelChange",function(r){t.eBV(i);const s=t.XpG().$implicit;return t.DH7(s.selectedSize,r)||(s.selectedSize=r),t.Njj(r)}),t.bIt("ionChange",function(){t.eBV(i);const r=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.updatePrice(r))}),t.j41(6,"ion-select-option",21),t.EFF(7,"Peque\xf1o (-$1.000)"),t.k0s(),t.j41(8,"ion-select-option",22),t.EFF(9,"Mediano"),t.k0s(),t.j41(10,"ion-select-option",23),t.EFF(11,"Grande (+$1.000)"),t.k0s()()(),t.j41(12,"ion-item")(13,"ion-label",19),t.EFF(14,"Tipo de leche"),t.k0s(),t.j41(15,"ion-select",24),t.mxI("ngModelChange",function(r){t.eBV(i);const s=t.XpG().$implicit;return t.DH7(s.selectedMilk,r)||(s.selectedMilk=r),t.Njj(r)}),t.j41(16,"ion-select-option",25),t.EFF(17,"Regular"),t.k0s(),t.j41(18,"ion-select-option",26),t.EFF(19,"Descremada"),t.k0s(),t.j41(20,"ion-select-option",27),t.EFF(21,"Soya"),t.k0s(),t.j41(22,"ion-select-option",28),t.EFF(23,"Almendra"),t.k0s()()(),t.j41(24,"ion-button",16),t.bIt("click",function(){t.eBV(i);const r=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.addToCart(r))}),t.EFF(25,"A\xf1adir al Carrito"),t.k0s()()()}if(2&n){const i=t.XpG().$implicit;t.Y8G("@slideInOut",void 0),t.R7$(5),t.R50("ngModel",i.selectedSize),t.R7$(10),t.R50("ngModel",i.selectedMilk)}}function v(n,e){if(1&n){const i=t.RV6();t.j41(0,"ion-col",12)(1,"ion-card",13)(2,"img",14),t.bIt("error",function(r){t.eBV(i);const s=t.XpG(2);return t.Njj(s.handleImageError(r))}),t.k0s(),t.j41(3,"ion-card-header")(4,"ion-card-title"),t.EFF(5),t.k0s()(),t.j41(6,"ion-card-content")(7,"p"),t.EFF(8),t.k0s(),t.j41(9,"ion-text",15)(10,"h2"),t.EFF(11),t.nI1(12,"currency"),t.k0s()(),t.j41(13,"ion-button",16),t.bIt("click",function(){const r=t.eBV(i).index,s=t.XpG(2);return t.Njj(s.toggleOptions(r))}),t.EFF(14),t.k0s()()(),t.DNE(15,b,26,3,"ion-card",17),t.k0s()}if(2&n){const i=e.$implicit,o=t.XpG(2);t.R7$(2),t.Y8G("src",i.imageURL,t.B4B)("alt",i.name||"Imagen del producto"),t.R7$(3),t.JRh(i.name||"Producto sin nombre"),t.R7$(3),t.JRh(i.description||"Sin descripci\xf3n disponible"),t.R7$(3),t.JRh(t.ii3(12,7,o.calculatePrice(i),"CLP","symbol-narrow","1.0-0")),t.R7$(3),t.SpI(" ",i.showOptions?"Ocultar opciones":"Personalizar y A\xf1adir"," "),t.R7$(),t.Y8G("ngIf",i.showOptions)}}function E(n,e){if(1&n&&(t.j41(0,"ion-row"),t.DNE(1,v,16,12,"ion-col",11),t.k0s()),2&n){const i=t.XpG();t.R7$(),t.Y8G("ngForOf",i.products)}}function w(n,e){1&n&&(t.j41(0,"ion-col")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),t.EFF(4,"No hay productos disponibles"),t.k0s()(),t.j41(5,"ion-card-content")(6,"p"),t.EFF(7,"Lo sentimos, no hay productos disponibles en este momento. Por favor, intente m\xe1s tarde."),t.k0s()()()())}const k=[{path:"",component:(()=>{var n;class e{constructor(o,r,s,c){this.router=o,this.databaseService=r,this.toastController=s,this.loadingController=c,this.products=[],this.currentOrderNumber=1,this.currentOrderItems=[],this.isLoading=!1,this.showToast=!1,this.toastMessage=""}ngOnInit(){var o=this;return(0,h.A)(function*(){yield o.loadProducts()})()}loadProducts(){var o=this;return(0,h.A)(function*(){const r=yield o.loadingController.create({message:"Cargando productos..."});yield r.present();try{const s=yield o.getAllProducts();console.log("Productos obtenidos de la base de datos:",s),o.products=s.map(c=>({...c,imageURL:c.imageURL?`assets/${c.imageURL}`:"assets/default-product-image.jpg",showOptions:!1,selectedSize:"medium",selectedMilk:"regular"})),console.log("Productos procesados con URLs de imagen actualizadas:",o.products)}catch(s){console.error("Error al cargar los productos:",s),o.presentToast("Error al cargar los productos. Por favor, intente de nuevo.")}finally{yield r.dismiss()}})()}getAllProducts(){return new Promise((o,r)=>{this.databaseService.getAllProducts().subscribe({next:s=>{console.log("Productos recibidos del servicio:",s),o(s)},error:s=>{console.error("Error al obtener productos:",s),r(s)}})})}get isLoggedIn(){return!!localStorage.getItem("currentUser")}get currentUserName(){const o=localStorage.getItem("currentUser");return o&&JSON.parse(o).name||null}toggleOptions(o){this.products[o].showOptions=!this.products[o].showOptions}calculatePrice(o){let r=o.price;return"peque\xf1o"===o.selectedSize?r-=1e3:"grande"===o.selectedSize&&(r+=1e3),r}updatePrice(o){}addToCart(o){var r=this;return(0,h.A)(function*(){if(!r.isLoggedIn)return yield r.presentToast("Por favor, inicia sesi\xf3n para a\xf1adir productos al carrito"),void r.router.navigate(["/login"]);const s=r.currentOrderItems.findIndex(c=>c.id===o.id&&c.selectedSize===o.selectedSize&&c.selectedMilk===o.selectedMilk);-1!==s?r.currentOrderItems[s].quantity+=1:r.currentOrderItems.push({...o,quantity:1,finalPrice:r.calculatePrice(o),image:o.imageURL}),o.showOptions=!1,yield r.presentToast(`${o.name} (${o.selectedSize}, ${o.selectedMilk}) a\xf1adido a la orden #${r.currentOrderNumber}`),r.updateLocalStorage()})()}updateLocalStorage(){localStorage.setItem("currentOrder",JSON.stringify({orderNumber:this.currentOrderNumber,items:this.currentOrderItems}))}completeOrder(){var o=this;return(0,h.A)(function*(){0!==o.currentOrderItems.length?(o.updateLocalStorage(),o.router.navigate(["/carro-compras"])):yield o.presentToast("El carrito est\xe1 vac\xedo. A\xf1ada productos antes de completar la orden.")})()}presentToast(o){var r=this;return(0,h.A)(function*(){(yield r.toastController.create({message:o,duration:2e3,position:"top"})).present()})()}updateQuantity(o,r){const s=this.currentOrderItems.findIndex(c=>c.id===o.id&&c.selectedSize===o.selectedSize&&c.selectedMilk===o.selectedMilk);-1!==s&&(this.currentOrderItems[s].quantity+=r,this.currentOrderItems[s].quantity<=0&&this.currentOrderItems.splice(s,1)),this.updateLocalStorage()}getQuantityInCart(o){const r=this.currentOrderItems.find(s=>s.id===o.id&&s.selectedSize===o.selectedSize&&s.selectedMilk===o.selectedMilk);return r?r.quantity:0}handleImageError(o){o.target.src="assets/default-product-image.jpg"}}return(n=e).\u0275fac=function(o){return new(o||n)(t.rXU(u.Ix),t.rXU(S.B),t.rXU(a.K_),t.rXU(a.Xi))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-main"]],decls:23,vars:9,consts:[["noProducts",""],["slot","start"],["slot","end"],["routerLink","/carro-compras"],["name","cart-outline","aria-hidden","true"],[4,"ngIf"],[1,"sr-only"],[1,"menu-container"],[4,"ngIf","ngIfElse"],["expand","block","routerLink","/carro-compras",3,"disabled"],["position","top","color","primary",3,"isOpen","message","duration"],["size","12","size-md","6","size-lg","4",4,"ngFor","ngForOf"],["size","12","size-md","6","size-lg","4"],[1,"product-card"],[3,"error","src","alt"],["color","primary"],["expand","block",3,"click"],["class","options-card",4,"ngIf"],[1,"options-card"],["position","stacked"],["interface","popover","placeholder","Seleccione un tama\xf1o",3,"ngModelChange","ionChange","ngModel"],["value","peque\xf1o"],["value","medium"],["value","grande"],["interface","popover","placeholder","Seleccione un tipo de leche",3,"ngModelChange","ngModel"],["value","regular"],["value","descremada"],["value","soya"],["value","almendra"]],template:function(o,r){if(1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title"),t.EFF(5),t.k0s(),t.j41(6,"ion-buttons",2)(7,"ion-button",3),t.nrm(8,"ion-icon",4),t.DNE(9,I,2,1,"ion-badge",5),t.j41(10,"span",6),t.EFF(11,"Carrito de compras"),t.k0s()()()()(),t.j41(12,"ion-content")(13,"div",7)(14,"ion-grid"),t.DNE(15,E,2,1,"ion-row",8)(16,w,8,0,"ng-template",null,0,t.C5r),t.k0s()()(),t.j41(18,"ion-footer")(19,"ion-toolbar")(20,"ion-button",9),t.EFF(21),t.k0s()()(),t.nrm(22,"ion-toast",10)),2&o){const s=t.sdS(17);t.R7$(5),t.SpI("Men\xfa - Orden #",r.currentOrderNumber||"Nueva",""),t.R7$(4),t.Y8G("ngIf",r.currentOrderItems&&r.currentOrderItems.length>0),t.R7$(6),t.Y8G("ngIf",r.products&&r.products.length>0)("ngIfElse",s),t.R7$(5),t.Y8G("disabled",!r.currentOrderItems||0===r.currentOrderItems.length),t.R7$(),t.SpI(" Completar Orden (",(null==r.currentOrderItems?null:r.currentOrderItems.length)||0," items) "),t.R7$(),t.Y8G("isOpen",r.showToast)("message",r.toastMessage)("duration",3e3)}},dependencies:[_.Sq,_.bT,g.BC,g.vS,a.In,a.Jm,a.QW,a.b_,a.I9,a.ME,a.tN,a.hU,a.W9,a.M0,a.lO,a.eU,a.iq,a.uz,a.he,a.MC,a.ln,a.Nm,a.Ip,a.IO,a.BC,a.op,a.ai,a.Je,a.N7,u.Wk,_.oe],styles:["[_nghost-%COMP%]{--ion-color-primary: #3880ff;--ion-color-secondary: #3dc2ff;--ion-color-tertiary: #5260ff;--ion-color-success: #2dd36f;--ion-color-warning: #ffc409;--ion-color-danger: #eb445a;--ion-color-medium: #92949c;--ion-color-light: #f4f5f8}.menu-container[_ngcontent-%COMP%]{padding:16px}.product-card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:10px;box-shadow:0 4px 6px #0000001a;overflow:hidden}.product-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover}.product-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding:16px}.product-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700}.product-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0 16px 16px}.product-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:var(--ion-color-medium);margin-bottom:10px}.product-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;margin:10px 0;color:var(--ion-color-success)}.product-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:10px}.options-card[_ngcontent-%COMP%]{margin-top:-10px;border-top-left-radius:0;border-top-right-radius:0;box-shadow:0 4px 6px #0000001a}.options-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:16px}.options-card[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}.options-card[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{width:100%;max-width:100%}.options-card[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:16px}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--padding-top: 0;--padding-bottom: 0;--padding-start: 16px;--padding-end: 16px}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:10px 0}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.product-card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-out}@media (max-width: 576px){.product-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.1rem}.product-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem}.product-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.3rem}}ion-badge[_ngcontent-%COMP%]{position:absolute;top:5px;right:5px;font-size:12px;padding:2px 4px;border-radius:50%}"],data:{animation:[P("slideInOut",[y(":enter",[p({transform:"translateY(100%)"}),f("200ms ease-out",p({transform:"translateY(0%)"}))]),y(":leave",[f("200ms ease-in",p({transform:"translateY(100%)"}))])])]}}),e})()}];let D=(()=>{var n;class e{}return(n=e).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[u.iI.forChild(k),u.iI]}),e})(),R=(()=>{var n;class e{}return(n=e).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[_.MD,g.YN,a.bv,D,u.iI]}),e})()}}]);